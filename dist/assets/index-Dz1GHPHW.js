var YI=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var lG=YI((hG,KI)=>{function XI(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function QI(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var sE={exports:{}},wd={},oE={exports:{}},Oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Du=Symbol.for("react.element"),JI=Symbol.for("react.portal"),ZI=Symbol.for("react.fragment"),eR=Symbol.for("react.strict_mode"),tR=Symbol.for("react.profiler"),nR=Symbol.for("react.provider"),rR=Symbol.for("react.context"),iR=Symbol.for("react.forward_ref"),sR=Symbol.for("react.suspense"),oR=Symbol.for("react.memo"),aR=Symbol.for("react.lazy"),d0=Symbol.iterator;function uR(n){return n===null||typeof n!="object"?null:(n=d0&&n[d0]||n["@@iterator"],typeof n=="function"?n:null)}var aE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uE=Object.assign,lE={};function na(n,e,t){this.props=n,this.context=e,this.refs=lE,this.updater=t||aE}na.prototype.isReactComponent={};na.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};na.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function cE(){}cE.prototype=na.prototype;function $g(n,e,t){this.props=n,this.context=e,this.refs=lE,this.updater=t||aE}var Gg=$g.prototype=new cE;Gg.constructor=$g;uE(Gg,na.prototype);Gg.isPureReactComponent=!0;var f0=Array.isArray,dE=Object.prototype.hasOwnProperty,Wg={current:null},fE={key:!0,ref:!0,__self:!0,__source:!0};function hE(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)dE.call(e,r)&&!fE.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var u=Array(a),l=0;l<a;l++)u[l]=arguments[l+2];i.children=u}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Du,type:n,key:s,ref:o,props:i,_owner:Wg.current}}function lR(n,e){return{$$typeof:Du,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Vg(n){return typeof n=="object"&&n!==null&&n.$$typeof===Du}function cR(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var h0=/\/+/g;function xf(n,e){return typeof n=="object"&&n!==null&&n.key!=null?cR(""+n.key):e.toString(36)}function Vl(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Du:case JI:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+xf(o,0):r,f0(i)?(t="",n!=null&&(t=n.replace(h0,"$&/")+"/"),Vl(i,e,t,"",function(l){return l})):i!=null&&(Vg(i)&&(i=lR(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(h0,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",f0(n))for(var a=0;a<n.length;a++){s=n[a];var u=r+xf(s,a);o+=Vl(s,e,t,u,i)}else if(u=uR(n),typeof u=="function")for(n=u.call(n),a=0;!(s=n.next()).done;)s=s.value,u=r+xf(s,a++),o+=Vl(s,e,t,u,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Ju(n,e,t){if(n==null)return n;var r=[],i=0;return Vl(n,r,"","",function(s){return e.call(t,s,i++)}),r}function dR(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var cn={current:null},Hl={transition:null},fR={ReactCurrentDispatcher:cn,ReactCurrentBatchConfig:Hl,ReactCurrentOwner:Wg};function pE(){throw Error("act(...) is not supported in production builds of React.")}Oe.Children={map:Ju,forEach:function(n,e,t){Ju(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Ju(n,function(){e++}),e},toArray:function(n){return Ju(n,function(e){return e})||[]},only:function(n){if(!Vg(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Oe.Component=na;Oe.Fragment=ZI;Oe.Profiler=tR;Oe.PureComponent=$g;Oe.StrictMode=eR;Oe.Suspense=sR;Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fR;Oe.act=pE;Oe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=uE({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Wg.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(u in e)dE.call(e,u)&&!fE.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=t;else if(1<u){a=Array(u);for(var l=0;l<u;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:Du,type:n.type,key:i,ref:s,props:r,_owner:o}};Oe.createContext=function(n){return n={$$typeof:rR,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:nR,_context:n},n.Consumer=n};Oe.createElement=hE;Oe.createFactory=function(n){var e=hE.bind(null,n);return e.type=n,e};Oe.createRef=function(){return{current:null}};Oe.forwardRef=function(n){return{$$typeof:iR,render:n}};Oe.isValidElement=Vg;Oe.lazy=function(n){return{$$typeof:aR,_payload:{_status:-1,_result:n},_init:dR}};Oe.memo=function(n,e){return{$$typeof:oR,type:n,compare:e===void 0?null:e}};Oe.startTransition=function(n){var e=Hl.transition;Hl.transition={};try{n()}finally{Hl.transition=e}};Oe.unstable_act=pE;Oe.useCallback=function(n,e){return cn.current.useCallback(n,e)};Oe.useContext=function(n){return cn.current.useContext(n)};Oe.useDebugValue=function(){};Oe.useDeferredValue=function(n){return cn.current.useDeferredValue(n)};Oe.useEffect=function(n,e){return cn.current.useEffect(n,e)};Oe.useId=function(){return cn.current.useId()};Oe.useImperativeHandle=function(n,e,t){return cn.current.useImperativeHandle(n,e,t)};Oe.useInsertionEffect=function(n,e){return cn.current.useInsertionEffect(n,e)};Oe.useLayoutEffect=function(n,e){return cn.current.useLayoutEffect(n,e)};Oe.useMemo=function(n,e){return cn.current.useMemo(n,e)};Oe.useReducer=function(n,e,t){return cn.current.useReducer(n,e,t)};Oe.useRef=function(n){return cn.current.useRef(n)};Oe.useState=function(n){return cn.current.useState(n)};Oe.useSyncExternalStore=function(n,e,t){return cn.current.useSyncExternalStore(n,e,t)};Oe.useTransition=function(){return cn.current.useTransition()};Oe.version="18.3.1";oE.exports=Oe;var X=oE.exports;const Qe=QI(X),hR=XI({__proto__:null,default:Qe},[X]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pR=X,gR=Symbol.for("react.element"),mR=Symbol.for("react.fragment"),vR=Object.prototype.hasOwnProperty,yR=pR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xR={key:!0,ref:!0,__self:!0,__source:!0};function gE(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)vR.call(e,r)&&!xR.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:gR,type:n,key:s,ref:o,props:i,_owner:yR.current}}wd.Fragment=mR;wd.jsx=gE;wd.jsxs=gE;sE.exports=wd;var H=sE.exports,mE={exports:{}},Un={},vE={exports:{}},yE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(D,P){var O=D.length;D.push(P);e:for(;0<O;){var K=O-1>>>1,Y=D[K];if(0<i(Y,P))D[K]=P,D[O]=Y,O=K;else break e}}function t(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var P=D[0],O=D.pop();if(O!==P){D[0]=O;e:for(var K=0,Y=D.length,ee=Y>>>1;K<ee;){var ne=2*(K+1)-1,ie=D[ne],se=ne+1,ye=D[se];if(0>i(ie,O))se<Y&&0>i(ye,ie)?(D[K]=ye,D[se]=O,K=se):(D[K]=ie,D[ne]=O,K=ne);else if(se<Y&&0>i(ye,O))D[K]=ye,D[se]=O,K=se;else break e}}return P}function i(D,P){var O=D.sortIndex-P.sortIndex;return O!==0?O:D.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var u=[],l=[],c=1,d=null,f=3,h=!1,p=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(D){for(var P=t(l);P!==null;){if(P.callback===null)r(l);else if(P.startTime<=D)r(l),P.sortIndex=P.expirationTime,e(u,P);else break;P=t(l)}}function E(D){if(g=!1,x(D),!p)if(t(u)!==null)p=!0,B(b);else{var P=t(l);P!==null&&$(E,P.startTime-D)}}function b(D,P){p=!1,g&&(g=!1,v(T),T=-1),h=!0;var O=f;try{for(x(P),d=t(u);d!==null&&(!(d.expirationTime>P)||D&&!A());){var K=d.callback;if(typeof K=="function"){d.callback=null,f=d.priorityLevel;var Y=K(d.expirationTime<=P);P=n.unstable_now(),typeof Y=="function"?d.callback=Y:d===t(u)&&r(u),x(P)}else r(u);d=t(u)}if(d!==null)var ee=!0;else{var ne=t(l);ne!==null&&$(E,ne.startTime-P),ee=!1}return ee}finally{d=null,f=O,h=!1}}var S=!1,w=null,T=-1,R=5,_=-1;function A(){return!(n.unstable_now()-_<R)}function k(){if(w!==null){var D=n.unstable_now();_=D;var P=!0;try{P=w(!0,D)}finally{P?G():(S=!1,w=null)}}else S=!1}var G;if(typeof y=="function")G=function(){y(k)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,M=U.port2;U.port1.onmessage=k,G=function(){M.postMessage(null)}}else G=function(){m(k,0)};function B(D){w=D,S||(S=!0,G())}function $(D,P){T=m(function(){D(n.unstable_now())},P)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_continueExecution=function(){p||h||(p=!0,B(b))},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(D){switch(f){case 1:case 2:case 3:var P=3;break;default:P=f}var O=f;f=P;try{return D()}finally{f=O}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(D,P){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var O=f;f=D;try{return P()}finally{f=O}},n.unstable_scheduleCallback=function(D,P,O){var K=n.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?K+O:K):O=K,D){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=O+Y,D={id:c++,callback:P,priorityLevel:D,startTime:O,expirationTime:Y,sortIndex:-1},O>K?(D.sortIndex=O,e(l,D),t(u)===null&&D===t(l)&&(g?(v(T),T=-1):g=!0,$(E,O-K))):(D.sortIndex=Y,e(u,D),p||h||(p=!0,B(b))),D},n.unstable_shouldYield=A,n.unstable_wrapCallback=function(D){var P=f;return function(){var O=f;f=P;try{return D.apply(this,arguments)}finally{f=O}}}})(yE);vE.exports=yE;var ER=vE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bR=X,Bn=ER;function te(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var xE=new Set,Xa={};function Ws(n,e){Go(n,e),Go(n+"Capture",e)}function Go(n,e){for(Xa[n]=e,n=0;n<e.length;n++)xE.add(e[n])}var li=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qh=Object.prototype.hasOwnProperty,SR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p0={},g0={};function wR(n){return qh.call(g0,n)?!0:qh.call(p0,n)?!1:SR.test(n)?g0[n]=!0:(p0[n]=!0,!1)}function TR(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function _R(n,e,t,r){if(e===null||typeof e>"u"||TR(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function dn(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var zt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){zt[n]=new dn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];zt[e]=new dn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){zt[n]=new dn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){zt[n]=new dn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){zt[n]=new dn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){zt[n]=new dn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){zt[n]=new dn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){zt[n]=new dn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){zt[n]=new dn(n,5,!1,n.toLowerCase(),null,!1,!1)});var Hg=/[\-:]([a-z])/g;function zg(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Hg,zg);zt[e]=new dn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Hg,zg);zt[e]=new dn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Hg,zg);zt[e]=new dn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){zt[n]=new dn(n,1,!1,n.toLowerCase(),null,!1,!1)});zt.xlinkHref=new dn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){zt[n]=new dn(n,1,!1,n.toLowerCase(),null,!0,!0)});function jg(n,e,t,r){var i=zt.hasOwnProperty(e)?zt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(_R(e,t,i,r)&&(t=null),r||i===null?wR(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var pi=bR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zu=Symbol.for("react.element"),co=Symbol.for("react.portal"),fo=Symbol.for("react.fragment"),Kg=Symbol.for("react.strict_mode"),Yh=Symbol.for("react.profiler"),EE=Symbol.for("react.provider"),bE=Symbol.for("react.context"),qg=Symbol.for("react.forward_ref"),Xh=Symbol.for("react.suspense"),Qh=Symbol.for("react.suspense_list"),Yg=Symbol.for("react.memo"),Ai=Symbol.for("react.lazy"),SE=Symbol.for("react.offscreen"),m0=Symbol.iterator;function fa(n){return n===null||typeof n!="object"?null:(n=m0&&n[m0]||n["@@iterator"],typeof n=="function"?n:null)}var ht=Object.assign,Ef;function ka(n){if(Ef===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Ef=e&&e[1]||""}return`
`+Ef+n}var bf=!1;function Sf(n,e){if(!n||bf)return"";bf=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(n,[],e)}else{try{e.call()}catch(l){r=l}n.call(e.prototype)}else{try{throw Error()}catch(l){r=l}n()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var u=`
`+i[o].replace(" at new "," at ");return n.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",n.displayName)),u}while(1<=o&&0<=a);break}}}finally{bf=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?ka(n):""}function IR(n){switch(n.tag){case 5:return ka(n.type);case 16:return ka("Lazy");case 13:return ka("Suspense");case 19:return ka("SuspenseList");case 0:case 2:case 15:return n=Sf(n.type,!1),n;case 11:return n=Sf(n.type.render,!1),n;case 1:return n=Sf(n.type,!0),n;default:return""}}function Jh(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case fo:return"Fragment";case co:return"Portal";case Yh:return"Profiler";case Kg:return"StrictMode";case Xh:return"Suspense";case Qh:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case bE:return(n.displayName||"Context")+".Consumer";case EE:return(n._context.displayName||"Context")+".Provider";case qg:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Yg:return e=n.displayName||null,e!==null?e:Jh(n.type)||"Memo";case Ai:e=n._payload,n=n._init;try{return Jh(n(e))}catch{}}return null}function RR(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Jh(e);case 8:return e===Kg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ji(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function wE(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function CR(n){var e=wE(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function el(n){n._valueTracker||(n._valueTracker=CR(n))}function TE(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=wE(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function hc(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Zh(n,e){var t=e.checked;return ht({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function v0(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Ji(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function _E(n,e){e=e.checked,e!=null&&jg(n,"checked",e,!1)}function ep(n,e){_E(n,e);var t=Ji(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?tp(n,e.type,t):e.hasOwnProperty("defaultValue")&&tp(n,e.type,Ji(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function y0(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function tp(n,e,t){(e!=="number"||hc(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var La=Array.isArray;function To(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Ji(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function np(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(te(91));return ht({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function x0(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(te(92));if(La(t)){if(1<t.length)throw Error(te(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Ji(t)}}function IE(n,e){var t=Ji(e.value),r=Ji(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function E0(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function RE(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rp(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?RE(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var tl,CE=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(tl=tl||document.createElement("div"),tl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=tl.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Qa(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Na={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},AR=["Webkit","ms","Moz","O"];Object.keys(Na).forEach(function(n){AR.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Na[e]=Na[n]})});function AE(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Na.hasOwnProperty(n)&&Na[n]?(""+e).trim():e+"px"}function kE(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=AE(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var kR=ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ip(n,e){if(e){if(kR[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(te(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(te(62))}}function sp(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var op=null;function Xg(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ap=null,_o=null,Io=null;function b0(n){if(n=Nu(n)){if(typeof ap!="function")throw Error(te(280));var e=n.stateNode;e&&(e=Cd(e),ap(n.stateNode,n.type,e))}}function LE(n){_o?Io?Io.push(n):Io=[n]:_o=n}function DE(){if(_o){var n=_o,e=Io;if(Io=_o=null,b0(n),e)for(n=0;n<e.length;n++)b0(e[n])}}function PE(n,e){return n(e)}function OE(){}var wf=!1;function NE(n,e,t){if(wf)return n(e,t);wf=!0;try{return PE(n,e,t)}finally{wf=!1,(_o!==null||Io!==null)&&(OE(),DE())}}function Ja(n,e){var t=n.stateNode;if(t===null)return null;var r=Cd(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(te(231,e,typeof t));return t}var up=!1;if(li)try{var ha={};Object.defineProperty(ha,"passive",{get:function(){up=!0}}),window.addEventListener("test",ha,ha),window.removeEventListener("test",ha,ha)}catch{up=!1}function LR(n,e,t,r,i,s,o,a,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(c){this.onError(c)}}var Fa=!1,pc=null,gc=!1,lp=null,DR={onError:function(n){Fa=!0,pc=n}};function PR(n,e,t,r,i,s,o,a,u){Fa=!1,pc=null,LR.apply(DR,arguments)}function OR(n,e,t,r,i,s,o,a,u){if(PR.apply(this,arguments),Fa){if(Fa){var l=pc;Fa=!1,pc=null}else throw Error(te(198));gc||(gc=!0,lp=l)}}function Vs(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function FE(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function S0(n){if(Vs(n)!==n)throw Error(te(188))}function NR(n){var e=n.alternate;if(!e){if(e=Vs(n),e===null)throw Error(te(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return S0(i),n;if(s===r)return S0(i),e;s=s.sibling}throw Error(te(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(te(189))}}if(t.alternate!==r)throw Error(te(190))}if(t.tag!==3)throw Error(te(188));return t.stateNode.current===t?n:e}function ME(n){return n=NR(n),n!==null?BE(n):null}function BE(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=BE(n);if(e!==null)return e;n=n.sibling}return null}var UE=Bn.unstable_scheduleCallback,w0=Bn.unstable_cancelCallback,FR=Bn.unstable_shouldYield,MR=Bn.unstable_requestPaint,yt=Bn.unstable_now,BR=Bn.unstable_getCurrentPriorityLevel,Qg=Bn.unstable_ImmediatePriority,$E=Bn.unstable_UserBlockingPriority,mc=Bn.unstable_NormalPriority,UR=Bn.unstable_LowPriority,GE=Bn.unstable_IdlePriority,Td=null,Mr=null;function $R(n){if(Mr&&typeof Mr.onCommitFiberRoot=="function")try{Mr.onCommitFiberRoot(Td,n,void 0,(n.current.flags&128)===128)}catch{}}var hr=Math.clz32?Math.clz32:VR,GR=Math.log,WR=Math.LN2;function VR(n){return n>>>=0,n===0?32:31-(GR(n)/WR|0)|0}var nl=64,rl=4194304;function Da(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function vc(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=Da(a):(s&=o,s!==0&&(r=Da(s)))}else o=t&~i,o!==0?r=Da(o):s!==0&&(r=Da(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-hr(e),i=1<<t,r|=n[t],e&=~i;return r}function HR(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zR(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-hr(s),a=1<<o,u=i[o];u===-1?(!(a&t)||a&r)&&(i[o]=HR(a,e)):u<=e&&(n.expiredLanes|=a),s&=~a}}function cp(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function WE(){var n=nl;return nl<<=1,!(nl&4194240)&&(nl=64),n}function Tf(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Pu(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-hr(e),n[e]=t}function jR(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-hr(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function Jg(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-hr(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var ze=0;function VE(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var HE,Zg,zE,jE,KE,dp=!1,il=[],$i=null,Gi=null,Wi=null,Za=new Map,eu=new Map,Pi=[],KR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function T0(n,e){switch(n){case"focusin":case"focusout":$i=null;break;case"dragenter":case"dragleave":Gi=null;break;case"mouseover":case"mouseout":Wi=null;break;case"pointerover":case"pointerout":Za.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":eu.delete(e.pointerId)}}function pa(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Nu(e),e!==null&&Zg(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function qR(n,e,t,r,i){switch(e){case"focusin":return $i=pa($i,n,e,t,r,i),!0;case"dragenter":return Gi=pa(Gi,n,e,t,r,i),!0;case"mouseover":return Wi=pa(Wi,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return Za.set(s,pa(Za.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,eu.set(s,pa(eu.get(s)||null,n,e,t,r,i)),!0}return!1}function qE(n){var e=Es(n.target);if(e!==null){var t=Vs(e);if(t!==null){if(e=t.tag,e===13){if(e=FE(t),e!==null){n.blockedOn=e,KE(n.priority,function(){zE(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function zl(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=fp(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);op=r,t.target.dispatchEvent(r),op=null}else return e=Nu(t),e!==null&&Zg(e),n.blockedOn=t,!1;e.shift()}return!0}function _0(n,e,t){zl(n)&&t.delete(e)}function YR(){dp=!1,$i!==null&&zl($i)&&($i=null),Gi!==null&&zl(Gi)&&(Gi=null),Wi!==null&&zl(Wi)&&(Wi=null),Za.forEach(_0),eu.forEach(_0)}function ga(n,e){n.blockedOn===e&&(n.blockedOn=null,dp||(dp=!0,Bn.unstable_scheduleCallback(Bn.unstable_NormalPriority,YR)))}function tu(n){function e(i){return ga(i,n)}if(0<il.length){ga(il[0],n);for(var t=1;t<il.length;t++){var r=il[t];r.blockedOn===n&&(r.blockedOn=null)}}for($i!==null&&ga($i,n),Gi!==null&&ga(Gi,n),Wi!==null&&ga(Wi,n),Za.forEach(e),eu.forEach(e),t=0;t<Pi.length;t++)r=Pi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Pi.length&&(t=Pi[0],t.blockedOn===null);)qE(t),t.blockedOn===null&&Pi.shift()}var Ro=pi.ReactCurrentBatchConfig,yc=!0;function XR(n,e,t,r){var i=ze,s=Ro.transition;Ro.transition=null;try{ze=1,em(n,e,t,r)}finally{ze=i,Ro.transition=s}}function QR(n,e,t,r){var i=ze,s=Ro.transition;Ro.transition=null;try{ze=4,em(n,e,t,r)}finally{ze=i,Ro.transition=s}}function em(n,e,t,r){if(yc){var i=fp(n,e,t,r);if(i===null)Of(n,e,r,xc,t),T0(n,r);else if(qR(i,n,e,t,r))r.stopPropagation();else if(T0(n,r),e&4&&-1<KR.indexOf(n)){for(;i!==null;){var s=Nu(i);if(s!==null&&HE(s),s=fp(n,e,t,r),s===null&&Of(n,e,r,xc,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else Of(n,e,r,null,t)}}var xc=null;function fp(n,e,t,r){if(xc=null,n=Xg(r),n=Es(n),n!==null)if(e=Vs(n),e===null)n=null;else if(t=e.tag,t===13){if(n=FE(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return xc=n,null}function YE(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(BR()){case Qg:return 1;case $E:return 4;case mc:case UR:return 16;case GE:return 536870912;default:return 16}default:return 16}}var Ni=null,tm=null,jl=null;function XE(){if(jl)return jl;var n,e=tm,t=e.length,r,i="value"in Ni?Ni.value:Ni.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return jl=i.slice(n,1<r?1-r:void 0)}function Kl(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function sl(){return!0}function I0(){return!1}function $n(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?sl:I0,this.isPropagationStopped=I0,this}return ht(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=sl)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=sl)},persist:function(){},isPersistent:sl}),e}var ra={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nm=$n(ra),Ou=ht({},ra,{view:0,detail:0}),JR=$n(Ou),_f,If,ma,_d=ht({},Ou,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rm,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ma&&(ma&&n.type==="mousemove"?(_f=n.screenX-ma.screenX,If=n.screenY-ma.screenY):If=_f=0,ma=n),_f)},movementY:function(n){return"movementY"in n?n.movementY:If}}),R0=$n(_d),ZR=ht({},_d,{dataTransfer:0}),eC=$n(ZR),tC=ht({},Ou,{relatedTarget:0}),Rf=$n(tC),nC=ht({},ra,{animationName:0,elapsedTime:0,pseudoElement:0}),rC=$n(nC),iC=ht({},ra,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),sC=$n(iC),oC=ht({},ra,{data:0}),C0=$n(oC),aC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cC(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=lC[n])?!!e[n]:!1}function rm(){return cC}var dC=ht({},Ou,{key:function(n){if(n.key){var e=aC[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Kl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?uC[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rm,charCode:function(n){return n.type==="keypress"?Kl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Kl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),fC=$n(dC),hC=ht({},_d,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),A0=$n(hC),pC=ht({},Ou,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rm}),gC=$n(pC),mC=ht({},ra,{propertyName:0,elapsedTime:0,pseudoElement:0}),vC=$n(mC),yC=ht({},_d,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),xC=$n(yC),EC=[9,13,27,32],im=li&&"CompositionEvent"in window,Ma=null;li&&"documentMode"in document&&(Ma=document.documentMode);var bC=li&&"TextEvent"in window&&!Ma,QE=li&&(!im||Ma&&8<Ma&&11>=Ma),k0=" ",L0=!1;function JE(n,e){switch(n){case"keyup":return EC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ZE(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ho=!1;function SC(n,e){switch(n){case"compositionend":return ZE(e);case"keypress":return e.which!==32?null:(L0=!0,k0);case"textInput":return n=e.data,n===k0&&L0?null:n;default:return null}}function wC(n,e){if(ho)return n==="compositionend"||!im&&JE(n,e)?(n=XE(),jl=tm=Ni=null,ho=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return QE&&e.locale!=="ko"?null:e.data;default:return null}}var TC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function D0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!TC[n.type]:e==="textarea"}function eb(n,e,t,r){LE(r),e=Ec(e,"onChange"),0<e.length&&(t=new nm("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Ba=null,nu=null;function _C(n){db(n,0)}function Id(n){var e=mo(n);if(TE(e))return n}function IC(n,e){if(n==="change")return e}var tb=!1;if(li){var Cf;if(li){var Af="oninput"in document;if(!Af){var P0=document.createElement("div");P0.setAttribute("oninput","return;"),Af=typeof P0.oninput=="function"}Cf=Af}else Cf=!1;tb=Cf&&(!document.documentMode||9<document.documentMode)}function O0(){Ba&&(Ba.detachEvent("onpropertychange",nb),nu=Ba=null)}function nb(n){if(n.propertyName==="value"&&Id(nu)){var e=[];eb(e,nu,n,Xg(n)),NE(_C,e)}}function RC(n,e,t){n==="focusin"?(O0(),Ba=e,nu=t,Ba.attachEvent("onpropertychange",nb)):n==="focusout"&&O0()}function CC(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Id(nu)}function AC(n,e){if(n==="click")return Id(e)}function kC(n,e){if(n==="input"||n==="change")return Id(e)}function LC(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var mr=typeof Object.is=="function"?Object.is:LC;function ru(n,e){if(mr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!qh.call(e,i)||!mr(n[i],e[i]))return!1}return!0}function N0(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function F0(n,e){var t=N0(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=N0(t)}}function rb(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?rb(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function ib(){for(var n=window,e=hc();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=hc(n.document)}return e}function sm(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function DC(n){var e=ib(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&rb(t.ownerDocument.documentElement,t)){if(r!==null&&sm(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=F0(t,s);var o=F0(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var PC=li&&"documentMode"in document&&11>=document.documentMode,po=null,hp=null,Ua=null,pp=!1;function M0(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;pp||po==null||po!==hc(r)||(r=po,"selectionStart"in r&&sm(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ua&&ru(Ua,r)||(Ua=r,r=Ec(hp,"onSelect"),0<r.length&&(e=new nm("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=po)))}function ol(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var go={animationend:ol("Animation","AnimationEnd"),animationiteration:ol("Animation","AnimationIteration"),animationstart:ol("Animation","AnimationStart"),transitionend:ol("Transition","TransitionEnd")},kf={},sb={};li&&(sb=document.createElement("div").style,"AnimationEvent"in window||(delete go.animationend.animation,delete go.animationiteration.animation,delete go.animationstart.animation),"TransitionEvent"in window||delete go.transitionend.transition);function Rd(n){if(kf[n])return kf[n];if(!go[n])return n;var e=go[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in sb)return kf[n]=e[t];return n}var ob=Rd("animationend"),ab=Rd("animationiteration"),ub=Rd("animationstart"),lb=Rd("transitionend"),cb=new Map,B0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function is(n,e){cb.set(n,e),Ws(e,[n])}for(var Lf=0;Lf<B0.length;Lf++){var Df=B0[Lf],OC=Df.toLowerCase(),NC=Df[0].toUpperCase()+Df.slice(1);is(OC,"on"+NC)}is(ob,"onAnimationEnd");is(ab,"onAnimationIteration");is(ub,"onAnimationStart");is("dblclick","onDoubleClick");is("focusin","onFocus");is("focusout","onBlur");is(lb,"onTransitionEnd");Go("onMouseEnter",["mouseout","mouseover"]);Go("onMouseLeave",["mouseout","mouseover"]);Go("onPointerEnter",["pointerout","pointerover"]);Go("onPointerLeave",["pointerout","pointerover"]);Ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ws("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FC=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pa));function U0(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,OR(r,e,void 0,n),n.currentTarget=null}function db(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],u=a.instance,l=a.currentTarget;if(a=a.listener,u!==s&&i.isPropagationStopped())break e;U0(i,a,l),s=u}else for(o=0;o<r.length;o++){if(a=r[o],u=a.instance,l=a.currentTarget,a=a.listener,u!==s&&i.isPropagationStopped())break e;U0(i,a,l),s=u}}}if(gc)throw n=lp,gc=!1,lp=null,n}function Ze(n,e){var t=e[xp];t===void 0&&(t=e[xp]=new Set);var r=n+"__bubble";t.has(r)||(fb(e,n,2,!1),t.add(r))}function Pf(n,e,t){var r=0;e&&(r|=4),fb(t,n,r,e)}var al="_reactListening"+Math.random().toString(36).slice(2);function iu(n){if(!n[al]){n[al]=!0,xE.forEach(function(t){t!=="selectionchange"&&(FC.has(t)||Pf(t,!1,n),Pf(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[al]||(e[al]=!0,Pf("selectionchange",!1,e))}}function fb(n,e,t,r){switch(YE(e)){case 1:var i=XR;break;case 4:i=QR;break;default:i=em}t=i.bind(null,e,t,n),i=void 0,!up||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Of(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Es(a),o===null)return;if(u=o.tag,u===5||u===6){r=s=o;continue e}a=a.parentNode}}r=r.return}NE(function(){var l=s,c=Xg(t),d=[];e:{var f=cb.get(n);if(f!==void 0){var h=nm,p=n;switch(n){case"keypress":if(Kl(t)===0)break e;case"keydown":case"keyup":h=fC;break;case"focusin":p="focus",h=Rf;break;case"focusout":p="blur",h=Rf;break;case"beforeblur":case"afterblur":h=Rf;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=R0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=eC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=gC;break;case ob:case ab:case ub:h=rC;break;case lb:h=vC;break;case"scroll":h=JR;break;case"wheel":h=xC;break;case"copy":case"cut":case"paste":h=sC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=A0}var g=(e&4)!==0,m=!g&&n==="scroll",v=g?f!==null?f+"Capture":null:f;g=[];for(var y=l,x;y!==null;){x=y;var E=x.stateNode;if(x.tag===5&&E!==null&&(x=E,v!==null&&(E=Ja(y,v),E!=null&&g.push(su(y,E,x)))),m)break;y=y.return}0<g.length&&(f=new h(f,p,null,t,c),d.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",f&&t!==op&&(p=t.relatedTarget||t.fromElement)&&(Es(p)||p[ci]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=t.relatedTarget||t.toElement,h=l,p=p?Es(p):null,p!==null&&(m=Vs(p),p!==m||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=l),h!==p)){if(g=R0,E="onMouseLeave",v="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(g=A0,E="onPointerLeave",v="onPointerEnter",y="pointer"),m=h==null?f:mo(h),x=p==null?f:mo(p),f=new g(E,y+"leave",h,t,c),f.target=m,f.relatedTarget=x,E=null,Es(c)===l&&(g=new g(v,y+"enter",p,t,c),g.target=x,g.relatedTarget=m,E=g),m=E,h&&p)t:{for(g=h,v=p,y=0,x=g;x;x=Xs(x))y++;for(x=0,E=v;E;E=Xs(E))x++;for(;0<y-x;)g=Xs(g),y--;for(;0<x-y;)v=Xs(v),x--;for(;y--;){if(g===v||v!==null&&g===v.alternate)break t;g=Xs(g),v=Xs(v)}g=null}else g=null;h!==null&&$0(d,f,h,g,!1),p!==null&&m!==null&&$0(d,m,p,g,!0)}}e:{if(f=l?mo(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var b=IC;else if(D0(f))if(tb)b=kC;else{b=CC;var S=RC}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=AC);if(b&&(b=b(n,l))){eb(d,b,t,c);break e}S&&S(n,f,l),n==="focusout"&&(S=f._wrapperState)&&S.controlled&&f.type==="number"&&tp(f,"number",f.value)}switch(S=l?mo(l):window,n){case"focusin":(D0(S)||S.contentEditable==="true")&&(po=S,hp=l,Ua=null);break;case"focusout":Ua=hp=po=null;break;case"mousedown":pp=!0;break;case"contextmenu":case"mouseup":case"dragend":pp=!1,M0(d,t,c);break;case"selectionchange":if(PC)break;case"keydown":case"keyup":M0(d,t,c)}var w;if(im)e:{switch(n){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else ho?JE(n,t)&&(T="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(T="onCompositionStart");T&&(QE&&t.locale!=="ko"&&(ho||T!=="onCompositionStart"?T==="onCompositionEnd"&&ho&&(w=XE()):(Ni=c,tm="value"in Ni?Ni.value:Ni.textContent,ho=!0)),S=Ec(l,T),0<S.length&&(T=new C0(T,n,null,t,c),d.push({event:T,listeners:S}),w?T.data=w:(w=ZE(t),w!==null&&(T.data=w)))),(w=bC?SC(n,t):wC(n,t))&&(l=Ec(l,"onBeforeInput"),0<l.length&&(c=new C0("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:l}),c.data=w))}db(d,e)})}function su(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Ec(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Ja(n,t),s!=null&&r.unshift(su(n,s,i)),s=Ja(n,e),s!=null&&r.push(su(n,s,i))),n=n.return}return r}function Xs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function $0(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,u=a.alternate,l=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&l!==null&&(a=l,i?(u=Ja(t,s),u!=null&&o.unshift(su(t,u,a))):i||(u=Ja(t,s),u!=null&&o.push(su(t,u,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var MC=/\r\n?/g,BC=/\u0000|\uFFFD/g;function G0(n){return(typeof n=="string"?n:""+n).replace(MC,`
`).replace(BC,"")}function ul(n,e,t){if(e=G0(e),G0(n)!==e&&t)throw Error(te(425))}function bc(){}var gp=null,mp=null;function vp(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var yp=typeof setTimeout=="function"?setTimeout:void 0,UC=typeof clearTimeout=="function"?clearTimeout:void 0,W0=typeof Promise=="function"?Promise:void 0,$C=typeof queueMicrotask=="function"?queueMicrotask:typeof W0<"u"?function(n){return W0.resolve(null).then(n).catch(GC)}:yp;function GC(n){setTimeout(function(){throw n})}function Nf(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),tu(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);tu(e)}function Vi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function V0(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var ia=Math.random().toString(36).slice(2),kr="__reactFiber$"+ia,ou="__reactProps$"+ia,ci="__reactContainer$"+ia,xp="__reactEvents$"+ia,WC="__reactListeners$"+ia,VC="__reactHandles$"+ia;function Es(n){var e=n[kr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ci]||t[kr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=V0(n);n!==null;){if(t=n[kr])return t;n=V0(n)}return e}n=t,t=n.parentNode}return null}function Nu(n){return n=n[kr]||n[ci],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function mo(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(te(33))}function Cd(n){return n[ou]||null}var Ep=[],vo=-1;function ss(n){return{current:n}}function tt(n){0>vo||(n.current=Ep[vo],Ep[vo]=null,vo--)}function Xe(n,e){vo++,Ep[vo]=n.current,n.current=e}var Zi={},sn=ss(Zi),yn=ss(!1),Ds=Zi;function Wo(n,e){var t=n.type.contextTypes;if(!t)return Zi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function xn(n){return n=n.childContextTypes,n!=null}function Sc(){tt(yn),tt(sn)}function H0(n,e,t){if(sn.current!==Zi)throw Error(te(168));Xe(sn,e),Xe(yn,t)}function hb(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(te(108,RR(n)||"Unknown",i));return ht({},t,r)}function wc(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Zi,Ds=sn.current,Xe(sn,n),Xe(yn,yn.current),!0}function z0(n,e,t){var r=n.stateNode;if(!r)throw Error(te(169));t?(n=hb(n,e,Ds),r.__reactInternalMemoizedMergedChildContext=n,tt(yn),tt(sn),Xe(sn,n)):tt(yn),Xe(yn,t)}var ri=null,Ad=!1,Ff=!1;function pb(n){ri===null?ri=[n]:ri.push(n)}function HC(n){Ad=!0,pb(n)}function os(){if(!Ff&&ri!==null){Ff=!0;var n=0,e=ze;try{var t=ri;for(ze=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ri=null,Ad=!1}catch(i){throw ri!==null&&(ri=ri.slice(n+1)),UE(Qg,os),i}finally{ze=e,Ff=!1}}return null}var yo=[],xo=0,Tc=null,_c=0,jn=[],Kn=0,Ps=null,si=1,oi="";function ps(n,e){yo[xo++]=_c,yo[xo++]=Tc,Tc=n,_c=e}function gb(n,e,t){jn[Kn++]=si,jn[Kn++]=oi,jn[Kn++]=Ps,Ps=n;var r=si;n=oi;var i=32-hr(r)-1;r&=~(1<<i),t+=1;var s=32-hr(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,si=1<<32-hr(e)+i|t<<i|r,oi=s+n}else si=1<<s|t<<i|r,oi=n}function om(n){n.return!==null&&(ps(n,1),gb(n,1,0))}function am(n){for(;n===Tc;)Tc=yo[--xo],yo[xo]=null,_c=yo[--xo],yo[xo]=null;for(;n===Ps;)Ps=jn[--Kn],jn[Kn]=null,oi=jn[--Kn],jn[Kn]=null,si=jn[--Kn],jn[Kn]=null}var On=null,An=null,it=!1,lr=null;function mb(n,e){var t=Xn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function j0(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,On=n,An=Vi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,On=n,An=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ps!==null?{id:si,overflow:oi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Xn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,On=n,An=null,!0):!1;default:return!1}}function bp(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Sp(n){if(it){var e=An;if(e){var t=e;if(!j0(n,e)){if(bp(n))throw Error(te(418));e=Vi(t.nextSibling);var r=On;e&&j0(n,e)?mb(r,t):(n.flags=n.flags&-4097|2,it=!1,On=n)}}else{if(bp(n))throw Error(te(418));n.flags=n.flags&-4097|2,it=!1,On=n}}}function K0(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;On=n}function ll(n){if(n!==On)return!1;if(!it)return K0(n),it=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!vp(n.type,n.memoizedProps)),e&&(e=An)){if(bp(n))throw vb(),Error(te(418));for(;e;)mb(n,e),e=Vi(e.nextSibling)}if(K0(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(te(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){An=Vi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}An=null}}else An=On?Vi(n.stateNode.nextSibling):null;return!0}function vb(){for(var n=An;n;)n=Vi(n.nextSibling)}function Vo(){An=On=null,it=!1}function um(n){lr===null?lr=[n]:lr.push(n)}var zC=pi.ReactCurrentBatchConfig;function va(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(te(309));var r=t.stateNode}if(!r)throw Error(te(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(te(284));if(!t._owner)throw Error(te(290,n))}return n}function cl(n,e){throw n=Object.prototype.toString.call(e),Error(te(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function q0(n){var e=n._init;return e(n._payload)}function yb(n){function e(v,y){if(n){var x=v.deletions;x===null?(v.deletions=[y],v.flags|=16):x.push(y)}}function t(v,y){if(!n)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function i(v,y){return v=Ki(v,y),v.index=0,v.sibling=null,v}function s(v,y,x){return v.index=x,n?(x=v.alternate,x!==null?(x=x.index,x<y?(v.flags|=2,y):x):(v.flags|=2,y)):(v.flags|=1048576,y)}function o(v){return n&&v.alternate===null&&(v.flags|=2),v}function a(v,y,x,E){return y===null||y.tag!==6?(y=Vf(x,v.mode,E),y.return=v,y):(y=i(y,x),y.return=v,y)}function u(v,y,x,E){var b=x.type;return b===fo?c(v,y,x.props.children,E,x.key):y!==null&&(y.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Ai&&q0(b)===y.type)?(E=i(y,x.props),E.ref=va(v,y,x),E.return=v,E):(E=ec(x.type,x.key,x.props,null,v.mode,E),E.ref=va(v,y,x),E.return=v,E)}function l(v,y,x,E){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=Hf(x,v.mode,E),y.return=v,y):(y=i(y,x.children||[]),y.return=v,y)}function c(v,y,x,E,b){return y===null||y.tag!==7?(y=Rs(x,v.mode,E,b),y.return=v,y):(y=i(y,x),y.return=v,y)}function d(v,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Vf(""+y,v.mode,x),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Zu:return x=ec(y.type,y.key,y.props,null,v.mode,x),x.ref=va(v,null,y),x.return=v,x;case co:return y=Hf(y,v.mode,x),y.return=v,y;case Ai:var E=y._init;return d(v,E(y._payload),x)}if(La(y)||fa(y))return y=Rs(y,v.mode,x,null),y.return=v,y;cl(v,y)}return null}function f(v,y,x,E){var b=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return b!==null?null:a(v,y,""+x,E);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Zu:return x.key===b?u(v,y,x,E):null;case co:return x.key===b?l(v,y,x,E):null;case Ai:return b=x._init,f(v,y,b(x._payload),E)}if(La(x)||fa(x))return b!==null?null:c(v,y,x,E,null);cl(v,x)}return null}function h(v,y,x,E,b){if(typeof E=="string"&&E!==""||typeof E=="number")return v=v.get(x)||null,a(y,v,""+E,b);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Zu:return v=v.get(E.key===null?x:E.key)||null,u(y,v,E,b);case co:return v=v.get(E.key===null?x:E.key)||null,l(y,v,E,b);case Ai:var S=E._init;return h(v,y,x,S(E._payload),b)}if(La(E)||fa(E))return v=v.get(x)||null,c(y,v,E,b,null);cl(y,E)}return null}function p(v,y,x,E){for(var b=null,S=null,w=y,T=y=0,R=null;w!==null&&T<x.length;T++){w.index>T?(R=w,w=null):R=w.sibling;var _=f(v,w,x[T],E);if(_===null){w===null&&(w=R);break}n&&w&&_.alternate===null&&e(v,w),y=s(_,y,T),S===null?b=_:S.sibling=_,S=_,w=R}if(T===x.length)return t(v,w),it&&ps(v,T),b;if(w===null){for(;T<x.length;T++)w=d(v,x[T],E),w!==null&&(y=s(w,y,T),S===null?b=w:S.sibling=w,S=w);return it&&ps(v,T),b}for(w=r(v,w);T<x.length;T++)R=h(w,v,T,x[T],E),R!==null&&(n&&R.alternate!==null&&w.delete(R.key===null?T:R.key),y=s(R,y,T),S===null?b=R:S.sibling=R,S=R);return n&&w.forEach(function(A){return e(v,A)}),it&&ps(v,T),b}function g(v,y,x,E){var b=fa(x);if(typeof b!="function")throw Error(te(150));if(x=b.call(x),x==null)throw Error(te(151));for(var S=b=null,w=y,T=y=0,R=null,_=x.next();w!==null&&!_.done;T++,_=x.next()){w.index>T?(R=w,w=null):R=w.sibling;var A=f(v,w,_.value,E);if(A===null){w===null&&(w=R);break}n&&w&&A.alternate===null&&e(v,w),y=s(A,y,T),S===null?b=A:S.sibling=A,S=A,w=R}if(_.done)return t(v,w),it&&ps(v,T),b;if(w===null){for(;!_.done;T++,_=x.next())_=d(v,_.value,E),_!==null&&(y=s(_,y,T),S===null?b=_:S.sibling=_,S=_);return it&&ps(v,T),b}for(w=r(v,w);!_.done;T++,_=x.next())_=h(w,v,T,_.value,E),_!==null&&(n&&_.alternate!==null&&w.delete(_.key===null?T:_.key),y=s(_,y,T),S===null?b=_:S.sibling=_,S=_);return n&&w.forEach(function(k){return e(v,k)}),it&&ps(v,T),b}function m(v,y,x,E){if(typeof x=="object"&&x!==null&&x.type===fo&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Zu:e:{for(var b=x.key,S=y;S!==null;){if(S.key===b){if(b=x.type,b===fo){if(S.tag===7){t(v,S.sibling),y=i(S,x.props.children),y.return=v,v=y;break e}}else if(S.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Ai&&q0(b)===S.type){t(v,S.sibling),y=i(S,x.props),y.ref=va(v,S,x),y.return=v,v=y;break e}t(v,S);break}else e(v,S);S=S.sibling}x.type===fo?(y=Rs(x.props.children,v.mode,E,x.key),y.return=v,v=y):(E=ec(x.type,x.key,x.props,null,v.mode,E),E.ref=va(v,y,x),E.return=v,v=E)}return o(v);case co:e:{for(S=x.key;y!==null;){if(y.key===S)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){t(v,y.sibling),y=i(y,x.children||[]),y.return=v,v=y;break e}else{t(v,y);break}else e(v,y);y=y.sibling}y=Hf(x,v.mode,E),y.return=v,v=y}return o(v);case Ai:return S=x._init,m(v,y,S(x._payload),E)}if(La(x))return p(v,y,x,E);if(fa(x))return g(v,y,x,E);cl(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(t(v,y.sibling),y=i(y,x),y.return=v,v=y):(t(v,y),y=Vf(x,v.mode,E),y.return=v,v=y),o(v)):t(v,y)}return m}var Ho=yb(!0),xb=yb(!1),Ic=ss(null),Rc=null,Eo=null,lm=null;function cm(){lm=Eo=Rc=null}function dm(n){var e=Ic.current;tt(Ic),n._currentValue=e}function wp(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Co(n,e){Rc=n,lm=Eo=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(vn=!0),n.firstContext=null)}function Zn(n){var e=n._currentValue;if(lm!==n)if(n={context:n,memoizedValue:e,next:null},Eo===null){if(Rc===null)throw Error(te(308));Eo=n,Rc.dependencies={lanes:0,firstContext:n}}else Eo=Eo.next=n;return e}var bs=null;function fm(n){bs===null?bs=[n]:bs.push(n)}function Eb(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,fm(e)):(t.next=i.next,i.next=t),e.interleaved=t,di(n,r)}function di(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ki=!1;function hm(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bb(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ui(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Hi(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Be&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,di(n,t)}return i=r.interleaved,i===null?(e.next=e,fm(r)):(e.next=i.next,i.next=e),r.interleaved=e,di(n,t)}function ql(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Jg(n,t)}}function Y0(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Cc(n,e,t,r){var i=n.updateQueue;ki=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var u=a,l=u.next;u.next=null,o===null?s=l:o.next=l,o=u;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=l:a.next=l,c.lastBaseUpdate=u))}if(s!==null){var d=i.baseState;o=0,c=l=u=null,a=s;do{var f=a.lane,h=a.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,g=a;switch(f=e,h=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=ht({},d,f);break e;case 2:ki=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else h={eventTime:h,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(c===null&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Ns|=o,n.lanes=o,n.memoizedState=d}}function X0(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(te(191,i));i.call(r)}}}var Fu={},Br=ss(Fu),au=ss(Fu),uu=ss(Fu);function Ss(n){if(n===Fu)throw Error(te(174));return n}function pm(n,e){switch(Xe(uu,e),Xe(au,n),Xe(Br,Fu),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rp(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=rp(e,n)}tt(Br),Xe(Br,e)}function zo(){tt(Br),tt(au),tt(uu)}function Sb(n){Ss(uu.current);var e=Ss(Br.current),t=rp(e,n.type);e!==t&&(Xe(au,n),Xe(Br,t))}function gm(n){au.current===n&&(tt(Br),tt(au))}var ut=ss(0);function Ac(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Mf=[];function mm(){for(var n=0;n<Mf.length;n++)Mf[n]._workInProgressVersionPrimary=null;Mf.length=0}var Yl=pi.ReactCurrentDispatcher,Bf=pi.ReactCurrentBatchConfig,Os=0,dt=null,Tt=null,Nt=null,kc=!1,$a=!1,lu=0,jC=0;function qt(){throw Error(te(321))}function vm(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!mr(n[t],e[t]))return!1;return!0}function ym(n,e,t,r,i,s){if(Os=s,dt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Yl.current=n===null||n.memoizedState===null?XC:QC,n=t(r,i),$a){s=0;do{if($a=!1,lu=0,25<=s)throw Error(te(301));s+=1,Nt=Tt=null,e.updateQueue=null,Yl.current=JC,n=t(r,i)}while($a)}if(Yl.current=Lc,e=Tt!==null&&Tt.next!==null,Os=0,Nt=Tt=dt=null,kc=!1,e)throw Error(te(300));return n}function xm(){var n=lu!==0;return lu=0,n}function Tr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nt===null?dt.memoizedState=Nt=n:Nt=Nt.next=n,Nt}function er(){if(Tt===null){var n=dt.alternate;n=n!==null?n.memoizedState:null}else n=Tt.next;var e=Nt===null?dt.memoizedState:Nt.next;if(e!==null)Nt=e,Tt=n;else{if(n===null)throw Error(te(310));Tt=n,n={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Nt===null?dt.memoizedState=Nt=n:Nt=Nt.next=n}return Nt}function cu(n,e){return typeof e=="function"?e(n):e}function Uf(n){var e=er(),t=e.queue;if(t===null)throw Error(te(311));t.lastRenderedReducer=n;var r=Tt,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,u=null,l=s;do{var c=l.lane;if((Os&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:n(r,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(a=u=d,o=r):u=u.next=d,dt.lanes|=c,Ns|=c}l=l.next}while(l!==null&&l!==s);u===null?o=r:u.next=a,mr(r,e.memoizedState)||(vn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=u,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,dt.lanes|=s,Ns|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function $f(n){var e=er(),t=e.queue;if(t===null)throw Error(te(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);mr(s,e.memoizedState)||(vn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function wb(){}function Tb(n,e){var t=dt,r=er(),i=e(),s=!mr(r.memoizedState,i);if(s&&(r.memoizedState=i,vn=!0),r=r.queue,Em(Rb.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||Nt!==null&&Nt.memoizedState.tag&1){if(t.flags|=2048,du(9,Ib.bind(null,t,r,i,e),void 0,null),Ft===null)throw Error(te(349));Os&30||_b(t,e,i)}return i}function _b(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=dt.updateQueue,e===null?(e={lastEffect:null,stores:null},dt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Ib(n,e,t,r){e.value=t,e.getSnapshot=r,Cb(e)&&Ab(n)}function Rb(n,e,t){return t(function(){Cb(e)&&Ab(n)})}function Cb(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!mr(n,t)}catch{return!0}}function Ab(n){var e=di(n,1);e!==null&&pr(e,n,1,-1)}function Q0(n){var e=Tr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cu,lastRenderedState:n},e.queue=n,n=n.dispatch=YC.bind(null,dt,n),[e.memoizedState,n]}function du(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=dt.updateQueue,e===null?(e={lastEffect:null,stores:null},dt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function kb(){return er().memoizedState}function Xl(n,e,t,r){var i=Tr();dt.flags|=n,i.memoizedState=du(1|e,t,void 0,r===void 0?null:r)}function kd(n,e,t,r){var i=er();r=r===void 0?null:r;var s=void 0;if(Tt!==null){var o=Tt.memoizedState;if(s=o.destroy,r!==null&&vm(r,o.deps)){i.memoizedState=du(e,t,s,r);return}}dt.flags|=n,i.memoizedState=du(1|e,t,s,r)}function J0(n,e){return Xl(8390656,8,n,e)}function Em(n,e){return kd(2048,8,n,e)}function Lb(n,e){return kd(4,2,n,e)}function Db(n,e){return kd(4,4,n,e)}function Pb(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Ob(n,e,t){return t=t!=null?t.concat([n]):null,kd(4,4,Pb.bind(null,e,n),t)}function bm(){}function Nb(n,e){var t=er();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&vm(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Fb(n,e){var t=er();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&vm(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Mb(n,e,t){return Os&21?(mr(t,e)||(t=WE(),dt.lanes|=t,Ns|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,vn=!0),n.memoizedState=t)}function KC(n,e){var t=ze;ze=t!==0&&4>t?t:4,n(!0);var r=Bf.transition;Bf.transition={};try{n(!1),e()}finally{ze=t,Bf.transition=r}}function Bb(){return er().memoizedState}function qC(n,e,t){var r=ji(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},Ub(n))$b(e,t);else if(t=Eb(n,e,t,r),t!==null){var i=ln();pr(t,n,r,i),Gb(t,e,r)}}function YC(n,e,t){var r=ji(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(Ub(n))$b(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,mr(a,o)){var u=e.interleaved;u===null?(i.next=i,fm(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}t=Eb(n,e,i,r),t!==null&&(i=ln(),pr(t,n,r,i),Gb(t,e,r))}}function Ub(n){var e=n.alternate;return n===dt||e!==null&&e===dt}function $b(n,e){$a=kc=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Gb(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Jg(n,t)}}var Lc={readContext:Zn,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useInsertionEffect:qt,useLayoutEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useMutableSource:qt,useSyncExternalStore:qt,useId:qt,unstable_isNewReconciler:!1},XC={readContext:Zn,useCallback:function(n,e){return Tr().memoizedState=[n,e===void 0?null:e],n},useContext:Zn,useEffect:J0,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Xl(4194308,4,Pb.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Xl(4194308,4,n,e)},useInsertionEffect:function(n,e){return Xl(4,2,n,e)},useMemo:function(n,e){var t=Tr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Tr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=qC.bind(null,dt,n),[r.memoizedState,n]},useRef:function(n){var e=Tr();return n={current:n},e.memoizedState=n},useState:Q0,useDebugValue:bm,useDeferredValue:function(n){return Tr().memoizedState=n},useTransition:function(){var n=Q0(!1),e=n[0];return n=KC.bind(null,n[1]),Tr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=dt,i=Tr();if(it){if(t===void 0)throw Error(te(407));t=t()}else{if(t=e(),Ft===null)throw Error(te(349));Os&30||_b(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,J0(Rb.bind(null,r,s,n),[n]),r.flags|=2048,du(9,Ib.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=Tr(),e=Ft.identifierPrefix;if(it){var t=oi,r=si;t=(r&~(1<<32-hr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=lu++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=jC++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},QC={readContext:Zn,useCallback:Nb,useContext:Zn,useEffect:Em,useImperativeHandle:Ob,useInsertionEffect:Lb,useLayoutEffect:Db,useMemo:Fb,useReducer:Uf,useRef:kb,useState:function(){return Uf(cu)},useDebugValue:bm,useDeferredValue:function(n){var e=er();return Mb(e,Tt.memoizedState,n)},useTransition:function(){var n=Uf(cu)[0],e=er().memoizedState;return[n,e]},useMutableSource:wb,useSyncExternalStore:Tb,useId:Bb,unstable_isNewReconciler:!1},JC={readContext:Zn,useCallback:Nb,useContext:Zn,useEffect:Em,useImperativeHandle:Ob,useInsertionEffect:Lb,useLayoutEffect:Db,useMemo:Fb,useReducer:$f,useRef:kb,useState:function(){return $f(cu)},useDebugValue:bm,useDeferredValue:function(n){var e=er();return Tt===null?e.memoizedState=n:Mb(e,Tt.memoizedState,n)},useTransition:function(){var n=$f(cu)[0],e=er().memoizedState;return[n,e]},useMutableSource:wb,useSyncExternalStore:Tb,useId:Bb,unstable_isNewReconciler:!1};function or(n,e){if(n&&n.defaultProps){e=ht({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Tp(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:ht({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ld={isMounted:function(n){return(n=n._reactInternals)?Vs(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=ln(),i=ji(n),s=ui(r,i);s.payload=e,t!=null&&(s.callback=t),e=Hi(n,s,i),e!==null&&(pr(e,n,i,r),ql(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=ln(),i=ji(n),s=ui(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Hi(n,s,i),e!==null&&(pr(e,n,i,r),ql(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=ln(),r=ji(n),i=ui(t,r);i.tag=2,e!=null&&(i.callback=e),e=Hi(n,i,r),e!==null&&(pr(e,n,r,t),ql(e,n,r))}};function Z0(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!ru(t,r)||!ru(i,s):!0}function Wb(n,e,t){var r=!1,i=Zi,s=e.contextType;return typeof s=="object"&&s!==null?s=Zn(s):(i=xn(e)?Ds:sn.current,r=e.contextTypes,s=(r=r!=null)?Wo(n,i):Zi),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ld,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function ey(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ld.enqueueReplaceState(e,e.state,null)}function _p(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},hm(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Zn(s):(s=xn(e)?Ds:sn.current,i.context=Wo(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Tp(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ld.enqueueReplaceState(i,i.state,null),Cc(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function jo(n,e){try{var t="",r=e;do t+=IR(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function Gf(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Ip(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var ZC=typeof WeakMap=="function"?WeakMap:Map;function Vb(n,e,t){t=ui(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Pc||(Pc=!0,Fp=r),Ip(n,e)},t}function Hb(n,e,t){t=ui(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){Ip(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){Ip(n,e),typeof r!="function"&&(zi===null?zi=new Set([this]):zi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function ty(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new ZC;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=hA.bind(null,n,e,t),e.then(n,n))}function ny(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function ry(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ui(-1,1),e.tag=2,Hi(t,e,1))),t.lanes|=1),n)}var eA=pi.ReactCurrentOwner,vn=!1;function an(n,e,t,r){e.child=n===null?xb(e,null,t,r):Ho(e,n.child,t,r)}function iy(n,e,t,r,i){t=t.render;var s=e.ref;return Co(e,i),r=ym(n,e,t,r,s,i),t=xm(),n!==null&&!vn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,fi(n,e,i)):(it&&t&&om(e),e.flags|=1,an(n,e,r,i),e.child)}function sy(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Am(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,zb(n,e,s,r,i)):(n=ec(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:ru,t(o,r)&&n.ref===e.ref)return fi(n,e,i)}return e.flags|=1,n=Ki(s,r),n.ref=e.ref,n.return=e,e.child=n}function zb(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(ru(s,r)&&n.ref===e.ref)if(vn=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(vn=!0);else return e.lanes=n.lanes,fi(n,e,i)}return Rp(n,e,t,r,i)}function jb(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Xe(So,_n),_n|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Xe(So,_n),_n|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Xe(So,_n),_n|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Xe(So,_n),_n|=r;return an(n,e,i,t),e.child}function Kb(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Rp(n,e,t,r,i){var s=xn(t)?Ds:sn.current;return s=Wo(e,s),Co(e,i),t=ym(n,e,t,r,s,i),r=xm(),n!==null&&!vn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,fi(n,e,i)):(it&&r&&om(e),e.flags|=1,an(n,e,t,i),e.child)}function oy(n,e,t,r,i){if(xn(t)){var s=!0;wc(e)}else s=!1;if(Co(e,i),e.stateNode===null)Ql(n,e),Wb(e,t,r),_p(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var u=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=Zn(l):(l=xn(t)?Ds:sn.current,l=Wo(e,l));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||u!==l)&&ey(e,o,r,l),ki=!1;var f=e.memoizedState;o.state=f,Cc(e,r,o,i),u=e.memoizedState,a!==r||f!==u||yn.current||ki?(typeof c=="function"&&(Tp(e,t,c,r),u=e.memoizedState),(a=ki||Z0(e,t,a,r,f,u,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),o.props=r,o.state=u,o.context=l,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,bb(n,e),a=e.memoizedProps,l=e.type===e.elementType?a:or(e.type,a),o.props=l,d=e.pendingProps,f=o.context,u=t.contextType,typeof u=="object"&&u!==null?u=Zn(u):(u=xn(t)?Ds:sn.current,u=Wo(e,u));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==u)&&ey(e,o,r,u),ki=!1,f=e.memoizedState,o.state=f,Cc(e,r,o,i);var p=e.memoizedState;a!==d||f!==p||yn.current||ki?(typeof h=="function"&&(Tp(e,t,h,r),p=e.memoizedState),(l=ki||Z0(e,t,l,r,f,p,u)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,u)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=u,r=l):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return Cp(n,e,t,r,s,i)}function Cp(n,e,t,r,i,s){Kb(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&z0(e,t,!1),fi(n,e,s);r=e.stateNode,eA.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Ho(e,n.child,null,s),e.child=Ho(e,null,a,s)):an(n,e,a,s),e.memoizedState=r.state,i&&z0(e,t,!0),e.child}function qb(n){var e=n.stateNode;e.pendingContext?H0(n,e.pendingContext,e.pendingContext!==e.context):e.context&&H0(n,e.context,!1),pm(n,e.containerInfo)}function ay(n,e,t,r,i){return Vo(),um(i),e.flags|=256,an(n,e,t,r),e.child}var Ap={dehydrated:null,treeContext:null,retryLane:0};function kp(n){return{baseLanes:n,cachePool:null,transitions:null}}function Yb(n,e,t){var r=e.pendingProps,i=ut.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Xe(ut,i&1),n===null)return Sp(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Od(o,r,0,null),n=Rs(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=kp(t),e.memoizedState=Ap,n):Sm(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return tA(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var u={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Ki(i,u),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Ki(a,s):(s=Rs(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?kp(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=Ap,r}return s=n.child,n=s.sibling,r=Ki(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Sm(n,e){return e=Od({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function dl(n,e,t,r){return r!==null&&um(r),Ho(e,n.child,null,t),n=Sm(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function tA(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=Gf(Error(te(422))),dl(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Od({mode:"visible",children:r.children},i,0,null),s=Rs(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Ho(e,n.child,null,o),e.child.memoizedState=kp(o),e.memoizedState=Ap,s);if(!(e.mode&1))return dl(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(te(419)),r=Gf(s,r,void 0),dl(n,e,o,r)}if(a=(o&n.childLanes)!==0,vn||a){if(r=Ft,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,di(n,i),pr(r,n,i,-1))}return Cm(),r=Gf(Error(te(421))),dl(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=pA.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,An=Vi(i.nextSibling),On=e,it=!0,lr=null,n!==null&&(jn[Kn++]=si,jn[Kn++]=oi,jn[Kn++]=Ps,si=n.id,oi=n.overflow,Ps=e),e=Sm(e,r.children),e.flags|=4096,e)}function uy(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),wp(n.return,e,t)}function Wf(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function Xb(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(an(n,e,r.children,t),r=ut.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&uy(n,t,e);else if(n.tag===19)uy(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Xe(ut,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Ac(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Wf(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Ac(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Wf(e,!0,t,null,s);break;case"together":Wf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ql(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function fi(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Ns|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(te(153));if(e.child!==null){for(n=e.child,t=Ki(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Ki(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function nA(n,e,t){switch(e.tag){case 3:qb(e),Vo();break;case 5:Sb(e);break;case 1:xn(e.type)&&wc(e);break;case 4:pm(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Xe(Ic,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Xe(ut,ut.current&1),e.flags|=128,null):t&e.child.childLanes?Yb(n,e,t):(Xe(ut,ut.current&1),n=fi(n,e,t),n!==null?n.sibling:null);Xe(ut,ut.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Xb(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Xe(ut,ut.current),r)break;return null;case 22:case 23:return e.lanes=0,jb(n,e,t)}return fi(n,e,t)}var Qb,Lp,Jb,Zb;Qb=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Lp=function(){};Jb=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Ss(Br.current);var s=null;switch(t){case"input":i=Zh(n,i),r=Zh(n,r),s=[];break;case"select":i=ht({},i,{value:void 0}),r=ht({},r,{value:void 0}),s=[];break;case"textarea":i=np(n,i),r=np(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=bc)}ip(t,r);var o;t=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Xa.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in r){var u=r[l];if(a=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&u!==a&&(u!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in u)u.hasOwnProperty(o)&&a[o]!==u[o]&&(t||(t={}),t[o]=u[o])}else t||(s||(s=[]),s.push(l,t)),t=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(s=s||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Xa.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&Ze("scroll",n),s||a===u||(s=[])):(s=s||[]).push(l,u))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};Zb=function(n,e,t,r){t!==r&&(e.flags|=4)};function ya(n,e){if(!it)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Yt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function rA(n,e,t){var r=e.pendingProps;switch(am(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(e),null;case 1:return xn(e.type)&&Sc(),Yt(e),null;case 3:return r=e.stateNode,zo(),tt(yn),tt(sn),mm(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(ll(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,lr!==null&&(Up(lr),lr=null))),Lp(n,e),Yt(e),null;case 5:gm(e);var i=Ss(uu.current);if(t=e.type,n!==null&&e.stateNode!=null)Jb(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(te(166));return Yt(e),null}if(n=Ss(Br.current),ll(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[kr]=e,r[ou]=s,n=(e.mode&1)!==0,t){case"dialog":Ze("cancel",r),Ze("close",r);break;case"iframe":case"object":case"embed":Ze("load",r);break;case"video":case"audio":for(i=0;i<Pa.length;i++)Ze(Pa[i],r);break;case"source":Ze("error",r);break;case"img":case"image":case"link":Ze("error",r),Ze("load",r);break;case"details":Ze("toggle",r);break;case"input":v0(r,s),Ze("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Ze("invalid",r);break;case"textarea":x0(r,s),Ze("invalid",r)}ip(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&ul(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ul(r.textContent,a,n),i=["children",""+a]):Xa.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ze("scroll",r)}switch(t){case"input":el(r),y0(r,s,!0);break;case"textarea":el(r),E0(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=bc)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=RE(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[kr]=e,n[ou]=r,Qb(n,e,!1,!1),e.stateNode=n;e:{switch(o=sp(t,r),t){case"dialog":Ze("cancel",n),Ze("close",n),i=r;break;case"iframe":case"object":case"embed":Ze("load",n),i=r;break;case"video":case"audio":for(i=0;i<Pa.length;i++)Ze(Pa[i],n);i=r;break;case"source":Ze("error",n),i=r;break;case"img":case"image":case"link":Ze("error",n),Ze("load",n),i=r;break;case"details":Ze("toggle",n),i=r;break;case"input":v0(n,r),i=Zh(n,r),Ze("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=ht({},r,{value:void 0}),Ze("invalid",n);break;case"textarea":x0(n,r),i=np(n,r),Ze("invalid",n);break;default:i=r}ip(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var u=a[s];s==="style"?kE(n,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&CE(n,u)):s==="children"?typeof u=="string"?(t!=="textarea"||u!=="")&&Qa(n,u):typeof u=="number"&&Qa(n,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Xa.hasOwnProperty(s)?u!=null&&s==="onScroll"&&Ze("scroll",n):u!=null&&jg(n,s,u,o))}switch(t){case"input":el(n),y0(n,r,!1);break;case"textarea":el(n),E0(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Ji(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?To(n,!!r.multiple,s,!1):r.defaultValue!=null&&To(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=bc)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Yt(e),null;case 6:if(n&&e.stateNode!=null)Zb(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(te(166));if(t=Ss(uu.current),Ss(Br.current),ll(e)){if(r=e.stateNode,t=e.memoizedProps,r[kr]=e,(s=r.nodeValue!==t)&&(n=On,n!==null))switch(n.tag){case 3:ul(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ul(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[kr]=e,e.stateNode=r}return Yt(e),null;case 13:if(tt(ut),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(it&&An!==null&&e.mode&1&&!(e.flags&128))vb(),Vo(),e.flags|=98560,s=!1;else if(s=ll(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(te(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(te(317));s[kr]=e}else Vo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Yt(e),s=!1}else lr!==null&&(Up(lr),lr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ut.current&1?It===0&&(It=3):Cm())),e.updateQueue!==null&&(e.flags|=4),Yt(e),null);case 4:return zo(),Lp(n,e),n===null&&iu(e.stateNode.containerInfo),Yt(e),null;case 10:return dm(e.type._context),Yt(e),null;case 17:return xn(e.type)&&Sc(),Yt(e),null;case 19:if(tt(ut),s=e.memoizedState,s===null)return Yt(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)ya(s,!1);else{if(It!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Ac(n),o!==null){for(e.flags|=128,ya(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Xe(ut,ut.current&1|2),e.child}n=n.sibling}s.tail!==null&&yt()>Ko&&(e.flags|=128,r=!0,ya(s,!1),e.lanes=4194304)}else{if(!r)if(n=Ac(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ya(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!it)return Yt(e),null}else 2*yt()-s.renderingStartTime>Ko&&t!==1073741824&&(e.flags|=128,r=!0,ya(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=yt(),e.sibling=null,t=ut.current,Xe(ut,r?t&1|2:t&1),e):(Yt(e),null);case 22:case 23:return Rm(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?_n&1073741824&&(Yt(e),e.subtreeFlags&6&&(e.flags|=8192)):Yt(e),null;case 24:return null;case 25:return null}throw Error(te(156,e.tag))}function iA(n,e){switch(am(e),e.tag){case 1:return xn(e.type)&&Sc(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return zo(),tt(yn),tt(sn),mm(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return gm(e),null;case 13:if(tt(ut),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(te(340));Vo()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return tt(ut),null;case 4:return zo(),null;case 10:return dm(e.type._context),null;case 22:case 23:return Rm(),null;case 24:return null;default:return null}}var fl=!1,Jt=!1,sA=typeof WeakSet=="function"?WeakSet:Set,ue=null;function bo(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){mt(n,e,r)}else t.current=null}function Dp(n,e,t){try{t()}catch(r){mt(n,e,r)}}var ly=!1;function oA(n,e){if(gp=yc,n=ib(),sm(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,u=-1,l=0,c=0,d=n,f=null;t:for(;;){for(var h;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(u=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===n)break t;if(f===t&&++l===i&&(a=o),f===s&&++c===r&&(u=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=a===-1||u===-1?null:{start:a,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;for(mp={focusedElem:n,selectionRange:t},yc=!1,ue=e;ue!==null;)if(e=ue,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ue=n;else for(;ue!==null;){e=ue;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,m=p.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?g:or(e.type,g),m);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(te(163))}}catch(E){mt(e,e.return,E)}if(n=e.sibling,n!==null){n.return=e.return,ue=n;break}ue=e.return}return p=ly,ly=!1,p}function Ga(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&Dp(e,t,s)}i=i.next}while(i!==r)}}function Dd(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Pp(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function eS(n){var e=n.alternate;e!==null&&(n.alternate=null,eS(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[kr],delete e[ou],delete e[xp],delete e[WC],delete e[VC])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function tS(n){return n.tag===5||n.tag===3||n.tag===4}function cy(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||tS(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Op(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=bc));else if(r!==4&&(n=n.child,n!==null))for(Op(n,e,t),n=n.sibling;n!==null;)Op(n,e,t),n=n.sibling}function Np(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Np(n,e,t),n=n.sibling;n!==null;)Np(n,e,t),n=n.sibling}var Ut=null,ur=!1;function Ti(n,e,t){for(t=t.child;t!==null;)nS(n,e,t),t=t.sibling}function nS(n,e,t){if(Mr&&typeof Mr.onCommitFiberUnmount=="function")try{Mr.onCommitFiberUnmount(Td,t)}catch{}switch(t.tag){case 5:Jt||bo(t,e);case 6:var r=Ut,i=ur;Ut=null,Ti(n,e,t),Ut=r,ur=i,Ut!==null&&(ur?(n=Ut,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Ut.removeChild(t.stateNode));break;case 18:Ut!==null&&(ur?(n=Ut,t=t.stateNode,n.nodeType===8?Nf(n.parentNode,t):n.nodeType===1&&Nf(n,t),tu(n)):Nf(Ut,t.stateNode));break;case 4:r=Ut,i=ur,Ut=t.stateNode.containerInfo,ur=!0,Ti(n,e,t),Ut=r,ur=i;break;case 0:case 11:case 14:case 15:if(!Jt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Dp(t,e,o),i=i.next}while(i!==r)}Ti(n,e,t);break;case 1:if(!Jt&&(bo(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){mt(t,e,a)}Ti(n,e,t);break;case 21:Ti(n,e,t);break;case 22:t.mode&1?(Jt=(r=Jt)||t.memoizedState!==null,Ti(n,e,t),Jt=r):Ti(n,e,t);break;default:Ti(n,e,t)}}function dy(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new sA),e.forEach(function(r){var i=gA.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function ir(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ut=a.stateNode,ur=!1;break e;case 3:Ut=a.stateNode.containerInfo,ur=!0;break e;case 4:Ut=a.stateNode.containerInfo,ur=!0;break e}a=a.return}if(Ut===null)throw Error(te(160));nS(s,o,i),Ut=null,ur=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){mt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)rS(e,n),e=e.sibling}function rS(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ir(e,n),Er(n),r&4){try{Ga(3,n,n.return),Dd(3,n)}catch(g){mt(n,n.return,g)}try{Ga(5,n,n.return)}catch(g){mt(n,n.return,g)}}break;case 1:ir(e,n),Er(n),r&512&&t!==null&&bo(t,t.return);break;case 5:if(ir(e,n),Er(n),r&512&&t!==null&&bo(t,t.return),n.flags&32){var i=n.stateNode;try{Qa(i,"")}catch(g){mt(n,n.return,g)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,u=n.updateQueue;if(n.updateQueue=null,u!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&_E(i,s),sp(a,o);var l=sp(a,s);for(o=0;o<u.length;o+=2){var c=u[o],d=u[o+1];c==="style"?kE(i,d):c==="dangerouslySetInnerHTML"?CE(i,d):c==="children"?Qa(i,d):jg(i,c,d,l)}switch(a){case"input":ep(i,s);break;case"textarea":IE(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?To(i,!!s.multiple,h,!1):f!==!!s.multiple&&(s.defaultValue!=null?To(i,!!s.multiple,s.defaultValue,!0):To(i,!!s.multiple,s.multiple?[]:"",!1))}i[ou]=s}catch(g){mt(n,n.return,g)}}break;case 6:if(ir(e,n),Er(n),r&4){if(n.stateNode===null)throw Error(te(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(g){mt(n,n.return,g)}}break;case 3:if(ir(e,n),Er(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{tu(e.containerInfo)}catch(g){mt(n,n.return,g)}break;case 4:ir(e,n),Er(n);break;case 13:ir(e,n),Er(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(_m=yt())),r&4&&dy(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(Jt=(l=Jt)||c,ir(e,n),Jt=l):ir(e,n),Er(n),r&8192){if(l=n.memoizedState!==null,(n.stateNode.isHidden=l)&&!c&&n.mode&1)for(ue=n,c=n.child;c!==null;){for(d=ue=c;ue!==null;){switch(f=ue,h=f.child,f.tag){case 0:case 11:case 14:case 15:Ga(4,f,f.return);break;case 1:bo(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){mt(r,t,g)}}break;case 5:bo(f,f.return);break;case 22:if(f.memoizedState!==null){hy(d);continue}}h!==null?(h.return=f,ue=h):hy(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,u=d.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=AE("display",o))}catch(g){mt(n,n.return,g)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(g){mt(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ir(e,n),Er(n),r&4&&dy(n);break;case 21:break;default:ir(e,n),Er(n)}}function Er(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(tS(t)){var r=t;break e}t=t.return}throw Error(te(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Qa(i,""),r.flags&=-33);var s=cy(n);Np(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=cy(n);Op(n,a,o);break;default:throw Error(te(161))}}catch(u){mt(n,n.return,u)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function aA(n,e,t){ue=n,iS(n)}function iS(n,e,t){for(var r=(n.mode&1)!==0;ue!==null;){var i=ue,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||fl;if(!o){var a=i.alternate,u=a!==null&&a.memoizedState!==null||Jt;a=fl;var l=Jt;if(fl=o,(Jt=u)&&!l)for(ue=i;ue!==null;)o=ue,u=o.child,o.tag===22&&o.memoizedState!==null?py(i):u!==null?(u.return=o,ue=u):py(i);for(;s!==null;)ue=s,iS(s),s=s.sibling;ue=i,fl=a,Jt=l}fy(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,ue=s):fy(n)}}function fy(n){for(;ue!==null;){var e=ue;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Jt||Dd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Jt)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:or(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&X0(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}X0(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&t.focus();break;case"img":u.src&&(t.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&tu(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(te(163))}Jt||e.flags&512&&Pp(e)}catch(f){mt(e,e.return,f)}}if(e===n){ue=null;break}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}}function hy(n){for(;ue!==null;){var e=ue;if(e===n){ue=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ue=t;break}ue=e.return}}function py(n){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Dd(4,e)}catch(u){mt(e,t,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){mt(e,i,u)}}var s=e.return;try{Pp(e)}catch(u){mt(e,s,u)}break;case 5:var o=e.return;try{Pp(e)}catch(u){mt(e,o,u)}}}catch(u){mt(e,e.return,u)}if(e===n){ue=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ue=a;break}ue=e.return}}var uA=Math.ceil,Dc=pi.ReactCurrentDispatcher,wm=pi.ReactCurrentOwner,Jn=pi.ReactCurrentBatchConfig,Be=0,Ft=null,Et=null,Ht=0,_n=0,So=ss(0),It=0,fu=null,Ns=0,Pd=0,Tm=0,Wa=null,hn=null,_m=0,Ko=1/0,ei=null,Pc=!1,Fp=null,zi=null,hl=!1,Fi=null,Oc=0,Va=0,Mp=null,Jl=-1,Zl=0;function ln(){return Be&6?yt():Jl!==-1?Jl:Jl=yt()}function ji(n){return n.mode&1?Be&2&&Ht!==0?Ht&-Ht:zC.transition!==null?(Zl===0&&(Zl=WE()),Zl):(n=ze,n!==0||(n=window.event,n=n===void 0?16:YE(n.type)),n):1}function pr(n,e,t,r){if(50<Va)throw Va=0,Mp=null,Error(te(185));Pu(n,t,r),(!(Be&2)||n!==Ft)&&(n===Ft&&(!(Be&2)&&(Pd|=t),It===4&&Oi(n,Ht)),En(n,r),t===1&&Be===0&&!(e.mode&1)&&(Ko=yt()+500,Ad&&os()))}function En(n,e){var t=n.callbackNode;zR(n,e);var r=vc(n,n===Ft?Ht:0);if(r===0)t!==null&&w0(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&w0(t),e===1)n.tag===0?HC(gy.bind(null,n)):pb(gy.bind(null,n)),$C(function(){!(Be&6)&&os()}),t=null;else{switch(VE(r)){case 1:t=Qg;break;case 4:t=$E;break;case 16:t=mc;break;case 536870912:t=GE;break;default:t=mc}t=fS(t,sS.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function sS(n,e){if(Jl=-1,Zl=0,Be&6)throw Error(te(327));var t=n.callbackNode;if(Ao()&&n.callbackNode!==t)return null;var r=vc(n,n===Ft?Ht:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Nc(n,r);else{e=r;var i=Be;Be|=2;var s=aS();(Ft!==n||Ht!==e)&&(ei=null,Ko=yt()+500,Is(n,e));do try{dA();break}catch(a){oS(n,a)}while(!0);cm(),Dc.current=s,Be=i,Et!==null?e=0:(Ft=null,Ht=0,e=It)}if(e!==0){if(e===2&&(i=cp(n),i!==0&&(r=i,e=Bp(n,i))),e===1)throw t=fu,Is(n,0),Oi(n,r),En(n,yt()),t;if(e===6)Oi(n,r);else{if(i=n.current.alternate,!(r&30)&&!lA(i)&&(e=Nc(n,r),e===2&&(s=cp(n),s!==0&&(r=s,e=Bp(n,s))),e===1))throw t=fu,Is(n,0),Oi(n,r),En(n,yt()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(te(345));case 2:gs(n,hn,ei);break;case 3:if(Oi(n,r),(r&130023424)===r&&(e=_m+500-yt(),10<e)){if(vc(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){ln(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=yp(gs.bind(null,n,hn,ei),e);break}gs(n,hn,ei);break;case 4:if(Oi(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-hr(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=yt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*uA(r/1960))-r,10<r){n.timeoutHandle=yp(gs.bind(null,n,hn,ei),r);break}gs(n,hn,ei);break;case 5:gs(n,hn,ei);break;default:throw Error(te(329))}}}return En(n,yt()),n.callbackNode===t?sS.bind(null,n):null}function Bp(n,e){var t=Wa;return n.current.memoizedState.isDehydrated&&(Is(n,e).flags|=256),n=Nc(n,e),n!==2&&(e=hn,hn=t,e!==null&&Up(e)),n}function Up(n){hn===null?hn=n:hn.push.apply(hn,n)}function lA(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!mr(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Oi(n,e){for(e&=~Tm,e&=~Pd,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-hr(e),r=1<<t;n[t]=-1,e&=~r}}function gy(n){if(Be&6)throw Error(te(327));Ao();var e=vc(n,0);if(!(e&1))return En(n,yt()),null;var t=Nc(n,e);if(n.tag!==0&&t===2){var r=cp(n);r!==0&&(e=r,t=Bp(n,r))}if(t===1)throw t=fu,Is(n,0),Oi(n,e),En(n,yt()),t;if(t===6)throw Error(te(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,gs(n,hn,ei),En(n,yt()),null}function Im(n,e){var t=Be;Be|=1;try{return n(e)}finally{Be=t,Be===0&&(Ko=yt()+500,Ad&&os())}}function Fs(n){Fi!==null&&Fi.tag===0&&!(Be&6)&&Ao();var e=Be;Be|=1;var t=Jn.transition,r=ze;try{if(Jn.transition=null,ze=1,n)return n()}finally{ze=r,Jn.transition=t,Be=e,!(Be&6)&&os()}}function Rm(){_n=So.current,tt(So)}function Is(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,UC(t)),Et!==null)for(t=Et.return;t!==null;){var r=t;switch(am(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Sc();break;case 3:zo(),tt(yn),tt(sn),mm();break;case 5:gm(r);break;case 4:zo();break;case 13:tt(ut);break;case 19:tt(ut);break;case 10:dm(r.type._context);break;case 22:case 23:Rm()}t=t.return}if(Ft=n,Et=n=Ki(n.current,null),Ht=_n=e,It=0,fu=null,Tm=Pd=Ns=0,hn=Wa=null,bs!==null){for(e=0;e<bs.length;e++)if(t=bs[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}bs=null}return n}function oS(n,e){do{var t=Et;try{if(cm(),Yl.current=Lc,kc){for(var r=dt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}kc=!1}if(Os=0,Nt=Tt=dt=null,$a=!1,lu=0,wm.current=null,t===null||t.return===null){It=1,fu=e,Et=null;break}e:{var s=n,o=t.return,a=t,u=e;if(e=Ht,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=ny(o);if(h!==null){h.flags&=-257,ry(h,o,a,s,e),h.mode&1&&ty(s,l,e),e=h,u=l;var p=e.updateQueue;if(p===null){var g=new Set;g.add(u),e.updateQueue=g}else p.add(u);break e}else{if(!(e&1)){ty(s,l,e),Cm();break e}u=Error(te(426))}}else if(it&&a.mode&1){var m=ny(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),ry(m,o,a,s,e),um(jo(u,a));break e}}s=u=jo(u,a),It!==4&&(It=2),Wa===null?Wa=[s]:Wa.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=Vb(s,u,e);Y0(s,v);break e;case 1:a=u;var y=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(zi===null||!zi.has(x)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=Hb(s,a,e);Y0(s,E);break e}}s=s.return}while(s!==null)}lS(t)}catch(b){e=b,Et===t&&t!==null&&(Et=t=t.return);continue}break}while(!0)}function aS(){var n=Dc.current;return Dc.current=Lc,n===null?Lc:n}function Cm(){(It===0||It===3||It===2)&&(It=4),Ft===null||!(Ns&268435455)&&!(Pd&268435455)||Oi(Ft,Ht)}function Nc(n,e){var t=Be;Be|=2;var r=aS();(Ft!==n||Ht!==e)&&(ei=null,Is(n,e));do try{cA();break}catch(i){oS(n,i)}while(!0);if(cm(),Be=t,Dc.current=r,Et!==null)throw Error(te(261));return Ft=null,Ht=0,It}function cA(){for(;Et!==null;)uS(Et)}function dA(){for(;Et!==null&&!FR();)uS(Et)}function uS(n){var e=dS(n.alternate,n,_n);n.memoizedProps=n.pendingProps,e===null?lS(n):Et=e,wm.current=null}function lS(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=iA(t,e),t!==null){t.flags&=32767,Et=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{It=6,Et=null;return}}else if(t=rA(t,e,_n),t!==null){Et=t;return}if(e=e.sibling,e!==null){Et=e;return}Et=e=n}while(e!==null);It===0&&(It=5)}function gs(n,e,t){var r=ze,i=Jn.transition;try{Jn.transition=null,ze=1,fA(n,e,t,r)}finally{Jn.transition=i,ze=r}return null}function fA(n,e,t,r){do Ao();while(Fi!==null);if(Be&6)throw Error(te(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(te(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(jR(n,s),n===Ft&&(Et=Ft=null,Ht=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||hl||(hl=!0,fS(mc,function(){return Ao(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Jn.transition,Jn.transition=null;var o=ze;ze=1;var a=Be;Be|=4,wm.current=null,oA(n,t),rS(t,n),DC(mp),yc=!!gp,mp=gp=null,n.current=t,aA(t),MR(),Be=a,ze=o,Jn.transition=s}else n.current=t;if(hl&&(hl=!1,Fi=n,Oc=i),s=n.pendingLanes,s===0&&(zi=null),$R(t.stateNode),En(n,yt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Pc)throw Pc=!1,n=Fp,Fp=null,n;return Oc&1&&n.tag!==0&&Ao(),s=n.pendingLanes,s&1?n===Mp?Va++:(Va=0,Mp=n):Va=0,os(),null}function Ao(){if(Fi!==null){var n=VE(Oc),e=Jn.transition,t=ze;try{if(Jn.transition=null,ze=16>n?16:n,Fi===null)var r=!1;else{if(n=Fi,Fi=null,Oc=0,Be&6)throw Error(te(331));var i=Be;for(Be|=4,ue=n.current;ue!==null;){var s=ue,o=s.child;if(ue.flags&16){var a=s.deletions;if(a!==null){for(var u=0;u<a.length;u++){var l=a[u];for(ue=l;ue!==null;){var c=ue;switch(c.tag){case 0:case 11:case 15:Ga(8,c,s)}var d=c.child;if(d!==null)d.return=c,ue=d;else for(;ue!==null;){c=ue;var f=c.sibling,h=c.return;if(eS(c),c===l){ue=null;break}if(f!==null){f.return=h,ue=f;break}ue=h}}}var p=s.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(g!==null)}}ue=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ue=o;else e:for(;ue!==null;){if(s=ue,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ga(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,ue=v;break e}ue=s.return}}var y=n.current;for(ue=y;ue!==null;){o=ue;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,ue=x;else e:for(o=y;ue!==null;){if(a=ue,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Dd(9,a)}}catch(b){mt(a,a.return,b)}if(a===o){ue=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,ue=E;break e}ue=a.return}}if(Be=i,os(),Mr&&typeof Mr.onPostCommitFiberRoot=="function")try{Mr.onPostCommitFiberRoot(Td,n)}catch{}r=!0}return r}finally{ze=t,Jn.transition=e}}return!1}function my(n,e,t){e=jo(t,e),e=Vb(n,e,1),n=Hi(n,e,1),e=ln(),n!==null&&(Pu(n,1,e),En(n,e))}function mt(n,e,t){if(n.tag===3)my(n,n,t);else for(;e!==null;){if(e.tag===3){my(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(zi===null||!zi.has(r))){n=jo(t,n),n=Hb(e,n,1),e=Hi(e,n,1),n=ln(),e!==null&&(Pu(e,1,n),En(e,n));break}}e=e.return}}function hA(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=ln(),n.pingedLanes|=n.suspendedLanes&t,Ft===n&&(Ht&t)===t&&(It===4||It===3&&(Ht&130023424)===Ht&&500>yt()-_m?Is(n,0):Tm|=t),En(n,e)}function cS(n,e){e===0&&(n.mode&1?(e=rl,rl<<=1,!(rl&130023424)&&(rl=4194304)):e=1);var t=ln();n=di(n,e),n!==null&&(Pu(n,e,t),En(n,t))}function pA(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),cS(n,t)}function gA(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(te(314))}r!==null&&r.delete(e),cS(n,t)}var dS;dS=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||yn.current)vn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return vn=!1,nA(n,e,t);vn=!!(n.flags&131072)}else vn=!1,it&&e.flags&1048576&&gb(e,_c,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ql(n,e),n=e.pendingProps;var i=Wo(e,sn.current);Co(e,t),i=ym(null,e,r,n,i,t);var s=xm();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,xn(r)?(s=!0,wc(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,hm(e),i.updater=Ld,e.stateNode=i,i._reactInternals=e,_p(e,r,n,t),e=Cp(null,e,r,!0,s,t)):(e.tag=0,it&&s&&om(e),an(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Ql(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=vA(r),n=or(r,n),i){case 0:e=Rp(null,e,r,n,t);break e;case 1:e=oy(null,e,r,n,t);break e;case 11:e=iy(null,e,r,n,t);break e;case 14:e=sy(null,e,r,or(r.type,n),t);break e}throw Error(te(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:or(r,i),Rp(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:or(r,i),oy(n,e,r,i,t);case 3:e:{if(qb(e),n===null)throw Error(te(387));r=e.pendingProps,s=e.memoizedState,i=s.element,bb(n,e),Cc(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=jo(Error(te(423)),e),e=ay(n,e,r,t,i);break e}else if(r!==i){i=jo(Error(te(424)),e),e=ay(n,e,r,t,i);break e}else for(An=Vi(e.stateNode.containerInfo.firstChild),On=e,it=!0,lr=null,t=xb(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Vo(),r===i){e=fi(n,e,t);break e}an(n,e,r,t)}e=e.child}return e;case 5:return Sb(e),n===null&&Sp(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,vp(r,i)?o=null:s!==null&&vp(r,s)&&(e.flags|=32),Kb(n,e),an(n,e,o,t),e.child;case 6:return n===null&&Sp(e),null;case 13:return Yb(n,e,t);case 4:return pm(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Ho(e,null,r,t):an(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:or(r,i),iy(n,e,r,i,t);case 7:return an(n,e,e.pendingProps,t),e.child;case 8:return an(n,e,e.pendingProps.children,t),e.child;case 12:return an(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Xe(Ic,r._currentValue),r._currentValue=o,s!==null)if(mr(s.value,o)){if(s.children===i.children&&!yn.current){e=fi(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(s.tag===1){u=ui(-1,t&-t),u.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}s.lanes|=t,u=s.alternate,u!==null&&(u.lanes|=t),wp(s.return,t,e),a.lanes|=t;break}u=u.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(te(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),wp(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}an(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Co(e,t),i=Zn(i),r=r(i),e.flags|=1,an(n,e,r,t),e.child;case 14:return r=e.type,i=or(r,e.pendingProps),i=or(r.type,i),sy(n,e,r,i,t);case 15:return zb(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:or(r,i),Ql(n,e),e.tag=1,xn(r)?(n=!0,wc(e)):n=!1,Co(e,t),Wb(e,r,i),_p(e,r,i,t),Cp(null,e,r,!0,n,t);case 19:return Xb(n,e,t);case 22:return jb(n,e,t)}throw Error(te(156,e.tag))};function fS(n,e){return UE(n,e)}function mA(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xn(n,e,t,r){return new mA(n,e,t,r)}function Am(n){return n=n.prototype,!(!n||!n.isReactComponent)}function vA(n){if(typeof n=="function")return Am(n)?1:0;if(n!=null){if(n=n.$$typeof,n===qg)return 11;if(n===Yg)return 14}return 2}function Ki(n,e){var t=n.alternate;return t===null?(t=Xn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function ec(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")Am(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case fo:return Rs(t.children,i,s,e);case Kg:o=8,i|=8;break;case Yh:return n=Xn(12,t,e,i|2),n.elementType=Yh,n.lanes=s,n;case Xh:return n=Xn(13,t,e,i),n.elementType=Xh,n.lanes=s,n;case Qh:return n=Xn(19,t,e,i),n.elementType=Qh,n.lanes=s,n;case SE:return Od(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case EE:o=10;break e;case bE:o=9;break e;case qg:o=11;break e;case Yg:o=14;break e;case Ai:o=16,r=null;break e}throw Error(te(130,n==null?n:typeof n,""))}return e=Xn(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Rs(n,e,t,r){return n=Xn(7,n,r,e),n.lanes=t,n}function Od(n,e,t,r){return n=Xn(22,n,r,e),n.elementType=SE,n.lanes=t,n.stateNode={isHidden:!1},n}function Vf(n,e,t){return n=Xn(6,n,null,e),n.lanes=t,n}function Hf(n,e,t){return e=Xn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function yA(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Tf(0),this.expirationTimes=Tf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tf(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function km(n,e,t,r,i,s,o,a,u){return n=new yA(n,e,t,a,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Xn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},hm(s),n}function xA(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:co,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function hS(n){if(!n)return Zi;n=n._reactInternals;e:{if(Vs(n)!==n||n.tag!==1)throw Error(te(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(xn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(te(171))}if(n.tag===1){var t=n.type;if(xn(t))return hb(n,t,e)}return e}function pS(n,e,t,r,i,s,o,a,u){return n=km(t,r,!0,n,i,s,o,a,u),n.context=hS(null),t=n.current,r=ln(),i=ji(t),s=ui(r,i),s.callback=e??null,Hi(t,s,i),n.current.lanes=i,Pu(n,i,r),En(n,r),n}function Nd(n,e,t,r){var i=e.current,s=ln(),o=ji(i);return t=hS(t),e.context===null?e.context=t:e.pendingContext=t,e=ui(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Hi(i,e,o),n!==null&&(pr(n,i,o,s),ql(n,i,o)),o}function Fc(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function vy(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Lm(n,e){vy(n,e),(n=n.alternate)&&vy(n,e)}function EA(){return null}var gS=typeof reportError=="function"?reportError:function(n){console.error(n)};function Dm(n){this._internalRoot=n}Fd.prototype.render=Dm.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(te(409));Nd(n,e,null,null)};Fd.prototype.unmount=Dm.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Fs(function(){Nd(null,n,null,null)}),e[ci]=null}};function Fd(n){this._internalRoot=n}Fd.prototype.unstable_scheduleHydration=function(n){if(n){var e=jE();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Pi.length&&e!==0&&e<Pi[t].priority;t++);Pi.splice(t,0,n),t===0&&qE(n)}};function Pm(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Md(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function yy(){}function bA(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var l=Fc(o);s.call(l)}}var o=pS(e,r,n,0,null,!1,!1,"",yy);return n._reactRootContainer=o,n[ci]=o.current,iu(n.nodeType===8?n.parentNode:n),Fs(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var l=Fc(u);a.call(l)}}var u=km(n,0,!1,null,null,!1,!1,"",yy);return n._reactRootContainer=u,n[ci]=u.current,iu(n.nodeType===8?n.parentNode:n),Fs(function(){Nd(e,u,t,r)}),u}function Bd(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var u=Fc(o);a.call(u)}}Nd(e,o,n,i)}else o=bA(t,e,n,i,r);return Fc(o)}HE=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Da(e.pendingLanes);t!==0&&(Jg(e,t|1),En(e,yt()),!(Be&6)&&(Ko=yt()+500,os()))}break;case 13:Fs(function(){var r=di(n,1);if(r!==null){var i=ln();pr(r,n,1,i)}}),Lm(n,1)}};Zg=function(n){if(n.tag===13){var e=di(n,134217728);if(e!==null){var t=ln();pr(e,n,134217728,t)}Lm(n,134217728)}};zE=function(n){if(n.tag===13){var e=ji(n),t=di(n,e);if(t!==null){var r=ln();pr(t,n,e,r)}Lm(n,e)}};jE=function(){return ze};KE=function(n,e){var t=ze;try{return ze=n,e()}finally{ze=t}};ap=function(n,e,t){switch(e){case"input":if(ep(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=Cd(r);if(!i)throw Error(te(90));TE(r),ep(r,i)}}}break;case"textarea":IE(n,t);break;case"select":e=t.value,e!=null&&To(n,!!t.multiple,e,!1)}};PE=Im;OE=Fs;var SA={usingClientEntryPoint:!1,Events:[Nu,mo,Cd,LE,DE,Im]},xa={findFiberByHostInstance:Es,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wA={bundleType:xa.bundleType,version:xa.version,rendererPackageName:xa.rendererPackageName,rendererConfig:xa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:pi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=ME(n),n===null?null:n.stateNode},findFiberByHostInstance:xa.findFiberByHostInstance||EA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pl.isDisabled&&pl.supportsFiber)try{Td=pl.inject(wA),Mr=pl}catch{}}Un.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SA;Un.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pm(e))throw Error(te(200));return xA(n,e,null,t)};Un.createRoot=function(n,e){if(!Pm(n))throw Error(te(299));var t=!1,r="",i=gS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=km(n,1,!1,null,null,t,!1,r,i),n[ci]=e.current,iu(n.nodeType===8?n.parentNode:n),new Dm(e)};Un.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(te(188)):(n=Object.keys(n).join(","),Error(te(268,n)));return n=ME(e),n=n===null?null:n.stateNode,n};Un.flushSync=function(n){return Fs(n)};Un.hydrate=function(n,e,t){if(!Md(e))throw Error(te(200));return Bd(null,n,e,!0,t)};Un.hydrateRoot=function(n,e,t){if(!Pm(n))throw Error(te(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=gS;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=pS(e,null,n,1,t??null,i,!1,s,o),n[ci]=e.current,iu(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Fd(e)};Un.render=function(n,e,t){if(!Md(e))throw Error(te(200));return Bd(null,n,e,!1,t)};Un.unmountComponentAtNode=function(n){if(!Md(n))throw Error(te(40));return n._reactRootContainer?(Fs(function(){Bd(null,null,n,!1,function(){n._reactRootContainer=null,n[ci]=null})}),!0):!1};Un.unstable_batchedUpdates=Im;Un.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Md(t))throw Error(te(200));if(n==null||n._reactInternals===void 0)throw Error(te(38));return Bd(n,e,t,!1,r)};Un.version="18.3.1-next-f1338f8080-20240426";function mS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mS)}catch(n){console.error(n)}}mS(),mE.exports=Un;var TA=mE.exports,vS,xy=TA;vS=xy.createRoot,xy.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hu(){return hu=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},hu.apply(this,arguments)}var Mi;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Mi||(Mi={}));const Ey="popstate";function _A(n){n===void 0&&(n={});function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return $p("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Mc(i)}return RA(e,t,null,n)}function ft(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function yS(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function IA(){return Math.random().toString(36).substr(2,8)}function by(n,e){return{usr:n.state,key:n.key,idx:e}}function $p(n,e,t,r){return t===void 0&&(t=null),hu({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?sa(e):e,{state:t,key:e&&e.key||r||IA()})}function Mc(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function sa(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function RA(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a=Mi.Pop,u=null,l=c();l==null&&(l=0,o.replaceState(hu({},o.state,{idx:l}),""));function c(){return(o.state||{idx:null}).idx}function d(){a=Mi.Pop;let m=c(),v=m==null?null:m-l;l=m,u&&u({action:a,location:g.location,delta:v})}function f(m,v){a=Mi.Push;let y=$p(g.location,m,v);l=c()+1;let x=by(y,l),E=g.createHref(y);try{o.pushState(x,"",E)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;i.location.assign(E)}s&&u&&u({action:a,location:g.location,delta:1})}function h(m,v){a=Mi.Replace;let y=$p(g.location,m,v);l=c();let x=by(y,l),E=g.createHref(y);o.replaceState(x,"",E),s&&u&&u({action:a,location:g.location,delta:0})}function p(m){let v=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof m=="string"?m:Mc(m);return y=y.replace(/ $/,"%20"),ft(v,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,v)}let g={get action(){return a},get location(){return n(i,o)},listen(m){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(Ey,d),u=m,()=>{i.removeEventListener(Ey,d),u=null}},createHref(m){return e(i,m)},createURL:p,encodeLocation(m){let v=p(m);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:f,replace:h,go(m){return o.go(m)}};return g}var Sy;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Sy||(Sy={}));function CA(n,e,t){return t===void 0&&(t="/"),AA(n,e,t,!1)}function AA(n,e,t,r){let i=typeof e=="string"?sa(e):e,s=qo(i.pathname||"/",t);if(s==null)return null;let o=xS(n);kA(o);let a=null;for(let u=0;a==null&&u<o.length;++u){let l=GA(s);a=UA(o[u],l,r)}return a}function xS(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(s,o,a)=>{let u={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};u.relativePath.startsWith("/")&&(ft(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let l=qi([r,u.relativePath]),c=t.concat(u);s.children&&s.children.length>0&&(ft(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),xS(s.children,e,c,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:MA(l,s.index),routesMeta:c})};return n.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let u of ES(s.path))i(s,o,u)}),e}function ES(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=ES(r.join("/")),a=[];return a.push(...o.map(u=>u===""?s:[s,u].join("/"))),i&&a.push(...o),a.map(u=>n.startsWith("/")&&u===""?"/":u)}function kA(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:BA(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const LA=/^:[\w-]+$/,DA=3,PA=2,OA=1,NA=10,FA=-2,wy=n=>n==="*";function MA(n,e){let t=n.split("/"),r=t.length;return t.some(wy)&&(r+=FA),e&&(r+=PA),t.filter(i=>!wy(i)).reduce((i,s)=>i+(LA.test(s)?DA:s===""?OA:NA),r)}function BA(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function UA(n,e,t){let{routesMeta:r}=n,i={},s="/",o=[];for(let a=0;a<r.length;++a){let u=r[a],l=a===r.length-1,c=s==="/"?e:e.slice(s.length)||"/",d=Bc({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),f=u.route;if(!d&&l&&t&&!r[r.length-1].route.index&&(d=Bc({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!d)return null;Object.assign(i,d.params),o.push({params:i,pathname:qi([s,d.pathname]),pathnameBase:zA(qi([s,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(s=qi([s,d.pathnameBase]))}return o}function Bc(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=$A(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((l,c,d)=>{let{paramName:f,isOptional:h}=c;if(f==="*"){let g=a[d]||"";o=s.slice(0,s.length-g.length).replace(/(.)\/+$/,"$1")}const p=a[d];return h&&!p?l[f]=void 0:l[f]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:n}}function $A(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),yS(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,u)=>(r.push({paramName:a,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function GA(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return yS(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function qo(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function WA(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?sa(n):n;return{pathname:t?t.startsWith("/")?t:VA(t,e):e,search:jA(r),hash:KA(i)}}function VA(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function zf(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function HA(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Om(n,e){let t=HA(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function Nm(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=sa(n):(i=hu({},n),ft(!i.pathname||!i.pathname.includes("?"),zf("?","pathname","search",i)),ft(!i.pathname||!i.pathname.includes("#"),zf("#","pathname","hash",i)),ft(!i.search||!i.search.includes("#"),zf("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?e[d]:"/"}let u=WA(i,a),l=o&&o!=="/"&&o.endsWith("/"),c=(s||o===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const qi=n=>n.join("/").replace(/\/\/+/g,"/"),zA=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),jA=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,KA=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function qA(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const bS=["post","put","patch","delete"];new Set(bS);const YA=["get",...bS];new Set(YA);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pu(){return pu=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},pu.apply(this,arguments)}const Ud=X.createContext(null),SS=X.createContext(null),gi=X.createContext(null),$d=X.createContext(null),as=X.createContext({outlet:null,matches:[],isDataRoute:!1}),wS=X.createContext(null);function XA(n,e){let{relative:t}=e===void 0?{}:e;oa()||ft(!1);let{basename:r,navigator:i}=X.useContext(gi),{hash:s,pathname:o,search:a}=Gd(n,{relative:t}),u=o;return r!=="/"&&(u=o==="/"?r:qi([r,o])),i.createHref({pathname:u,search:a,hash:s})}function oa(){return X.useContext($d)!=null}function aa(){return oa()||ft(!1),X.useContext($d).location}function TS(n){X.useContext(gi).static||X.useLayoutEffect(n)}function _S(){let{isDataRoute:n}=X.useContext(as);return n?l2():QA()}function QA(){oa()||ft(!1);let n=X.useContext(Ud),{basename:e,future:t,navigator:r}=X.useContext(gi),{matches:i}=X.useContext(as),{pathname:s}=aa(),o=JSON.stringify(Om(i,t.v7_relativeSplatPath)),a=X.useRef(!1);return TS(()=>{a.current=!0}),X.useCallback(function(l,c){if(c===void 0&&(c={}),!a.current)return;if(typeof l=="number"){r.go(l);return}let d=Nm(l,JSON.parse(o),s,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:qi([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,o,s,n])}function Gd(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=X.useContext(gi),{matches:i}=X.useContext(as),{pathname:s}=aa(),o=JSON.stringify(Om(i,r.v7_relativeSplatPath));return X.useMemo(()=>Nm(n,JSON.parse(o),s,t==="path"),[n,o,s,t])}function JA(n,e){return ZA(n,e)}function ZA(n,e,t,r){oa()||ft(!1);let{navigator:i,static:s}=X.useContext(gi),{matches:o}=X.useContext(as),a=o[o.length-1],u=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let c=aa(),d;if(e){var f;let v=typeof e=="string"?sa(e):e;l==="/"||(f=v.pathname)!=null&&f.startsWith(l)||ft(!1),d=v}else d=c;let h=d.pathname||"/",p=h;if(l!=="/"){let v=l.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let g=!s&&t&&t.matches&&t.matches.length>0?t.matches:CA(n,{pathname:p}),m=i2(g&&g.map(v=>Object.assign({},v,{params:Object.assign({},u,v.params),pathname:qi([l,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?l:qi([l,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,t,r);return e&&m?X.createElement($d.Provider,{value:{location:pu({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Mi.Pop}},m):m}function e2(){let n=u2(),e=qA(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return X.createElement(X.Fragment,null,X.createElement("h2",null,"Unexpected Application Error!"),X.createElement("h3",{style:{fontStyle:"italic"}},e),t?X.createElement("pre",{style:i},t):null,null)}const t2=X.createElement(e2,null);class n2 extends X.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?X.createElement(as.Provider,{value:this.props.routeContext},X.createElement(wS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function r2(n){let{routeContext:e,match:t,children:r}=n,i=X.useContext(Ud);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),X.createElement(as.Provider,{value:e},r)}function i2(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(i=t)==null?void 0:i.errors;if(a!=null){let c=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);c>=0||ft(!1),o=o.slice(0,Math.min(o.length,c+1))}let u=!1,l=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<o.length;c++){let d=o[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=c),d.route.id){let{loaderData:f,errors:h}=t,p=d.route.loader&&f[d.route.id]===void 0&&(!h||h[d.route.id]===void 0);if(d.route.lazy||p){u=!0,l>=0?o=o.slice(0,l+1):o=[o[0]];break}}}return o.reduceRight((c,d,f)=>{let h,p=!1,g=null,m=null;t&&(h=a&&d.route.id?a[d.route.id]:void 0,g=d.route.errorElement||t2,u&&(l<0&&f===0?(p=!0,m=null):l===f&&(p=!0,m=d.route.hydrateFallbackElement||null)));let v=e.concat(o.slice(0,f+1)),y=()=>{let x;return h?x=g:p?x=m:d.route.Component?x=X.createElement(d.route.Component,null):d.route.element?x=d.route.element:x=c,X.createElement(r2,{match:d,routeContext:{outlet:c,matches:v,isDataRoute:t!=null},children:x})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?X.createElement(n2,{location:t.location,revalidation:t.revalidation,component:g,error:h,children:y(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):y()},null)}var IS=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(IS||{}),Uc=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Uc||{});function s2(n){let e=X.useContext(Ud);return e||ft(!1),e}function o2(n){let e=X.useContext(SS);return e||ft(!1),e}function a2(n){let e=X.useContext(as);return e||ft(!1),e}function RS(n){let e=a2(),t=e.matches[e.matches.length-1];return t.route.id||ft(!1),t.route.id}function u2(){var n;let e=X.useContext(wS),t=o2(Uc.UseRouteError),r=RS(Uc.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function l2(){let{router:n}=s2(IS.UseNavigateStable),e=RS(Uc.UseNavigateStable),t=X.useRef(!1);return TS(()=>{t.current=!0}),X.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,pu({fromRouteId:e},s)))},[n,e])}function c2(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function d2(n){let{to:e,replace:t,state:r,relative:i}=n;oa()||ft(!1);let{future:s,static:o}=X.useContext(gi),{matches:a}=X.useContext(as),{pathname:u}=aa(),l=_S(),c=Nm(e,Om(a,s.v7_relativeSplatPath),u,i==="path"),d=JSON.stringify(c);return X.useEffect(()=>l(JSON.parse(d),{replace:t,state:r,relative:i}),[l,d,i,t,r]),null}function so(n){ft(!1)}function f2(n){let{basename:e="/",children:t=null,location:r,navigationType:i=Mi.Pop,navigator:s,static:o=!1,future:a}=n;oa()&&ft(!1);let u=e.replace(/^\/*/,"/"),l=X.useMemo(()=>({basename:u,navigator:s,static:o,future:pu({v7_relativeSplatPath:!1},a)}),[u,a,s,o]);typeof r=="string"&&(r=sa(r));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:p="default"}=r,g=X.useMemo(()=>{let m=qo(c,u);return m==null?null:{location:{pathname:m,search:d,hash:f,state:h,key:p},navigationType:i}},[u,c,d,f,h,p,i]);return g==null?null:X.createElement(gi.Provider,{value:l},X.createElement($d.Provider,{children:t,value:g}))}function h2(n){let{children:e,location:t}=n;return JA(Gp(e),t)}new Promise(()=>{});function Gp(n,e){e===void 0&&(e=[]);let t=[];return X.Children.forEach(n,(r,i)=>{if(!X.isValidElement(r))return;let s=[...e,i];if(r.type===X.Fragment){t.push.apply(t,Gp(r.props.children,s));return}r.type!==so&&ft(!1),!r.props.index||!r.props.children||ft(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Gp(r.props.children,s)),t.push(o)}),t}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $c(){return $c=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$c.apply(this,arguments)}function CS(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function p2(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function g2(n,e){return n.button===0&&(!e||e==="_self")&&!p2(n)}const m2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],v2=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],y2="6";try{window.__reactRouterVersion=y2}catch{}const x2=X.createContext({isTransitioning:!1}),E2="startTransition",Ty=hR[E2];function b2(n){let{basename:e,children:t,future:r,window:i}=n,s=X.useRef();s.current==null&&(s.current=_A({window:i,v5Compat:!0}));let o=s.current,[a,u]=X.useState({action:o.action,location:o.location}),{v7_startTransition:l}=r||{},c=X.useCallback(d=>{l&&Ty?Ty(()=>u(d)):u(d)},[u,l]);return X.useLayoutEffect(()=>o.listen(c),[o,c]),X.useEffect(()=>c2(r),[r]),X.createElement(f2,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}const S2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",w2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,tc=X.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:s,replace:o,state:a,target:u,to:l,preventScrollReset:c,viewTransition:d}=e,f=CS(e,m2),{basename:h}=X.useContext(gi),p,g=!1;if(typeof l=="string"&&w2.test(l)&&(p=l,S2))try{let x=new URL(window.location.href),E=l.startsWith("//")?new URL(x.protocol+l):new URL(l),b=qo(E.pathname,h);E.origin===x.origin&&b!=null?l=b+E.search+E.hash:g=!0}catch{}let m=XA(l,{relative:i}),v=_2(l,{replace:o,state:a,target:u,preventScrollReset:c,relative:i,viewTransition:d});function y(x){r&&r(x),x.defaultPrevented||v(x)}return X.createElement("a",$c({},f,{href:p||m,onClick:g||s?r:y,ref:t,target:u}))}),jf=X.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:i=!1,className:s="",end:o=!1,style:a,to:u,viewTransition:l,children:c}=e,d=CS(e,v2),f=Gd(u,{relative:d.relative}),h=aa(),p=X.useContext(SS),{navigator:g,basename:m}=X.useContext(gi),v=p!=null&&I2(f)&&l===!0,y=g.encodeLocation?g.encodeLocation(f).pathname:f.pathname,x=h.pathname,E=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;i||(x=x.toLowerCase(),E=E?E.toLowerCase():null,y=y.toLowerCase()),E&&m&&(E=qo(E,m)||E);const b=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let S=x===y||!o&&x.startsWith(y)&&x.charAt(b)==="/",w=E!=null&&(E===y||!o&&E.startsWith(y)&&E.charAt(y.length)==="/"),T={isActive:S,isPending:w,isTransitioning:v},R=S?r:void 0,_;typeof s=="function"?_=s(T):_=[s,S?"active":null,w?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let A=typeof a=="function"?a(T):a;return X.createElement(tc,$c({},d,{"aria-current":R,className:_,ref:t,style:A,to:u,viewTransition:l}),typeof c=="function"?c(T):c)});var Wp;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Wp||(Wp={}));var _y;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(_y||(_y={}));function T2(n){let e=X.useContext(Ud);return e||ft(!1),e}function _2(n,e){let{target:t,replace:r,state:i,preventScrollReset:s,relative:o,viewTransition:a}=e===void 0?{}:e,u=_S(),l=aa(),c=Gd(n,{relative:o});return X.useCallback(d=>{if(g2(d,t)){d.preventDefault();let f=r!==void 0?r:Mc(l)===Mc(c);u(n,{replace:f,state:i,preventScrollReset:s,relative:o,viewTransition:a})}},[l,u,c,r,i,t,n,s,o,a])}function I2(n,e){e===void 0&&(e={});let t=X.useContext(x2);t==null&&ft(!1);let{basename:r}=T2(Wp.useViewTransitionState),i=Gd(n,{relative:e.relative});if(!t.isTransitioning)return!1;let s=qo(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=qo(t.nextLocation.pathname,r)||t.nextLocation.pathname;return Bc(i.pathname,o)!=null||Bc(i.pathname,s)!=null}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var R2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C2=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),mi=(n,e)=>{const t=X.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:a="",children:u,...l},c)=>X.createElement("svg",{ref:c,...R2,width:i,height:i,stroke:r,strokeWidth:o?Number(s)*24/Number(i):s,className:["lucide",`lucide-${C2(n)}`,a].join(" "),...l},[...e.map(([d,f])=>X.createElement(d,f)),...Array.isArray(u)?u:[u]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AS=mi("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A2=mi("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kS=mi("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k2=mi("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L2=mi("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D2=mi("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LS=mi("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P2=mi("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DS=mi("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function PS(n,e){return function(){return n.apply(e,arguments)}}const{toString:O2}=Object.prototype,{getPrototypeOf:Fm}=Object,Wd=(n=>e=>{const t=O2.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),vr=n=>(n=n.toLowerCase(),e=>Wd(e)===n),Vd=n=>e=>typeof e===n,{isArray:ua}=Array,gu=Vd("undefined");function N2(n){return n!==null&&!gu(n)&&n.constructor!==null&&!gu(n.constructor)&&Nn(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const OS=vr("ArrayBuffer");function F2(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&OS(n.buffer),e}const M2=Vd("string"),Nn=Vd("function"),NS=Vd("number"),Hd=n=>n!==null&&typeof n=="object",B2=n=>n===!0||n===!1,nc=n=>{if(Wd(n)!=="object")return!1;const e=Fm(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},U2=vr("Date"),$2=vr("File"),G2=vr("Blob"),W2=vr("FileList"),V2=n=>Hd(n)&&Nn(n.pipe),H2=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Nn(n.append)&&((e=Wd(n))==="formdata"||e==="object"&&Nn(n.toString)&&n.toString()==="[object FormData]"))},z2=vr("URLSearchParams"),[j2,K2,q2,Y2]=["ReadableStream","Request","Response","Headers"].map(vr),X2=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Mu(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,i;if(typeof n!="object"&&(n=[n]),ua(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let a;for(r=0;r<o;r++)a=s[r],e.call(null,n[a],a,n)}}function FS(n,e){e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const ws=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,MS=n=>!gu(n)&&n!==ws;function Vp(){const{caseless:n}=MS(this)&&this||{},e={},t=(r,i)=>{const s=n&&FS(e,i)||i;nc(e[s])&&nc(r)?e[s]=Vp(e[s],r):nc(r)?e[s]=Vp({},r):ua(r)?e[s]=r.slice():e[s]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&Mu(arguments[r],t);return e}const Q2=(n,e,t,{allOwnKeys:r}={})=>(Mu(e,(i,s)=>{t&&Nn(i)?n[s]=PS(i,t):n[s]=i},{allOwnKeys:r}),n),J2=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Z2=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},ek=(n,e,t,r)=>{let i,s,o;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&Fm(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},tk=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},nk=n=>{if(!n)return null;if(ua(n))return n;let e=n.length;if(!NS(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},rk=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Fm(Uint8Array)),ik=(n,e)=>{const r=(n&&n[Symbol.iterator]).call(n);let i;for(;(i=r.next())&&!i.done;){const s=i.value;e.call(n,s[0],s[1])}},sk=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},ok=vr("HTMLFormElement"),ak=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),Iy=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),uk=vr("RegExp"),BS=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};Mu(t,(i,s)=>{let o;(o=e(i,s,n))!==!1&&(r[s]=o||i)}),Object.defineProperties(n,r)},lk=n=>{BS(n,(e,t)=>{if(Nn(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Nn(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},ck=(n,e)=>{const t={},r=i=>{i.forEach(s=>{t[s]=!0})};return ua(n)?r(n):r(String(n).split(e)),t},dk=()=>{},fk=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function hk(n){return!!(n&&Nn(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const pk=n=>{const e=new Array(10),t=(r,i)=>{if(Hd(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const s=ua(r)?[]:{};return Mu(r,(o,a)=>{const u=t(o,i+1);!gu(u)&&(s[a]=u)}),e[i]=void 0,s}}return r};return t(n,0)},gk=vr("AsyncFunction"),mk=n=>n&&(Hd(n)||Nn(n))&&Nn(n.then)&&Nn(n.catch),US=((n,e)=>n?setImmediate:e?((t,r)=>(ws.addEventListener("message",({source:i,data:s})=>{i===ws&&s===t&&r.length&&r.shift()()},!1),i=>{r.push(i),ws.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Nn(ws.postMessage)),vk=typeof queueMicrotask<"u"?queueMicrotask.bind(ws):typeof process<"u"&&process.nextTick||US,q={isArray:ua,isArrayBuffer:OS,isBuffer:N2,isFormData:H2,isArrayBufferView:F2,isString:M2,isNumber:NS,isBoolean:B2,isObject:Hd,isPlainObject:nc,isReadableStream:j2,isRequest:K2,isResponse:q2,isHeaders:Y2,isUndefined:gu,isDate:U2,isFile:$2,isBlob:G2,isRegExp:uk,isFunction:Nn,isStream:V2,isURLSearchParams:z2,isTypedArray:rk,isFileList:W2,forEach:Mu,merge:Vp,extend:Q2,trim:X2,stripBOM:J2,inherits:Z2,toFlatObject:ek,kindOf:Wd,kindOfTest:vr,endsWith:tk,toArray:nk,forEachEntry:ik,matchAll:sk,isHTMLForm:ok,hasOwnProperty:Iy,hasOwnProp:Iy,reduceDescriptors:BS,freezeMethods:lk,toObjectSet:ck,toCamelCase:ak,noop:dk,toFiniteNumber:fk,findKey:FS,global:ws,isContextDefined:MS,isSpecCompliantForm:hk,toJSONObject:pk,isAsyncFn:gk,isThenable:mk,setImmediate:US,asap:vk};function Ie(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}q.inherits(Ie,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:q.toJSONObject(this.config),code:this.code,status:this.status}}});const $S=Ie.prototype,GS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{GS[n]={value:n}});Object.defineProperties(Ie,GS);Object.defineProperty($S,"isAxiosError",{value:!0});Ie.from=(n,e,t,r,i,s)=>{const o=Object.create($S);return q.toFlatObject(n,o,function(u){return u!==Error.prototype},a=>a!=="isAxiosError"),Ie.call(o,n.message,e,t,r,i),o.cause=n,o.name=n.name,s&&Object.assign(o,s),o};const yk=null;function Hp(n){return q.isPlainObject(n)||q.isArray(n)}function WS(n){return q.endsWith(n,"[]")?n.slice(0,-2):n}function Ry(n,e,t){return n?n.concat(e).map(function(i,s){return i=WS(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function xk(n){return q.isArray(n)&&!n.some(Hp)}const Ek=q.toFlatObject(q,{},null,function(e){return/^is[A-Z]/.test(e)});function zd(n,e,t){if(!q.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=q.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,m){return!q.isUndefined(m[g])});const r=t.metaTokens,i=t.visitor||c,s=t.dots,o=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&q.isSpecCompliantForm(e);if(!q.isFunction(i))throw new TypeError("visitor must be a function");function l(p){if(p===null)return"";if(q.isDate(p))return p.toISOString();if(!u&&q.isBlob(p))throw new Ie("Blob is not supported. Use a Buffer instead.");return q.isArrayBuffer(p)||q.isTypedArray(p)?u&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function c(p,g,m){let v=p;if(p&&!m&&typeof p=="object"){if(q.endsWith(g,"{}"))g=r?g:g.slice(0,-2),p=JSON.stringify(p);else if(q.isArray(p)&&xk(p)||(q.isFileList(p)||q.endsWith(g,"[]"))&&(v=q.toArray(p)))return g=WS(g),v.forEach(function(x,E){!(q.isUndefined(x)||x===null)&&e.append(o===!0?Ry([g],E,s):o===null?g:g+"[]",l(x))}),!1}return Hp(p)?!0:(e.append(Ry(m,g,s),l(p)),!1)}const d=[],f=Object.assign(Ek,{defaultVisitor:c,convertValue:l,isVisitable:Hp});function h(p,g){if(!q.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(p),q.forEach(p,function(v,y){(!(q.isUndefined(v)||v===null)&&i.call(e,v,q.isString(y)?y.trim():y,g,f))===!0&&h(v,g?g.concat(y):[y])}),d.pop()}}if(!q.isObject(n))throw new TypeError("data must be an object");return h(n),e}function Cy(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Mm(n,e){this._pairs=[],n&&zd(n,this,e)}const VS=Mm.prototype;VS.append=function(e,t){this._pairs.push([e,t])};VS.toString=function(e){const t=e?function(r){return e.call(this,r,Cy)}:Cy;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function bk(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function HS(n,e,t){if(!e)return n;const r=t&&t.encode||bk;q.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let s;if(i?s=i(e,t):s=q.isURLSearchParams(e)?e.toString():new Mm(e,t).toString(r),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class Ay{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){q.forEach(this.handlers,function(r){r!==null&&e(r)})}}const zS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Sk=typeof URLSearchParams<"u"?URLSearchParams:Mm,wk=typeof FormData<"u"?FormData:null,Tk=typeof Blob<"u"?Blob:null,_k={isBrowser:!0,classes:{URLSearchParams:Sk,FormData:wk,Blob:Tk},protocols:["http","https","file","blob","url","data"]},Bm=typeof window<"u"&&typeof document<"u",zp=typeof navigator=="object"&&navigator||void 0,Ik=Bm&&(!zp||["ReactNative","NativeScript","NS"].indexOf(zp.product)<0),Rk=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ck=Bm&&window.location.href||"http://localhost",Ak=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Bm,hasStandardBrowserEnv:Ik,hasStandardBrowserWebWorkerEnv:Rk,navigator:zp,origin:Ck},Symbol.toStringTag,{value:"Module"})),en={...Ak,..._k};function kk(n,e){return zd(n,new en.classes.URLSearchParams,Object.assign({visitor:function(t,r,i,s){return en.isNode&&q.isBuffer(t)?(this.append(r,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Lk(n){return q.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Dk(n){const e={},t=Object.keys(n);let r;const i=t.length;let s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function jS(n){function e(t,r,i,s){let o=t[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),u=s>=t.length;return o=!o&&q.isArray(i)?i.length:o,u?(q.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):((!i[o]||!q.isObject(i[o]))&&(i[o]=[]),e(t,r,i[o],s)&&q.isArray(i[o])&&(i[o]=Dk(i[o])),!a)}if(q.isFormData(n)&&q.isFunction(n.entries)){const t={};return q.forEachEntry(n,(r,i)=>{e(Lk(r),i,t,0)}),t}return null}function Pk(n,e,t){if(q.isString(n))try{return(e||JSON.parse)(n),q.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(n)}const Bu={transitional:zS,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,s=q.isObject(e);if(s&&q.isHTMLForm(e)&&(e=new FormData(e)),q.isFormData(e))return i?JSON.stringify(jS(e)):e;if(q.isArrayBuffer(e)||q.isBuffer(e)||q.isStream(e)||q.isFile(e)||q.isBlob(e)||q.isReadableStream(e))return e;if(q.isArrayBufferView(e))return e.buffer;if(q.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return kk(e,this.formSerializer).toString();if((a=q.isFileList(e))||r.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return zd(a?{"files[]":e}:e,u&&new u,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),Pk(e)):e}],transformResponse:[function(e){const t=this.transitional||Bu.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(q.isResponse(e)||q.isReadableStream(e))return e;if(e&&q.isString(e)&&(r&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?Ie.from(a,Ie.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:en.classes.FormData,Blob:en.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};q.forEach(["delete","get","head","post","put","patch"],n=>{Bu.headers[n]={}});const Ok=q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Nk=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&Ok[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ky=Symbol("internals");function Ea(n){return n&&String(n).trim().toLowerCase()}function rc(n){return n===!1||n==null?n:q.isArray(n)?n.map(rc):String(n)}function Fk(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const Mk=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Kf(n,e,t,r,i){if(q.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!q.isString(e)){if(q.isString(r))return e.indexOf(r)!==-1;if(q.isRegExp(r))return r.test(e)}}function Bk(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Uk(n,e){const t=q.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,s,o){return this[r].call(this,e,i,s,o)},configurable:!0})})}class bn{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function s(a,u,l){const c=Ea(u);if(!c)throw new Error("header name must be a non-empty string");const d=q.findKey(i,c);(!d||i[d]===void 0||l===!0||l===void 0&&i[d]!==!1)&&(i[d||u]=rc(a))}const o=(a,u)=>q.forEach(a,(l,c)=>s(l,c,u));if(q.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(q.isString(e)&&(e=e.trim())&&!Mk(e))o(Nk(e),t);else if(q.isHeaders(e))for(const[a,u]of e.entries())s(u,a,r);else e!=null&&s(t,e,r);return this}get(e,t){if(e=Ea(e),e){const r=q.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return Fk(i);if(q.isFunction(t))return t.call(this,i,r);if(q.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ea(e),e){const r=q.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Kf(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function s(o){if(o=Ea(o),o){const a=q.findKey(r,o);a&&(!t||Kf(r,r[a],a,t))&&(delete r[a],i=!0)}}return q.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const s=t[r];(!e||Kf(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,r={};return q.forEach(this,(i,s)=>{const o=q.findKey(r,s);if(o){t[o]=rc(i),delete t[s];return}const a=e?Bk(s):String(s).trim();a!==s&&delete t[s],t[a]=rc(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return q.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&q.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[ky]=this[ky]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=Ea(o);r[a]||(Uk(i,o),r[a]=!0)}return q.isArray(e)?e.forEach(s):s(e),this}}bn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);q.reduceDescriptors(bn.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});q.freezeMethods(bn);function qf(n,e){const t=this||Bu,r=e||t,i=bn.from(r.headers);let s=r.data;return q.forEach(n,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function KS(n){return!!(n&&n.__CANCEL__)}function la(n,e,t){Ie.call(this,n??"canceled",Ie.ERR_CANCELED,e,t),this.name="CanceledError"}q.inherits(la,Ie,{__CANCEL__:!0});function qS(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ie("Request failed with status code "+t.status,[Ie.ERR_BAD_REQUEST,Ie.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function $k(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Gk(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(u){const l=Date.now(),c=r[s];o||(o=l),t[i]=u,r[i]=l;let d=s,f=0;for(;d!==i;)f+=t[d++],d=d%n;if(i=(i+1)%n,i===s&&(s=(s+1)%n),l-o<e)return;const h=c&&l-c;return h?Math.round(f*1e3/h):void 0}}function Wk(n,e){let t=0,r=1e3/e,i,s;const o=(l,c=Date.now())=>{t=c,i=null,s&&(clearTimeout(s),s=null),n.apply(null,l)};return[(...l)=>{const c=Date.now(),d=c-t;d>=r?o(l,c):(i=l,s||(s=setTimeout(()=>{s=null,o(i)},r-d)))},()=>i&&o(i)]}const Gc=(n,e,t=3)=>{let r=0;const i=Gk(50,250);return Wk(s=>{const o=s.loaded,a=s.lengthComputable?s.total:void 0,u=o-r,l=i(u),c=o<=a;r=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:u,rate:l||void 0,estimated:l&&a&&c?(a-o)/l:void 0,event:s,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(d)},t)},Ly=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},Dy=n=>(...e)=>q.asap(()=>n(...e)),Vk=en.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,en.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(en.origin),en.navigator&&/(msie|trident)/i.test(en.navigator.userAgent)):()=>!0,Hk=en.hasStandardBrowserEnv?{write(n,e,t,r,i,s){const o=[n+"="+encodeURIComponent(e)];q.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),q.isString(r)&&o.push("path="+r),q.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function zk(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function jk(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function YS(n,e,t){let r=!zk(e);return n&&(r||t==!1)?jk(n,e):e}const Py=n=>n instanceof bn?{...n}:n;function Ms(n,e){e=e||{};const t={};function r(l,c,d,f){return q.isPlainObject(l)&&q.isPlainObject(c)?q.merge.call({caseless:f},l,c):q.isPlainObject(c)?q.merge({},c):q.isArray(c)?c.slice():c}function i(l,c,d,f){if(q.isUndefined(c)){if(!q.isUndefined(l))return r(void 0,l,d,f)}else return r(l,c,d,f)}function s(l,c){if(!q.isUndefined(c))return r(void 0,c)}function o(l,c){if(q.isUndefined(c)){if(!q.isUndefined(l))return r(void 0,l)}else return r(void 0,c)}function a(l,c,d){if(d in e)return r(l,c);if(d in n)return r(void 0,l)}const u={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,c,d)=>i(Py(l),Py(c),d,!0)};return q.forEach(Object.keys(Object.assign({},n,e)),function(c){const d=u[c]||i,f=d(n[c],e[c],c);q.isUndefined(f)&&d!==a||(t[c]=f)}),t}const XS=n=>{const e=Ms({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:a}=e;e.headers=o=bn.from(o),e.url=HS(YS(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let u;if(q.isFormData(t)){if(en.hasStandardBrowserEnv||en.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((u=o.getContentType())!==!1){const[l,...c]=u?u.split(";").map(d=>d.trim()).filter(Boolean):[];o.setContentType([l||"multipart/form-data",...c].join("; "))}}if(en.hasStandardBrowserEnv&&(r&&q.isFunction(r)&&(r=r(e)),r||r!==!1&&Vk(e.url))){const l=i&&s&&Hk.read(s);l&&o.set(i,l)}return e},Kk=typeof XMLHttpRequest<"u",qk=Kk&&function(n){return new Promise(function(t,r){const i=XS(n);let s=i.data;const o=bn.from(i.headers).normalize();let{responseType:a,onUploadProgress:u,onDownloadProgress:l}=i,c,d,f,h,p;function g(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let m=new XMLHttpRequest;m.open(i.method.toUpperCase(),i.url,!0),m.timeout=i.timeout;function v(){if(!m)return;const x=bn.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders()),b={data:!a||a==="text"||a==="json"?m.responseText:m.response,status:m.status,statusText:m.statusText,headers:x,config:n,request:m};qS(function(w){t(w),g()},function(w){r(w),g()},b),m=null}"onloadend"in m?m.onloadend=v:m.onreadystatechange=function(){!m||m.readyState!==4||m.status===0&&!(m.responseURL&&m.responseURL.indexOf("file:")===0)||setTimeout(v)},m.onabort=function(){m&&(r(new Ie("Request aborted",Ie.ECONNABORTED,n,m)),m=null)},m.onerror=function(){r(new Ie("Network Error",Ie.ERR_NETWORK,n,m)),m=null},m.ontimeout=function(){let E=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const b=i.transitional||zS;i.timeoutErrorMessage&&(E=i.timeoutErrorMessage),r(new Ie(E,b.clarifyTimeoutError?Ie.ETIMEDOUT:Ie.ECONNABORTED,n,m)),m=null},s===void 0&&o.setContentType(null),"setRequestHeader"in m&&q.forEach(o.toJSON(),function(E,b){m.setRequestHeader(b,E)}),q.isUndefined(i.withCredentials)||(m.withCredentials=!!i.withCredentials),a&&a!=="json"&&(m.responseType=i.responseType),l&&([f,p]=Gc(l,!0),m.addEventListener("progress",f)),u&&m.upload&&([d,h]=Gc(u),m.upload.addEventListener("progress",d),m.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=x=>{m&&(r(!x||x.type?new la(null,n,m):x),m.abort(),m=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const y=$k(i.url);if(y&&en.protocols.indexOf(y)===-1){r(new Ie("Unsupported protocol "+y+":",Ie.ERR_BAD_REQUEST,n));return}m.send(s||null)})},Yk=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,i;const s=function(l){if(!i){i=!0,a();const c=l instanceof Error?l:this.reason;r.abort(c instanceof Ie?c:new la(c instanceof Error?c.message:c))}};let o=e&&setTimeout(()=>{o=null,s(new Ie(`timeout ${e} of ms exceeded`,Ie.ETIMEDOUT))},e);const a=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(l=>{l.unsubscribe?l.unsubscribe(s):l.removeEventListener("abort",s)}),n=null)};n.forEach(l=>l.addEventListener("abort",s));const{signal:u}=r;return u.unsubscribe=()=>q.asap(a),u}},Xk=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,i;for(;r<t;)i=r+e,yield n.slice(r,i),r=i},Qk=async function*(n,e){for await(const t of Jk(n))yield*Xk(t,e)},Jk=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},Oy=(n,e,t,r)=>{const i=Qk(n,e);let s=0,o,a=u=>{o||(o=!0,r&&r(u))};return new ReadableStream({async pull(u){try{const{done:l,value:c}=await i.next();if(l){a(),u.close();return}let d=c.byteLength;if(t){let f=s+=d;t(f)}u.enqueue(new Uint8Array(c))}catch(l){throw a(l),l}},cancel(u){return a(u),i.return()}},{highWaterMark:2})},jd=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",QS=jd&&typeof ReadableStream=="function",Zk=jd&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),JS=(n,...e)=>{try{return!!n(...e)}catch{return!1}},eL=QS&&JS(()=>{let n=!1;const e=new Request(en.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Ny=64*1024,jp=QS&&JS(()=>q.isReadableStream(new Response("").body)),Wc={stream:jp&&(n=>n.body)};jd&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Wc[e]&&(Wc[e]=q.isFunction(n[e])?t=>t[e]():(t,r)=>{throw new Ie(`Response type '${e}' is not supported`,Ie.ERR_NOT_SUPPORT,r)})})})(new Response);const tL=async n=>{if(n==null)return 0;if(q.isBlob(n))return n.size;if(q.isSpecCompliantForm(n))return(await new Request(en.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(q.isArrayBufferView(n)||q.isArrayBuffer(n))return n.byteLength;if(q.isURLSearchParams(n)&&(n=n+""),q.isString(n))return(await Zk(n)).byteLength},nL=async(n,e)=>{const t=q.toFiniteNumber(n.getContentLength());return t??tL(e)},rL=jd&&(async n=>{let{url:e,method:t,data:r,signal:i,cancelToken:s,timeout:o,onDownloadProgress:a,onUploadProgress:u,responseType:l,headers:c,withCredentials:d="same-origin",fetchOptions:f}=XS(n);l=l?(l+"").toLowerCase():"text";let h=Yk([i,s&&s.toAbortSignal()],o),p;const g=h&&h.unsubscribe&&(()=>{h.unsubscribe()});let m;try{if(u&&eL&&t!=="get"&&t!=="head"&&(m=await nL(c,r))!==0){let b=new Request(e,{method:"POST",body:r,duplex:"half"}),S;if(q.isFormData(r)&&(S=b.headers.get("content-type"))&&c.setContentType(S),b.body){const[w,T]=Ly(m,Gc(Dy(u)));r=Oy(b.body,Ny,w,T)}}q.isString(d)||(d=d?"include":"omit");const v="credentials"in Request.prototype;p=new Request(e,{...f,signal:h,method:t.toUpperCase(),headers:c.normalize().toJSON(),body:r,duplex:"half",credentials:v?d:void 0});let y=await fetch(p);const x=jp&&(l==="stream"||l==="response");if(jp&&(a||x&&g)){const b={};["status","statusText","headers"].forEach(R=>{b[R]=y[R]});const S=q.toFiniteNumber(y.headers.get("content-length")),[w,T]=a&&Ly(S,Gc(Dy(a),!0))||[];y=new Response(Oy(y.body,Ny,w,()=>{T&&T(),g&&g()}),b)}l=l||"text";let E=await Wc[q.findKey(Wc,l)||"text"](y,n);return!x&&g&&g(),await new Promise((b,S)=>{qS(b,S,{data:E,headers:bn.from(y.headers),status:y.status,statusText:y.statusText,config:n,request:p})})}catch(v){throw g&&g(),v&&v.name==="TypeError"&&/fetch/i.test(v.message)?Object.assign(new Ie("Network Error",Ie.ERR_NETWORK,n,p),{cause:v.cause||v}):Ie.from(v,v&&v.code,n,p)}}),Kp={http:yk,xhr:qk,fetch:rL};q.forEach(Kp,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Fy=n=>`- ${n}`,iL=n=>q.isFunction(n)||n===null||n===!1,ZS={getAdapter:n=>{n=q.isArray(n)?n:[n];const{length:e}=n;let t,r;const i={};for(let s=0;s<e;s++){t=n[s];let o;if(r=t,!iL(t)&&(r=Kp[(o=String(t)).toLowerCase()],r===void 0))throw new Ie(`Unknown adapter '${o}'`);if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map(([a,u])=>`adapter ${a} `+(u===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(Fy).join(`
`):" "+Fy(s[0]):"as no adapter specified";throw new Ie("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:Kp};function Yf(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new la(null,n)}function My(n){return Yf(n),n.headers=bn.from(n.headers),n.data=qf.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),ZS.getAdapter(n.adapter||Bu.adapter)(n).then(function(r){return Yf(n),r.data=qf.call(n,n.transformResponse,r),r.headers=bn.from(r.headers),r},function(r){return KS(r)||(Yf(n),r&&r.response&&(r.response.data=qf.call(n,n.transformResponse,r.response),r.response.headers=bn.from(r.response.headers))),Promise.reject(r)})}const ew="1.8.4",Kd={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Kd[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const By={};Kd.transitional=function(e,t,r){function i(s,o){return"[Axios v"+ew+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return(s,o,a)=>{if(e===!1)throw new Ie(i(o," has been removed"+(t?" in "+t:"")),Ie.ERR_DEPRECATED);return t&&!By[o]&&(By[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};Kd.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function sL(n,e,t){if(typeof n!="object")throw new Ie("options must be an object",Ie.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=n[s],u=a===void 0||o(a,s,n);if(u!==!0)throw new Ie("option "+s+" must be "+u,Ie.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ie("Unknown option "+s,Ie.ERR_BAD_OPTION)}}const ic={assertOptions:sL,validators:Kd},br=ic.validators;class Cs{constructor(e){this.defaults=e,this.interceptors={request:new Ay,response:new Ay}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{r.stack?s&&!String(r.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+s):r.stack=s}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ms(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:s}=t;r!==void 0&&ic.assertOptions(r,{silentJSONParsing:br.transitional(br.boolean),forcedJSONParsing:br.transitional(br.boolean),clarifyTimeoutError:br.transitional(br.boolean)},!1),i!=null&&(q.isFunction(i)?t.paramsSerializer={serialize:i}:ic.assertOptions(i,{encode:br.function,serialize:br.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ic.assertOptions(t,{baseUrl:br.spelling("baseURL"),withXsrfToken:br.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&q.merge(s.common,s[t.method]);s&&q.forEach(["delete","get","head","post","put","patch","common"],p=>{delete s[p]}),t.headers=bn.concat(o,s);const a=[];let u=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(u=u&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});const l=[];this.interceptors.response.forEach(function(g){l.push(g.fulfilled,g.rejected)});let c,d=0,f;if(!u){const p=[My.bind(this),void 0];for(p.unshift.apply(p,a),p.push.apply(p,l),f=p.length,c=Promise.resolve(t);d<f;)c=c.then(p[d++],p[d++]);return c}f=a.length;let h=t;for(d=0;d<f;){const p=a[d++],g=a[d++];try{h=p(h)}catch(m){g.call(this,m);break}}try{c=My.call(this,h)}catch(p){return Promise.reject(p)}for(d=0,f=l.length;d<f;)c=c.then(l[d++],l[d++]);return c}getUri(e){e=Ms(this.defaults,e);const t=YS(e.baseURL,e.url,e.allowAbsoluteUrls);return HS(t,e.params,e.paramsSerializer)}}q.forEach(["delete","get","head","options"],function(e){Cs.prototype[e]=function(t,r){return this.request(Ms(r||{},{method:e,url:t,data:(r||{}).data}))}});q.forEach(["post","put","patch"],function(e){function t(r){return function(s,o,a){return this.request(Ms(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Cs.prototype[e]=t(),Cs.prototype[e+"Form"]=t(!0)});class Um{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(s,o,a){r.reason||(r.reason=new la(s,o,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Um(function(i){e=i}),cancel:e}}}function oL(n){return function(t){return n.apply(null,t)}}function aL(n){return q.isObject(n)&&n.isAxiosError===!0}const qp={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(qp).forEach(([n,e])=>{qp[e]=n});function tw(n){const e=new Cs(n),t=PS(Cs.prototype.request,e);return q.extend(t,Cs.prototype,e,{allOwnKeys:!0}),q.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return tw(Ms(n,i))},t}const je=tw(Bu);je.Axios=Cs;je.CanceledError=la;je.CancelToken=Um;je.isCancel=KS;je.VERSION=ew;je.toFormData=zd;je.AxiosError=Ie;je.Cancel=je.CanceledError;je.all=function(e){return Promise.all(e)};je.spread=oL;je.isAxiosError=aL;je.mergeConfig=Ms;je.AxiosHeaders=bn;je.formToJSON=n=>jS(q.isHTMLForm(n)?new FormData(n):n);je.getAdapter=ZS.getAdapter;je.HttpStatusCode=qp;je.default=je;const oe=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},uL=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=lL},lL=Number.MAX_SAFE_INTEGER||9007199254740991;let pe=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),V=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),I=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var Ae={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},de={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Qs{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class cL{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Qs(e),this.fast_=new Qs(t),this.defaultTTFB_=i,this.ttfb_=new Qs(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new Qs(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Qs(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Qs(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,i=e/1e3,s=r/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function dL(n,e,t){return(e=hL(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ke(){return Ke=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ke.apply(null,arguments)}function Uy(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ge(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Uy(Object(t),!0).forEach(function(r){dL(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Uy(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function fL(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hL(n){var e=fL(n,"string");return typeof e=="symbol"?e:e+""}class vi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Li,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Li=function(){},pL={trace:Li,debug:Li,log:Li,warn:Li,info:Li,error:Li};function Yp(){return Ke({},pL)}function gL(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Li}function $y(n,e,t){return e[n]?e[n].bind(e):gL(n,t)}const Xp=Yp();function mL(n,e,t){const r=Yp();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{r[s]=$y(s,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.0`)}catch{return Yp()}i.forEach(s=>{Xp[s]=$y(s,n)})}else Ke(Xp,r);return r}const Fe=Xp;function es(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function vL(n){return typeof self<"u"&&n===self.ManagedMediaSource}function nw(n,e){const t=Object.keys(n),r=Object.keys(e),i=t.length,s=r.length;return!i||!s||i===s&&!t.some(o=>r.indexOf(o)===-1)}function Fn(n,e=!1){if(typeof TextDecoder<"u"){const l=new TextDecoder("utf-8").decode(n);if(e){const c=l.indexOf("\0");return c!==-1?l.substring(0,c):l}return l.replace(/\0/g,"")}const t=n.length;let r,i,s,o="",a=0;for(;a<t;){if(r=n[a++],r===0&&e)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:i=n[a++],o+=String.fromCharCode((r&31)<<6|i&63);break;case 14:i=n[a++],s=n[a++],o+=String.fromCharCode((r&15)<<12|(i&63)<<6|(s&63)<<0);break}}return o}const Rr={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}};function yL(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Xf={exports:{}},Gy;function xL(){return Gy||(Gy=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(u,l,c){if(c=c||{},u=u.trim(),l=l.trim(),!l){if(!c.alwaysNormalize)return u;var d=a.parseURL(u);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(l);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):l;var h=a.parseURL(u);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var p=i.exec(h.path);h.netLoc=p[1],h.path=p[2]}h.netLoc&&!h.path&&(h.path="/");var g={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)g.path=h.path,f.params||(g.params=h.params,f.query||(g.query=h.query));else{var m=h.path,v=m.substring(0,m.lastIndexOf("/")+1)+f.path;g.path=a.normalizePath(v)}return g.path===null&&(g.path=c.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(g)},parseURL:function(u){var l=r.exec(u);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(o,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};n.exports=a})()}(Xf)),Xf.exports}var $m=xL();class Gm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var He={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class rw{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,bL(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let i;r.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[He.AUDIO]:null,[He.VIDEO]:null,[He.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Gm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=$m.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[He.AUDIO]=null,e[He.VIDEO]=null,e[He.AUDIOVIDEO]=null}}function Vt(n){return n.sn!=="initSegment"}class Qf extends rw{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(oe(e)&&oe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=oe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!oe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Vt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,i,s,o=!1){const{elementaryStreams:a}=this,u=a[e];if(!u){a[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:o};return}u.startPTS=Math.min(u.startPTS,t),u.endPTS=Math.max(u.endPTS,r),u.startDTS=Math.min(u.startDTS,i),u.endDTS=Math.max(u.endDTS,s)}}class EL extends rw{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function iw(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||iw(t,e)}}function bL(n,e){const t=iw(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Vc=Math.pow(2,32)-1,SL=[].push,sw={video:1,audio:2,id3:3,text:4};function wt(n){return String.fromCharCode.apply(null,n)}function ow(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function xe(n,e){const t=aw(n,e);return t<0?4294967296+t:t}function Wy(n,e){let t=xe(n,e);return t*=Math.pow(2,32),t+=xe(n,e+4),t}function aw(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function Jf(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function wL(n){const e=n.byteLength;for(let t=0;t<e;){const r=xe(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Te(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=xe(n,i),o=wt(n.subarray(i+4,i+8)),a=s>1?i+s:r;if(o===e[0])if(e.length===1)t.push(n.subarray(i+8,a));else{const u=Te(n.subarray(i+8,a),e.slice(1));u.length&&SL.apply(t,u)}i=a}return t}function TL(n){const e=[],t=n[0];let r=8;const i=xe(n,r);r+=4;let s=0,o=0;t===0?(s=xe(n,r),o=xe(n,r+4),r+=8):(s=Wy(n,r),o=Wy(n,r+8),r+=16),r+=2;let a=n.length+o;const u=ow(n,r);r+=2;for(let l=0;l<u;l++){let c=r;const d=xe(n,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return Fe.warn("SIDX has hierarchical references (not supported)"),null;const p=xe(n,c);c+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/i,start:a,end:a+f-1}}),a+=f,c+=4,r=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:u,references:e}}function uw(n){const e=[],t=Te(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],o=Te(s,["tkhd"])[0];if(o){let a=o[0];const u=xe(o,a===0?12:20),l=Te(s,["mdia","mdhd"])[0];if(l){a=l[0];const c=xe(l,a===0?12:20),d=Te(s,["mdia","hdlr"])[0];if(d){const f=wt(d.subarray(8,12)),h={soun:He.AUDIO,vide:He.VIDEO}[f],p=Te(s,["mdia","minf","stbl","stsd"])[0],g=_L(p);h?(e[u]={timescale:c,type:h,stsd:g},e[h]=Ge({timescale:c,id:u},g)):e[u]={timescale:c,type:f,stsd:g}}}}}return Te(n,["moov","mvex","trex"]).forEach(i=>{const s=xe(i,4),o=e[s];o&&(o.default={duration:xe(i,12),flags:xe(i,20)})}),e}function _L(n){const e=n.subarray(8),t=e.subarray(86),r=wt(e.subarray(4,8));let i=r,s;const o=r==="enca"||r==="encv";if(o){const l=Te(e,[r])[0].subarray(r==="enca"?28:78);Te(l,["sinf"]).forEach(d=>{const f=Te(d,["schm"])[0];if(f){const h=wt(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const p=Te(d,["frma"])[0];p&&(i=wt(p))}}})}const a=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const u=Te(t,["avcC"])[0];i+="."+ml(u[1])+ml(u[2])+ml(u[3]),s=gl(a==="avc1"?"dva1":"dvav",t);break}case"mp4a":{const u=Te(e,[r])[0],l=Te(u.subarray(28),["esds"])[0];if(l&&l.length>7){let c=4;if(l[c++]!==3)break;c=Zf(l,c),c+=2;const d=l[c++];if(d&128&&(c+=2),d&64&&(c+=l[c++]),l[c++]!==4)break;c=Zf(l,c);const f=l[c++];if(f===64)i+="."+ml(f);else break;if(c+=12,l[c++]!==5)break;c=Zf(l,c);const h=l[c++];let p=(h&248)>>3;p===31&&(p+=1+((h&7)<<3)+((l[c]&224)>>5)),i+="."+p}break}case"hvc1":case"hev1":{const u=Te(t,["hvcC"]);if(u){const l=u[0],c=l[1],d=["","A","B","C"][c>>6],f=c&31,h=xe(l,2),p=(c&32)>>5?"H":"L",g=l[12],m=l.subarray(6,12);i+="."+d+f,i+="."+h.toString(16).toUpperCase(),i+="."+p+g;let v="";for(let y=m.length;y--;){const x=m[y];(x||v)&&(v="."+x.toString(16).toUpperCase()+v)}i+=v}s=gl(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=gl(i,t)||i;break}case"vp09":{const u=Te(t,["vpcC"])[0],l=u[4],c=u[5],d=u[6]>>4&15;i+="."+_r(l)+"."+_r(c)+"."+_r(d);break}case"av01":{const u=Te(t,["av1C"])[0],l=u[1]>>>5,c=u[1]&31,d=u[2]>>>7?"H":"M",f=(u[2]&64)>>6,h=(u[2]&32)>>5,p=l===2&&f?h?12:10:f?10:8,g=(u[2]&16)>>4,m=(u[2]&8)>>3,v=(u[2]&4)>>2,y=u[2]&3;i+="."+l+"."+_r(c)+d+"."+_r(p)+"."+g+"."+m+v+y+"."+_r(1)+"."+_r(1)+"."+_r(1)+"."+0,s=gl("dav1",t);break}}return{codec:i,encrypted:o,supplemental:s}}function gl(n,e){const t=Te(e,["dvvC"]),r=t.length?t[0]:Te(e,["dvcC"])[0];if(r){const i=r[2]>>1&127,s=r[2]<<5&32|r[3]>>3&31;return n+"."+_r(i)+"."+_r(s)}}function Zf(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function ml(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function _r(n){return(n<10?"0":"")+n}function IL(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&Te(n,["moov","trak"]).forEach(i=>{const o=Te(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=Te(o,["enca"]);const u=a.length>0;u||(a=Te(o,["encv"])),a.forEach(l=>{const c=u?l.subarray(28):l.subarray(78);Te(c,["sinf"]).forEach(f=>{const h=lw(f);if(h){const p=h.subarray(8,24);p.some(g=>g!==0)||(Fe.log(`[eme] Patching keyId in 'enc${u?"a":"v"}>sinf>>tenc' box: ${Rr.hexDump(p)} -> ${Rr.hexDump(t)}`),h.set(t,8))}})})}),n}function lw(n){const e=Te(n,["schm"])[0];if(e){const t=wt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Te(n,["schi","tenc"])[0]}return null}function RL(n,e){return Te(e,["moof","traf"]).reduce((t,r)=>{const i=Te(r,["tfdt"])[0],s=i[0],o=Te(r,["tfhd"]).reduce((a,u)=>{const l=xe(u,4),c=n[l];if(c){let d=xe(i,4);if(s===1){if(d===Vc)return Fe.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=Vc+1,d+=xe(i,8)}const f=c.timescale||9e4,h=d/f;if(oe(h)&&(a===null||h<a))return h}return a},null);return o!==null&&oe(o)&&(t===null||o<t)?o:t},null)}function CL(n,e){let t=0,r=0,i=0;const s=Te(n,["moof","traf"]);for(let o=0;o<s.length;o++){const a=s[o],u=Te(a,["tfhd"])[0],l=xe(u,4),c=e[l];if(!c)continue;const d=c.default,f=xe(u,0)|(d==null?void 0:d.flags);let h=d==null?void 0:d.duration;f&8&&(f&2?h=xe(u,12):h=xe(u,8));const p=c.timescale||9e4,g=Te(a,["trun"]);for(let m=0;m<g.length;m++){if(t=AL(g[m]),!t&&h){const v=xe(g[m],4);t=h*v}c.type===He.VIDEO?r+=t/p:c.type===He.AUDIO&&(i+=t/p)}}if(r===0&&i===0){let o=1/0,a=0,u=0;const l=Te(n,["sidx"]);for(let c=0;c<l.length;c++){const d=TL(l[c]);if(d!=null&&d.references){o=Math.min(o,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((h,p)=>h+p.info.duration||0,0);a=Math.max(a,f+d.earliestPresentationTime/d.timescale),u=a-o}}if(u&&oe(u))return u}return r||i}function AL(n){const e=xe(n,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let r=0;const i=xe(n,4);for(let s=0;s<i;s++){if(e&256){const o=xe(n,t);r+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return r}function kL(n,e,t){Te(e,["moof","traf"]).forEach(r=>{Te(r,["tfhd"]).forEach(i=>{const s=xe(i,4),o=n[s];if(!o)return;const a=o.timescale||9e4;Te(r,["tfdt"]).forEach(u=>{const l=u[0],c=t*a;if(c){let d=xe(u,4);if(l===0)d-=c,d=Math.max(d,0),Jf(u,4,d);else{d*=Math.pow(2,32),d+=xe(u,8),d-=c,d=Math.max(d,0);const f=Math.floor(d/(Vc+1)),h=Math.floor(d%(Vc+1));Jf(u,4,f),Jf(u,8,h)}}})})})}function LL(n){const e={valid:null,remainder:null},t=Te(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function tr(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Vy(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let o=!1;return Te(r,["moof"]).map(u=>{const l=u.byteOffset-8;Te(u,["traf"]).map(d=>{const f=Te(d,["tfdt"]).map(h=>{const p=h[0];let g=xe(h,4);return p===1&&(g*=Math.pow(2,32),g+=xe(h,8)),g/i})[0];return f!==void 0&&(n=f),Te(d,["tfhd"]).map(h=>{const p=xe(h,4),g=xe(h,0)&16777215,m=(g&1)!==0,v=(g&2)!==0,y=(g&8)!==0;let x=0;const E=(g&16)!==0;let b=0;const S=(g&32)!==0;let w=8;p===s&&(m&&(w+=8),v&&(w+=4),y&&(x=xe(h,w),w+=4),E&&(b=xe(h,w),w+=4),S&&(w+=4),e.type==="video"&&(o=qd(e.codec)),Te(d,["trun"]).map(T=>{const R=T[0],_=xe(T,0)&16777215,A=(_&1)!==0;let k=0;const G=(_&4)!==0,U=(_&256)!==0;let M=0;const B=(_&512)!==0;let $=0;const D=(_&1024)!==0,P=(_&2048)!==0;let O=0;const K=xe(T,4);let Y=8;A&&(k=xe(T,Y),Y+=4),G&&(Y+=4);let ee=k+l;for(let ne=0;ne<K;ne++){if(U?(M=xe(T,Y),Y+=4):M=x,B?($=xe(T,Y),Y+=4):$=b,D&&(Y+=4),P&&(R===0?O=xe(T,Y):O=aw(T,Y),Y+=4),e.type===He.VIDEO){let ie=0;for(;ie<$;){const se=xe(r,ee);if(ee+=4,DL(o,r[ee])){const ye=r.subarray(ee,ee+se);Wm(ye,o?2:1,n+O/i,t)}ee+=se,ie+=se+4}}n+=M/i}}))})})}),t}function qd(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function DL(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Wm(n,e,t,r){const i=cw(n);let s=0;s+=e;let o=0,a=0,u=0;for(;s<i.length;){o=0;do{if(s>=i.length)break;u=i[s++],o+=u}while(u===255);a=0;do{if(s>=i.length)break;u=i[s++],a+=u}while(u===255);const l=i.length-s;let c=s;if(a<l)s+=a;else if(a>l){Fe.error(`Malformed SEI payload. ${a} is too small, only ${l} bytes left to parse.`);break}if(o===4){if(i[c++]===181){const f=ow(i,c);if(c+=2,f===49){const h=xe(i,c);if(c+=4,h===1195456820){const p=i[c++];if(p===3){const g=i[c++],m=31&g,v=64&g,y=v?2+m*3:0,x=new Uint8Array(y);if(v){x[0]=g;for(let E=1;E<y;E++)x[E]=i[c++]}r.push({type:p,payloadType:o,pts:t,bytes:x})}}}}}else if(o===5&&a>16){const d=[];for(let p=0;p<16;p++){const g=i[c++].toString(16);d.push(g.length==1?"0"+g:g),(p===3||p===5||p===7||p===9)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let p=0;p<f;p++)h[p]=i[c++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:Fn(h),userDataBytes:h})}}}function cw(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const i=e-t.length,s=new Uint8Array(i);let o=0;for(r=0;r<i;o++,r++)o===t[0]&&(o++,t.shift()),s[r]=n[o];return s}function PL(n){const e=n[0];let t="",r="",i=0,s=0,o=0,a=0,u=0,l=0;if(e===0){for(;wt(n.subarray(l,l+1))!=="\0";)t+=wt(n.subarray(l,l+1)),l+=1;for(t+=wt(n.subarray(l,l+1)),l+=1;wt(n.subarray(l,l+1))!=="\0";)r+=wt(n.subarray(l,l+1)),l+=1;r+=wt(n.subarray(l,l+1)),l+=1,i=xe(n,12),s=xe(n,16),a=xe(n,20),u=xe(n,24),l=28}else if(e===1){l+=4,i=xe(n,l),l+=4;const d=xe(n,l);l+=4;const f=xe(n,l);for(l+=4,o=2**32*d+f,uL(o)||(o=Number.MAX_SAFE_INTEGER,Fe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=xe(n,l),l+=4,u=xe(n,l),l+=4;wt(n.subarray(l,l+1))!=="\0";)t+=wt(n.subarray(l,l+1)),l+=1;for(t+=wt(n.subarray(l,l+1)),l+=1;wt(n.subarray(l,l+1))!=="\0";)r+=wt(n.subarray(l,l+1)),l+=1;r+=wt(n.subarray(l,l+1)),l+=1}const c=n.subarray(l,n.byteLength);return{schemeIdUri:t,value:r,timeScale:i,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:u,payload:c}}function OL(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}function NL(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,i;r=0,i=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),OL([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,o,t||new Uint8Array)}function FL(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const i=new DataView(n,r),s=ML(i);e.push(s),r+=s.size}}return e}function ML(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const o=n.buffer,a=Rr.hexDump(new Uint8Array(o,t+12,16)),u=n.getUint32(28);let l=null,c=null;if(s===0){if(e-32<u||u<22)return{offset:t,size:e};c=new Uint8Array(o,t+32,u)}else if(s===1){if(!u||r<t+32+u*16+16)return{offset:t,size:e};l=[];for(let d=0;d<u;d++)l.push(new Uint8Array(o,t+32+d*16,16))}return{version:s,systemId:a,kids:l,data:c,offset:t,size:e}}const dw=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Yo={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function fw(n,e){const t=Yo[e];return!!t&&!!t[n.slice(0,4)]}function Qp(n,e,t=!0){return!n.split(",").some(r=>!hw(r,e,t))}function hw(n,e,t=!0){var r;const i=es(t);return(r=i==null?void 0:i.isTypeSupported(mu(n,e)))!=null?r:!1}function mu(n,e){return`${e}/mp4;codecs=${n}`}function Hy(n){if(n){const e=n.substring(0,4);return Yo.video[e]}return 2}function Hc(n){const e=dw();return n.split(",").reduce((t,r)=>{const s=e&&qd(r)?9:Yo.video[r];return s?(s*2+t)/(t?3:2):(Yo.audio[r]+t)/(t?2:1)},0)}const eh={};function BL(n,e=!0){if(eh[n])return eh[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var r;if(hw(t[i],"audio",e))return eh[n]=t[i],t[i];if(t[i]==="mp3"&&(r=es(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const UL=/flac|opus|mp4a\.40\.34/i;function zc(n,e=!0){return n.replace(UL,t=>BL(t.toLowerCase(),e))}function $L(n,e){const t=[];if(n){const r=n.split(",");for(let i=0;i<r.length;i++)fw(r[i],"video")||t.push(r[i])}return e&&t.push(e),t.join(",")}function sc(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function GL(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");if(r.length>2){let i=r.shift()+".";i+=parseInt(r.shift()).toString(16),i+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e[t]=i}}return e.join(",")}function WL(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function zy(n){const e=es(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function pw(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const gw={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function mw(n,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:n}}const jy={};function VL(n,e,t,r,i,s){const o=n.audioCodec?n.audioGroups:null,a=s==null?void 0:s.audioCodec,u=s==null?void 0:s.channels,l=u?parseInt(u):a?1/0:2;let c=null;if(o!=null&&o.length)try{o.length===1&&o[0]?c=e.groups[o[0]].channels:c=o.reduce((d,f)=>{if(f){const h=e.groups[f];if(!h)throw new Error(`Audio track group ${f} not found`);Object.keys(h.channels).forEach(p=>{d[p]=(d[p]||0)+h.channels[p]})}return d},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!c&&oe(l)&&Object.keys(c).some(d=>parseInt(d)>l)}function vw(n,e,t){const r=n.videoCodec,i=n.audioCodec;if(!r&&!i||!t)return Promise.resolve(gw);const s=[];if(r){const o={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},a=n.videoRange;a!=="SDR"&&(o.transferFunction=a.toLowerCase());const u=r.split(","),l=navigator.userAgent;if(u.some(c=>qd(c))&&dw())return Promise.resolve(mw(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${l})`),s));s.push.apply(s,u.map(c=>({type:"media-source",video:Ge(Ge({},o),{},{contentType:mu(WL(c),"video")})})))}return i&&n.audioGroups&&n.audioGroups.forEach(o=>{var a;o&&((a=e.groups[o])==null||a.tracks.forEach(u=>{if(u.groupId===o){const l=u.channels||"",c=parseFloat(l);oe(c)&&c>2&&s.push.apply(s,i.split(",").map(d=>({type:"media-source",audio:{contentType:mu(d,"audio"),channels:""+c}})))}}))}),Promise.all(s.map(o=>{const a=HL(o);return jy[a]||(jy[a]=t.decodingInfo(o))})).then(o=>({supported:!o.some(a=>!a.supported),configurations:s,decodingInfoResults:o})).catch(o=>({supported:!1,configurations:s,decodingInfoResults:[],error:o}))}function HL(n){const{audio:e,video:t}=n,r=t||e;if(r){const i=pw(r.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${i}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${i}`}return""}const Jp=["NONE","TYPE-0","TYPE-1",null];function zL(n){return Jp.indexOf(n)>-1}const jc=["SDR","PQ","HLG"];function jL(n){return!!n&&jc.indexOf(n)>-1}var oc={No:"",Yes:"YES",v2:"v2"};function Ky(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,i=r<e/2;return e&&i?t?oc.v2:oc.Yes:oc.No}class qy{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class vu{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Yy(this._audioGroups,e)}hasSubtitleGroup(e){return Yy(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Yy(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function KL(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function qL(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||jc.slice(0);const i=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&KL(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const YL=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},st=(n,e)=>JSON.stringify(n,YL(e));function XL(n,e,t,r,i){const s=Object.keys(n),o=r==null?void 0:r.channels,a=r==null?void 0:r.audioCodec,u=i==null?void 0:i.videoCodec,l=o&&parseInt(o)===2;let c=!1,d=!1,f=1/0,h=1/0,p=1/0,g=1/0,m=0,v=[];const{preferHDR:y,allowedVideoRanges:x}=qL(e,i);for(let T=s.length;T--;){const R=n[s[T]];c||(c=R.channels[2]>0),f=Math.min(f,R.minHeight),h=Math.min(h,R.minFramerate),p=Math.min(p,R.minBitrate),x.filter(A=>R.videoRanges[A]>0).length>0&&(d=!0)}f=oe(f)?f:0,h=oe(h)?h:0;const E=Math.max(1080,f),b=Math.max(30,h);p=oe(p)?p:t,t=Math.max(p,t),d||(e=void 0);const S=s.length>1;return{codecSet:s.reduce((T,R)=>{const _=n[R];if(R===T)return T;if(v=d?x.filter(A=>_.videoRanges[A]>0):[],S){if(_.minBitrate>t)return Sr(R,`min bitrate of ${_.minBitrate} > current estimate of ${t}`),T;if(!_.hasDefaultAudio)return Sr(R,"no renditions with default or auto-select sound found"),T;if(a&&R.indexOf(a.substring(0,4))%5!==0)return Sr(R,`audio codec preference "${a}" not found`),T;if(o&&!l){if(!_.channels[o])return Sr(R,`no renditions with ${o} channel sound found (channels options: ${Object.keys(_.channels)})`),T}else if((!a||l)&&c&&_.channels[2]===0)return Sr(R,"no renditions with stereo sound found"),T;if(_.minHeight>E)return Sr(R,`min resolution of ${_.minHeight} > maximum of ${E}`),T;if(_.minFramerate>b)return Sr(R,`min framerate of ${_.minFramerate} > maximum of ${b}`),T;if(!v.some(A=>_.videoRanges[A]>0))return Sr(R,`no variants with VIDEO-RANGE of ${st(v)} found`),T;if(u&&R.indexOf(u.substring(0,4))%5!==0)return Sr(R,`video codec preference "${u}" not found`),T;if(_.maxScore<m)return Sr(R,`max score of ${_.maxScore} < selected max of ${m}`),T}return T&&(Hc(R)>=Hc(T)||_.fragmentError>n[T].fragmentError)?T:(g=_.minIndex,m=_.maxScore,R)},void 0),videoRanges:v,preferHDR:y,minFramerate:h,minBitrate:p,minIndex:g}}function Sr(n,e){Fe.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function yw(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function QL(n,e,t,r){return n.slice(t,r+1).reduce((i,s,o)=>{if(!s.codecSet)return i;const a=s.audioGroups;let u=i[s.codecSet];u||(i[s.codecSet]=u={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),u.minBitrate=Math.min(u.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return u.minHeight=Math.min(u.minHeight,l),u.minFramerate=Math.min(u.minFramerate,s.frameRate),u.minIndex=Math.min(u.minIndex,o),u.maxScore=Math.max(u.maxScore,s.score),u.fragmentError+=s.fragmentError,u.videoRanges[s.videoRange]=(u.videoRanges[s.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(u.hasDefaultAudio=u.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{u.channels[f]=(u.channels[f]||0)+d.channels[f]}))}),i},{})}function Xy(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}}function Pr(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const i=e[r];if(As(n,i,t))return r}return-1}function As(n,e,t){const{groupId:r,name:i,lang:s,assocLang:o,default:a}=n,u=n.forced;return(r===void 0||e.groupId===r)&&(i===void 0||e.name===i)&&(s===void 0||JL(s,e.lang))&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(u===void 0||e.forced===u)&&(!("characteristics"in n)||ZL(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function JL(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function ZL(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(i=>r.indexOf(i)===-1)}function ms(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function eD(n,e,t,r,i){const s=e[r],a=e.reduce((f,h,p)=>{const g=h.uri;return(f[g]||(f[g]=[])).push(p),f},{})[s.uri];a.length>1&&(r=Math.max.apply(Math,a));const u=s.videoRange,l=s.frameRate,c=s.codecSet.substring(0,4),d=Qy(e,r,f=>{if(f.videoRange!==u||f.frameRate!==l||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,p=t.filter(g=>!h||h.indexOf(g.groupId)!==-1);return Pr(n,p,i)>-1});return d>-1?d:Qy(e,r,f=>{const h=f.audioGroups,p=t.filter(g=>!h||h.indexOf(g.groupId)!==-1);return Pr(n,p,i)>-1})}function Qy(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function Kc(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class tD extends vi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:i,partCurrent:s,hls:o}=this,{autoLevelEnabled:a,media:u}=o;if(!i||!u)return;const l=performance.now(),c=s?s.stats:i.stats,d=s?s.duration:i.duration,f=l-c.loading.start,h=o.minAutoLevel,p=i.level,g=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||p<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const m=g>-1&&g!==p,v=!!t||m;if(!v&&(u.paused||!u.playbackRate||!u.readyState))return;const y=o.mainForwardBufferInfo;if(!v&&y===null)return;const x=this.bwEstimator.getEstimateTTFB(),E=Math.abs(u.playbackRate);if(f<=Math.max(x,1e3*(d/(E*2))))return;const b=y?y.len/E:0,S=c.loading.first?c.loading.first-c.loading.start:-1,w=c.loaded&&S>-1,T=this.getBwEstimate(),R=o.levels,_=R[p],A=Math.max(c.loaded,Math.round(d*(i.bitrate||_.averageBitrate)/8));let k=w?f-S:f;k<1&&w&&(k=Math.min(f,c.loaded*8/T));const G=w?c.loaded*1e3/k:0,U=x/1e3,M=G?(A-c.loaded)/G:A*8/T+U;if(M<=b)return;const B=G?G*8:T,$=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,D=this.hls.config.abrBandWidthUpFactor;let P=Number.POSITIVE_INFINITY,O;for(O=p-1;O>h;O--){const ne=R[O].maxBitrate,ie=!R[O].details||$;if(P=this.getTimeToLoadFrag(U,B,d*ne,ie),P<Math.min(b,d+U))break}if(P>=M||P>d*10)return;w?this.bwEstimator.sample(f-Math.min(x,S),c.loaded):this.bwEstimator.sampleTTFB(f);const K=R[O].maxBitrate;this.getBwEstimate()*D>K&&this.resetEstimator(K);const Y=this.findBestLevel(K,h,O,0,b,1,1);Y>-1&&(O=Y),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${b.toFixed(3)} s
      Estimated load time for current fragment: ${M.toFixed(3)} s
      Estimated load time for down switch fragment: ${P.toFixed(3)} s
      TTFB estimate: ${S|0} ms
      Current BW estimate: ${oe(T)?T|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${O} @ ${K|0} bps`),o.nextLoadLevel=o.nextAutoLevel=O,this.clearTimer();const ee=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===O&&O>0){const ne=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${O>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${ne.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,O>h){let ie=this.findBestLevel(this.hls.levels[h].bitrate,h,O,0,ne,1,1);ie===-1&&(ie=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ie,this.resetEstimator(this.hls.levels[ie].bitrate)}}};m||M>P*2?ee():this.timer=self.setInterval(ee,P*1e3),o.trigger(I.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new cL(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(I.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case V.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:i,partCurrent:s}=this;if(r&&i&&r.sn===i.sn&&r.level===i.level){const o=performance.now(),a=s?s.stats:r.stats,u=o-a.loading.start,l=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&l>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(d,l),a.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(e,t,r,i){const s=e+r/t,o=i?e+this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;oe(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===de.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+i.loaded,u=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:u},o.realBitrate=Math.round(8*a/u)}if(t.bitrateTest){const s={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(I.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==de.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,i,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,u=this.getBwEstimate(),l=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(l){const m=this.findBestLevel(u,o,i,l,0,c,d);if(m>=0)return this.rebufferNotice=-1,m}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!l){const m=this.bitrateTestDelay;m&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-m,this.info(`bitrate test took ${Math.round(1e3*m)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(u,o,i,l,f,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const p=r.levels[o],g=r.loadLevelObj;return g&&(p==null?void 0:p.bitrate)<g.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,s,o,a){var u;const l=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:p,allAudioTracks:g,loadLevel:m,config:v}=this.hls;if(p.length===1)return 0;const y=p[d],x=!!((u=this.hls.latestLevelDetails)!=null&&u.live),E=m===-1||c===-1;let b,S="SDR",w=(y==null?void 0:y.frameRate)||0;const{audioPreference:T,videoPreference:R}=v,_=this.audioTracksByGroup||(this.audioTracksByGroup=yw(g));let A=-1;if(E){if(this.firstSelection!==-1)return this.firstSelection;const B=this.codecTiers||(this.codecTiers=QL(p,_,t,r)),$=XL(B,S,e,T,R),{codecSet:D,videoRanges:P,minFramerate:O,minBitrate:K,minIndex:Y,preferHDR:ee}=$;A=Y,b=D,S=ee?P[P.length-1]:P[0],w=O,e=Math.max(e,K),this.log(`picked start tier ${st($)}`)}else b=y==null?void 0:y.codecSet,S=y==null?void 0:y.videoRange;const k=h?h.duration:f?f.duration:0,G=this.bwEstimator.getEstimateTTFB()/1e3,U=[];for(let B=r;B>=t;B--){var M;const $=p[B],D=B>d;if(!$)continue;if(v.useMediaCapabilities&&!$.supportedResult&&!$.supportedPromise){const ie=navigator.mediaCapabilities;typeof(ie==null?void 0:ie.decodingInfo)=="function"&&(VL($,_,S,w,e,T)||qd($.videoCodec))?($.supportedPromise=vw($,_,ie),$.supportedPromise.then(se=>{if(!this.hls)return;$.supportedResult=se;const ye=this.hls.levels,Ee=ye.indexOf($);se.error?this.warn(`MediaCapabilities decodingInfo error: "${se.error}" for level ${Ee} ${st(se)}`):se.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ee} ${st(se)}`),Ee>-1&&ye.length>1&&(this.log(`Removing unsupported level ${Ee}`),this.hls.removeLevel(Ee),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):$.supportedResult=gw}if((b&&$.codecSet!==b||S&&$.videoRange!==S||D&&w>$.frameRate||!D&&w>0&&w<$.frameRate||$.supportedResult&&!((M=$.supportedResult.decodingInfoResults)!=null&&M[0].smooth))&&(!E||B!==A)){U.push(B);continue}const P=$.details,O=(h?P==null?void 0:P.partTarget:P==null?void 0:P.averagetargetduration)||k;let K;D?K=a*e:K=o*e;const Y=k&&i>=k*2&&s===0?$.averageBitrate:$.maxBitrate,ee=this.getTimeToLoadFrag(G,K,Y*O,P===void 0);if(K>=Y&&(B===c||$.loadError===0&&$.fragmentError===0)&&(ee<=G||!oe(ee)||x&&!this.bitrateTestDelay||ee<l)){const ie=this.forcedAutoLevel;return B!==m&&(ie===-1||ie!==m)&&(U.length&&this.trace(`Skipped level(s) ${U.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${p[U[0]].codecs}" ${p[U[0]].videoRange}; not compatible with "${b}" ${S}`),this.info(`switch candidate:${d}->${B} adjustedbw(${Math.round(K)})-bitrate=${Math.round(K-Y)} ttfb:${G.toFixed(1)} avgDuration:${O.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${ee.toFixed(1)} firstSelection:${E} codecSet:${$.codecSet} videoRange:${$.videoRange} hls.loadLevel:${m}`)),E&&(this.firstSelection=B),B}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const Vm={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const o=e(s);if(o>0)t=i+1;else if(o<0)r=i-1;else return s}return null}};function nD(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!oe(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;t=t||0;for(let s=0;s<n.length;++s){const o=n[s];if(iD(e,t,o))return o}return null}function Bs(n,e,t=0,r=0,i=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&Jy(t,r,s)===0||rD(s,n,Math.min(i,r))))return s;const o=Vm.search(e,Jy.bind(null,t,r));return o&&(o!==n||!s)?o:s}function rD(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return n.start<=r}return!1}function Jy(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function iD(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function xw(n,e){return Vm.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}function sD(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){const r=t.start,i=t.end;let s=n.fragments;if(!t.relurl){const{fragmentHint:o}=n;o&&(s=s.concat(o))}return Vm.search(s,o=>o.cc<e||o.end<=r?1:o.cc>e||o.start>=i?-1:0)}return null}function qc(n){switch(n.details){case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_TIMEOUT:case V.LEVEL_LOAD_TIMEOUT:case V.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Zy(n,e){const t=qc(e);return n.default[`${t?"timeout":"error"}Retry`]}function Hm(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function ex(n){return Ge(Ge({},n),{errorRetry:null,timeoutRetry:null})}function Yc(n,e,t,r){if(!n)return!1;const i=r==null?void 0:r.code,s=e<n.maxNumRetry&&(oD(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,s):s}function oD(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}var Xt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ar={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class aD extends vi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.ERROR,this.onError,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.ERROR,this.onError,this),e.off(I.ERROR,this.onErrorOut,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===de.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case V.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=yu();return}case V.FRAG_GAP:case V.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Xt.SendAlternateToPenaltyBox;return}case V.LEVEL_EMPTY_ERROR:case V.LEVEL_PARSING_ERROR:{var o,a;const l=t.parent===de.MAIN?t.level:i.loadLevel;t.details===V.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(a=o.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case V.LEVEL_LOAD_ERROR:case V.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case V.AUDIO_TRACK_LOAD_ERROR:case V.AUDIO_TRACK_LOAD_TIMEOUT:case V.SUBTITLE_LOAD_ERROR:case V.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=i.loadLevelObj;if(l&&(s.type===Ae.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===Ae.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Xt.SendAlternateToPenaltyBox,t.errorAction.flags=ar.MoveAllAlternatesMatchingHost;return}}return;case V.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const l=i.loadLevelObj,c=l==null?void 0:l.attrs["HDCP-LEVEL"];c?t.errorAction={action:Xt.SendAlternateToPenaltyBox,flags:ar.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case V.BUFFER_ADD_CODEC_ERROR:case V.REMUX_ALLOC_ERROR:case V.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:i.loadLevel)}return;case V.INTERNAL_EXCEPTION:case V.BUFFER_APPENDING_ERROR:case V.BUFFER_FULL_ERROR:case V.LEVEL_SWITCH_ERROR:case V.BUFFER_STALLED_ERROR:case V.BUFFER_SEEK_OVER_HOLE:case V.BUFFER_NUDGE_ON_STALL:t.errorAction=yu();return}t.type===pe.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,i=Zy(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(Yc(i,s,qc(e),e.response))return{action:Xt.RetryRequest,flags:ar.None,retryConfig:i,retryCount:s};const a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=Zy(e.details.startsWith("key")?o:s,e),u=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==V.FRAG_GAP&&i.fragmentError++,Yc(a,u,qc(e),e.response)))return{action:Xt.RetryRequest,flags:ar.None,retryConfig:a,retryCount:u};const l=this.getLevelSwitchAction(e,r);return a&&(l.retryConfig=a,l.retryCount=u),l}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var s,o;const l=e.details;i.loadError++,l===V.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:p}=r;r.autoLevelEnabled||(r.loadLevel=-1);const g=(s=e.frag)==null?void 0:s.type,v=(g===de.AUDIO&&l===V.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(l===V.BUFFER_ADD_CODEC_ERROR||l===V.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:S})=>i.audioCodec!==S),x=e.sourceBufferName==="video"&&(l===V.BUFFER_ADD_CODEC_ERROR||l===V.BUFFER_APPEND_ERROR)&&d.some(({codecSet:S,audioCodec:w})=>i.codecSet!==S&&i.audioCodec===w),{type:E,groupId:b}=(o=e.context)!=null?o:{};for(let S=d.length;S--;){const w=(S+f)%d.length;if(w!==f&&w>=h&&w<=p&&d[w].loadError===0){var a,u;const T=d[w];if(l===V.FRAG_GAP&&g===de.MAIN&&e.frag){const R=d[w].details;if(R){const _=Bs(e.frag,R.fragments,e.frag.start);if(_!=null&&_.gap)continue}}else{if(E===Ae.AUDIO_TRACK&&T.hasAudioGroup(b)||E===Ae.SUBTITLE_TRACK&&T.hasSubtitleGroup(b))continue;if(g===de.AUDIO&&(a=i.audioGroups)!=null&&a.some(R=>T.hasAudioGroup(R))||g===de.SUBTITLE&&(u=i.subtitleGroups)!=null&&u.some(R=>T.hasSubtitleGroup(R))||v&&i.audioCodec===T.audioCodec||!v&&i.audioCodec!==T.audioCodec||x&&i.codecSet===T.codecSet)continue}c=w;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Xt.SendAlternateToPenaltyBox,flags:ar.None,nextAutoLevel:c}}return{action:Xt.SendAlternateToPenaltyBox,flags:ar.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Xt.DoNothing:break;case Xt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==V.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:s,nextAutoLevel:o}=r;switch(i){case ar.None:this.switchLevel(e,o);break;case ar.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=Jp[Jp.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===V.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=pw(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===r&&this.hls.removeLevel(s)}}}function yu(n){const e={action:Xt.DoNothing,flags:ar.None};return n&&(e.resolved=!0),e}var _t={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class uD{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;const o=s.end;if(s.start<=e&&o!==null&&e<=o)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:i}=this,s=Object.keys(i);for(let o=s.length;o--;){const a=i[s[o]];if((a==null?void 0:a.body.type)===t&&(!r||a.buffered)){const u=a.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,r,i,s){this.timeRanges&&(this.timeRanges[e]=t);const o=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const u=this.fragments[a];if(!u||o>=u.body.sn)return;if(!u.buffered&&(!u.loaded||s)){u.body.type===r&&this.removeFragment(u.body);return}const l=u.range[e];if(l){if(l.time.length===0){this.removeFragment(u.body);return}l.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(u.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,i=Js(r),s=this.fragments[i];if(!s||s.buffered&&r.gap)return;const o=!r.relurl;Object.keys(t).forEach(a=>{const u=r.elementaryStreams[a];if(!u)return;const l=t[a],c=o||u.partial===!0;s.range[a]=this.getBufferedTimes(r,e.part,c,l)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=r.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),vl(s)||this.removeParts(r.sn-1,r.type)):this.removeFragment(s.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=Js(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},o=e.start,a=e.end,u=e.minEndPTS||a,l=e.maxStartPTS||o;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,f=i.end(c)+this.bufferPadding;if(l>=d&&u<=f){s.time.push({startPTS:Math.max(o,i.start(c)),endPTS:Math.min(a,i.end(c))});break}else if(o<f&&a>d){const h=Math.max(o,i.start(c)),p=Math.min(a,i.end(c));p>h&&(s.partial=!0,s.time.push({startPTS:h,endPTS:p}))}else if(a<=d)break}return s}getPartialFragment(e){let t=null,r,i,s,o=0;const{bufferPadding:a,fragments:u}=this;return Object.keys(u).forEach(l=>{const c=u[l];c&&vl(c)&&(i=c.body.start-a,s=c.body.end+a,e>=i&&e<=s&&(r=Math.min(e-i,s-e),o<=r&&(t=c.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||vl(t))}getState(e){const t=Js(e),r=this.fragments[t];return r?r.buffered?vl(r)?_t.PARTIAL:_t.OK:_t.APPENDING:_t.NOT_LOADED}isTimeBuffered(e,t,r){let i,s;for(let o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,s=r.end(o)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,i=t.part?null:t,s=Js(r);this.fragments[s]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s,type:o}=t;if(r.sn==="initSegment")return;const a=r.type;if(i){let l=this.activePartLists[a];l||(this.activePartLists[a]=l=[]),l.push(i)}this.timeRanges=s;const u=s[o];this.detectEvictedFragments(o,u,a,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Js(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let i=r.length;i--;){const s=t[r[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const u=a.body;u.type!==r||i&&!u.gap||u.start<t&&u.end>e&&(a.buffered||s)&&this.removeFragment(u)})}removeFragment(e){const t=Js(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=r.filter(s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const r=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;r&&r.forEach(i=>i.clearElementaryStreamInfo())}}function vl(n){var e,t,r;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((r=n.range.audiovideo)==null?void 0:r.partial))}function Js(n){return`${n.type}_${n.level}_${n.sn}`}var ts={cbc:0,ctr:1};class lD{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case ts.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ts.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function cD(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class dD{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(i*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],o=r[2],a=r[3],u=this.invSubMix,l=u[0],c=u[1],d=u[2],f=u[3],h=new Uint32Array(256);let p=0,g=0,m=0;for(m=0;m<256;m++)m<128?h[m]=m<<1:h[m]=m<<1^283;for(m=0;m<256;m++){let v=g^g<<1^g<<2^g<<3^g<<4;v=v>>>8^v&255^99,e[p]=v,t[v]=p;const y=h[p],x=h[y],E=h[x];let b=h[v]*257^v*16843008;i[p]=b<<24|b>>>8,s[p]=b<<16|b>>>16,o[p]=b<<8|b>>>24,a[p]=b,b=E*16843009^x*65537^y*257^p*16843008,l[v]=b<<24|b>>>8,c[v]=b<<16|b>>>16,d[v]=b<<8|b>>>24,f[v]=b,p?(p=y^h[h[h[E^y]]],g^=h[h[g]]):p=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,u;const l=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,p=h[0],g=h[1],m=h[2],v=h[3];let y,x;for(a=0;a<o;a++){if(a<s){y=l[a]=t[a];continue}x=y,a%s===0?(x=x<<8|x>>>24,x=d[x>>>24]<<24|d[x>>>16&255]<<16|d[x>>>8&255]<<8|d[x&255],x^=f[a/s|0]<<24):s>6&&a%s===4&&(x=d[x>>>24]<<24|d[x>>>16&255]<<16|d[x>>>8&255]<<8|d[x&255]),l[a]=y=(l[a-s]^x)>>>0}for(u=0;u<o;u++)a=o-u,u&3?x=l[a]:x=l[a-4],u<4||a<=4?c[u]=x:c[u]=p[d[x>>>24]]^g[d[x>>>16&255]]^m[d[x>>>8&255]]^v[d[x&255]],c[u]=c[u]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,u=a[0],l=a[1],c=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let h=f[0],p=f[1],g=f[2],m=f[3];const v=new Int32Array(e),y=new Int32Array(v.length);let x,E,b,S,w,T,R,_,A,k,G,U,M,B;const $=this.networkToHostOrderSwap;for(;t<v.length;){for(A=$(v[t]),k=$(v[t+1]),G=$(v[t+2]),U=$(v[t+3]),w=A^s[0],T=U^s[1],R=G^s[2],_=k^s[3],M=4,B=1;B<i;B++)x=u[w>>>24]^l[T>>16&255]^c[R>>8&255]^d[_&255]^s[M],E=u[T>>>24]^l[R>>16&255]^c[_>>8&255]^d[w&255]^s[M+1],b=u[R>>>24]^l[_>>16&255]^c[w>>8&255]^d[T&255]^s[M+2],S=u[_>>>24]^l[w>>16&255]^c[T>>8&255]^d[R&255]^s[M+3],w=x,T=E,R=b,_=S,M=M+4;x=o[w>>>24]<<24^o[T>>16&255]<<16^o[R>>8&255]<<8^o[_&255]^s[M],E=o[T>>>24]<<24^o[R>>16&255]<<16^o[_>>8&255]<<8^o[w&255]^s[M+1],b=o[R>>>24]<<24^o[_>>16&255]<<16^o[w>>8&255]<<8^o[T&255]^s[M+2],S=o[_>>>24]<<24^o[w>>16&255]<<16^o[T>>8&255]<<8^o[R&255]^s[M+3],y[t]=$(x^h),y[t+1]=$(S^p),y[t+2]=$(b^g),y[t+3]=$(E^m),h=A,p=k,g=G,m=U,t=t+4}return y.buffer}}class fD{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=hD(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function hD(n){switch(n){case ts.cbc:return"AES-CBC";case ts.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const pD=16;class zm{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?cD(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,i){return this.useSoftware?new Promise((s,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,r,i);const u=this.flush();u?s(u.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,i)}softwareDecrypt(e,t,r,i){const{currentIV:s,currentResult:o,remainderData:a}=this;if(i!==ts.cbc||t.byteLength!==16)return Fe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=tr(a,e),this.remainderData=null);const u=this.getValidChunk(e);if(!u.length)return null;s&&(r=s);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new dD),l.expandKey(t);const c=o;return this.currentResult=l.decrypt(u.buffer,0,r),this.currentIV=u.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,i));this.key=t,this.fastAesKey=new fD(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new lD(this.subtle,new Uint8Array(r),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Fe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r,i)))}onWebCryptoError(e,t,r,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,i);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%pD;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Fe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const tx=Math.pow(2,17);class gD{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new ti({type:pe.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,u)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){u(rx(e));return}else e.gap=!1;const l=this.loader=s?new s(i):new o(i),c=nx(e);e.loader=l;const d=ex(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:tx};e.stats=l.stats;const h={onSuccess:(p,g,m,v)=>{this.resetLoader(e,l);let y=p.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),a({frag:e,part:null,payload:y,networkDetails:v})},onError:(p,g,m,v)=>{this.resetLoader(e,l),u(new ti({type:pe.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ge({url:r,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:m,stats:v}))},onAbort:(p,g,m)=>{this.resetLoader(e,l),u(new ti({type:pe.NETWORK_ERROR,details:V.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:p}))},onTimeout:(p,g,m)=>{this.resetLoader(e,l),u(new ti({type:pe.NETWORK_ERROR,details:V.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:m,stats:p}))}};t&&(h.onProgress=(p,g,m,v)=>t({frag:e,part:null,payload:m,networkDetails:v})),l.load(c,f,h)})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,u)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){u(rx(e,t));return}const l=this.loader=s?new s(i):new o(i),c=nx(e,t);e.loader=l;const d=ex(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:tx};t.stats=l.stats,l.load(c,f,{onSuccess:(h,p,g,m)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const v={frag:e,part:t,payload:h.data,networkDetails:m};r(v),a(v)},onError:(h,p,g,m)=>{this.resetLoader(e,l),u(new ti({type:pe.NETWORK_ERROR,details:V.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ge({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:m}))},onAbort:(h,p,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),u(new ti({type:pe.NETWORK_ERROR,details:V.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,p,g)=>{this.resetLoader(e,l),u(new ti({type:pe.NETWORK_ERROR,details:V.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const u=Math.round(e.duration/t.duration),l=Math.min(Math.round(r.loaded/s),u),d=(u-l)*Math.round(r.loaded/l);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=i.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function nx(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(oe(i)&&oe(s)){var o;let a=i,u=s;if(n.sn==="initSegment"&&mD((o=n.decryptdata)==null?void 0:o.method)){const l=s-i;l%16&&(u=s+(16-l%16)),i!==0&&(r.resetIV=!0,a=i-16)}r.rangeStart=a,r.rangeEnd=u}return r}function rx(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:pe.MEDIA_ERROR,details:V.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new ti(r)}function mD(n){return n==="AES-128"||n==="AES-256"}class ti extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Ew extends vi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class jm{constructor(e,t,r,i=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=yl(),this.buffering={audio:yl(),video:yl(),audiovideo:yl()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=o}}function yl(){return{start:0,executeStart:0,executeEnd:0,end:0}}const ix={length:0,start:()=>0,end:()=>0};class Ce{static isBuffered(e,t){if(e){const r=Ce.getBuffered(e);for(let i=r.length;i--;)if(t>=r.start(i)&&t<=r.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=Ce.getBuffered(e);return Ce.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const i=Ce.bufferedRanges(e);if(i.length)return Ce.bufferedInfo(i,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let i=-1,s=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const d=s.length;if(d){const f=s[d-1].end;e[c].start-f<r?e[c].end>f&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let o=0,a,u=t,l=t;for(let c=0;c<s.length;c++){const d=s[c].start,f=s[c].end;if(i===-1&&t>=d&&t<=f&&(i=c),t+r>=d&&t<f)u=d,l=f,o=l-t;else if(t+r<d){a=d;break}}return{len:o,start:u||0,end:l||0,nextStart:a,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||ix}catch(t){return Fe.log("failed to get media.buffered",t),ix}}}const bw=/\{\$([a-zA-Z0-9-_]+)\}/g;function sx(n){return bw.test(n)}function Zp(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(bw,r=>{const i=r.substring(2,r.length-1),s=t==null?void 0:t[i];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function ox(n,e,t){let r=n.variableList;r||(n.variableList=r={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(i))s=o.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function vD(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const yD=/^(\d+)x(\d+)$/,ax=/(.+?)=(".*?"|.*?)(?:,|$)/g;class at{constructor(e,t){typeof e=="string"&&(e=at.parseAttrList(e,t)),Ke(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(i*2,i*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=yD.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const i={},s='"';for(ax.lastIndex=0;(r=ax.exec(e))!==null;){const o=r[1].trim();let a=r[2];const u=a.indexOf(s)===0&&a.lastIndexOf(s)===a.length-1;let l=!1;if(u)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":l=!0}if(t&&(u||l))a=Zp(t,a);else if(!l&&!u)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Fe.warn(`${e}: attribute ${o} is missing quotes`)}i[o]=a}return i}}const xD="com.apple.hls.interstitial";function ED(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function bD(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class Sw{constructor(e,t,r=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:r,t){const s=t.attr;for(const o in s)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==s[o]){Fe.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Ke(new at({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);oe(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Fe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(oe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===xD}get isValid(){return!!this.id&&!this._badValueForSameId&&oe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const SD=10;class wD{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?oe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||SD}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function ko(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Km(n){switch(n){case"AES-128":case"AES-256":return ts.cbc;case"AES-256-CTR":return ts.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function qm(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function eg(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function TD(n){const e=eg(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function _D(n){const e=function(r,i,s){const o=r[i];r[i]=r[s],r[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function ID(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),i=r[r.length-1].split(",");if(i.length===2){const s=i[0]==="base64",o=i[1];s?(r.splice(-1,1),t=qm(o)):t=TD(o)}}return t}const Xc=typeof self<"u"?self:void 0;var We={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},pn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function th(n){switch(n){case pn.FAIRPLAY:return We.FAIRPLAY;case pn.PLAYREADY:return We.PLAYREADY;case pn.WIDEVINE:return We.WIDEVINE;case pn.CLEARKEY:return We.CLEARKEY}}var xl={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function nh(n){if(n===xl.WIDEVINE)return We.WIDEVINE;if(n===xl.PLAYREADY)return We.PLAYREADY;if(n===xl.CENC||n===xl.CLEARKEY)return We.CLEARKEY}function rh(n){switch(n){case We.FAIRPLAY:return pn.FAIRPLAY;case We.PLAYREADY:return pn.PLAYREADY;case We.WIDEVINE:return pn.WIDEVINE;case We.CLEARKEY:return pn.CLEARKEY}}function El(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[We.FAIRPLAY,We.WIDEVINE,We.PLAYREADY,We.CLEARKEY].filter(i=>!!e[i]):[];return!r[We.WIDEVINE]&&t&&r.push(We.WIDEVINE),r}const ww=function(n){return Xc!=null&&(n=Xc.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function RD(n,e,t,r){let i;switch(n){case We.FAIRPLAY:i=["cenc","sinf"];break;case We.WIDEVINE:case We.PLAYREADY:i=["cenc"];break;case We.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return CD(i,e,t,r)}function CD(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function Tw(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const u=qm(a).subarray(0,16);return _D(u),u}}return null}let bl={};class xu{static clearKeyUriToKeyIdMap(){bl={}}constructor(e,t,r,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ko(e)}isSupported(){if(this.method){if(ko(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case pn.FAIRPLAY:case pn.WIDEVINE:case pn.PLAYREADY:case pn.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(ko(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Fe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=AD(e);return new xu(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=ID(this.uri);if(t)switch(this.keyFormat){case pn.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case pn.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=NL(r,null,t),this.keyId=Tw(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const i=new Uint8Array(16);i.set(r,16-r.length),r=i}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=bl[this.uri];if(!r){const i=Object.keys(bl).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,i),bl[this.uri]=r}this.keyId=r}return this}}function AD(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const ux=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,lx=/#EXT-X-MEDIA:(.*)/g,kD=/^#EXT(?:INF|-X-TARGETDURATION):/m,ih=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),LD=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Or{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return $m.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return kD.test(e)}static parseMasterPlaylist(e,t){const r=sx(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];ux.lastIndex=0;let o;for(;(o=ux.exec(e))!=null;)if(o[1]){var a;const l=new at(o[1],i),c=Zp(i,o[2]),d={attrs:l,bitrate:l.decimalInteger("BANDWIDTH")||l.decimalInteger("AVERAGE-BANDWIDTH"),name:l.NAME,url:Or.resolve(c,t)},f=l.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),fx(l.CODECS,d);const h=l["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},fx(h,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||s.push(d),i.levels.push(d)}else if(o[3]){const l=o[3],c=o[4];switch(l){case"SESSION-DATA":{const d=new at(c,i),f=d["DATA-ID"];f&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[f]=d);break}case"SESSION-KEY":{const d=cx(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):Fe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new at(c,i);ox(i,d,t)}break}case"CONTENT-STEERING":{const d=new at(c,i);i.contentSteering={uri:Or.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=dx(c);break}}}const u=s.length>0&&s.length<i.levels.length;return i.levels=u?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},o=r.levels,a={AUDIO:o.map(l=>({id:l.attrs.AUDIO,audioCodec:l.audioCodec})),SUBTITLES:o.map(l=>({id:l.attrs.SUBTITLES,textCodec:l.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(lx.lastIndex=0;(i=lx.exec(e))!==null;){const l=new at(i[1],r),c=l.TYPE;if(c){const d=a[c],f=s[c]||[];s[c]=f;const h=l.LANGUAGE,p=l["ASSOC-LANGUAGE"],g=l.CHANNELS,m=l.CHARACTERISTICS,v=l["INSTREAM-ID"],y={attrs:l,bitrate:0,id:u++,groupId:l["GROUP-ID"]||"",name:l.NAME||h||"",type:c,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:h,url:l.URI?Or.resolve(l.URI,t):""};if(p&&(y.assocLang=p),g&&(y.channels=g),m&&(y.characteristics=m),v&&(y.instreamId=v),d!=null&&d.length){const x=Or.findGroup(d,y.groupId)||d[0];hx(y,x,"audioCodec"),hx(y,x,"textCodec")}f.push(y)}}return s}static parseLevelPlaylist(e,t,r,i,s,o){var a;const u={url:t},l=new wD(t),c=l.fragments,d=[];let f=null,h=0,p=0,g=0,m=0,v=0,y=null,x=new Qf(i,u),E,b,S,w=-1,T=!1,R=null,_;if(ih.lastIndex=0,l.m3u8=e,l.hasVariableRefs=sx(e),((a=ih.exec(e))==null?void 0:a[0])!=="#EXTM3U")return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;(E=ih.exec(e))!==null;){T&&(T=!1,x=new Qf(i,u),x.playlistOffset=g,x.start=g,x.sn=h,x.cc=m,v&&(x.bitrate=v),x.level=r,f&&(x.initSegment=f,f.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),R&&(x.setByteRange(R),R=null)));const U=E[1];if(U){x.duration=parseFloat(U);const M=(" "+E[2]).slice(1);x.title=M||null,x.tagList.push(M?["INF",U,M]:["INF",U])}else if(E[3]){if(oe(x.duration)){x.playlistOffset=g,x.start=g,S&&gx(x,S,l),x.sn=h,x.level=r,x.cc=m,c.push(x);const M=(" "+E[3]).slice(1);x.relurl=Zp(l,M),tg(x,y,d),y=x,g+=x.duration,h++,p=0,T=!0}}else{if(E=E[0].match(LD),!E){Fe.warn("No matches on slow regex match for level playlist!");continue}for(b=1;b<E.length&&E[b]===void 0;b++);const M=(" "+E[b]).slice(1),B=(" "+E[b+1]).slice(1),$=E[b+2]?(" "+E[b+2]).slice(1):null;switch(M){case"BYTERANGE":y?x.setByteRange(B,y):x.setByteRange(B);break;case"PROGRAM-DATE-TIME":x.rawProgramDateTime=B,x.tagList.push(["PROGRAM-DATE-TIME",B]),w===-1&&(w=c.length);break;case"PLAYLIST-TYPE":l.type&&Xr(l,M,E),l.type=B.toUpperCase();break;case"MEDIA-SEQUENCE":l.startSN!==0?Xr(l,M,E):c.length>0&&mx(l,M,E),h=l.startSN=parseInt(B);break;case"SKIP":{l.skippedSegments&&Xr(l,M,E);const D=new at(B,l),P=D.decimalInteger("SKIPPED-SEGMENTS");if(oe(P)){l.skippedSegments+=P;for(let K=P;K--;)c.push(null);h+=P}const O=D.enumeratedString("RECENTLY-REMOVED-DATERANGES");O&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(O.split("	")));break}case"TARGETDURATION":l.targetduration!==0&&Xr(l,M,E),l.targetduration=Math.max(parseInt(B),1);break;case"VERSION":l.version!==null&&Xr(l,M,E),l.version=parseInt(B);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Xr(l,M,E),l.live=!1;break;case"#":(B||$)&&x.tagList.push($?[B,$]:[B]);break;case"DISCONTINUITY":m++,x.tagList.push(["DIS"]);break;case"GAP":x.gap=!0,x.tagList.push([M]);break;case"BITRATE":x.tagList.push([M,B]),v=parseInt(B)*1e3,oe(v)?x.bitrate=v:v=0;break;case"DATERANGE":{const D=new at(B,l),P=new Sw(D,l.dateRanges[D.ID],l.dateRangeTagCount);l.dateRangeTagCount++,P.isValid||l.skippedSegments?l.dateRanges[P.id]=P:Fe.warn(`Ignoring invalid DATERANGE tag: "${B}"`),x.tagList.push(["EXT-X-DATERANGE",B]);break}case"DEFINE":{{const D=new at(B,l);"IMPORT"in D?vD(l,D,o):ox(l,D,t)}break}case"DISCONTINUITY-SEQUENCE":l.startCC!==0?Xr(l,M,E):c.length>0&&mx(l,M,E),l.startCC=m=parseInt(B);break;case"KEY":{const D=cx(B,t,l);if(D.isSupported()){if(D.method==="NONE"){S=void 0;break}S||(S={}),S[D.keyFormat]&&(S=Ke({},S)),S[D.keyFormat]=D}else Fe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${B}"`);break}case"START":l.startTimeOffset=dx(B);break;case"MAP":{const D=new at(B,l);if(x.duration){const P=new Qf(i,u);px(P,D,r,S),f=P,x.initSegment=f,f.rawProgramDateTime&&!x.rawProgramDateTime&&(x.rawProgramDateTime=f.rawProgramDateTime)}else{const P=x.byteRangeEndOffset;if(P){const O=x.byteRangeStartOffset;R=`${P-O}@${O}`}else R=null;px(x,D,r,S),f=x,T=!0}f.cc=m;break}case"SERVER-CONTROL":{_&&Xr(l,M,E),_=new at(B),l.canBlockReload=_.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=_.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&_.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=_.optionalFloat("PART-HOLD-BACK",0),l.holdBack=_.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{l.partTarget&&Xr(l,M,E);const D=new at(B);l.partTarget=D.decimalFloatingPoint("PART-TARGET");break}case"PART":{let D=l.partList;D||(D=l.partList=[]);const P=p>0?D[D.length-1]:void 0,O=p++,K=new at(B,l),Y=new EL(K,x,u,O,P);D.push(Y),x.duration+=Y.duration;break}case"PRELOAD-HINT":{const D=new at(B,l);l.preloadHint=D;break}case"RENDITION-REPORT":{const D=new at(B,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(D);break}default:Fe.warn(`line parsed but not handled: ${E}`);break}}}y&&!y.relurl?(c.pop(),g-=y.duration,l.partList&&(l.fragmentHint=y)):l.partList&&(tg(x,y,d),x.cc=m,l.fragmentHint=x,S&&gx(x,S,l)),l.targetduration||(l.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const A=c.length,k=c[0],G=c[A-1];if(g+=l.skippedSegments*l.targetduration,g>0&&A&&G){l.averagetargetduration=g/A;const U=G.sn;l.endSN=U!=="initSegment"?U:0,l.live||(G.endList=!0),k&&l.startCC===void 0&&(l.startCC=k.cc),w>0&&(PD(c,w),k&&d.unshift(k))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(g+=l.fragmentHint.duration),l.totalduration=g,d.length&&l.dateRangeTagCount&&k&&_w(d,l),l.endCC=m,l}}function _w(n,e){const t=n.length,r=n[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const a=e.dateRanges[s[o]],u=a.startDate.getTime();a.tagAnchor=r.ref;for(let l=t;l--;){const c=DD(e,u,n,l,i);if(c!==-1){a.tagAnchor=e.fragments[c].ref;break}}}}function DD(n,e,t,r,i){const s=t[r];if(s){const a=s.programDateTime;if(e>=a||r===0){var o;const u=(((o=t[r+1])==null?void 0:o.start)||i)-s.start;if(e<=a+u*1e3){const l=t[r].sn-n.startSN,c=n.fragments;if(c.length>t.length){const f=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let h=f;h>l;h--){const p=c[h].programDateTime;if(e>=p&&e<p+c[h].duration*1e3)return h}}return l}}}return-1}function cx(n,e,t){var r,i;const s=new at(n,t),o=(r=s.METHOD)!=null?r:"",a=s.URI,u=s.hexadecimalInteger("IV"),l=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";a&&s.IV&&!u&&Fe.error(`Invalid IV: ${s.IV}`);const d=a?Or.resolve(a,e):"",f=(l||"1").split("/").map(Number).filter(Number.isFinite);return new xu(o,d,c,f,u)}function dx(n){const t=new at(n).decimalFloatingPoint("TIME-OFFSET");return oe(t)?t:null}function fx(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const i=t.filter(s=>fw(s,r));i.length&&(e[`${r}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function hx(n,e,t){const r=e[t];r&&(n[t]=r)}function PD(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function tg(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function px(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function gx(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}function Xr(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function mx(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function sh(n,e){const t=e.startPTS;if(oe(t)){let r=0,i;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&i.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function Iw(n,e,t,r,i,s){r-t<=0&&(Fe.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let a=t,u=r;const l=e.startPTS,c=e.endPTS;if(oe(l)){const m=Math.abs(l-t);oe(e.deltaPTS)?e.deltaPTS=Math.max(m,e.deltaPTS):e.deltaPTS=m,a=Math.max(t,l),t=Math.min(t,l),i=Math.min(i,e.startDTS),u=Math.min(r,c),r=Math.max(r,c),s=Math.max(s,e.endDTS)}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=a,e.startDTS=i,e.endPTS=r,e.minEndPTS=u,e.endDTS=s;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let h;const p=f-n.startSN,g=n.fragments;for(g[p]=e,h=p;h>0;h--)sh(g[h],g[h-1]);for(h=p;h<g.length-1;h++)sh(g[h],g[h+1]);return n.fragmentHint&&sh(g[g.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function OD(n,e){if(n===e)return;let t=null;const r=n.fragments;for(let u=r.length-1;u>=0;u--){const l=r[u].initSegment;if(l){t=l;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;MD(n,e,(u,l,c,d)=>{if(e.skippedSegments&&l.cc!==u.cc){const f=u.cc-l.cc;for(let h=c;h<d.length;h++)d[h].cc+=f}oe(u.startPTS)&&oe(u.endPTS)&&(l.setStart(l.startPTS=u.startPTS),l.startDTS=u.startDTS,l.maxStartPTS=u.maxStartPTS,l.endPTS=u.endPTS,l.endDTS=u.endDTS,l.minEndPTS=u.minEndPTS,l.setDuration(u.endPTS-u.startPTS),l.duration&&(i=l),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(l.elementaryStreams=u.elementaryStreams),l.loader=u.loader,u.hasStats&&(l.stats=u.stats),u.initSegment&&(l.initSegment=u.initSegment,t=u.initSegment)});const s=e.fragments,o=e.fragmentHint?s.concat(e.fragmentHint):s;if(t&&o.forEach(u=>{var l;u&&(!u.initSegment||u.initSegment.relurl===((l=t)==null?void 0:l.relurl))&&(u.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=s.some(u=>!u),e.deltaUpdateFailed){Fe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)s.shift();e.startSN=s[0].sn}else{e.endCC=s[s.length-1].cc,e.canSkipDateRanges&&(e.dateRanges=ND(n.dateRanges,e));const u=n.fragments.filter(l=>l.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let l=1;l<o.length;l++)o[l].programDateTime===null&&tg(o[l],o[l-1],u);_w(u,e)}FD(n.partList,e.partList,(u,l)=>{l.elementaryStreams=u.elementaryStreams,l.stats=u.stats}),i?Iw(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):Rw(n,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const u=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=u),e.driftEndTime=a,e.driftEnd=u}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function ND(n,e){const{dateRanges:t,recentlyRemovedDateranges:r}=e,i=Ke({},n);r&&r.forEach(a=>{delete i[a]});const o=Object.keys(i).length;return o&&Object.keys(t).forEach(a=>{const u=i[a],l=new Sw(t[a].attr,u);l.isValid?(i[a]=l,u||(l.tagOrder+=o)):Fe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${st(t[a].attr)}"`)}),i}function FD(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const o=n[i],a=e[i+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function MD(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let l=i;l<=s;l++){const c=u[o+l];let d=a[l];if(r&&!d&&c&&(d=e.fragments[l]=c),c&&d){if(t(c,d,l,a),c.url&&c.url!==d.url){e.playlistParsingError=vx(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=vx(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function vx(n,e,t,r,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Rw(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,s=r>=0;let o=0;if(s&&r<i.length)o=i[r].start;else if(s&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(s&&t)o=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;ng(e,o)}function ng(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function Cw(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function BD(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function yx(n,e,t){return n?Aw(n.partList,e,t):null}function Aw(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function kw(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function Ha(n,e){for(let r=0,i=n.length;r<i;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function UD(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function xx(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function Lw(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)xx(t[r],n);e.fragmentHint&&xx(e.fragmentHint,n),e.alignedSliding=!0}function $D(n,e){n&&(Dw(e,n),!e.alignedSliding&&n&&Qc(e,n),!e.alignedSliding&&n&&!e.skippedSegments&&Rw(n,e,!1))}function Dw(n,e){if(!UD(e,n))return;const t=Math.min(e.endCC,n.endCC),r=Ha(e.fragments,t),i=Ha(n.fragments,t);if(!r||!i)return;Fe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=r.start-i.start;Lw(s,n)}function Qc(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let i,s;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(i=Ha(r,o),s=Ha(t,o)),(!i||!s)&&(i=r[Math.floor(r.length/2)],s=Ha(t,i.cc)||t[Math.floor(t.length/2)]);const a=i.programDateTime,u=s.programDateTime;if(!a||!u)return;const l=(u-a)/1e3-(s.start-i.start);Lw(l,n)}const GD={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},J={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Ym extends Ew{constructor(e,t,r,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=J.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:u,mediaBuffer:l,state:c}=this,d=u?u.currentTime:0,f=Ce.bufferInfo(l||u,d,o.maxBufferHole);if(this.log(`media seeking to ${oe(d)?d.toFixed(3):d}, state: ${c}`),this.state===J.ENDED)this.resetLoadingState();else if(a){const h=o.maxFragLookUpTolerance,p=a.start-h,g=a.start+a.duration+h;if(!f.len||g<f.start||p>f.end){const m=d>g;(d<p||m)&&(m&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(u){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const h=this.lastCurrentTime;if(d>h&&(this.lastCurrentTime=d),!this.loadingParts){const p=Math.max(f.end,d),g=this.shouldLoadParts(this.getLevelDetails(),p);g&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=g)}}!this.hls.hasEnoughToStart&&!f.len&&(this.log(`setting startPosition to ${d} because of seek before start`),this.nextLoadPosition=this.startPosition=d),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new gD(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new zm(e.config)}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===J.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=J.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,i=this.config.timelineOffset||0;if(r<=i)return!1;const s=e.nextStart;if(s&&s>i&&s<t.edge||this.media.currentTime<e.start)return!1;const a=t.partList;if(a!=null&&a.length){const l=a[a.length-1];return Ce.isBuffered(this.media,l.start+l.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),r.addEventListener("seeking",this.onMediaSeeking),r.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===J.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=J.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const i=s=>{const o=s.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(o,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,i).then(s=>{if(!s)return;const o=this.state,a=s.frag;if(this.fragContextChanged(a)){(o===J.FRAG_LOADING||!this.fragCurrent&&o===J.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=J.IDLE);return}"payload"in s&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(I.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===_t.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?e.sn-u.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===_t.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(I.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{frag:s,payload:o}=r,a=s.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&ko(a.method)){const u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,Km(a.method)).catch(l=>{throw i.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:s}),l}).then(l=>{const c=self.performance.now();return i.trigger(I.FRAG_DECRYPTED,{frag:s,payload:l,stats:{tstart:u,tdecrypt:c}}),r.payload=l,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==J.STOPPED&&(this.state=J.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?GD.toString(Ce.getBuffered(r)):"(detached)"})`),Vt(e)){var i;if(e.type!==de.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=J.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=J.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,o=!s||s.length===0||s.some(u=>!u),a=new jm(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;this.fragCurrent=e;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=J.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(I.KEY_LOADED,d),this.state===J.KEY_LOADING&&(this.state=J.IDLE),d}),this.hls.trigger(I.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments);const u=this.fragPrevious;if(Vt(e)&&(!u||e.sn!==u.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${u==null?void 0:u.sn}->${e.sn}`),this.loadingParts=d)}if(r=Math.max(e.start,r||0),this.loadingParts&&Vt(e)){const d=o.partList;if(d&&i){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const f=this.getNextPart(d,e,r);if(f>-1){const h=d[f];e=this.fragCurrent=h.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${h.index} (${f}/${d.length-1}) of ${this.fragInfo(e,!1,h)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=h.start+h.duration,this.state=J.FRAG_LOADING;let p;return a?p=a.then(g=>!g||this.fragContextChanged(g.frag)?null:this.doFragPartsLoad(e,h,t,i)).catch(g=>this.handleFragLoadError(g)):p=this.doFragPartsLoad(e,h,t,i).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(I.FRAG_LOADING,{frag:e,part:h,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(d,r))return Promise.resolve(null)}}if(Vt(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(r.toFixed(3))}`),oe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=J.FRAG_LOADING;const l=this.config.progressive;let c;return l&&a?c=a.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(e,i)).catch(d=>this.handleFragLoadError(d)):c=Promise.all([this.fragmentLoader.load(e,l?i:void 0),a]).then(([d])=>(!l&&d&&i&&i(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(I.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,i){return new Promise((s,o)=>{var a;const u=[],l=(a=r.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(f=>{u[d.index]=f;const h=f.part;this.hls.trigger(I.FRAG_LOADED,f);const p=yx(r.details,e.sn,d.index+1)||Aw(l,e.sn,d.index+1);if(p)c(p);else return s({frag:e,part:h,partsLoaded:u})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===V.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(I.ERROR,t)}else this.hls.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==J.PARSING){!this.fragCurrent&&this.state!==J.STOPPED&&this.state!==J.ERROR&&(this.state=J.IDLE);return}const{frag:r,part:i,level:s}=t,o=self.performance.now();r.stats.parsing.end=o,i&&(i.stats.parsing.end=o);const a=this.getLevelDetails(),l=a&&r.sn>a.endSN||this.shouldLoadParts(a,r.end);l!==this.loadingParts&&(this.log(`LL-Part loading ${l?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=l),this.updateLevelTiming(r,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var r;const s=e.partList[0],o=s.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=o){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:o}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const a=t[i],u=a.details,l=o>-1?yx(u,s,o):null,c=l?l.fragment:BD(u,s,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(e,t,r,i,s){var o;if(!e||this.state!==J.PARSING)return;const{data1:a,data2:u}=e;let l=a;if(a&&u&&(l=tr(a,u)),!((o=l)!=null&&o.length))return;const c={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(I.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ce.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,i=Ce.bufferInfo(t,r,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,i.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var r;const i=this.getLoadPosition();if(!oe(i))return null;const o=this.lastCurrentTime>i||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,o)}getFwdBufferInfoAtPos(e,t,r,i){const s=Ce.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&(s.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(s.nextStart,o.end)-t,i);return Ce.bufferInfo(e,t,a)}}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,i);return s>=i?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=de.MAIN){var r;const i=(r=this.fragmentTracker)==null?void 0:r.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,o=r[0].start,a=s.lowLatencyMode&&!!t.partList;let u=null;if(t.live){const d=s.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),u=this.getInitialLiveFragment(t,r);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,p=u?(f!==-1&&f>=o?f:h)||u.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(l=u)==null?void 0:l.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=o&&(u=r[0]);if(!u){const d=this.loadingParts?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(u,t);if(!c&&u){const d=u.sn-t.startSN;c=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===_t.OK||r===_t.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&r.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i,0);if(a!==null&&r.len+a.len>=s){const u=o.sn;return this.loopSn!==u&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${u}`),this.loopSn=u),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Ex(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Ex(this.hls.config)&&e.type!==de.SUBTITLE){const r=this.hls.interstitialsManager,i=r==null?void 0:r.bufferingItem;if(i){const o=i.event;if(o){if(o.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=r==null?void 0:r.playerQueue;if(s)for(let o=s.length;o--;){const a=s[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let i=-1,s=!1,o=!0;for(let a=0,u=e.length;a<u;a++){const l=e[a];if(o=o&&!l.independent,i>-1&&r<l.start)break;const c=l.loaded;c?i=-1:(s||l.independent||o)&&l.fragment===t&&(i=a),s=c}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=nD(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];r.cc===o.cc&&(i=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=xw(t,r.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=r;const{fragmentHint:u}=r,{maxFragLookUpTolerance:l}=i,c=r.partList,d=!!(this.loadingParts&&c!=null&&c.length&&u);d&&u&&!this.bitrateTest&&c[c.length-1].fragment.sn===u.sn&&(o=o.concat(u),a=u.sn);let f;if(e<t){var h;const g=e<this.lastCurrentTime||e>t-l||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:l;f=Bs(s,o,e,g)}else f=o[o.length-1];if(f){const p=f.sn-r.startSN,g=this.fragmentTracker.getState(f);if((g===_t.OK||g===_t.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||c[0].fragment.sn>f.sn||!r.live&&!d)&&s&&f.level===s.level){const v=o[p+1];f.sn<a&&this.fragmentTracker.getState(v)!==_t.OK?f=v:f=null}}return f}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,o=!t,a=e.alignedSliding&&oe(s);if(o||!a&&!s){$D(r,e);const u=e.fragmentStart;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),u}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const i=this.timelineOffset;if(r===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&oe(o)?(r=t+o,o<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${o} found in ${s?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+i}this.nextLoadPosition=r+i}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Vt(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==J.FRAG_LOADING_WAITING_RETRY)&&(this.state=J.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const p=this.getCurrentContext(t.chunkMeta);p&&(t.frag=p.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var i;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const s=t.details===V.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:a,flags:u,retryCount:l=0,retryConfig:c}=o||{},d=!!o&&!!c,f=d&&a===Xt.RetryRequest,h=d&&!o.resolved&&u===ar.MoveAllAlternatesMatchingHost;if(!f&&h&&Vt(r)&&!r.endList)this.resetFragmentErrors(e),this.treatAsGap(r),o.resolved=!0;else if((f||h)&&l<c.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const p=Hm(c,l);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${l+1}/${c.maxNumRetry} in ${p}ms`),o.resolved=!0,this.retryDate=self.performance.now()+p,this.state=J.FRAG_LOADING_WAITING_RETRY}else if(c&&o)if(this.resetFragmentErrors(e),l<c.maxNumRetry)!s&&a!==Xt.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${l})`);return}else a===Xt.SendAlternateToPenaltyBox?this.state=J.WAITING_LEVEL:this.state=J.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===J.PARSING||this.state===J.PARSED){const t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===de.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==J.STOPPED&&(this.state=J.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const i=Ce.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===J.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==J.STOPPED&&(this.state=J.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){const s=r.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,l)=>{const c=e.elementaryStreams[l];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${l} duration reliably (${d})`),u||!1;const f=i?0:Iw(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(I.LEVEL_PTS_UPDATED,{details:s,level:r,drift:f,type:l,frag:e,start:c.startPTS,end:c.endPTS}),!0}return u},!1)){var a;if(r.fragmentError===0&&this.treatAsGap(e,r),((a=this.transmuxer)==null?void 0:a.error)===null){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=J.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(I.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===de.MAIN?"level":"track"}fragInfo(e,t=!0,r){var i,s;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((i=t&&!r?e.startPTS:(r||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!r?e.endPTS:(r||e).end)!=null?s:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Ex(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class Pw{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=WD(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function WD(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}var oh={exports:{}},bx;function VD(){return bx||(bx=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function s(u,l,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,d||u,f),p=t?t+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],h]:u._events[p].push(h):(u._events[p]=h,u._eventsCount++),u}function o(u,l){--u._eventsCount===0?u._events=new r:delete u._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=t?t+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,p=new Array(h);f<h;f++)p[f]=d[f].fn;return p},a.prototype.listenerCount=function(l){var c=t?t+l:l,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,c,d,f,h,p){var g=t?t+l:l;if(!this._events[g])return!1;var m=this._events[g],v=arguments.length,y,x;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,d),!0;case 4:return m.fn.call(m.context,c,d,f),!0;case 5:return m.fn.call(m.context,c,d,f,h),!0;case 6:return m.fn.call(m.context,c,d,f,h,p),!0}for(x=1,y=new Array(v-1);x<v;x++)y[x-1]=arguments[x];m.fn.apply(m.context,y)}else{var E=m.length,b;for(x=0;x<E;x++)switch(m[x].once&&this.removeListener(l,m[x].fn,void 0,!0),v){case 1:m[x].fn.call(m[x].context);break;case 2:m[x].fn.call(m[x].context,c);break;case 3:m[x].fn.call(m[x].context,c,d);break;case 4:m[x].fn.call(m[x].context,c,d,f);break;default:if(!y)for(b=1,y=new Array(v-1);b<v;b++)y[b-1]=arguments[b];m[x].fn.apply(m[x].context,y)}}return!0},a.prototype.on=function(l,c,d){return s(this,l,c,d,!1)},a.prototype.once=function(l,c,d){return s(this,l,c,d,!0)},a.prototype.removeListener=function(l,c,d,f){var h=t?t+l:l;if(!this._events[h])return this;if(!c)return o(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&o(this,h);else{for(var g=0,m=[],v=p.length;g<v;g++)(p[g].fn!==c||f&&!p[g].once||d&&p[g].context!==d)&&m.push(p[g]);m.length?this._events[h]=m.length===1?m[0]:m:o(this,h)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(oh)),oh.exports}var HD=VD(),Xm=yL(HD);const Eu="1.6.0",Xo={};function zD(){return typeof __HLS_WORKER_BUNDLE__=="function"}function jD(){const n=Xo[Eu];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return Xo[Eu]=i,i}function KD(n){const e=Xo[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Xo[n]=i,i}function qD(n){const e=Xo[n||Eu];if(e&&e.clientCount--===1){const{worker:r,objectURL:i}=e;delete Xo[n||Eu],i&&self.URL.revokeObjectURL(i),r.terminate()}}function Ow(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Qm(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Yd(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function bu(n,e){const t=e;let r=0;for(;Qm(n,e);){r+=10;const i=Yd(n,e+6);r+=i,Ow(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function YD(n,e,t,r){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],o=s>>2&15;if(o>12){const h=new Error(`invalid ADTS sampling index:${o}`);n.emit(I.ERROR,I.ERROR,{type:pe.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const a=(s>>6&3)+1,u=e[t+3]>>6&3|(s&1)<<2,l="mp4a.40."+a,c=i[o];let d=o;(a===5||a===29)&&(d-=3);const f=[a<<3|(d&14)>>1,(d&1)<<7|u<<3];return Fe.log(`manifest codec:${r}, parsed codec:${l}, channels:${u}, rate:${c} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:c,channelCount:u,codec:l,parsedCodec:l,manifestCodec:r}}function Nw(n,e){return n[e]===255&&(n[e+1]&246)===240}function Fw(n,e){return n[e+1]&1?7:9}function Jm(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function XD(n,e){return e+5<n.length}function Jc(n,e){return e+1<n.length&&Nw(n,e)}function QD(n,e){return XD(n,e)&&Nw(n,e)&&Jm(n,e)<=n.length-e}function JD(n,e){if(Jc(n,e)){const t=Fw(n,e);if(e+t>=n.length)return!1;const r=Jm(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||Jc(n,i)}return!1}function Mw(n,e,t,r,i){if(!n.samplerate){const s=YD(e,t,r,i);if(!s)return;Ke(n,s)}}function Bw(n){return 1024*9e4/n}function ZD(n,e){const t=Fw(n,e);if(e+t<=n.length){const r=Jm(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Uw(n,e,t,r,i){const s=Bw(n.samplerate),o=r+i*s,a=ZD(e,t);let u;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,p=Math.max(0,t+h-e.length);p?(u=new Uint8Array(h-f),u.set(e.subarray(t+f,e.length),0)):u=e.subarray(t+f,t+h);const g={unit:u,pts:o};return p||n.samples.push(g),{sample:g,length:h,missing:p}}const l=e.length-t;return u=new Uint8Array(l),u.set(e.subarray(t,e.length),0),{sample:{unit:u,pts:o},length:l,missing:-1}}function eP(n,e){return Qm(n,e)&&Yd(n,e+6)+10<=n.length-e}function tP(n){if(n.size<2)return;const e=Fn(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function nP(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Fn(n.data.subarray(t),!0);t+=r.length+1;const i=Fn(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=Fn(n.data.subarray(1));return{key:n.type,info:"",data:e}}function rP(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Fn(n.data.subarray(t),!0);t+=r.length+1;const i=Fn(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=Fn(n.data);return{key:n.type,info:"",data:e}}function iP(n){return btoa(String.fromCharCode(...n))}function $w(n,e){if(n<0)return-$w(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}function sP(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const i=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}function oP(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function aP(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function ah(n,e=0,t=1/0){return uP(n,e,t,Uint8Array)}function uP(n,e,t,r){const i=lP(n);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const o=cP(n)?n.byteOffset:0,a=(o+n.byteLength)/s,u=(o+e)/s,l=Math.floor(Math.max(0,Math.min(u,a))),c=Math.floor(Math.min(l+Math.max(t,0),a));return new r(i,l,c-l)}function lP(n){return n instanceof ArrayBuffer?n:n.buffer}function cP(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function dP(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const i=Fn(ah(n.data,1,r)),s=n.data[2+r],o=n.data.subarray(3+r).indexOf(0);if(o===-1)return;const a=Fn(ah(n.data,3+r,o));let u;return i==="-->"?u=Fn(ah(n.data,4+r+o)):u=aP(n.data.subarray(4+r+o)),e.mimeType=i,e.pictureType=s,e.description=a,e.data=u,e}function fP(n){return n.type==="PRIV"?tP(n):n.type[0]==="W"?rP(n):n.type==="APIC"?dP(n):nP(n)}function hP(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Yd(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Sl=10,pP=10;function Gw(n){let e=0;const t=[];for(;Qm(n,e);){const r=Yd(n,e+6);n[e+5]>>6&1&&(e+=Sl),e+=Sl;const i=e+r;for(;e+pP<i;){const s=hP(n.subarray(e)),o=fP(s);o&&t.push(o),e+=s.size+Sl}Ow(n,e)&&(e+=Sl)}return t}function Ww(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function gP(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Zm(n){const e=Gw(n);for(let t=0;t<e.length;t++){const r=e[t];if(Ww(r))return gP(r)}}let Rn=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Cr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class ev{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=tr(this.cachedData,e),this.cachedData=null);let r=bu(e,0),i=r?r.length:0,s;const o=this._audioTrack,a=this._id3Track,u=r?Zm(r):void 0,l=e.length;for((this.basePTS===null||this.frameIndex===0&&oe(u))&&(this.basePTS=mP(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Rn.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const c=this.appendFrame(o,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=l}else eP(e,i)?(r=bu(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Rn.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===l&&s!==l){const c=e.slice(s);this.cachedData?this.cachedData=tr(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:Cr(),id3Track:a,textTrack:Cr()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Cr(),id3Track:this._id3Track,textTrack:Cr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const mP=(n,e,t)=>{if(oe(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let wl=null;const vP=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],yP=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],xP=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],EP=[0,1,1,4];function Vw(n,e,t,r,i){if(t+24>e.length)return;const s=Hw(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=r+i*o,u={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(u),{sample:u,length:s.frameLength,missing:0}}}function Hw(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,u=t===3?3-r:r===3?3:4,l=vP[u*14+i-1]*1e3,d=yP[(t===3?0:t===2?1:2)*3+s],f=a===3?1:2,h=xP[t][r],p=EP[r],g=h*8*p,m=Math.floor(h*l/d+o)*p;if(wl===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);wl=x?parseInt(x[1]):0}return!!wl&&wl<=87&&r===2&&l>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:m,samplesPerFrame:g}}}function tv(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function zw(n,e){return e+1<n.length&&tv(n,e)}function bP(n,e){return tv(n,e)&&4<=n.length-e}function jw(n,e){if(e+1<n.length&&tv(n,e)){const r=Hw(n,e);let i=4;r!=null&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||zw(n,s)}return!1}class SP extends ev{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=bu(e,0);let i=(r==null?void 0:r.length)||0;if(jw(e,i))return!1;for(let s=e.length;i<s;i++)if(JD(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return QD(e,t)}appendFrame(e,t,r){Mw(e,this.observer,t,r,e.manifestCodec);const i=Uw(e,t,r,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const Kw=(n,e)=>{let t=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),u=8-a;s[0]=4278190080>>>24+u<<u,i[0]=(o[0]&s[0])>>u,t=t?t<<a|i[0]:i[0],e+=1,r-=a}return t};class wP extends ev{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=qw(e,t,r,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=bu(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Zm(t)!==void 0&&Kw(e,r)<16}}function qw(n,e,t,r,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],u=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,g=[2,1,2,3,3,4,4,5][d]+h,m=e[t+5]>>3,v=e[t+5]&7,y=new Uint8Array([s<<6|m<<1|v>>2,(v&3)<<6|d<<3|h<<2|u>>4,u<<4&224]),x=1536/a*9e4,E=r+i*x,b=e.subarray(t,t+c);return n.config=y,n.channelCount=g,n.samplerate=a,n.samples.push({unit:b,pts:E}),c}class TP extends ev{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=bu(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Zm(t)!==void 0&&Kw(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(jw(e,r))return Fe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return bP(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return Vw(e,t,r,this.basePTS,this.frameIndex)}}const _P=/\/emsg[-/]ID3/i;class IP{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=Cr("video",1),o=this.audioTrack=Cr("audio",1),a=this.txtTrack=Cr("text",1);if(this.id3Track=Cr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const u=uw(e);if(u.video){const{id:l,timescale:c,codec:d,supplemental:f}=u.video;s.id=l,s.timescale=a.timescale=c,s.codec=d,s.supplemental=f}if(u.audio){const{id:l,timescale:c,codec:d}=u.audio;o.id=l,o.timescale=c,o.codec=d}a.id=sw.text,s.sampleDuration=0,s.duration=o.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return wL(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=tr(this.remainderData,e));const a=LL(r);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=r;const o=this.extractID3Track(i,t);return s.samples=Vy(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=Vy(e,t),{videoTrack:t,audioTrack:Cr(),id3Track:i,textTrack:Cr()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=Te(e.samples,["emsg"]);i&&i.forEach(s=>{const o=PL(s);if(_P.test(o.schemeIdUri)){const a=Sx(o,t);let u=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const l=o.payload;r.samples.push({data:l,len:l.byteLength,dts:a,pts:a,type:Rn.emsg,duration:u})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=Sx(o,t);r.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Rn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Sx(n,e){return oe(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class RP{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new zm(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ts.cbc)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const u=new Uint8Array(a);i.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const o=cw(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(u=>{s.data=this.getAvcDecryptedUnit(o,u),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(r>=s.length);r++){const o=s[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,i,o),!this.decrypter.isSync()))return}}}}class Yw{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,i;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,i=r.length;if(i){const s=r[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const i=t.byteLength;let s=e.naluState||0;const o=s,a=[];let u=0,l,c,d,f=-1,h=0;for(s===-1&&(f=0,h=this.getNALuType(t,0),s=0,u=1);u<i;){if(l=t[u++],!s){s=l?0:1;continue}if(s===1){s=l?0:2;continue}if(!l)s=3;else if(l===1){if(c=u-s-1,f>=0){const p={data:t.subarray(f,c),type:h};a.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(o&&u<=4-o&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-o)),c>0&&(p.data=tr(p.data,t.subarray(0,c)),p.state=0))}u<i?(d=this.getNALuType(t,u),f=u,h=d,s=0):s=-1}else s=0}if(f>=0&&s>=0){const p={data:t.subarray(f,i),type:h,state:s};a.push(p)}if(a.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=tr(p.data,t))}return e.naluState=s,a}}class za{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Fe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class wx extends Yw{parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let o=this.VideoSample,a,u=!1;r.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(l=>{var c,d;switch(l.type){case 1:{let g=!1;a=!0;const m=l.data;if(u&&m.length>4){const v=this.readSliceType(m);(v===2||v===4||v===7||v===9)&&(g=!0)}if(g){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.frame=!0,o.key=g;break}case 5:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,Wm(l.data,1,r.pts,t.samples);break}case 7:{var h,p;a=!0,u=!0;const g=l.data,m=this.readSPS(g);if(!e.sps||e.width!==m.width||e.height!==m.height||((h=e.pixelRatio)==null?void 0:h[0])!==m.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==m.pixelRatio[1]){e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.sps=[g];const v=g.subarray(1,4);let y="avc1.";for(let x=0;x<3;x++){let E=v[x].toString(16);E.length<2&&(E="0"+E),y+=E}e.codec=y}break}case 8:a=!0,e.pps=[l.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(l)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new za(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,i=8,s;for(let o=0;o<e;o++)i!==0&&(s=t.readEG(),i=(r+s+256)%256),r=i===0?r:i}readSPS(e){const t=new za(e);let r=0,i=0,s=0,o=0,a,u,l;const c=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),h=t.readBoolean.bind(t),p=t.skipBits.bind(t),g=t.skipEG.bind(t),m=t.skipUEG.bind(t),v=this.skipScalingList.bind(this);c();const y=c();if(d(5),p(3),c(),m(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const T=f();if(T===3&&p(1),m(),m(),p(1),h())for(u=T!==3?8:12,l=0;l<u;l++)h()&&(l<6?v(16,t):v(64,t))}m();const x=f();if(x===0)f();else if(x===1)for(p(1),g(),g(),a=f(),l=0;l<a;l++)g();m(),p(1);const E=f(),b=f(),S=d(1);S===0&&p(1),p(1),h()&&(r=f(),i=f(),s=f(),o=f());let w=[1,1];if(h()&&h())switch(c()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((E+1)*16-r*2-i*2),height:(2-S)*(b+1)*16-(S?2:4)*(s+o),pixelRatio:w}}}class Tx extends Yw{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let o=this.VideoSample,a,u=!1;r.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(l=>{var c,d;switch(l.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,u){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,Wm(l.data,2,r.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ke(e.params,this.readVPS(l.data)),this.initVPS=l.data),e.vps=[l.data];break;case 33:if(a=!0,u=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],l.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(l.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in h.params)e.params[p]=h.params[p]}this.pushParameterSet(e.sps,l.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(l.data);for(const p in h)e.params[p]=h[p]}this.pushParameterSet(e.pps,l.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:a=!1;break}o&&a&&o.units.push(l)}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[r]=e[i],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new za(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:i}}readSPS(e){const t=new za(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),u=t.readUByte(),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),p=t.readUByte(),g=t.readUByte(),m=t.readUByte(),v=t.readUByte(),y=[],x=[];for(let ve=0;ve<r;ve++)y.push(t.readBoolean()),x.push(t.readBoolean());if(r>0)for(let ve=r;ve<8;ve++)t.readBits(2);for(let ve=0;ve<r;ve++)y[ve]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[ve]&&t.readUByte();t.readUEG();const E=t.readUEG();E==3&&t.skipBits(1);const b=t.readUEG(),S=t.readUEG(),w=t.readBoolean();let T=0,R=0,_=0,A=0;w&&(T+=t.readUEG(),R+=t.readUEG(),_+=t.readUEG(),A+=t.readUEG());const k=t.readUEG(),G=t.readUEG(),U=t.readUEG(),M=t.readBoolean();for(let ve=M?0:r;ve<=r;ve++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let qe=0;qe<4;qe++)for(let ot=0;ot<(qe===3?2:6);ot++)if(!t.readBoolean())t.readUEG();else{const Dt=Math.min(64,1<<4+(qe<<1));qe>1&&t.readEG();for(let jt=0;jt<Dt;jt++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const D=t.readUEG();let P=0;for(let ve=0;ve<D;ve++){let qe=!1;if(ve!==0&&(qe=t.readBoolean()),qe){ve===D&&t.readUEG(),t.readBoolean(),t.readUEG();let ot=0;for(let vt=0;vt<=P;vt++){const Dt=t.readBoolean();let jt=!1;Dt||(jt=t.readBoolean()),(Dt||jt)&&ot++}P=ot}else{const ot=t.readUEG(),vt=t.readUEG();P=ot+vt;for(let Dt=0;Dt<ot;Dt++)t.readUEG(),t.readBoolean();for(let Dt=0;Dt<vt;Dt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ve=t.readUEG();for(let qe=0;qe<ve;qe++){for(let ot=0;ot<U+4;ot++)t.readBits(1);t.readBits(1)}}let K=0,Y=1,ee=1,ne=!0,ie=1,se=0;t.readBoolean(),t.readBoolean();let ye=!1;if(t.readBoolean()){if(t.readBoolean()){const Kt=t.readUByte(),Gn=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],rr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Kt>0&&Kt<16?(Y=Gn[Kt-1],ee=rr[Kt-1]):Kt===255&&(Y=t.readBits(16),ee=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ye=t.readBoolean(),ye&&(T+=t.readUEG(),R+=t.readUEG(),_+=t.readUEG(),A+=t.readUEG()),t.readBoolean()&&(ie=t.readBits(32),se=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const rr=t.readBoolean(),Wn=t.readBoolean();let qr=!1;(rr||Wn)&&(qr=t.readBoolean(),qr&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),qr&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Yr=0;Yr<=r;Yr++){ne=t.readBoolean();const Vn=ne||t.readBoolean();let Ys=!1;Vn?t.readEG():Ys=t.readBoolean();const Qu=Ys?1:t.readUEG()+1;if(rr)for(let ds=0;ds<Qu;ds++)t.readUEG(),t.readUEG(),qr&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Wn)for(let ds=0;ds<Qu;ds++)t.readUEG(),t.readUEG(),qr&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),K=t.readUEG())}let _e=b,nt=S;if(w||ye){let ve=1,qe=1;E===1?ve=qe=2:E==2&&(ve=2),_e=b-ve*R-ve*T,nt=S-qe*A-qe*_}const Le=i?["A","B","C"][i]:"",$e=a<<24|u<<16|l<<8|c;let Ne=0;for(let ve=0;ve<32;ve++)Ne=(Ne|($e>>ve&1)<<31-ve)>>>0;let Ye=Ne.toString(16);return o===1&&Ye==="2"&&(Ye="6"),{codecString:`hvc1.${Le}${o}.${Ye}.${s?"H":"L"}${v}.B0`,params:{general_tier_flag:s,general_profile_idc:o,general_profile_space:i,general_profile_compatibility_flags:[a,u,l,c],general_constraint_indicator_flags:[d,f,h,p,g,m],general_level_idc:v,bit_depth:k+8,bit_depth_luma_minus8:k,bit_depth_chroma_minus8:G,min_spatial_segmentation_idc:K,chroma_format_idc:E,frame_rate:{fixed:ne,fps:se/ie}},width:_e,height:nt,pixelRatio:[Y,ee]}}readPPS(e){const t=new za(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let o=1;return s&&i?o=0:s?o=3:i&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Pt=188;class Di{constructor(e,t,r,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.videoParser=null}static probe(e,t){const r=Di.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Pt*5,t-Pt)+1,i=0;for(;i<r;){let s=!1,o=-1,a=0;for(let u=i;u<t;u+=Pt)if(e[u]===71&&(t-u===Pt||e[u+Pt]===71)){if(a++,o===-1&&(o=u,o!==0&&(r=Math.min(o+Pt*99,e.length-Pt)+1)),s||(s=rg(e,u)===0),s&&a>1&&(o===0&&a>2||u+Pt>r))return o}else{if(a)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:sw[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Di.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Di.createTrack("audio",i),this._id3Track=Di.createTrack("id3"),this._txtTrack=Di.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){r||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,u=this._id3Track,l=this._txtTrack;let c=o.pid,d=o.pesData,f=a.pid,h=u.pid,p=a.pesData,g=u.pesData,m=null,v=this.pmtParsed,y=this._pmtId,x=e.length;if(this.remainderData&&(e=tr(this.remainderData,e),x=e.length,this.remainderData=null),x<Pt&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:u,textTrack:l};const E=Math.max(0,Di.syncOffset(e));x-=(x-E)%Pt,x<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let b=0;for(let w=E;w<x;w+=Pt)if(e[w]===71){const T=!!(e[w+1]&64),R=rg(e,w),_=(e[w+3]&48)>>4;let A;if(_>1){if(A=w+5+e[w+4],A===w+Pt)continue}else A=w+4;switch(R){case c:if(T){if(d&&(s=Zs(d,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new wx;break;case"hevc":this.videoParser=new Tx;break}this.videoParser!==null&&this.videoParser.parsePES(o,l,s,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(A,w+Pt)),d.size+=w+Pt-A);break;case f:if(T){if(p&&(s=Zs(p,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(A,w+Pt)),p.size+=w+Pt-A);break;case h:T&&(g&&(s=Zs(g,this.logger))&&this.parseID3PES(u,s),g={data:[],size:0}),g&&(g.data.push(e.subarray(A,w+Pt)),g.size+=w+Pt-A);break;case 0:T&&(A+=e[A]+1),y=this._pmtId=CP(e,A);break;case y:{T&&(A+=e[A]+1);const k=AP(e,A,this.typeSupported,r,this.observer,this.logger);c=k.videoPid,c>0&&(o.pid=c,o.segmentCodec=k.segmentVideoCodec),f=k.audioPid,f>0&&(a.pid=f,a.segmentCodec=k.segmentAudioCodec),h=k.id3Pid,h>0&&(u.pid=h),m!==null&&!v&&(this.logger.warn(`MPEG-TS PMT found at ${w} after unknown PID '${m}'. Backtracking to sync byte @${E} to parse all TS packets.`),m=null,w=E-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=R;break}}else b++;b>0&&ig(this.observer,new Error(`Found ${b} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=p,u.pesData=g;const S={audioTrack:a,videoTrack:o,id3Track:u,textTrack:l};return i&&this.extractRemainingSamples(S),S}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,o=r.pesData,a=t.pesData,u=i.pesData;let l;if(o&&(l=Zs(o,this.logger))){if(this.videoParser===null)switch(r.segmentCodec){case"avc":this.videoParser=new wx;break;case"hevc":this.videoParser=new Tx;break}this.videoParser!==null&&(this.videoParser.parsePES(r,s,l,!0),r.pesData=null)}else r.pesData=o;if(a&&(l=Zs(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;u&&(l=Zs(u,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=u}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new RP(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,f=i.sample.unit.byteLength;if(d===-1)s=tr(i.sample.unit,s);else{const h=f-d;i.sample.unit.set(s.subarray(0,d),h),e.samples.push(i.sample),r=i.missing}}let o,a;for(o=r,a=s.length;o<a-1&&!Jc(s,o);o++);if(o!==r){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",ig(this.observer,new Error(d),f,this.logger),!f)return}Mw(e,this.observer,s,o,this.audioCodec);let u;if(t.pts!==void 0)u=t.pts;else if(i){const d=Bw(e.samplerate);u=i.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let l=0,c;for(;o<a;)if(c=Uw(e,s,o,u,l),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(l++;o<a-1&&!Jc(s,o);o++);}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<i;)if(zw(r,o)){const u=Vw(e,r,o,a,s);if(u)o+=u.length,s++;else break}else o++}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let o=0,a=0,u;for(;a<s&&(u=qw(e,r,a,i,o++))>0;)a+=u}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Ke({},t,{type:this._videoTrack?Rn.emsg:Rn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function rg(n,e){return((n[e+1]&31)<<8)+n[e+2]}function CP(n,e){return(n[e+10]&31)<<8|n[e+11]}function AP(n,e,t,r,i,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],u=e+3+a-4,l=(n[e+10]&15)<<8|n[e+11];for(e+=12+l;e<u;){const c=rg(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){uh("ADTS AAC",s);break}case 15:o.audioPid===-1&&(o.audioPid=c);break;case 21:o.id3Pid===-1&&(o.id3Pid=c);break;case 219:if(!r){uh("H.264",s);break}case 27:o.videoPid===-1&&(o.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="mp3");break;case 193:if(!r){uh("AC-3",s);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(n[f]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=c,o.segmentAudioCodec="ac3");break}const g=n[f+1]+2;f+=g,h-=g}}break;case 194:case 135:return ig(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),o;case 36:o.videoPid===-1&&(o.videoPid=c,o.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return o}function ig(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(I.ERROR,I.ERROR,{type:pe.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function uh(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Zs(n,e){let t=0,r,i,s,o,a;const u=n.data;if(!n||n.size===0)return null;for(;u[0].length<19&&u.length>1;)u[0]=tr(u[0],u[1]),u.splice(1,1);if(r=u[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(i=(r[4]<<8)+r[5],i&&i>n.size-6)return null;const c=r[7];c&192&&(o=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(a=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=r[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const f=new Uint8Array(n.size);for(let h=0,p=u.length;h<p;h++){r=u[h];let g=r.byteLength;if(d)if(d>g){d-=g;continue}else r=r.subarray(d),g-=d,d=0;f.set(r,t),t+=g}return i&&(i-=s+3),{data:f,pts:o,dts:a,len:i}}return null}class kP{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const _i=Math.pow(2,32)-1;class W{static init(){W.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in W.types)W.types.hasOwnProperty(e)&&(W.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);W.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);W.STTS=W.STSC=W.STCO=s,W.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),W.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),W.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),W.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);W.FTYP=W.box(W.types.ftyp,o,u,o,a),W.DINF=W.box(W.types.dinf,W.box(W.types.dref,i))}static box(e,...t){let r=8,i=t.length;const s=i;for(;i--;)r+=t[i].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),i=0,r=8;i<s;i++)o.set(t[i],r),r+=t[i].byteLength;return o}static hdlr(e){return W.box(W.types.hdlr,W.HDLR_TYPES[e])}static mdat(e){return W.box(W.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(_i+1)),i=Math.floor(t%(_i+1));return W.box(W.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return W.box(W.types.mdia,W.mdhd(e.timescale||0,e.duration||0),W.hdlr(e.type),W.minf(e))}static mfhd(e){return W.box(W.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?W.box(W.types.minf,W.box(W.types.smhd,W.SMHD),W.DINF,W.stbl(e)):W.box(W.types.minf,W.box(W.types.vmhd,W.VMHD),W.DINF,W.stbl(e))}static moof(e,t,r){return W.box(W.types.moof,W.mfhd(e),W.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=W.trak(e[t]);return W.box.apply(null,[W.types.moov,W.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(W.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=W.trex(e[t]);return W.box.apply(null,[W.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(_i+1)),i=Math.floor(t%(_i+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return W.box(W.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return W.box(W.types.sdtp,r)}static stbl(e){return W.box(W.types.stbl,W.stsd(e),W.box(W.types.stts,W.STTS),W.box(W.types.stsc,W.STSC),W.box(W.types.stsz,W.STSZ),W.box(W.types.stco,W.STCO))}static avc1(e){let t=[],r=[],i,s,o;for(i=0;i<e.sps.length;i++)s=e.sps[i],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],o=s.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(s));const a=W.box(W.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),u=e.width,l=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return W.box(W.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,W.box(W.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),W.box(W.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return W.box(W.types.mp4a,W.audioStsd(e),W.box(W.types.esds,W.esds(e)))}static mp3(e){return W.box(W.types[".mp3"],W.audioStsd(e))}static ac3(e){return W.box(W.types["ac-3"],W.audioStsd(e),W.box(W.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return W.box(W.types.stsd,W.STSD,W.mp4a(e));if(t==="ac3"&&e.config)return W.box(W.types.stsd,W.STSD,W.ac3(e));if(t==="mp3"&&e.codec==="mp3")return W.box(W.types.stsd,W.STSD,W.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return W.box(W.types.stsd,W.STSD,W.avc1(e));if(t==="hevc"&&e.vps)return W.box(W.types.stsd,W.STSD,W.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,o=Math.floor(r/(_i+1)),a=Math.floor(r%(_i+1));return W.box(W.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=W.sdtp(e),i=e.id,s=Math.floor(t/(_i+1)),o=Math.floor(t%(_i+1));return W.box(W.types.traf,W.box(W.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),W.box(W.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),W.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,W.box(W.types.trak,W.tkhd(e),W.mdia(e))}static trex(e){const t=e.id;return W.box(W.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,s=12+16*i,o=new Uint8Array(s);let a,u,l,c,d,f;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<i;a++)u=r[a],l=u.duration,c=u.size,d=u.flags,f=u.cts,o.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return W.box(W.types.trun,o)}static initSegment(e){W.types||W.init();const t=W.moov(e);return tr(W.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let o=s.length;for(let p=0;p<r.length;p+=1){o+=3;for(let g=0;g<r[p].length;g+=1)o+=2+r[p][g].length}const a=new Uint8Array(o);a.set(s,0),o=s.length;const u=r.length-1;for(let p=0;p<r.length;p+=1){a.set(new Uint8Array([32+p|(p===u?128:0),0,r[p].length]),o),o+=3;for(let g=0;g<r[p].length;g+=1)a.set(new Uint8Array([r[p][g].length>>8,r[p][g].length&255]),o),o+=2,a.set(r[p][g],o),o+=r[p][g].length}const l=W.box(W.types.hvcC,a),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return W.box(W.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,W.box(W.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),W.box(W.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}W.types=void 0;W.HDLR_TYPES=void 0;W.STTS=void 0;W.STSC=void 0;W.STCO=void 0;W.STSZ=void 0;W.VMHD=void 0;W.SMHD=void 0;W.STSD=void 0;W.FTYP=void 0;W.DINF=void 0;const Xw=9e4;function nv(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function LP(n,e,t=1,r=!1){return nv(n,e,1/t,r)}function ba(n,e=!1){return nv(n,1e3,1/Xw,e)}function DP(n,e=1){return nv(n,Xw,1/e)}const PP=10*1e3,OP=1024,NP=1152,FP=1536;let eo=null,lh=null;function _x(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class ac{constructor(e,t,r,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.ISGenerated=!1,eo===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);eo=o?parseInt(o[1]):0}if(lh===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);lh=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,i=e.reduce((s,o)=>{let a=o.pts,u=a-s;return u<-4294967296&&(t=!0,a=zn(a,r),u=a-s),u>0?s:a},r);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,r,i,s,o,a,u){let l,c,d,f,h,p,g=s,m=s;const v=e.pid>-1,y=t.pid>-1,x=t.samples.length,E=e.samples.length>0,b=a&&x>0||x>1;if((!v||E)&&(!y||b)||this.ISGenerated||a){if(this.ISGenerated){var w,T,R,_;const U=this.videoTrackConfig;(U&&(t.width!==U.width||t.height!==U.height||((w=t.pixelRatio)==null?void 0:w[0])!==((T=U.pixelRatio)==null?void 0:T[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((_=U.pixelRatio)==null?void 0:_[1]))||!U&&b||this.nextAudioPts===null&&E)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,o));const A=this.isVideoContiguous;let k=-1,G;if(b&&(k=MP(t.samples),!A&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,k>0){this.logger.warn(`[mp4-remuxer]: Dropped ${k} out of ${x} video samples due to a missing keyframe`);const U=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(k),t.dropped+=k,m+=(t.samples[0].pts-U)/t.inputTimeScale,G=m}else k===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${x} video samples`),p=!1);if(this.ISGenerated){if(E&&b){const U=this.getVideoStartPts(t.samples),B=(zn(e.samples[0].pts,U)-U)/t.inputTimeScale;g+=Math.max(0,B),m+=Math.max(0,-B)}if(E){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,o)),c=this.remuxAudio(e,g,this.isAudioContiguous,o,y||b||u===de.AUDIO?m:void 0),b){const U=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,o)),l=this.remuxVideo(t,m,A,U)}}else b&&(l=this.remuxVideo(t,m,A,0));l&&(l.firstKeyFrame=k,l.independent=k!==-1,l.firstKeyFramePTS=G)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=Qw(r,s,this._initPTS,this._initDTS)),i.samples.length&&(f=Jw(i,s,this._initPTS))),{audio:c,video:l,initSegment:d,independent:p,text:f,id3:h}}generateIS(e,t,r,i){const s=e.samples,o=t.samples,a=this.typeSupported,u={},l=this._initPTS;let c=!l||i,d="audio/mp4",f,h,p;if(c&&(f=h=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}u.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):W.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(p=e.inputTimeScale,!l||p!==l.timescale?f=h=s[0].pts-Math.round(p*r):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:W.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(p=t.inputTimeScale,!l||p!==l.timescale){const g=this.getVideoStartPts(o),m=Math.round(p*r);h=Math.min(h,zn(o[0].dts,g)-m),f=Math.min(f,g-m)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:f,timescale:p},this._initDTS={baseTime:h,timescale:p}):f=p=void 0,{tracks:u,initPTS:f,timescale:p}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,o=e.samples,a=[],u=o.length,l=this._initPTS;let c=this.nextAvcDts,d=8,f=this.videoSampleDuration,h,p,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=!1;if(!r||c===null){const P=t*s,O=o[0].pts-zn(o[0].dts,o[0].pts);eo&&c!==null&&Math.abs(P-O-c)<15e3?r=!0:c=P-O}const y=l.baseTime*s/l.timescale;for(let P=0;P<u;P++){const O=o[P];O.pts=zn(O.pts-y,c),O.dts=zn(O.dts-y,c),O.dts<o[P>0?P-1:P].dts&&(v=!0)}v&&o.sort(function(P,O){const K=P.dts-O.dts,Y=P.pts-O.pts;return K||Y}),h=o[0].dts,p=o[o.length-1].dts;const x=p-h,E=x?Math.round(x/(u-1)):f||e.inputTimeScale/30;if(r){const P=h-c,O=P>E,K=P<-1;if((O||K)&&(O?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ba(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ba(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!K||c>=o[0].pts||eo)){h=c;const Y=o[0].pts-P;if(O)o[0].dts=h,o[0].pts=Y;else{let ee=!0;for(let ne=0;ne<o.length&&!(o[ne].dts>Y&&ee);ne++){const ie=o[ne].pts;if(o[ne].dts-=P,o[ne].pts-=P,ne<o.length-1){const se=o[ne+1].pts,ye=o[ne].pts,Ee=se<=ye,_e=se<=ie;ee=Ee==_e}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${ba(Y,!0)}/${ba(h,!0)}, delta: ${ba(P,!0)} ms`)}}h=Math.max(0,h);let b=0,S=0,w=h;for(let P=0;P<u;P++){const O=o[P],K=O.units,Y=K.length;let ee=0;for(let ne=0;ne<Y;ne++)ee+=K[ne].data.length;S+=ee,b+=Y,O.length=ee,O.dts<w?(O.dts=w,w+=E/4|0||1):w=O.dts,g=Math.min(O.pts,g),m=Math.max(O.pts,m)}p=o[u-1].dts;const T=S+4*b+8;let R;try{R=new Uint8Array(T)}catch(P){this.observer.emit(I.ERROR,I.ERROR,{type:pe.MUX_ERROR,details:V.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:T,reason:`fail allocating video mdat ${T}`});return}const _=new DataView(R.buffer);_.setUint32(0,T),R.set(W.types.mdat,4);let A=!1,k=Number.POSITIVE_INFINITY,G=Number.POSITIVE_INFINITY,U=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let P=0;P<u;P++){const O=o[P],K=O.units;let Y=0;for(let ie=0,se=K.length;ie<se;ie++){const ye=K[ie],Ee=ye.data,_e=ye.data.byteLength;_.setUint32(d,_e),d+=4,R.set(Ee,d),d+=_e,Y+=4+_e}let ee;if(P<u-1)f=o[P+1].dts-O.dts,ee=o[P+1].pts-O.pts;else{const ie=this.config,se=P>0?O.dts-o[P-1].dts:E;if(ee=P>0?O.pts-o[P-1].pts:E,ie.stretchShortVideoTrack&&this.nextAudioPts!==null){const ye=Math.floor(ie.maxBufferHole*s),Ee=(i?g+i*s:this.nextAudioPts)-O.pts;Ee>ye?(f=Ee-se,f<0?f=se:A=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Ee/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=se}else f=se}const ne=Math.round(O.pts-O.dts);k=Math.min(k,f),U=Math.max(U,f),G=Math.min(G,ee),M=Math.max(M,ee),a.push(_x(O.key,f,Y,ne))}if(a.length){if(eo){if(eo<70){const P=a[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(lh&&M-G<U-k&&E/U<.025&&a[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=h;for(let O=0,K=a.length;O<K;O++){const Y=P+a[O].duration,ee=P+a[O].cts;if(O<K-1){const ne=Y+a[O+1].cts;a[O].duration=ne-ee}else a[O].duration=O?a[O-1].duration:E;a[O].cts=0,P=Y}}}f=A||!f?E:f,this.nextAvcDts=c=p+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const D={data1:W.moof(e.sequenceNumber++,h,Ke(e,{samples:a})),data2:R,startPTS:g/s,endPTS:(m+f)/s,startDTS:h/s,endDTS:c/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,D}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return NP;case"ac3":return FP;default:return OP}}remuxAudio(e,t,r,i,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,u=o/a,l=this.getSamplesPerFrame(e),c=l*u,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],p=s!==void 0;let g=e.samples,m=f?0:8,v=this.nextAudioPts||-1;const y=t*o,x=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||g.length&&v>0&&(i&&Math.abs(y-v)<9e3||Math.abs(zn(g[0].pts-x,y)-v)<20*c),g.forEach(function(B){B.pts=zn(B.pts-x,y)}),!r||v<0){if(g=g.filter(B=>B.pts>=0),!g.length)return;s===0?v=0:i&&!p?v=Math.max(0,y):v=g[0].pts}if(e.segmentCodec==="aac"){const B=this.config.maxAudioFramesDrift;for(let $=0,D=v;$<g.length;$++){const P=g[$],O=P.pts,K=O-D,Y=Math.abs(1e3*K/o);if(K<=-B*c&&p)$===0&&(this.logger.warn(`Audio frame @ ${(O/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*K/o)} ms.`),this.nextAudioPts=v=D=O);else if(K>=B*c&&Y<PP&&p){let ee=Math.round(K/c);D=O-ee*c,D<0&&(ee--,D+=c),$===0&&(this.nextAudioPts=v=D),this.logger.warn(`[mp4-remuxer]: Injecting ${ee} audio frame @ ${(D/o).toFixed(3)}s due to ${Math.round(1e3*K/o)} ms gap.`);for(let ne=0;ne<ee;ne++){const ie=Math.max(D,0);let se=kP.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);se||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),se=P.unit.subarray()),g.splice($,0,{unit:se,pts:ie}),D+=c,$++}}P.pts=D,D+=c}}let E=null,b=null,S,w=0,T=g.length;for(;T--;)w+=g[T].unit.byteLength;for(let B=0,$=g.length;B<$;B++){const D=g[B],P=D.unit;let O=D.pts;if(b!==null){const Y=h[B-1];Y.duration=Math.round((O-b)/u)}else if(r&&e.segmentCodec==="aac"&&(O=v),E=O,w>0){w+=m;try{S=new Uint8Array(w)}catch(Y){this.observer.emit(I.ERROR,I.ERROR,{type:pe.MUX_ERROR,details:V.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:w,reason:`fail allocating audio mdat ${w}`});return}f||(new DataView(S.buffer).setUint32(0,w),S.set(W.types.mdat,4))}else return;S.set(P,m);const K=P.byteLength;m+=K,h.push(_x(!0,l,K,0)),b=O}const R=h.length;if(!R)return;const _=h[h.length-1];this.nextAudioPts=v=b+u*_.duration;const A=f?new Uint8Array(0):W.moof(e.sequenceNumber++,E/u,Ke({},e,{samples:h}));e.samples=[];const k=E/o,G=v/o,M={data1:A,data2:S,startPTS:k,endPTS:G,startDTS:k,endDTS:G,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,M}}function zn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function MP(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Qw(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let a=0;a<i;a++){const u=n.samples[a];u.pts=zn(u.pts-t.baseTime*s/t.timescale,e*s)/s,u.dts=zn(u.dts-r.baseTime*s/r.timescale,e*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function Jw(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=zn(a.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((o,a)=>o.pts-a.pts);const s=n.samples;return n.samples=[],{samples:s}}class BP{constructor(e,t,r,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(IL(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const i=this.initData=uw(e);i.audio&&(t=Ix(i.audio,He.AUDIO)),i.video&&(r=Ix(i.video,He.VIDEO));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,s,o){var a,u;let{initPTS:l,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};oe(c)||(c=this.lastEndTime=s||0);const f=t.samples;if(!(f!=null&&f.length))return d;const h={initPTS:void 0,timescale:1};let p=this.initData;if((a=p)!=null&&a.length||(this.generateInitSegment(f),p=this.initData),!((u=p)!=null&&u.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=CL(f,p),m=RL(p,f),v=m===null?s:m;(o||!l)&&(UP(l,v,s,g)||h.timescale!==l.timescale)&&(h.initPTS=v-s,l&&l.timescale===1&&this.logger.warn(`Adjusting initPTS @${s} from ${l.baseTime/l.timescale} to ${h.initPTS}`),this.initPTS=l={baseTime:h.initPTS,timescale:1});const y=e?v-l.baseTime/l.timescale:c,x=y+g;kL(p,f,l.baseTime/l.timescale),g>0?this.lastEndTime=x:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const E=!!p.audio,b=!!p.video;let S="";E&&(S+="audio"),b&&(S+="video");const w={data1:f,startPTS:y,startDTS:y,endPTS:x,endDTS:x,type:S,hasAudio:E,hasVideo:b,nb:1,dropped:0};return d.audio=w.type==="audio"?w:void 0,d.video=w.type!=="audio"?w:void 0,d.initSegment=h,d.id3=Qw(r,s,l,l),i.samples.length&&(d.text=Jw(i,s,l)),d}}function UP(n,e,t,r){if(n===null)return!0;const i=Math.max(r,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>i}function Ix(n,e){const t=n==null?void 0:n.codec;return t&&t.length>4?t:e===He.AUDIO?t==="ec-3"||t==="ac-3"||t==="alac"?t:t==="fLaC"||t==="Opus"?zc(t,!1):(Fe.warn(`Unhandled audio codec "${t}" in mp4 MAP`),t||"mp4a"):(Fe.warn(`Unhandled video codec "${t}" in mp4 MAP`),t||"avc1")}let ni;try{ni=self.performance.now.bind(self.performance)}catch{ni=Date.now}const uc=[{demux:IP,remux:BP},{demux:Di,remux:ac},{demux:SP,remux:ac},{demux:TP,remux:ac}];uc.splice(2,0,{demux:wP,remux:ac});class Rx{constructor(e,t,r,i,s,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=s,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=ni();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:u}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:p}=i||a,{audioCodec:g,videoCodec:m,defaultInitPts:v,duration:y,initSegmentData:x}=u,E=$P(o,t);if(E&&ko(E.method)){const T=this.getDecrypter(),R=Km(E.method);if(T.isSync()){let _=T.softwareDecrypt(o,E.key.buffer,E.iv.buffer,R);if(r.part>-1){const k=T.flush();_=k&&k.buffer}if(!_)return s.executeEnd=ni(),ch(r);o=new Uint8Array(_)}else return this.asyncResult=!0,this.decryptionPromise=T.webCryptoDecrypt(o,E.key.buffer,E.iv.buffer,R).then(_=>{const A=this.push(_,null,r);return this.decryptionPromise=null,A}),this.decryptionPromise}const b=this.needsProbing(c,d);if(b){const T=this.configureTransmuxer(o);if(T)return this.logger.warn(`[transmuxer] ${T.message}`),this.observer.emit(I.ERROR,I.ERROR,{type:pe.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,fatal:!1,error:T,reason:T.message}),s.executeEnd=ni(),ch(r)}(c||d||p||b)&&this.resetInitSegment(x,g,m,y,t),(c||p||b)&&this.resetInitialTimestamp(v),l||this.resetContiguity();const S=this.transmux(o,E,h,f,r);this.asyncResult=Su(S);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,s.executeEnd=ni(),S}flush(e){const t=e.transmuxing;t.executeStart=ni();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const o=[],{timeOffset:a}=i;if(r){const d=r.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:u,remuxer:l}=this;if(!u||!l){t.executeEnd=ni();const d=[ch(e)];return this.asyncResult?Promise.resolve(d):d}const c=u.flush(a);return Su(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,c,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:u,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===de.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(i,s,o,a,l,u,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=ni()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,i,s):o=this.transmuxUnencrypted(e,r,i,s),o}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:u}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,u,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i}=this;let s;for(let d=0,f=uc.length;d<f;d++){var o;if((o=uc[d].demux)!=null&&o.probe(e,this.logger)){s=uc[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,u=this.remuxer,l=s.remux,c=s.demux;(!u||!(u instanceof l))&&(this.remuxer=new l(r,t,i,this.logger)),(!a||!(a instanceof c))&&(this.demuxer=new c(r,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new zm(this.config)),e}}function $P(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const ch=n=>({remuxResult:{},chunkMeta:n});function Su(n){return"then"in n&&n.then instanceof Function}class GP{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class WP{constructor(e,t,r,i,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=o}}let Cx=0;class Zw{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Cx++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=u=>{const l=u.data,c=this.hls;if(!(!c||!(l!=null&&l.event)||l.instanceNo!==this.instanceNo))switch(l.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":{c.logger[l.data.logType]&&c.logger[l.data.logType](l.data.message);break}default:{l.data=l.data||{},l.data.frag=this.frag,l.data.part=this.part,l.data.id=this.id,c.trigger(l.event,l.data);break}}},this.onWorkerError=u=>{if(!this.hls)return;const l=new Error(`${u.message}  (${u.filename}:${u.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:l})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const o=(u,l)=>{l=l||{},l.frag=this.frag||void 0,u===I.ERROR&&(l=l,l.parent=this.id,l.part=this.part,this.error=l.error),this.hls.trigger(u,l)};this.observer=new Xm,this.observer.on(I.FRAG_DECRYPTED,o),this.observer.on(I.ERROR,o);const a=zy(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const u=this.hls.logger;if(s.workerPath||zD()){try{s.workerPath?(u.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=KD(s.workerPath)):(u.log(`injecting Web Worker for "${t}"`),this.workerContext=jD());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:st(s)})}catch(c){u.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Rx(this.observer,a,s,"",t,e.logger)}return}}this.transmuxer=new Rx(this.observer,a,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Cx++;const t=this.hls.config,r=zy(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:st(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),qD(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,i,s,o,a,u,l,c){var d,f;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:p}=this,g=o?o.start:s.start,m=s.decryptdata,v=this.frag,y=!(v&&s.cc===v.cc),x=!(v&&l.level===v.level),E=v?l.sn-v.sn:-1,b=this.part?l.part-this.part.index:-1,S=E===0&&l.id>1&&l.id===(v==null?void 0:v.stats.chunkCount),w=!x&&(E===1||E===0&&(b===1||S&&b<=0)),T=self.performance.now();(x||E||s.stats.parsing.start===0)&&(s.stats.parsing.start=T),o&&(b||!w)&&(o.stats.parsing.start=T);const R=!(v&&((d=s.initSegment)==null?void 0:d.url)===((f=v.initSegment)==null?void 0:f.url)),_=new WP(y,w,u,x,g,R);if(!w||y||R){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===de.MAIN?"level":"track"}: ${l.level} id: ${l.id}
        discontinuity: ${y}
        trackSwitch: ${x}
        contiguous: ${w}
        accurateTimeOffset: ${u}
        timeOffset: ${g}
        initSegmentChange: ${R}`);const A=new GP(r,i,t,a,c);this.configureTransmuxer(A)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:m,chunkMeta:l,state:_},e instanceof ArrayBuffer?[e]:[]);else if(p){const A=p.push(e,m,l,_);Su(A)?A.then(k=>{this.handleTransmuxComplete(k)}).catch(k=>{this.transmuxerError(k,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(A)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const i=r.flush(e);Su(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Ax=100;class VP extends Ym{constructor(e,t,r){super(e,t,r,"audio-stream-controller",de.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){if(r===de.MAIN){const o=t.cc,a=this.fragCurrent;if(this.initPTS[o]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${o} found from main: ${i}/${s}`),this.mainAnchor=t,this.state===J.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==o)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&a&&a.cc!==o?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,a.abortRequests(),this.resetLoadingState()):this.state===J.IDLE&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),r=e.cc;return sD(t,r,e)||t&&xw(t.fragments,r)||e}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=J.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ax),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=J.IDLE):this.state=J.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case J.IDLE:this.doTickIdle();break;case J.WAITING_TRACK:{const{levels:t,trackId:r}=this,i=t==null?void 0:t[r],s=i==null?void 0:i.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=J.WAITING_INIT_PTS}break}case J.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((i==null?void 0:i[s])||null),this.state=J.IDLE}break}case J.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:r,part:i,cache:s,complete:o}=t,a=this.mainAnchor;if(this.initPTS[r.cc]!==void 0){this.waitingData=null,this.state=J.FRAG_LOADING;const u=s.flush().buffer,l={frag:r,part:i,payload:u,networkDetails:null};this._handleFragmentLoadProgress(l),o&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==t.frag.cc&&(this.log(`Waiting fragment cc (${r.cc}) cancelled because video is at cc ${a.cc}`),this.nextLoadPosition=this.findSyncFrag(a).start,this.clearWaitingFragment())}else this.state=J.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==J.STOPPED&&(this.state=J.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:i,trackId:s}=this,o=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(r!=null&&r[s]))return;const a=r[s],u=a.details;if(!u||this.waitForLive(a)||this.waitForCdnTuneIn(u)){this.state=J.WAITING_TRACK,this.startFragRequested=!1;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,He.AUDIO,de.AUDIO));const c=this.getFwdBufferInfo(l,de.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,u)){t.trigger(I.BUFFER_EOS,{type:"audio"}),this.state=J.ENDED;return}const d=c.len,f=t.maxBufferLength,h=u.fragments,p=h[0].start,g=this.getLoadPosition(),m=this.flushing?g:c.end;if(this.switchingTrack&&i){const x=g;u.PTSKnown&&x<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}if(d>=f&&!this.switchingTrack&&m<h[h.length-1].start)return;let v=this.getNextFragment(m,u);if(v&&this.isLoopLoading(v,m)&&(v=this.getNextFragmentLoopLoading(v,u,c,de.MAIN,f)),!v){this.bufferFlushed=!0;return}let y=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&Vt(v)&&!v.endList&&(!u.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===_t.OK&&(this.mainFragLoading=y=null),y&&Vt(y))){if(v.start>y.end){const E=this.fragmentTracker.getFragAtPos(m,de.MAIN);E&&E.end>y.end&&(y=E,this.mainFragLoading={frag:E,targetBufferTime:null})}if(v.start>y.end)return}this.loadFragment(v,a,m)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new vu(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==J.STOPPED&&(this.setInterval(Ax),this.state=J.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(I.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:i}=this,{details:s,id:o,groupId:a,track:u}=t;if(!i){this.warn(`Audio tracks reset while loading track ${o} "${u.name}" of "${a}"`);return}const l=this.mainDetails;if(!l||s.endCC>l.endCC||l.expired){this.cachedTrackLoadedData=t,this.state!==J.STOPPED&&(this.state=J.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${u.name}" of "${a}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=i[o];let d=0;if(s.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(s,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}s.alignedSliding||(Dw(s,l),s.alignedSliding||Qc(s,l),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,d),this.hls.trigger(I.AUDIO_TRACK_UPDATED,{details:s,id:o,groupId:t.groupId}),this.state===J.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=J.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{config:o,trackId:a,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const l=u[a];if(!l){this.warn("Audio track is undefined on fragment load progress");return}const c=l.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=o.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new Zw(this.hls,de.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],p=(t=r.initSegment)==null?void 0:t.data;if(h!==void 0){const m=i?i.index:-1,v=m!==-1,y=new jm(r.level,r.sn,r.stats.chunkCount,s.byteLength,m,v);f.push(s,p,d,"",r,i,c.totalduration,!1,y,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:g}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new Pw,complete:!1};g.push(new Uint8Array(s)),this.state!==J.STOPPED&&(this.state=J.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===de.MAIN&&Vt(t.frag)&&(this.mainFragLoading=t,this.state===J.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type!==de.AUDIO){!this.audioOnly&&r.type===de.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Vt(r)){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(I.AUDIO_TRACK_SWITCHED,Ge({},s)))}this.fragBufferedComplete(r,i),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=J.ERROR;return}switch(t.details){case V.FRAG_GAP:case V.FRAG_PARSING_ERROR:case V.FRAG_DECRYPT_ERROR:case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.AUDIO,t);break;case V.AUDIO_TRACK_LOAD_ERROR:case V.AUDIO_TRACK_LOAD_TIMEOUT:case V.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===J.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Ae.AUDIO_TRACK&&(this.state=J.IDLE);break;case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case V.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case V.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==He.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==He.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===J.ENDED&&(this.state=J.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,de.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:u,part:l,level:c}=a,{details:d}=c,{audio:f,text:h,id3:p,initSegment:g}=s;if(this.fragContextChanged(u)||!d){this.fragmentTracker.removeFragment(u);return}if(this.state=J.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const m=u.initSegment||u;this._bufferInitSegment(c,g.tracks,m,o),i.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:r,tracks:g.tracks})}if(f){const{startPTS:m,endPTS:v,startDTS:y,endDTS:x}=f;l&&(l.elementaryStreams[He.AUDIO]={startPTS:m,endPTS:v,startDTS:y,endDTS:x}),u.setElementaryStreamInfo(He.AUDIO,m,v,y,x),this.bufferFragmentData(f,u,l,o)}if(p!=null&&(t=p.samples)!=null&&t.length){const m=Ke({id:r,frag:u,details:d},p);i.trigger(I.FRAG_PARSING_METADATA,m)}if(h){const m=Ke({id:r,frag:u,details:d},h);i.trigger(I.FRAG_PARSING_USERDATA,m)}}_bufferInitSegment(e,t,r,i){if(this.state!==J.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=de.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(I.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const u={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:a};this.hls.trigger(I.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===_t.NOT_LOADED||i===_t.PARTIAL){var s;if(!Vt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=J.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Qc(t.details,o)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;As({name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a},e,ms)||(Kc(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(I.AUDIO_TRACK_SWITCHED,Ge({},e))}}class rv extends vi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let o=0;o<i.length;o++){const a=i[o];let u;try{u=new self.URL(a.URI,t.url).href}catch(l){this.warn(`Could not construct new URL for Rendition Report: ${l}`),u=a.URI||""}if(u===e){s=o;break}else u===e.substring(0,u.length)&&(s=o)}if(s!==-1){const o=i[s],a=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let u=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&c>t.partTarget&&(u+=1)}const l=r&&Ky(r);return new qy(a,u>=0?u:void 0,l)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:i,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;i.advancedDateTime=Date.now()-a;const u=this.hls.config.timelineOffset;if(u!==i.appliedTimelineOffset){const c=Math.max(u||0,0);i.appliedTimelineOffset=c,i.fragments.forEach(d=>{d.start=d.playlistOffset+c})}if(i.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(r),r&&i.fragments.length>0){OD(r,i);const y=i.playlistParsingError;if(y){this.warn(y);const x=this.hls;if(!x.config.ignorePlaylistParsingErrors){var l;const{networkDetails:E}=t;x.trigger(I.ERROR,{type:pe.NETWORK_ERROR,details:V.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:y,reason:y.message,level:t.level||void 0,parent:(l=i.fragments[0])==null?void 0:l.type,networkDetails:E,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(i.edge-f)*1e3,p=Cw(i,h);if(i.requestScheduled+p<o?i.requestScheduled=o:i.requestScheduled+=p,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let g,m,v;if(i.canBlockReload&&i.endSN&&i.advanced){const y=this.hls.config.lowLatencyMode,x=i.lastPartSn,E=i.endSN,b=i.lastPartIndex,S=b!==-1,w=x===E;S?w?(m=E+1,v=y?0:b):(m=x,v=y?b+1:i.maxPartIndex):m=E+1;const T=i.age,R=T+i.ageHeader;let _=Math.min(R-i.partTarget,i.targetduration*1.5);if(_>0){if(R>i.targetduration*3)this.log(`Playlist last advanced ${T.toFixed(2)}s ago. Omitting segment and part directives.`),m=void 0,v=void 0;else if(r!=null&&r.tuneInGoal&&R-i.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${_} with playlist age: ${i.age}`),_=0;else{const A=Math.floor(_/i.targetduration);if(m+=A,v!==void 0){const k=Math.round(_%i.targetduration/i.partTarget);v+=k}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${T.toFixed(2)}s goal: ${_} skip sn ${A} to part ${v}`)}i.tuneInGoal=_}if(g=this.getDeliveryDirectives(i,t.deliveryDirectives,m,v),y||!w){i.requestScheduled=o,this.loadingPlaylist(c,g);return}}else(i.canBlockReload||i.canSkipUntil)&&(g=this.getDeliveryDirectives(i,t.deliveryDirectives,m,v));g&&m!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(p-a*2,p/2)),this.scheduleLoading(c,g,i)}else this.clearTimer()}scheduleLoading(e,t,r){const i=r||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),o=i.requestScheduled;if(s>=o){this.loadingPlaylist(e,t);return}const a=o-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,r,i){let s=Ky(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=oc.No),new qy(r,i,s)}checkRetry(e){const t=e.details,r=qc(e),i=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=i||{},u=!!i&&!!a&&(s===Xt.RetryRequest||!i.resolved&&s===Xt.SendAlternateToPenaltyBox);if(u){var l;if(o>=a.maxNumRetry)return!1;if(r&&(l=e.context)!=null&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Hm(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return u}}function eT(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!wu(n[t].attrs,e[t].attrs))return!1;return!0}function wu(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function sg(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class HP extends rv{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(I.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,h)=>{f.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const u=this.hls.config.audioPreference;if(!s&&u){const f=Pr(u,a,ms);if(f>-1)s=a[f];else{const h=Pr(u,this.tracks);s=this.tracks[h]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(I.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(l!==-1&&d===-1)this.setAudioTrack(l);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ae.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&As(e,i,ms))return i;const s=Pr(e,this.tracksInGroup,ms);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(i){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=eD(e,t.levels,r,o,ms);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Pr(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===r&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(I.AUDIO_TRACK_SWITCHING,Ge({},i)),s))return;const o=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(!(this.selectDefaultTrack&&!i.default)&&(!e||As(e,i,ms)))return r}if(e){const{name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:u}=e;for(let l=0;l<t.length;l++){const c=t[l];if(As({name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:u},c,ms))return l}for(let l=0;l<t.length;l++){const c=t[l];if(wu(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const c=t[l];if(wu(e.attrs,c.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Kc(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(I.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}}class zP{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var r;if(i.onError(s),this.queues===null||this.tracks===null)return;const o=(r=this.tracks[e])==null?void 0:r.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],i=r==null?void 0:r.buffer;return i?`SourceBuffer${i.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const kx=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,tT="HlsJsTrackRemovedError";class jP extends Error{constructor(e){super(e),this.name=tT}}class KP extends vi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:i,mediaSource:s}=this;r&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(I.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:i}=this;r!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=vL(es(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.BUFFER_RESET,this.onBufferReset,this),e.on(I.BUFFER_APPENDING,this.onBufferAppending,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.BUFFER_EOS,this.onBufferEos,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.FRAG_PARSED,this.onFragParsed,this),e.on(I.FRAG_CHANGED,this.onFragChanged,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.BUFFER_RESET,this.onBufferReset,this),e.off(I.BUFFER_APPENDING,this.onBufferAppending,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_EOS,this.onBufferEos,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.FRAG_PARSED,this.onFragParsed,this),e.off(I.FRAG_CHANGED,this.onFragChanged,this),e.off(I.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const o=this.isQueued();(s||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Ke(r,i.tracks):this.sourceBuffers.forEach(s=>{const[o]=s;o&&(r[o]=Ke({},this.tracks[o]),this.removeBuffer(o)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media,i=es(this.appendSource);if(this.transferData=this.overrides=void 0,r&&i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(o),s)this._objectUrl=r.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const u=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||u&&o instanceof u,Lx(r),qP(r,a),r.load()}catch{r.src=a}else r.src=a}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,i=t.tracks,s=i?Object.keys(i):null,o=s?s.length:0,a=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&s&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${st(r,(u,l)=>u==="initSegment"?void 0:l)};
transfer tracks: ${st(i,(u,l)=>u==="initSegment"?void 0:l)}}`),!nw(i,r)){t.mediaSource=null,t.tracks=void 0;const u=e.currentTime,l=this.details,c=Math.max(u,(l==null?void 0:l.fragments[0].start)||0);if(c-u>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${u} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${u}`),this.onMediaDetaching(I.MEDIA_DETACHING,{}),this.onMediaAttaching(I.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,s.forEach(u=>{const l=u,c=i[l];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,h=c.id;if(f.hasFragments(h)||f.hasParts(h)){const m=Ce.getBuffered(d);f.detectEvictedFragments(l,m,h,null,!0)}const p=dh(l),g=[l,d];this.sourceBuffers[p]=g,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(l),this.trackSourceBuffer(l,c)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:o}=this;if(s){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=s.readyState==="open";try{const u=s.sourceBuffers;for(let l=u.length;l--;)a&&u[l].abort(),s.removeSourceBuffer(u[l]);a&&s.endOfStream()}catch(u){this.warn(`onMediaDetaching: ${u.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),r||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(i.removeAttribute("src"),this.appendSource&&Lx(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(I.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[dh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new zP(this.tracks)}onBufferCodecs(e,t){const r=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),o=!s&&this.sourceBufferCount&&this.media&&i.some(a=>!r[a]);if(s||o){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${i}" SourceBuffers`);return}i.forEach(a=>{var u,l,c;const d=t[a],{id:f,codec:h,levelCodec:p,container:g,metadata:m,supplemental:v}=d;let y=r[a];const x=(u=this.transferData)==null||(l=u.tracks)==null?void 0:l[a],E=x!=null&&x.buffer?x:y,b=(E==null?void 0:E.pendingCodec)||(E==null?void 0:E.codec),S=E==null?void 0:E.levelCodec;y||(y=r[a]={buffer:void 0,listeners:[],codec:h,supplemental:v,container:g,levelCodec:p,metadata:m,id:f});const w=sc(b,S),T=w==null?void 0:w.replace(kx,"$1");let R=sc(h,p);const _=(c=R)==null?void 0:c.replace(kx,"$1");R&&w&&T!==_&&(a.slice(0,5)==="audio"&&(R=zc(R,this.appendSource)),this.log(`switching codec ${b} to ${R}`),R!==(y.pendingCodec||y.codec)&&(y.pendingCodec=R),y.container=g,this.appendChangeType(a,g,R))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const i=`${t};codecs=${r}`,s={label:`change-type=${i}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),a.changeType(i),o.codec=r,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,i=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,de.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const u=this.tracks.video;(this.lastVideoAppendEnd>i||u!=null&&u.buffer&&Ce.isBuffered(u.buffer,i)||((a=this.fragmentTracker.getAppendedFrag(i,de.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:i,type:s,parent:o,frag:a,part:u,chunkMeta:l}=t,c=l.buffering[s],d=a.sn,f=self.performance.now();c.start=f;const h=a.stats.buffering,p=u?u.stats.buffering:null;h.start===0&&(h.start=f),p&&p.start===0&&(p.start=f);const g=r.audio;let m=!1;s==="audio"&&(g==null?void 0:g.container)==="audio/mpeg"&&(m=!this.lastMpegAudioChunk||l.id===1||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const v=this.tracks.video,y=v==null?void 0:v.buffer;if(y&&d!=="initSegment"){const b=u||a,S=this.blockedAudioAppend;if(s==="audio"&&o!=="main"&&!this.blockedAudioAppend){const T=b.start+b.duration*.05,R=y.buffered,_=this.currentOp("video");!R.length&&!_?this.blockAudio(b):!_&&!Ce.isBuffered(y,T)&&this.lastVideoAppendEnd<T&&this.blockAudio(b)}else if(s==="video"){const w=b.end;if(S){const T=S.frag.start;(w>T||w<this.lastVideoAppendEnd||Ce.isBuffered(y,T))&&this.unblockAudio()}this.lastVideoAppendEnd=w}}const x=(u||a).start,E={label:`append-${s}`,execute:()=>{if(c.executeStart=self.performance.now(),m){const b=this.tracks[s];if(b){const S=b.buffer;if(S){const w=x-S.timestampOffset;Math.abs(w)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${x} (delta: ${w}) sn: ${d})`),S.timestampOffset=x)}}}this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const b=self.performance.now();c.executeEnd=c.end=b,h.first===0&&(h.first=b),p&&p.first===0&&(p.first=b);const S={};this.sourceBuffers.forEach(([w,T])=>{w&&(S[w]=Ce.getBuffered(T))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(I.BUFFER_APPENDED,{type:s,frag:a,part:u,chunkMeta:l,parent:a.type,timeRanges:S})},onError:b=>{var S;const w={type:pe.MEDIA_ERROR,parent:a.type,details:V.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:a,part:u,chunkMeta:l,error:b,err:b,fatal:!1};if(b.code===DOMException.QUOTA_EXCEEDED_ERR)w.details=V.BUFFER_FULL_ERROR;else if(b.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!((S=this.media)!=null&&S.error))w.errorAction=yu(!0);else if(b.name===tT)this.sourceBufferCount===0?w.errorAction=yu(!0):++this.appendErrors[s];else{const T=++this.appendErrors[s];this.warn(`Failed ${T}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer`),T>=this.hls.config.appendErrorMaxRetry&&(w.fatal=!0)}this.hls.trigger(I.ERROR,w)}};this.append(E,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(I.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:r,startOffset:i,endOffset:s}=t;r?this.append(this.getFlushOp(r,i,s),r):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,i,s),o)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],o=i?i.elementaryStreams:r.elementaryStreams;o[He.AUDIOVIDEO]?s.push("audiovideo"):(o[He.AUDIO]&&s.push("audio"),o[He.VIDEO]&&s.push("video"));const a=()=>{const u=self.performance.now();r.stats.buffering.end=u,i&&(i.stats.buffering.end=u);const l=i?i.stats:r.stats;this.hls.trigger(I.FRAG_BUFFERED,{frag:r,part:i,stats:l,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,s)}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,r;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((r=this.tracks[e])==null?void 0:r.ending))})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const i=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})&&(i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(I.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(I.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===V.BUFFER_APPEND_ERROR&&t.frag){var r;const i=(r=t.errorAction)==null?void 0:r.nextAutoLevel;oe(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const i=e.config,s=r.currentTime,o=t.levelTargetDuration,a=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(oe(a)&&a>=0){const u=Math.max(a,o),l=Math.floor(s/o)*o-u;this.flushBackBuffer(s,o,l)}if(oe(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const u=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),l=Math.max(u,o),c=Math.floor(s/o)*o+l;this.flushFrontBuffer(s,o,c)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=Ce.getBuffered(s);if(a.length>0&&r>a.start(0)){var o;this.hls.trigger(I.BACK_BUFFER_REACHED,{bufferEnd:r});const u=this.tracks[i];if((o=this.details)!=null&&o.live)this.hls.trigger(I.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(u!=null&&u.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:i})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=Ce.getBuffered(s),a=o.length;if(a<2)return;const u=o.start(a-1),l=o.end(a-1);if(r>u||e>=u&&e<=l)return;this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&r.setLiveSeekableRange){const l=Math.max(0,t.fragmentStart),c=Math.max(l,i);return{duration:1/0,start:l,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return oe(s)?{duration:s}:null;const o=this.media.duration,a=oe(r.duration)?r.duration:0;return i>a&&i>o||!oe(o)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:r}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(oe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${r}.`),i.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${st(r)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const i=this.tracks[t];e[t]={buffer:r,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(I.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const o=s,a=e[o];if(this.isPending(a)){const u=this.getTrackCodec(a,o),l=`${a.container};codecs=${u}`;a.codec=u,this.log(`creating sourceBuffer(${l})${this.currentOp(o)?" Queued":""} ${st(a)}`);try{const c=r.addSourceBuffer(l),d=dh(o),f=[o,c];t[d]=f,a.buffer=c}catch(c){var i;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(o),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[o],this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:o,mimeType:l,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let i=e.codec;r&&(t==="video"||t==="audiovideo")&&Qp(r,"video")&&(i=$L(i,r));const s=sc(i,e.levelCodec);return s?t.slice(0,5)==="audio"?zc(s,this.appendSource):s:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(I.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}removeExecutor(e,t,r){const{media:i,mediaSource:s}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!i||!s||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const u=oe(i.duration)?i.duration:1/0,l=oe(s.duration)?s.duration:1/0,c=Math.max(0,t),d=Math.min(r,u,l);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),a.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],i=r==null?void 0:r.buffer;if(!i)throw new jP(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){this.isUpdating()||this.isQueued()?this.blockBuffers(e):e()}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:r}=this,i=t.map(o=>this.appendBlocker(o));t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(o=>{r===this.operationQueue&&(e(),this.stepOperationQueue(t))})}stepOperationQueue(e){e.forEach(t=>{var r;const i=(r=this.tracks[t])==null?void 0:r.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const o=r.bind(this,e);i.listeners.push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(i=>{r.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function Lx(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function qP(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function dh(n){return n==="audio"?1:0}class iv{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.BUFFER_CODECS,this.onBufferCodecs,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(I.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&oe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,iv.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const i=(a,u)=>u?a.width!==u.width||a.height!==u.height:!0;let s=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const u=e[a];if((u.width>=o||u.height>=o)&&i(u,e[a+1])){s=a;break}}return s}}const YP={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},fn=YP,XP={HLS:"h"},QP=XP,JP="CMCD-Object",ZP="CMCD-Request",eO="CMCD-Session",tO="CMCD-Status",Oa={OBJECT:JP,REQUEST:ZP,SESSION:eO,STATUS:tO},nO={[Oa.OBJECT]:["br","d","ot","tb"],[Oa.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Oa.SESSION]:["cid","pr","sf","sid","st","v"],[Oa.STATUS]:["bs","rtp"]};class Qo{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Qo?r:new Qo(r))),this.value=e,this.params=t}}const rO="Dict";function iO(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function sO(n,e,t,r){return new Error(`failed to ${n} "${iO(e)}" as ${t}`,{cause:r})}function Wr(n,e,t){return sO("serialize",n,e,t)}class nT{constructor(e){this.description=e}}const Dx="Bare Item",oO="Boolean";function aO(n){if(typeof n!="boolean")throw Wr(n,oO);return n?"?1":"?0"}const uO="Byte Sequence";function lO(n){if(ArrayBuffer.isView(n)===!1)throw Wr(n,uO);return`:${iP(n)}:`}const cO="Integer";function dO(n){return n<-999999999999999||999999999999999<n}function rT(n){if(dO(n))throw Wr(n,cO);return n.toString()}function fO(n){return`@${rT(n.getTime()/1e3)}`}const hO="Decimal";function pO(n){const e=$w(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Wr(n,hO);const t=e.toString();return t.includes(".")?t:`${t}.0`}const gO="String",mO=/[\x00-\x1f\x7f]+/;function vO(n){if(mO.test(n))throw Wr(n,gO);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function yO(n){return n.description||n.toString().slice(7,-1)}const xO="Token";function Px(n){const e=yO(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Wr(e,xO);return e}function og(n){switch(typeof n){case"number":if(!oe(n))throw Wr(n,Dx);return Number.isInteger(n)?rT(n):pO(n);case"string":return vO(n);case"symbol":return Px(n);case"boolean":return aO(n);case"object":if(n instanceof Date)return fO(n);if(n instanceof Uint8Array)return lO(n);if(n instanceof nT)return Px(n);default:throw Wr(n,Dx)}}const EO="Key";function ag(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Wr(n,EO);return n}function sv(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${ag(e)}`:`;${ag(e)}=${og(t)}`).join("")}function iT(n){return n instanceof Qo?`${og(n.value)}${sv(n.params)}`:og(n)}function bO(n){return`(${n.value.map(iT).join(" ")})${sv(n.params)}`}function SO(n,e={whitespace:!0}){if(typeof n!="object")throw Wr(n,rO);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof Qo||(s=new Qo(s));let o=ag(i);return s.value===!0?o+=sv(s.params):(o+="=",Array.isArray(s.value)?o+=bO(s):o+=iT(s)),o}).join(`,${r}`)}function wO(n,e){return SO(n,e)}function TO(n){return n==="ot"||n==="sf"||n==="st"}function _O(n){return typeof n=="number"?oe(n):n!=null&&n!==""&&n!==!1}const lc=n=>Math.round(n),IO=(n,e)=>(e!=null&&e.baseUrl&&(n=sP(n,e.baseUrl)),encodeURIComponent(n)),Tl=n=>lc(n/100)*100,RO={br:lc,d:lc,bl:Tl,dl:Tl,mtp:Tl,nor:IO,rtp:Tl,tb:lc};function CO(n,e){const t={};if(n==null||typeof n!="object")return t;const r=Object.keys(n).sort(),i=Ke({},RO,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return r.forEach(o=>{if(s!=null&&s(o))return;let a=n[o];const u=i[o];u&&(a=u(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||_O(a)&&(TO(o)&&typeof a=="string"&&(a=new nT(a)),t[o]=a))}),t}function sT(n,e={}){return n?wO(CO(n,e),Ke({whitespace:!1},e)):""}function AO(n,e={}){const t={};if(!n)return t;const r=Object.entries(n),i=Object.entries(nO).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=r.reduce((o,a)=>{var u,l;const[c,d]=a,f=((u=i.find(h=>h[1].includes(c)))===null||u===void 0?void 0:u[0])||Oa.REQUEST;return(l=o[f])!==null&&l!==void 0||(o[f]={}),o[f][c]=d,o},{});return Object.entries(s).reduce((o,[a,u])=>(o[a]=sT(u,e),o),t)}function kO(n,e,t){return Ke(n,AO(e,t))}const LO="CMCD";function DO(n,e={}){if(!n)return"";const t=sT(n,e);return`${LO}=${encodeURIComponent(t)}`}const Ox=/CMCD=[^&#]+/;function PO(n,e,t){const r=DO(e,t);if(!r)return n;if(Ox.test(n))return n.replace(Ox,r);const i=n.includes("?")?"&":"?";return`${n}${i}${r}`}class OO{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:fn.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:o}=i,a=this.hls.levels[s.level],u=this.getObjectType(s),l={d:(o||s).duration*1e3,ot:u};(u===fn.VIDEO||u===fn.AUDIO||u==fn.MUXED)&&(l.br=a.bitrate/1e3,l.tb=this.getTopBandwidth(u)/1e3,l.bl=this.getBufferLength(u));const c=o?this.getNextPart(o):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(l.nor=c.url),this.apply(i,l)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHED,this.onMediaDetached,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHED,this.onMediaDetached,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:QP.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ke(t,this.createData());const r=t.ot===fn.INIT||t.ot===fn.VIDEO||t.ot===fn.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((o,a)=>(i.includes(a)&&(o[a]=t[a]),o),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),kO(e.headers,t,s)):e.url=PO(e.url,t,s)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const i=e.sn-r.startSN;return r.fragments[i+1]}}getNextPart(e){var t,r;const{index:i,fragment:s}=e,o=(t=this.hls.levels[s.level])==null||(r=t.details)==null?void 0:r.partList;if(o){const{sn:a}=s;for(let u=o.length-1;u>=0;u--){const l=o[u];if(l.index===i&&l.fragment.sn===a)return o[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return fn.TIMED_TEXT;if(e.sn==="initSegment")return fn.INIT;if(t==="audio")return fn.AUDIO;if(t==="main")return this.hls.audioTracks.length?fn.VIDEO:fn.MUXED}getTopBandwidth(e){let t=0,r;const i=this.hls;if(e===fn.AUDIO)r=i.audioTracks;else{const s=i.maxAutoLevel,o=s>-1?s+1:i.levels.length;r=i.levels.slice(0,o)}for(const s of r)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===fn.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Ce.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const NO=3e5;class FO extends vi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===Xt.SendAlternateToPenaltyBox&&r.flags===ar.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:u,type:l}=t.context;a&&i?o=this.getPathwayForGroupId(a,l,o):u&&(o=u)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==o),r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${i&&i.length} priorities: ${st(s)} penalized: ${st(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>NO&&delete r[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,u=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,kw(t),this.hls.trigger(I.LEVELS_UPDATED,{levels:t});const l=this.hls.levels[a];u&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${l.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===Ae.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===Ae.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":u}=s;if(t.some(c=>c.pathwayId===o))return;const l=this.getLevelsForPathway(a).map(c=>{const d=new at(c.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),h&&(i[d.SUBTITLES]=h,d.SUBTITLES=h);const p=oT(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),g=new vu({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:p,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let m=1;m<c.audioGroups.length;m++)g.addGroupId("audio",`${c.audioGroups[m]}_clone_${o}`);if(c.subtitleGroups)for(let m=1;m<c.subtitleGroups.length;m++)g.addGroupId("text",`${c.subtitleGroups[m]}_clone_${o}`);return g});t.push(...l),Nx(this.audioTracks,r,u,o),Nx(this.subtitleTracks,i,u,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},u={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${i}"`);const p=c.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":v}=p;if(g)try{this.uri=new self.URL(g,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||f.url),m&&this.clonePathways(m);const y={steeringManifest:p,url:i.toString()};this.hls.trigger(I.STEERING_MANIFEST_LOADED,y),v&&this.updatePathwayPriority(v)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let p=this.timeToLoad*1e3;if(c.code===429){const g=this.loader;if(typeof(g==null?void 0:g.getResponseHeader)=="function"){const m=g.getResponseHeader("Retry-After");m&&(p=parseFloat(m)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,p)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,u,l)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const i=(r=this.hls)==null?void 0:r.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Nx(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(o=>o.groupId===i).map(o=>{const a=Ke({},o);return a.details=void 0,a.attrs=new at(a.attrs),a.url=a.attrs.URI=oT(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[i],a.attrs["PATHWAY-ID"]=r,a});n.push(...s)})}function oT(n,e,t,r){const{HOST:i,PARAMS:s,[t]:o}=r;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const u=new self.URL(n);return i&&!a&&(u.host=i),s&&Object.keys(s).sort().forEach(l=>{l&&u.searchParams.set(l,s[l])}),u.href}class Lo extends vi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Lo.CDMCleanupPromise?[Lo.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:r,initData:i}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=El(this.config));const a=o.map(rh).filter(u=>!!u);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=th(o);let u,l;if(r==="sinf"){if(a!==We.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const p=wt(new Uint8Array(i));try{const g=qm(JSON.parse(p).sinf),m=lw(g);if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");u=new Uint8Array(m.subarray(8,24)),l=We.FAIRPLAY}catch(g){this.warn(`${s} Failed to parse sinf: ${g}`);return}}else{if(a!==We.WIDEVINE&&a!==We.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const p=FL(i),g=p.filter(v=>!!v.systemId&&nh(v.systemId)===a);g.length>1&&this.warn(`${s} Using first of ${g.length} pssh found for selected key-system ${a}`);const m=g[0];if(!m){p.length===0||p.some(v=>!v.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${p.map(v=>nh(v.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(l=nh(m.systemId),m.version===0&&m.data)if(l===We.WIDEVINE){const v=m.data.length-22;u=new Uint8Array(m.data.subarray(v,v+16))}else l===We.PLAYREADY&&(u=Tw(m.data))}if(!l||!u)return;const c=Rr.hexDump(u),{keyIdToKeySessionPromise:d,mediaKeySessions:f}=this;let h=d[c];for(let p=0;p<f.length;p++){const g=f[p],m=g.decryptdata;if(!m.keyId)continue;const v=Rr.hexDump(m.keyId);if(c===v||m.uri.replace(/-/g,"").indexOf(c)!==-1){if(h=d[v],m.pssh)break;delete d[v],m.pssh=new Uint8Array(i),m.keyId=u,h=d[c]=h.then(()=>this.generateRequestWithPreferredKeySession(g,r,i,"encrypted-event-key-match")),h.catch(y=>this.handleError(y));break}}if(!h){if(l!==a){this.log(`Ignoring "${t.type}" event with ${l} init data for selected key-system ${a}`);return}h=d[c]=this.getKeySystemSelectionPromise([l]).then(({keySystem:p,mediaKeys:g})=>{var m;this.throwIfDestroyed();const v=new xu("ISO-23001-7",c,(m=rh(p))!=null?m:"");return v.pssh=new Uint8Array(i),v.keyId=u,this.attemptSetMediaKeys(p,g).then(()=>{this.throwIfDestroyed();const y=this.createMediaKeySessionContext({decryptdata:v,keySystem:p,mediaKeys:g});return this.generateRequestWithPreferredKeySession(y,r,i,"encrypted-event-no-match")})}),h.catch(p=>this.handleError(p))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(I.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(I.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(I.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===We.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,u)=>!!o&&u.indexOf(o)===a,i=t.map(o=>o.audioCodec).filter(r),s=t.map(o=>o.videoCodec).filter(r);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const u=l=>{const c=l.shift();this.getMediaKeysPromise(c,i,s).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{l.length?u(l):d instanceof Hn?a(d):a(new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};u(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${r}`;return ww===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return r(e,t)}getMediaKeysPromise(e,t,r){const i=RD(e,t,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let o=s==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${st(i)}`),o=this.requestMediaKeySystemAccess(e,i);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),o.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const l=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=u.createMediaKeys().then(c=>(this.log(`Media-keys created for "${e}"`),l.then(d=>d?this.setMediaKeysServerCertificate(c,e,d):c))),a.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${e}"}: ${c}`)}),a.mediaKeys})}return o.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Rr.hexDump(e.keyId||[])}`);const i=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Rr.hexDump(e.keyId)}updateKeySession(e,t){var r;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Rr.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,r)=>{const i=El(this.config),s=e.map(th).filter(o=>!!o&&i.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:o})=>{const a=rh(o);a?t(a):r(new Error(`Unable to find format for key-system "${o}"`))}).catch(r)})}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[r];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(a,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:a,mediaKeys:u,decryptdata:t}))))),(this.keyIdToKeySessionPromise[r]=s.then(a=>{const u="cenc",l=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(a,u,l,"playlist-key")})).catch(a=>this.handleError(a))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Hn?this.hls.trigger(I.ERROR,e.data):this.hls.trigger(I.ERROR,{type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const i=th(e.keyFormat),s=i?[i]:El(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=El(this.config)),e.length===0)throw new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${st({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,i){var s,o;const a=(s=this.config.drmSystems)==null||(o=s[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const p=a.call(this.hls,t,r,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,r=p.initData?p.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(p){var u;if(this.warn(p.message),(u=this.hls)!=null&&u.config.debug)throw p}if(r===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new Xm,d=e._onmessage=p=>{const g=e.mediaKeysSession;if(!g){c.emit("error",new Error("invalid state"));return}const{messageType:m,message:v}=p;this.log(`"${m}" message event for session "${g.sessionId}" message size: ${v.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,v).catch(y=>{c.eventNames().length?c.emit("error",y):this.handleError(y)}):m==="license-release"?e.keySystem===We.FAIRPLAY&&(this.updateKeySession(e,eg("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${m}"`)},f=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const m=e.keyStatus;c.emit("keyStatus",m),m==="expired"&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",f);const h=new Promise((p,g)=>{c.on("error",g),c.on("keyStatus",m=>{m.startsWith("usable")?p():m==="output-restricted"?g(new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?g(new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?g(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var p;this.log(`Request generated for key-session "${(p=e.mediaKeysSession)==null?void 0:p.sessionId}" keyId: ${l}`)}).catch(p=>{throw new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_NO_SESSION,error:p,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>h).catch(p=>{throw c.removeAllListeners(),this.removeSession(e),p}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Rr.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Rr.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,i=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const u={responseType:"arraybuffer",url:s},l=t.certLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,g)=>{o(f.data)},onError:(f,h,p,g)=>{a(new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:Ge({url:u.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,p)=>{a(new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:u.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,h,p)=>{a(new Error("aborted"))}};i.load(u,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,s)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),i(e)}).catch(o=>{s(new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(i=>{throw new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(r,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,f=s.length;d<f;d++){var o,a;c=s[d];const h=(o=c.querySelector("name"))==null?void 0:o.textContent,p=(a=c.querySelector("value"))==null?void 0:a.textContent;h&&p&&e.setRequestHeader(h,p)}}const u=i.querySelector("Challenge"),l=u==null?void 0:u.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return eg(atob(l))}setupLicenseXHR(e,t,r,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,i)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,r,i)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let u=a.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const l=this.config.licenseResponseCallback;if(l)try{u=l.call(this.hls,a,o,e)}catch(c){this.error(c)}i(u)}else{const u=r.errorRetry,l=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)s(new Hn({type:pe.KEY_SYSTEM_ERROR,details:V.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:u,licenseChallenge:l})=>{e.keySystem==We.PLAYREADY&&(l=this.unpackPlayReadyKeyMessage(u,l)),u.send(l)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const r=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},xu.clearKeyUriToKeyIdMap();const i=r.length;Lo.CDMCleanupPromise=Promise.all(r.map(s=>this.removeSession(s)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(s=>{var o;this.log(`Could not clear media keys: ${s}`),(o=this.hls)==null||o.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(s=>{var o;this.log(`Could not close sessions and clear media keys: ${s}`),(o=this.hls)==null||o.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch(s=>{var o;this.log(`Could not remove session: ${s}`),(o=this.hls)==null||o.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${s}`)})}).then(()=>t.close()).catch(s=>{var o;this.log(`Could not close session: ${s}`),(o=this.hls)==null||o.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${s}`)})})}}}Lo.CDMCleanupPromise=void 0;class Hn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class MO{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(I.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(I.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,u=1e3*o/s,l=this.hls;if(l.trigger(I.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),u>0&&o>l.config.fpsDroppedMonitoringThreshold*a){let c=l.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=c)&&(c=c-1,l.trigger(I.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function aT(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function uT(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Fe.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){Fe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function wo(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function ug(n,e,t,r){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=UO(n.cues,e,t);for(let o=0;o<s.length;o++)(!r||r(s[o]))&&n.removeCue(s[o])}i==="disabled"&&(n.mode=i)}function BO(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t,s;for(;r<=i;)if(s=Math.floor((i+r)/2),e<n[s].startTime)i=s-1;else if(e>n[s].startTime&&r<t)r=s+1;else return s;return n[r].startTime-e<e-n[i].startTime?r:i}function UO(n,e,t){const r=[],i=BO(n,e);if(i>-1)for(let s=i,o=n.length;s<o;s++){const a=n[s];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function cc(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class $O extends rv{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=cc(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;cc(r.textTracks).forEach(o=>{wo(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const c=Pr(a,o);if(c>-1)s=o[c];else{const d=Pr(a,this.tracks);s=this.tracks[d]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const l={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(I.SUBTITLE_TRACKS_UPDATED,l),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(r&&!s.default||!r&&!e)&&(!e||As(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(wu(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(wu(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(sg(i,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ae.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&As(e,r))return r;const i=Pr(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(r)return null;{const s=Pr(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(I.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=cc(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter(s=>sg(r,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!oe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:o,groupId:a="",name:u,type:l,url:c}=i;this.hls.trigger(I.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:u,type:l,url:c});const d=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(d)}}function ja(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Do=.025;let Zc=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function GO(n,e,t){return`${n.identifier}-${t+1}-${ja(e)}`}class WO{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;return e<=0||isNaN(t)?!1:this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return fh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=fh(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=oe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return fh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Do))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Zc.Range:Zc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return VO(this)}}function fh(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Do)?e.start:e.start+e.duration}function lT(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function VO(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function lg(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class HO{constructor(e,t,r,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const l=this.interstitial.playoutLimit,c=this.currentTime;this.startOffset+c>=l&&this.hls.trigger(I.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=r,this.assetItem=i;let o=i.uri;try{o=lT(o,s.sessionId).href}catch{}s.loadSource(o);const a=()=>{this.hasDetails=!0};s.once(I.LEVEL_LOADED,a),s.once(I.AUDIO_TRACK_LOADED,a),s.once(I.SUBTITLE_TRACK_LOADED,a),s.on(I.MEDIA_ATTACHING,(u,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&l.addEventListener("timeupdate",this.checkPlayout)})}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const r=this.timelineOffset,i=Ce.bufferInfo(e,r,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ce.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,r){this.hls.on(e,t)}once(e,t,r){this.hls.once(e,t)}off(e,t,r){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${lg(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${(t=this.interstitial)!=null&&t.appendInPlace?"append-in-place":""}`}}const Fx=.033;class zO extends vi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(s=i[r])!=null&&s.event;){var s;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let i=0;i<r.length;i++){let s=r[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let i=e;i<=t&&r[i];i++){const s=r[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var r;if(((r=t[i].event)==null?void 0:r.identifier)===e)return i}return-1}findAssetIndex(e,t){const r=e.assetList,i=r.length;if(i>1)for(let s=0;s<i;s++){const o=r[s];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&t<a+(o.duration||0))return s}}return 0}get assetIdAtEnd(){var e,t;const r=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(r){const i=r.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:i}=r,s=this.events,o=this.parseDateRanges(i,{url:r.url},t),a=Object.keys(i),u=s?s.filter(l=>!a.includes(l.identifier)):[];o.length&&o.sort((l,c)=>{const d=l.cue.pre,f=l.cue.post,h=c.cue.pre,p=c.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!p)return 1;if(p&&!f)return-1;if(!d&&!h&&!f&&!p){const g=l.startTime,m=c.startTime;if(g!==m)return g-m}return l.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=o,u.forEach(l=>{this.removeEvent(l)}),this.updateSchedule(e,u)}updateSchedule(e,t=[]){const r=this.events||[];if(r.length||t.length||this.length<2){const i=this.items,s=this.parseSchedule(r,e);(t.length||(i==null?void 0:i.length)!==s.length||s.some((a,u)=>Math.abs(a.playout.start-i[u].playout.start)>.005||Math.abs(a.playout.end-i[u].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const i=[],s=Object.keys(e);for(let o=0;o<s.length;o++){const a=s[o],u=e[a];if(u.isInterstitial){let l=this.eventMap[a];l?l.setDateRange(u):(l=new WO(u,t),this.eventMap[a]=l,r===!1&&(l.appendInPlace=r)),i.push(l)}}return i}parseSchedule(e,t){const r=[],i=t.main.details,s=i.live?1/0:i.edge;let o=0;if(e=e.filter(u=>!u.error&&!(u.cue.once&&u.hasPlayed)),e.length){this.resolveOffsets(e,t);let u=0,l=0;if(e.forEach((c,d)=>{const f=c.cue.pre,h=c.cue.post,p=e[d-1]||null,g=c.appendInPlace,m=h?s:c.startOffset,v=c.duration,y=c.timelineOccupancy===Zc.Range?v:0,x=c.resumptionOffset,E=(p==null?void 0:p.startTime)===m,b=m+c.cumulativeDuration;let S=g?b+v:m+x;if(f||!h&&m<=0){const T=l;l+=y,c.timelineStart=b;const R=o;o+=v,r.push({event:c,start:b,end:S,playout:{start:R,end:o},integrated:{start:T,end:l}})}else if(m<=s){if(!E){const _=m-u;if(_>Fx){const A=u,k=l;l+=_;const G=o;o+=_;const U={previousEvent:e[d-1]||null,nextEvent:c,start:A,end:A+_,playout:{start:G,end:o},integrated:{start:k,end:l}};r.push(U)}else _>0&&p&&(p.cumulativeDuration+=_,r[r.length-1].end=m)}h&&(S=b),c.timelineStart=b;const T=l;l+=y;const R=o;o+=v,r.push({event:c,start:b,end:S,playout:{start:R,end:o},integrated:{start:T,end:l}})}else return;const w=c.resumeTime;h||w>s?u=s:u=w}),u<s){var a;const c=u,d=l,f=s-u;l+=f;const h=o;o+=f,r.push({previousEvent:((a=r[r.length-1])==null?void 0:a.event)||null,nextEvent:null,start:u,end:c+f,playout:{start:h,end:o},integrated:{start:d,end:l}})}this.setDurations(s,o,l)}else r.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,i=r.live?1/0:r.edge;let s=0,o=-1;e.forEach((a,u)=>{const l=a.cue.pre,c=a.cue.post,d=l?0:c?i:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=s:(s=0,o=d),!c&&a.snapOptions.in&&(a.resumeAnchor=Bs(null,r.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&u+1<e.length&&e[u+1].startTime-e[u].resumeTime<Fx&&(e[u+1].appendInPlace=!1,e[u+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const h=oe(a.resumeOffset)?a.resumeOffset:a.duration;s+=h})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(r-i)>Do?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${i}`),!1):t?!Object.keys(t).some(o=>{const a=t[o].details,u=a.edge;if(r>=u)return this.log(`"${e.identifier}" resumption ${r} past ${o} playlist end ${u}`),!1;const l=Bs(null,a.fragments,r);if(!l)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const c=o==="audio"?.175:0;return Math.abs(l.start-r)<Do+c||Math.abs(l.end-r)<Do+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${o} fragment bounds (${l.start}-${l.end} sn: ${l.sn} cc: ${l.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${r} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,i=!1,s=!1;e.assetList.forEach((o,a)=>{const u=t+r;o.startOffset=r,o.timelineStart=u,i||(i=o.duration===null),s||(s=!!o.error);const l=o.error?0:o.duration||0;r+=l}),i&&!s?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ii(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class jO{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let i;try{i=lT(r,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,V.ASSET_LIST_LOAD_ERROR,f,r);this.hls.trigger(I.ERROR,h);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,o=s.loader,a=new o(s),u={responseType:"json",url:i.href},l=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,g)=>{const m=f.data,v=m==null?void 0:m.ASSETS;if(!Array.isArray(v)){const y=this.assignAssetListError(e,V.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,h,g);this.hls.trigger(I.ERROR,y);return}e.assetListResponse=m,this.hls.trigger(I.ASSET_LIST_LOADED,{event:e,assetListResponse:m,networkDetails:g})},onError:(f,h,p,g)=>{const m=this.assignAssetListError(e,V.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,g,p);this.hls.trigger(I.ERROR,m)},onTimeout:(f,h,p)=>{const g=this.assignAssetListError(e,V.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,p);this.hls.trigger(I.ERROR,g)}};return a.load(u,c,d),this.hls.trigger(I.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,r,i,s,o){return e.error=r,{type:pe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:r,networkDetails:o,stats:s}}}function ai(n,e,t){Nr(n,e,t),n.addEventListener(e,t)}function Nr(n,e,t){n.removeEventListener(e,t)}function Mx(n){n==null||n.play().catch(()=>{})}class KO extends vi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;const i=r-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const o=i<=-.01;this.timelinePos=r,this.bufferedPos=r;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(r,r-i)&&this.updateSchedule(),this.checkBuffer(),o&&r<a.start||r>=a.end){var u;const f=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(a)&&(u=this.media)!=null&&u.paused&&(this.shouldPlay=!1),!o){const h=this.findItemIndex(a);if(f>h){const p=this.schedule.findJumpRestrictedIndex(h+1,f);if(p>h){this.setSchedulePosition(p);return}}}this.setSchedulePosition(f);return}const l=this.playingAsset;if(!l){if(this.playingLastItem&&this.isInterstitial(a)){const f=a.event.assetList[0];f&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,f))}return}const c=l.timelineStart,d=l.duration||0;(o&&r<c||r>=c+d)&&this.setScheduleToAssetAtTime(r,l)},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(r>=i.end){this.timelinePos=i.end;const a=this.findItemIndex(i);this.setSchedulePosition(a+1)}const s=this.playingAsset;if(!s)return;const o=s.timelineStart+(s.duration||0);r>=o&&this.setScheduleToAssetAtTime(r,s)},this.onScheduleUpdate=(r,i)=>{const s=this.schedule,o=this.playingItem,a=s.events||[],u=s.items||[],l=s.durations,c=r.map(h=>h.identifier),d=!!(a.length||c.length);if(d&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${u.map(h=>Ii(h))}`),c.length&&this.log(`Removed events ${c}`),this.playerQueue.forEach(h=>{if(h.interstitial.appendInPlace){const p=h.assetItem.timelineStart,g=h.timelineOffset-p;if(g)try{h.timelineOffset=p}catch(m){Math.abs(g)>Do&&this.warn(`${m} ("${h.assetId}" ${h.timelineOffset}->${p})`)}}}),o){const h=this.updateItem(o,this.timelinePos);this.itemsMatch(o,h)&&(this.playingItem=h,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const f=this.bufferingItem;if(f){const h=this.updateItem(f,this.bufferedPos);this.itemsMatch(f,h)?this.bufferingItem=h:f.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(f.event,null))}if(r.forEach(h=>{h.assetList.forEach(p=>{this.clearAssetPlayer(p.identifier,null)})}),d||i){if(this.hls.trigger(I.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:u.slice(0),durations:l,removedIds:c}),this.isInterstitial(o)&&c.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new jO(e),this.schedule=new zO(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(I.MEDIA_ENDED,this.onMediaEnded,this),e.on(I.ERROR,this.onError,this),e.on(I.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(I.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(I.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(I.BUFFER_CODECS,this.onBufferCodecs,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(I.MEDIA_ENDED,this.onMediaEnded,this),e.off(I.ERROR,this.onError,this),e.off(I.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Nr(e,"play",this.onPlay),Nr(e,"pause",this.onPause),Nr(e,"seeking",this.onSeeking),Nr(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;ai(r,"seeking",this.onSeeking),ai(r,"timeupdate",this.onTimeupdate),ai(r,"play",this.onPlay),ai(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(r);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(this.media=null,!r&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),i=(d,f,h,p,g)=>{if(d){let m=d[f].start;const v=d.event;if(v){if(f==="playout"||v.timelineOccupancy!==Zc.Point){const y=r(h);(y==null?void 0:y.interstitial)===v&&(m+=y.assetItem.startOffset+y[g])}}else{const y=p==="bufferedPos"?o():e[p];m+=y-d.start}return m}return 0},s=(d,f)=>{if(d!==0&&f!=="primary"&&e.schedule.length){var h;const p=e.schedule.findItemIndexAtTime(d),g=(h=e.schedule.items)==null?void 0:h[p];if(g){const m=g[f].start-g.start;return d+m}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var f;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:e.schedule.durations[d]},u=(d,f)=>{var h,p;const g=e.effectivePlayingItem;if(g!=null&&(h=g.event)!=null&&h.restrictions.skip)return;e.log(`seek to ${d} "${f}"`);const m=e.effectivePlayingItem,v=e.schedule.findItemIndexAtTime(d,f),y=(p=e.schedule.items)==null?void 0:p[v],x=e.getBufferingPlayer(),E=x==null?void 0:x.interstitial,b=E==null?void 0:E.appendInPlace,S=m&&e.itemsMatch(m,y);if(m&&(b||S)){const T=r(e.playingAsset),R=(T==null?void 0:T.media)||e.primaryMedia;if(R){const _=f==="primary"?R.currentTime:i(m,f,e.playingAsset,"timelinePos","currentTime"),A=d-_,k=(b?_:R.currentTime)+A;if(k>=0&&(!T||b||k<=T.duration)){R.currentTime=k;return}}}if(y){let T=d;if(f!=="primary"){const _=y[f].start,A=d-_;T=y.start+A}const R=!e.isInterstitial(y);if((!e.isInterstitial(m)||m.event.appendInPlace)&&(R||y.event.appendInPlace)){const _=e.media||(b?x==null?void 0:x.media:null);_&&(_.currentTime=T)}else if(m){const _=e.findItemIndex(m);if(v>_){const k=e.schedule.findJumpRestrictedIndex(_+1,v);if(k>_){e.setSchedulePosition(k);return}}let A=0;if(R)e.timelinePos=T,e.checkBuffer();else{var w;const k=y==null||(w=y.event)==null?void 0:w.assetList;if(k){const G=d-(y[f]||y).start;for(let U=k.length;U--;){const M=k[U];if(M.duration&&G>=M.startOffset&&G<M.startOffset+M.duration){A=U;break}}}}e.setSchedulePosition(v,A)}}},l=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},c={get currentTime(){const d=l(),f=e.effectivePlayingItem;return f&&f===d?i(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=l(),h=e.effectivePlayingItem;h&&h===f&&u(d+h.playout.start,"playout")},get duration(){const d=l();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=l())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=l())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return l()}};this.manager={get events(){var d,f;return((d=e.schedule)==null||(f=d.events)==null?void 0:f.slice(0))||[]},get schedule(){var d,f;return((d=e.schedule)==null||(f=d.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return l()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){u(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){u(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const p=d.playout.start+d.event.duration;u(p+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,r;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const o=(r=s)==null?void 0:r.currentTime;if(!(o===void 0||!oe(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,i=e.media;if(r&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${st(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var r,i;if(e.media===t)return;let s=null;const o=this.hls,a=e!==o,u=a&&e.interstitial.appendInPlace,l=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(o.media)u&&(s=o.transferMedia(),this.detachedData=s),c="Primary";else if(l){const h=this.getBufferingPlayer();h?(s=h.transferMedia(),c=`${h}`):c="detached MediaSource"}else c="detached media";if(!s){if(l)s=this.detachedData,this.log(`using detachedData: MediaSource ${st(s)}`);else if(!this.detachedData||o.media===t){const h=this.playerQueue;h.length>1&&h.forEach(p=>{if(a&&p.interstitial.appendInPlace!==u){const g=p.interstitial;this.clearInterstitial(p.interstitial,null),g.appendInPlace=!1,g.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${g}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",f=d&&s?s:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c}`),f===s){const h=a&&e.assetId===this.schedule.assetIdAtEnd;f.overrides={duration:this.schedule.duration,endOfStream:!a||h,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,i=this.effectivePlayingItem;if(r===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(s>=0||!this.primaryLive){const o=this.timelinePos=s>0?s:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAfterAssetEnded(e,t,r){const i=r+1;if(!e.isAssetPastPlayoutLimit(i)&&!e.assetList[i].error)this.setSchedulePosition(t,i);else{const s=this.schedule.items;if(s){const o=t+1,a=s.length;if(o>=a){this.setSchedulePosition(-1);return}const u=e.resumeTime;this.timelinePos<u&&(this.timelinePos=u,this.checkBuffer()),this.setSchedulePosition(o)}}}setScheduleToAssetAtTime(e,t){const r=this.schedule,i=t.parentIdentifier,s=r.getEvent(i);if(s){const o=r.findEventIndex(i),a=r.findAssetIndex(s,e);this.setSchedulePosition(o,a)}}setSchedulePosition(e,t){const r=this.schedule.items;if(!r||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?r[e]:null,s=this.playingItem,o=this.playingLastItem;if(this.isInterstitial(s)){var a;const l=s.event,c=this.playingAsset,d=c==null?void 0:c.identifier,f=d?this.getAssetPlayer(d):null;if(f&&d&&(!this.eventItemsMatch(s,i)||t!==void 0&&d!==((a=l.assetList)==null?void 0:a[t].identifier))){var u;const h=l.findAssetIndex(c);this.log(`INTERSTITIAL_ASSET_ENDED ${h+1}/${l.assetList.length} ${lg(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(I.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:h,event:l,schedule:r.slice(0),scheduleIndex:e,player:f}),this.retreiveMediaSource(d,i),f.media&&!((u=this.detachedData)!=null&&u.mediaSource)&&f.detachMedia()}if(!this.eventItemsMatch(s,i)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${l} ${Ii(s)}`),l.hasPlayed=!0,this.hls.trigger(I.INTERSTITIAL_ENDED,{event:l,schedule:r.slice(0),scheduleIndex:e}),l.cue.once)){this.updateSchedule();const h=this.schedule.items;if(i&&h){const p=this.schedule.findItemIndex(i);this.advanceSchedule(p,h,t,s,o)}return}}this.advanceSchedule(e,r,t,s,o)}advanceSchedule(e,t,r,i,s){const o=e>=0?t[e]:null,a=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(l=>{const c=l.interstitial,d=this.schedule.findEventIndex(c.identifier);(d<e||d>e+1)&&this.clearInterstitial(c,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const l=o.event;r===void 0&&(r=this.schedule.findAssetIndex(l,this.timelinePos));const c=this.waitingItem;this.assetsBuffered(o,a)||this.setBufferingItem(o);let d=this.preloadAssets(l,r);if(this.eventItemsMatch(o,c||i)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Ii(o)} ${l.appendInPlace?"append in place":""}`),this.hls.trigger(I.INTERSTITIAL_STARTED,{event:l,schedule:t.slice(0),scheduleIndex:e})),!l.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${l}`);return}if(l.assetListLoader&&(l.assetListLoader.destroy(),l.assetListLoader=void 0),!a){this.log(`Waiting for attachMedia to start Interstitial ${l}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const f=l.assetList[r];if(!f){const h=t[e+1],p=this.media;h&&p&&!this.isInterstitial(h)&&p.currentTime<h.start&&(p.currentTime=this.timelinePos=h.start),this.advanceAfterAssetEnded(l,e,r||0);return}if(d||(d=this.getAssetPlayer(f.identifier)),d===null||d.destroyed){const h=l.assetList.length;this.warn(`asset ${r+1}/${h} player destroyed ${l}`),d=this.createAssetPlayer(l,f,r)}if(!this.eventItemsMatch(o,this.bufferingItem)&&l.appendInPlace&&this.isAssetBuffered(f))return;this.startAssetPlayer(d,r,t,e,a),this.shouldPlay&&Mx(d.media)}else o!==null?(this.resumePrimary(o,e,i),this.shouldPlay&&Mx(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ii(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!r)return;const s=this.schedule.items;s&&(this.log(`resumed ${Ii(e)}`),this.hls.trigger(I.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(r<i.fragmentStart||r>i.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ce.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),r&&this.startLoadingPrimaryAt(e,r)),r||(this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((r=i.mainForwardBufferInfo)==null?void 0:r.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(I.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(I.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const r=this.hls.levels[t.level],i=Ge(Ge({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Ge(Ge({},this.altSelection),{},{audio:r});return}const s=Ge(Ge({},i),{},{audio:r});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Ge(Ge({},this.altSelection),{},{subtitles:r});return}const s=Ge(Ge({},i),{},{subtitles:r});this.mediaSelection=s}onAudioTrackSwitching(e,t){const r=Xy(t);this.playerQueue.forEach(i=>i.hls.setAudioOption(t)||i.hls.setAudioOption(r))}onSubtitleTrackSwitch(e,t){const r=Xy(t);this.playerQueue.forEach(i=>i.hls.setSubtitleOption(t)||t.id!==-1&&i.hls.setSubtitleOption(r))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var r;const o=this.schedule.findEventIndex(s.identifier),a=(r=this.schedule.items)==null?void 0:r[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){const r=this.schedule.items;if(e&&r){const i=this.findItemIndex(e,t);return r[i]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const r=Ce.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,t,e)}updateBufferedPos(e,t,r){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let u=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var l,c;const d=this.findItemIndex(s),f=Math.min(d+1,t.length-1),h=t[f];if((u===-1&&s&&e>=s.end||(l=h.event)!=null&&l.appendInPlace&&e+.01>=h.start)&&(u=f),f-a>1&&(s==null||(c=s.event)==null?void 0:c.appendInPlace)===!1)return;if(this.bufferedPos=e,u>d&&u>a)this.bufferedToItem(h);else{const p=this.primaryDetails;this.primaryLive&&p&&e>p.edge-p.targetduration&&h.start<p.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else r&&o&&!this.itemsMatch(o,s)&&(u===a?this.bufferedToItem(o):u===a+1&&this.bufferedToItem(t[u]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:s}=r;if(!i||!s)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const u=a?a.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${Ii(e)}`+(t?` (${u.toFixed(2)} remaining)`:"")),o?e.event.assetList.forEach(l=>{const c=this.getAssetPlayer(l.identifier);c&&c.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(l=>l.pauseBuffering()))}this.hls.trigger(I.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,i=r.assetList.length===0&&!r.assetListLoader,s=r.cue.once;if(i||!s){const o=this.preloadAssets(r,t);if(o!=null&&o.interstitial.appendInPlace){const a=r.assetList[t],u=this.primaryMedia;a&&u&&this.bufferAssetPlayer(o,u)}}}preloadAssets(e,t){const r=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,o=e.cue.once;if(s){const u=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(u+.25)}let l,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-u;f>0&&(l=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:i} ${e}${l?` live-start: ${c} start-offset: ${l}`:""}`),r)return this.createAsset(e,0,0,u,e.duration,r);const d=this.assetListLoader.loadAssetList(e,l);d&&(e.assetListLoader=d)}else if(!o&&i){for(let u=t;u<i;u++){const l=e.assetList[u],c=this.getAssetPlayerQueueIndex(l.identifier);(c===-1||this.playerQueue[c].destroyed)&&!l.error&&this.createAssetPlayer(e,l,u)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(I.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,i,s,o){const a={parentIdentifier:e.identifier,identifier:GO(e,o,t),duration:s,startOffset:r,timelineStart:i,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,r){this.log(`create HLSAssetPlayer for ${lg(t)}`);const i=this.hls,s=i.userConfig;let o=s.videoPreference;const a=i.loadLevelObj||i.levels[i.currentLevel];(o||a)&&(o=Ke({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const u=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const x=this.timelinePos-t.timelineStart;if(x>1){const E=t.duration;E&&x<E&&(c=x)}}const d=t.identifier,f=Ge(Ge({},s),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:u||s.audioPreference,subtitlePreference:l||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=Ke({},h,{contentId:ja(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const p=new HO(this.HlsPlayerClass,f,e,t);this.playerQueue.push(p),e.assetList[r]=t;const g=x=>{if(x.live){const S=new Error(`Interstitials MUST be VOD assets ${e}`),w={fatal:!0,type:pe.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:S};this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),r,S.message);return}const E=x.edge-x.fragmentStart,b=t.duration;(b===null||E>b)&&(this.log(`Interstitial asset "${d}" duration change ${b} > ${E}`),t.duration=E,this.updateSchedule())};p.on(I.LEVEL_UPDATED,(x,{details:E})=>g(E)),p.on(I.LEVEL_PTS_UPDATED,(x,{details:E})=>g(E));const m=(x,E)=>{const b=this.getAssetPlayer(d);if(b&&E.tracks){b.off(I.BUFFER_CODECS,m),b.tracks=E.tracks;const S=this.primaryMedia;this.bufferingAsset===b.assetItem&&S&&!b.media&&this.bufferAssetPlayer(b,S)}};p.on(I.BUFFER_CODECS,m);const v=()=>{var x;const E=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${E}`),!E)return;const b=this.schedule.findEventIndex(e.identifier),S=e.findAssetIndex(t),w=S+1,T=(x=this.schedule.items)==null?void 0:x[b];if(this.isInterstitial(T))if(S!==-1&&!e.isAssetPastPlayoutLimit(w)&&!e.assetList[w].error)this.bufferedToItem(T,w);else{var R;const _=(R=this.schedule.items)==null?void 0:R[b+1];_&&this.bufferedToItem(_)}};p.on(I.BUFFERED_TO_END,v);const y=x=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const b=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,b,x)};return p.once(I.MEDIA_ENDED,y(r)),p.once(I.PLAYOUT_LIMIT_REACHED,y(1/0)),p.on(I.ERROR,(x,E)=>{const b=this.getAssetPlayer(d);if(E.details===V.BUFFER_STALLED_ERROR){if(b!=null&&b.media){const S=b.currentTime,w=b.duration-S;S&&e.appendInPlace&&w/b.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${b.media.currentTime}`),v()):(this.warn(`Stalled at ${S} of ${S+w} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(E,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${E.error} ${e}`)}),p.on(I.DESTROYING,()=>{if(!this.getAssetPlayer(d))return;const E=new Error(`Asset player destroyed unexpectedly ${d}`),b={fatal:!0,type:pe.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:E};this.handleAssetItemError(b,e,this.schedule.findEventIndex(e.identifier),r,E.message)}),this.hls.trigger(I.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:p}),p}clearInterstitial(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)}),e.reset()}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){this.log(`clearAssetPlayer "${e}" toSegment: ${t&&Ii(t)}`);const i=this.playerQueue[r];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(r,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,i,s){const{interstitial:o,assetItem:a,assetId:u}=e,l=o.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!c||c.identifier!==u)&&(c&&(this.clearAssetPlayer(c.identifier,r[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${e}`),this.hls.trigger(I.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:r.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var r,i;const{interstitial:s,assetItem:o,assetId:a}=e,u=this.schedule.findEventIndex(s.identifier),l=(r=this.schedule.items)==null?void 0:r[u];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const d=s.appendInPlace;if(d&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const f=(c==null?void 0:c.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(d&&o!==this.playingAsset){if(!e.tracks)return;if(f&&!nw(f,e.tracks)){const h=new Error(`Asset "${a}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(f)}')`),p={fatal:!0,type:pe.OTHER_ERROR,details:V.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=s.findAssetIndex(o);this.handleAssetItemError(p,s,u,g,h.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,r,i,s){if(e.details===V.BUFFER_STALLED_ERROR)return;const o=t.assetList[i]||null;let a=null;if(o){const d=this.getAssetPlayerQueueIndex(o.identifier);a=this.playerQueue[d]||null}const u=this.schedule.items,l=Ke({},e,{fatal:!1,errorAction:yu(!0),asset:o,assetListIndex:i,event:t,schedule:u,scheduleIndex:r,player:a});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(I.INTERSTITIAL_ASSET_ERROR,l),!e.fatal)return;const c=new Error(s);o&&(this.playingAsset!==o&&this.clearAssetPlayer(o.identifier,null),o.error=c),t.assetList.some(d=>!d.error)?t.appendInPlace&&(t.error=c):t.error=c,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(this.updateSchedule(),r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${r?Ii(r):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let i=this.timelinePos;i===-1&&(i=this.hls.startPosition);const s=this.updateItem(r,i);if(this.itemsMatch(r,s))this.clearInterstitial(e,null);else{const o=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(o)}}else this.checkStart()}onAssetListLoaded(e,t){var r;const i=t.event,s=i.identifier,o=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(s))return;const a=i.timelineStart,u=i.duration;let l=0;o.forEach((p,g)=>{const m=parseFloat(p.DURATION);this.createAsset(i,g,l,a+l,m,p.URI),l+=m}),i.duration=l,this.log(`Loaded asset-list with duration: ${l} (was: ${u}) ${i}`);const c=this.waitingItem,d=(c==null?void 0:c.event.identifier)===s;this.updateSchedule();const f=(r=this.bufferingItem)==null?void 0:r.event;if(d){var h;const p=this.schedule.findEventIndex(s),g=(h=this.schedule.items)==null?void 0:h[p];if(g){if(!this.playingItem&&this.timelinePos>g.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.primaryFallback(i);return}this.setBufferingItem(g)}this.setSchedulePosition(p)}else if((f==null?void 0:f.identifier)===s&&f.appendInPlace){const p=i.assetList[0],g=this.getAssetPlayer(p.identifier),m=this.primaryMedia;p&&g&&m&&this.bufferAssetPlayer(g,m)}}onError(e,t){switch(t.details){case V.ASSET_LIST_PARSING_ERROR:case V.ASSET_LIST_LOAD_ERROR:case V.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&this.primaryFallback(r);break}case V.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Bx=500;class qO extends Ym{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",de.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(I.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=J.IDLE,this.setInterval(Bx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(Vt(r)&&(this.fragPrevious=r),this.state=J.IDLE,!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=r.start;for(let l=0;l<s.length;l++)if(a>=s[l].start&&a<=s[l].end){o=s[l];break}const u=r.start+r.duration;o?o.end=u:(o={start:a,end:u},s.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(r===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,s,de.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===de.SUBTITLE&&(t.details===V.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==J.STOPPED&&(this.state=J.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&eT(this.levels,t)){this.levels=t.map(r=>new vu(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const i=new vu(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,de.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==J.STOPPED&&this.setInterval(Bx)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const u=s[a];if(a>=s.length||!u)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(o.live||(r=u.details)!=null&&r.live){const d=this.mainDetails;if(o.deltaUpdateFailed||!d)return;const f=d.fragments[0];if(!u.details)o.hasProgramDateTime&&d.hasProgramDateTime?(Qc(o,d),l=o.fragmentStart):f&&(l=f.start,ng(o,l));else{var c;l=this.alignPlaylists(o,u.details,(c=this.levelLastLoaded)==null?void 0:c.details),l===0&&f&&(l=f.start,ng(o,l))}}u.details=o,this.levelLastLoaded=u,a===i&&(this.hls.trigger(I.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===J.IDLE&&(Bs(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i!=null&&i.key&&i.iv&&ko(i.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,Km(i.method)).catch(a=>{throw s.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const u=performance.now();s.trigger(I.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:u}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=J.IDLE})}}doTick(){if(!this.media){this.state=J.IDLE;return}if(this.state===J.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:i}=this,s=this.getLoadPosition(),o=Ce.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:a,len:u}=o,l=r.details,c=this.hls.maxBufferLength+l.levelTargetDuration;if(u>c)return;const d=l.fragments,f=d.length,h=l.edge;let p=null;const g=this.fragPrevious;if(a<h){const y=i.maxFragLookUpTolerance,x=a>h-y?0:y;p=Bs(g,d,Math.max(d[0].start,a),x),!p&&g&&g.start<d[0].start&&(p=d[0])}else p=d[f-1];if(p=this.filterReplacedPrimary(p,r.details),!p)return;const m=p.sn-l.startSN,v=d[m-1];if(v&&v.cc===p.cc&&this.fragmentTracker.getState(v)===_t.NOT_LOADED&&(p=v),this.fragmentTracker.getState(p)===_t.NOT_LOADED){const y=this.mapToInitFragWhenRequired(p);y&&this.loadFragment(y,r,a)}}}loadFragment(e,t,r){Vt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new YO(this.tracksBuffered[this.currentTrackId]||[])}}class YO{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const XO={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},cT=n=>String.fromCharCode(XO[n]||n),sr=15,Qr=100,QO={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},JO={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ZO={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},eN={25:2,26:4,29:6,30:8,31:10,27:13,28:15},tN=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class nN{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Fe.log(`${this.time} [${e}] ${r}`)}}}const fs=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class dT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class rN{constructor(){this.uchar=" ",this.penState=new dT}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class iN{constructor(e){this.chars=[],this.pos=0,this.currPenState=new dT,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Qr;t++)this.chars.push(new rN);this.logger=e}equals(e){for(let t=0;t<Qr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Qr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Qr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Qr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Qr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=cT(e);if(this.pos>=Qr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Qr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Qr;r++){const i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class hh{constructor(e){this.rows=[],this.currRow=sr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<sr;t++)this.rows.push(new iN(e));this.logger=e}reset(){for(let e=0;e<sr;e++)this.rows[e].clear();this.currRow=sr-1}equals(e){let t=!0;for(let r=0;r<sr;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<sr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<sr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+st(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<sr;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,u=this.logger.time;if(a!==null&&u!==null&&a<u)for(let l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(o.rows[s+l])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+st(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<sr;s++){const o=this.rows[s].getTextString();o&&(i=s+1,e?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class Ux{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new hh(r),this.nonDisplayedMemory=new hh(r),this.lastOutputScreen=new hh(r),this.currRollUpRow=this.displayedMemory.rows[sr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[sr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+st(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class $x{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=oN(),this.logger=void 0;const i=this.logger=new nN;this.channels=[null,new Ux(e,t,i),new Ux(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const i=t[r]&127,s=t[r+1]&127;let o=!1,a=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+fs([t[r],t[r+1]])+"] -> ("+fs([i,s])+")");const u=this.cmdHistory;if(i>=16&&i<=31){if(sN(i,s,u)){_l(null,null,u),this.logger.log(3,()=>"Repeated command ("+fs([i,s])+") is dropped");continue}_l(i,s,this.cmdHistory),o=this.parseCmd(i,s),o||(o=this.parseMidrow(i,s)),o||(o=this.parsePAC(i,s)),o||(o=this.parseBackgroundAttributes(i,s))}else _l(null,null,u);if(!o&&(a=this.parseChars(i,s),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+fs([i,s])+" orig: "+fs([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(r||i))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+fs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?QO[e]:ZO[e]:r=o===1?JO[e]:eN[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,i.underline=(r&1)===1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((r-16)/2)*4,i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+cT(o)+"' in channel "+r),i=[o]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+fs(i).join(",")),i}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(r||i))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=tN[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}_l(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function _l(n,e,t){t.a=n,t.b=e}function sN(n,e,t){return t.a===n&&t.b===e}function oN(){return{a:null,b:null}}var ov=function(){if(Xc!=null&&Xc.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,u){if(typeof u!="string"||!Array.isArray(a))return!1;const l=u.toLowerCase();return~a.indexOf(l)?l:!1}function r(a){return t(n,a)}function i(a){return t(e,a)}function s(a,...u){let l=1;for(;l<arguments.length;l++){const c=arguments[l];for(const d in c)a[d]=c[d]}return a}function o(a,u,l){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,p=a,g=u,m=l,v=null,y="",x=!0,E="auto",b="start",S=50,w="middle",T=50,R="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return f},set:function(_){f=""+_}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return h},set:function(_){h=!!_}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return p},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");p=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return g},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");g=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return m},set:function(_){m=""+_,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return v},set:function(_){v=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return y},set:function(_){const A=r(_);if(A===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return x},set:function(_){x=!!_,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return E},set:function(_){if(typeof _!="number"&&_!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");E=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return b},set:function(_){const A=i(_);if(!A)throw new SyntaxError("An invalid or illegal string was specified.");b=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return S},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");S=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return w},set:function(_){const A=i(_);if(!A)throw new SyntaxError("An invalid or illegal string was specified.");w=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return T},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");T=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return R},set:function(_){const A=i(_);if(!A)throw new SyntaxError("An invalid or illegal string was specified.");R=A,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class aN{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function fT(n){function e(r,i,s,o){return(r|0)*3600+(i|0)*60+(s|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class uN{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function hT(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if(typeof i[s]!="string")continue;const o=i[s].split(t);if(o.length!==2)continue;const a=o[0],u=o[1];e(a,u)}}const cg=new ov(0,0,""),Il=cg.align==="middle"?"middle":"center";function lN(n,e,t){const r=n;function i(){const a=fT(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,u){const l=new uN;hT(a,function(f,h){let p;switch(f){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===h){l.set(f,t[g].region);break}break;case"vertical":l.alt(f,h,["rl","lr"]);break;case"line":p=h.split(","),l.integer(f,p[0]),l.percent(f,p[0])&&l.set("snapToLines",!1),l.alt(f,p[0],["auto"]),p.length===2&&l.alt("lineAlign",p[1],["start",Il,"end"]);break;case"position":p=h.split(","),l.percent(f,p[0]),p.length===2&&l.alt("positionAlign",p[1],["start",Il,"end","line-left","line-right","auto"]);break;case"size":l.percent(f,h);break;case"align":l.alt(f,h,["start",Il,"end","left","right"]);break}},/:/,/\s/),u.region=l.get("region",null),u.vertical=l.get("vertical","");let c=l.get("line","auto");c==="auto"&&cg.line===-1&&(c=-1),u.line=c,u.lineAlign=l.get("lineAlign","start"),u.snapToLines=l.get("snapToLines",!0),u.size=l.get("size",100),u.align=l.get("align",Il);let d=l.get("position","auto");d==="auto"&&cg.position===50&&(d=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=d}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=i(),o(),s(n,e)}function pT(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class cN{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new aN,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,o=0;for(s=pT(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function i(s){hT(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const a=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new ov(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{lN(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const dN=/\r\n|\n\r|\n|\r/g,ph=function(e,t,r=0){return e.slice(r,r+t.length)===t},fN=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!oe(t)||!oe(r)||!oe(i)||!oe(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*i,t+=60*60*1e3*s,t};function av(n,e,t){return ja(n.toString())+ja(e.toString())+ja(t)}const hN=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};function pN(n,e,t,r,i,s,o){const a=new cN,u=Fn(new Uint8Array(n)).trim().replace(dN,`
`).split(`
`),l=[],c=e?DP(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,p,g=!0;a.oncue=function(m){const v=t[r];let y=t.ccOffset;const x=(f-c)/9e4;if(v!=null&&v.new&&(h!==void 0?y=t.ccOffset=v.start:hN(t,r,x)),x){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}y=x-t.presentationOffset}const E=m.endTime-m.startTime,b=zn((m.startTime+y-h)*9e4,i*9e4)/9e4;m.startTime=Math.max(b,0),m.endTime=Math.max(b+E,0);const S=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(S)),m.id||(m.id=av(m.startTime,m.endTime,S)),m.endTime>0&&l.push(m)},a.onparsingerror=function(m){p=m},a.onflush=function(){if(p){o(p);return}s(l)},u.forEach(m=>{if(g)if(ph(m,"X-TIMESTAMP-MAP=")){g=!1,m.slice(16).split(",").forEach(v=>{ph(v,"LOCAL:")?d=v.slice(6):ph(v,"MPEGTS:")&&(f=parseInt(v.slice(7)))});try{h=fN(d)/1e3}catch(v){p=v}return}else m===""&&(g=!1);a.parse(m+`
`)}),a.flush()}const gh="stpp.ttml.im1t",gT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,gN={left:"start",center:"center",right:"end",start:"start",end:"end"};function Gx(n,e,t,r){const i=Te(new Uint8Array(n),["mdat"]);if(i.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(a=>Fn(a)),o=LP(e.baseTime,1,e.timescale);try{s.forEach(a=>t(mN(a,o)))}catch(a){r(a)}}function mN(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,f)=>(d[f]=i.getAttribute(`ttp:${f}`)||s[f],d),{}),a=i.getAttribute("xml:space")!=="preserve",u=Wx(mh(i,"styling","style")),l=Wx(mh(i,"layout","region")),c=mh(i,"body","[begin]");return[].map.call(c,d=>{const f=vT(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=yh(d.getAttribute("begin"),o),p=yh(d.getAttribute("dur"),o);let g=yh(d.getAttribute("end"),o);if(h===null)throw Vx(d);if(g===null){if(p===null)throw Vx(d);g=h+p}const m=new ov(h-e,g-e,f);m.id=av(m.startTime,m.endTime,m.text);const v=l[d.getAttribute("region")],y=u[d.getAttribute("style")],x=vN(v,y,u),{textAlign:E}=x;if(E){const b=gN[E];b&&(m.lineAlign=b),m.align=E}return Ke(m,x),m}).filter(d=>d!==null)}function mh(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function Wx(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function vT(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return r.nodeName==="br"&&i?t+`
`:(s=r.childNodes)!=null&&s.length?vT(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function vN(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(i=t[o]),s.reduce((a,u)=>{const l=vh(e,r,u)||vh(n,r,u)||vh(i,r,u);return l&&(a[u]=l),a},{})}function vh(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Vx(n){return new Error(`Could not parse ttml timestamp ${n}`)}function yh(n,e){if(!n)return null;let t=fT(n);return t===null&&(gT.test(n)?t=yN(n,e):mT.test(n)&&(t=xN(n,e))),t}function yN(n,e){const t=gT.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function xN(n,e){const t=mT.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Rl{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class EN{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=zx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(I.FRAG_LOADING,this.onFragLoading,this),e.on(I.FRAG_LOADED,this.onFragLoaded,this),e.on(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(I.FRAG_LOADING,this.onFragLoading,this),e.off(I.FRAG_LOADED,this.onFragLoaded,this),e.off(I.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(I.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(I.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(I.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Rl(this,"textTrack1"),t=new Rl(this,"textTrack2"),r=new Rl(this,"textTrack3"),i=new Rl(this,"textTrack4");this.cea608Parser1=new $x(1,e,t),this.cea608Parser2=new $x(3,r,i)}addCues(e,t,r,i,s){let o=!1;for(let a=s.length;a--;){const u=s[a],l=bN(u[0],u[1],t,r);if(l>=0&&(u[0]=Math.min(u[0],t),u[1]=Math.max(u[1],r),o=!0,l/(r-t)>.5))return}if(o||s.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,i)}else{const a=this.Cues.newCue(null,t,r,i);this.hls.trigger(I.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){const{unparsedVttFrags:o}=this;r===de.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(I.FRAG_LOADED,a)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const s=r.textTracks[i];if(Hx(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)r[e]=a,wo(r[e]),aT(r[e],i);else{const u=this.createTextTrack("captions",s,o);u&&(u[e]=!0,r[e]=u)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,i={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{wo(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=zx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)wo(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===gh);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(eT(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?cc(o.textTracks):null;if(this.tracks.forEach((u,l)=>{let c;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&Hx(a[f],u)){d=a[f],a[f]=null;break}d&&(c=d)}if(c)wo(c);else{const d=yT(u);c=this.createTextTrack(d,u.name,u.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const u=a.filter(l=>l!==null).map(l=>l.label);u.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(I.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const s=`textTrack${i[1]}`,o=this.captionsProperties[s];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===de.MAIN){var r,i;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:u,sn:l}=t.frag,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;s&&o&&(l!==a+1||l===a&&c!==this.lastPartIndex+1||u!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=u,this.lastSn=l,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===de.SUBTITLE)if(i.byteLength){const s=r.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[r.level],u=this.vttCCs;u[r.cc]||(u[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===gh?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;Gx(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{r.logger.log(`Failed to parse IMSC1: ${i}`),r.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[r.cc]&&a===-1){o.push(e);return}const u=this.hls,l=(t=r.initSegment)!=null&&t.data?tr(r.initSegment.data,new Uint8Array(i)).buffer:i;pN(l,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),u.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(r,i),u.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&a>r.cc)&&u.trigger(I.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||Gx(t,this.initPTS[e.cc],()=>{r.textCodec=gh,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>uT(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;r.trigger(I.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===de.SUBTITLE&&this.onFragLoaded(I.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:i}=t;if(!(r.type===de.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let s=0;s<i.length;s++){const o=i[s].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(i[s].pts,a[0]),this.cea608Parser2.addData(i[s].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(u=>ug(a[u],t,r))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(u=>ug(a[u],t,i))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let i=2;for(let s=0;s<r;s++){const o=e[i++],a=127&e[i++],u=127&e[i++];if(a===0&&u===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(u))}}return t}}function yT(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function Hx(n,e){return!!n&&n.kind===yT(e)&&sg(e,n)}function bN(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function zx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const SN=/\s/,wN={newCue(n,e,t,r){const i=[];let s,o,a,u,l;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(s=r.rows[f],a=!0,u=0,l="",!s.isEmpty()){var d;for(let g=0;g<s.chars.length;g++)SN.test(s.chars[g].uchar)&&a?u++:(l+=s.chars[g].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),u>=16?u--:u++;const h=pT(l.trim()),p=av(e,t,h);n!=null&&(d=n.cues)!=null&&d.getCueById(p)||(o=new c(e,t,h),o.id=p,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(u*8/32)*10),i.push(o))}return n&&i.length&&(i.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),i.forEach(f=>uT(n,f))),i}};function TN(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const _N=/(\d+)-(\d+)\/(\d+)/;class jx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||AN,this.controller=new self.AbortController,this.stats=new Gm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=IN(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&oe(u)?u:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(Su(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},l-(h-i.loading.start)),!d.ok){const{status:g,statusText:m}=d;throw new kN(m||"fetch, bad network response",g,d)}i.loading.first=h,i.total=CN(d.headers)||i.total;const p=(f=this.callbacks)==null?void 0:f.onProgress;return p&&oe(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,p):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const g=d[a];g&&(i.loaded=i.total=g);const m={url:p.url,data:d,code:p.status},v=(f=this.callbacks)==null?void 0:f.onProgress;v&&!oe(t.highWaterMark)&&v(i,e,d,p),(h=this.callbacks)==null||h.onSuccess(m,i,e,p)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const h=d&&d.code||0,p=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:p},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const o=new Pw,a=e.body.getReader(),u=()=>a.read().then(l=>{if(l.done)return o.dataLength&&s(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=l.value,d=c.length;return t.loaded+=d,d<i||o.dataLength?(o.push(c),o.dataLength>=i&&s(t,r,o.flush().buffer,e)):s(t,r,c.buffer,e),u()}).catch(()=>Promise.reject());return u()}}function IN(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ke({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function RN(n){const e=_N.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function CN(n){const e=n.get("Content-Range");if(e){const r=RN(e);if(oe(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function AN(n,e){return new self.Request(n.url,e)}class kN extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const LN=/^age:\s*[\d.]+\s*$/im;class xT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Gm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:r.status,text:o.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=r.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&oe(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const l=t.status,c=t.responseType==="text"?t.responseText:null;if(l>=200&&l<300){const p=c??t.response;if(p!=null){var o,a;r.loading.end=Math.max(self.performance.now(),r.loading.first);const g=t.responseType==="arraybuffer"?p.byteLength:p.length;r.loaded=r.total=g,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const m=(o=this.callbacks)==null?void 0:o.onProgress;m&&m(r,e,p,t);const v={url:t.responseURL,data:p,code:l};(a=this.callbacks)==null||a.onSuccess(v,r,e,t);return}}const d=s.loadPolicy.errorRetry,f=r.retry,h={url:e.url,data:void 0,code:l};if(Yc(d,f,!1,h))this.retry(d);else{var u;Fe.error(`${l} while loading ${e.url}`),(u=this.callbacks)==null||u.onError({code:l,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Yc(e,t,!0))this.retry(e);else{var r;Fe.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Hm(e,r.retry),r.retry++,Fe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&LN.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const DN={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},PN=Ge(Ge({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:xT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:tD,bufferController:KP,capLevelController:iv,errorController:aD,fpsController:MO,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ww,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:DN},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},ON()),{},{subtitleStreamController:qO,subtitleTrackController:$O,timelineController:EN,audioStreamController:VP,audioTrackController:HP,emeController:Lo,cmcdController:OO,contentSteeringController:FO,interstitialsController:KO});function ON(){return{cueHandler:wN,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function NN(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=dg(n),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,u=e[a]===void 0,l=[];s.forEach(c=>{const d=`${o}Loading${c}`,f=e[d];if(f!==void 0&&u){l.push(d);const h=r[a].default;switch(e[a]={default:h},c){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),l.length&&t.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${a}": ${st(e[a])}`)}),Ge(Ge({},r),e)}function dg(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(dg):Object.keys(n).reduce((e,t)=>(e[t]=dg(n[t]),e),{}):n}function FN(n,e){const t=n.loader;t!==jx&&t!==xT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):TN()&&(n.loader=jx,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const dc=2,MN=.1,BN=.05,UN=100;class $N extends Ew{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(UN),this.mediaSource=t.mediaSource;const r=this.media=t.media;ai(r,"playing",this.onMediaPlaying),ai(r,"waiting",this.onMediaWaiting),ai(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Nr(r,"playing",this.onMediaPlaying),Nr(r,"waiting",this.onMediaWaiting),Nr(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,i;const s=(r=this.hls)==null?void 0:r.config;if(!s)return;const{media:o,stalled:a}=this;if(!o)return;const{seeking:u}=o,l=this.seeking&&!u,c=!this.seeking&&u,d=o.paused&&!u||o.ended||o.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!1}));return}if(!Ce.getBuffered(o).length){this.nudgeRetry=0;return}const f=Ce.bufferInfo(o,e,0),h=f.nextStart||0,p=this.fragmentTracker;if(u&&p&&this.hls){const S=Kx(this.hls.inFlightFragments,e),w=f.len>dc,T=!h||S||h-e>dc&&!p.getPartialFragment(e);if(w||T)return;this.moved=!1}const g=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&p){if(!(f.len>0)&&!h)return;const w=Math.max(h,f.start||0)-e,R=!!(g!=null&&g.live)?g.targetduration*2:dc,_=p.getPartialFragment(e);if(w>0&&(w<=R||_)){o.paused||this._trySkipBufferHole(_);return}}const m=s.detectStallWithCurrentTimeMs,v=self.performance.now(),y=this.waiting;if(a===null){y>0&&v-y<m?this.stalled=y:this.stalled=v;return}const x=v-a;if(!u&&(x>=m||y)&&this.hls){var E;if(((E=this.mediaSource)==null?void 0:E.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(I.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(f),!this.media||!this.hls)return}const b=Ce.bufferInfo(o,e,s.maxBufferHole);this._tryFixBufferStall(b,x)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(I.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&i&&i.length>1&&e>i.end(0)){const s=Ce.bufferedInfo(Ce.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const o=Ce.timeRangesToArray(i),a=Ce.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const u=Ce.bufferedInfo(o,e,0).bufferedIndex,l=o[a].end,c=o[a+1].start;if((u===-1||u>a)&&c-l<1&&e-l<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${l} -> ${c} buffered index: ${u}`);this.warn(d.message),this.media.currentTime+=1e-6;const f=this.fragmentTracker.getPartialFragment(e)||void 0,h=Ce.bufferInfo(this.media,e,0);this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t){var r,i;const{fragmentTracker:s,media:o}=this,a=(r=this.hls)==null?void 0:r.config;if(!o||!s||!a)return;const u=o.currentTime,l=(i=this.hls)==null?void 0:i.latestLevelDetails,c=s.getPartialFragment(u);if((c||l!=null&&l.live&&u<l.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered;(d&&d.length>1&&e.len>a.maxBufferHole||e.nextStart&&e.nextStart-u<a.maxBufferHole)&&(t>a.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:r,stallReported:i,stalled:s}=this;if(!i&&s!==null&&r&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${st(e)})`);this.warn(o.message),t.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!r||!s)return 0;const o=i.currentTime,a=Ce.bufferInfo(i,o,0),u=o<a.start?a.start:a.nextStart;if(u&&this.hls){const c=a.len<=s.maxBufferHole,d=a.len>0&&a.len<1&&i.readyState<3,f=u-o;if(f>0&&(c||d)){if(f>s.maxBufferHole){let p=!1;if(o===0){const g=r.getAppendedFrag(0,de.MAIN);g&&u<g.end&&(p=!0)}if(!p){const g=e||r.getAppendedFrag(o,de.MAIN);if(g){var l;if(!((l=this.hls.loadLevelObj)!=null&&l.details)||Kx(this.hls.inFlightFragments,u))return 0;let v=!1,y=g.end;for(;y<u;){const x=r.getPartialFragment(y);if(x)y+=x.duration;else{v=!0;break}}if(v)return 0}}}const h=Math.max(u+BN,o+MN);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${h}`),this.moved=!0,i.currentTime=h,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${h}`);this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:e||void 0,buffer:a.len,bufferInfo:a})}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!r||!s)return 0;const o=r.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const a=o+(i+1)*s.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(u.message),r.currentTime=a,t.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${s.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Kx(n,e){const t=qx(n.main);if(t&&t.start<=e)return t;const r=qx(n.audio);return r&&r.start<=e?r:null}function qx(n){if(!n)return null;switch(n.state){case J.IDLE:case J.STOPPED:case J.ENDED:case J.ERROR:return null}return n.frag}const GN=.25;function fg(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Yx(n,e,t,r,i){let s=new n(e,t,"");try{s.value=r,i&&(s.type=i)}catch{s=new n(e,t,st(i?Ge({type:i},r):r))}return s}const Cl=(()=>{const n=fg();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function WN(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class VN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(I.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(I.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(I.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&wo(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return aT(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=fg();if(o)for(let a=0;a<s.length;a++){const u=s[a].type;if(u===Rn.emsg&&!r||!i)continue;const l=Gw(s[a].data);if(l){const c=s[a].pts;let d=c+s[a].duration;d>Cl&&(d=Cl),d-c<=0&&(d=c+GN);for(let h=0;h<l.length;h++){const p=l[h];if(!Ww(p)){this.updateId3CueEnds(c,u);const g=Yx(o,c,d,p,u);g&&this.id3Track.addCue(g)}}}}}updateId3CueEnds(e,t){var r;const i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(let s=i.length;s--;){const o=i[s];o.type===t&&o.startTime<e&&o.endTime===Cl&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:u}}=o;if(s&&(a||u)){let l;i==="audio"?l=c=>c.type===Rn.audioId3&&u:i==="video"?l=c=>c.type===Rn.emsg&&a:l=c=>c.type===Rn.audioId3&&u||c.type===Rn.emsg&&a,ug(s,t,r,l)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:r}=this,{dateRanges:i}=e,s=Object.keys(i);let o=this.dateRangeCuesAppended;if(r&&t){var a;if((a=r.cues)!=null&&a.length){const c=Object.keys(o).filter(d=>!s.includes(d));for(let d=c.length;d--;){const f=c[d],h=o[f].cues;delete o[f],Object.keys(h).forEach(p=>{try{const g=h[p];g.removeEventListener("enter",this.onEventCueEnter),r.removeCue(g)}catch{}})}}else o=this.dateRangeCuesAppended={}}const u=e.fragments[e.fragments.length-1];if(s.length===0||!oe(u==null?void 0:u.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=fg();for(let c=0;c<s.length;c++){const d=s[c],f=i[d],h=f.startTime,p=o[d],g=(p==null?void 0:p.cues)||{};let m=(p==null?void 0:p.durationKnown)||!1,v=Cl;const{duration:y,endDate:x}=f;if(x&&y!==null)v=h+y,m=!0;else if(f.endOnNext&&!m){const b=s.reduce((S,w)=>{if(w!==f.id){const T=i[w];if(T.class===f.class&&T.startDate>f.startDate&&(!S||f.startDate<S.startDate))return T}return S},null);b&&(v=b.startTime,m=!0)}const E=Object.keys(f.attr);for(let b=0;b<E.length;b++){const S=E[b];if(!ED(S))continue;const w=g[S];if(w)m&&!p.durationKnown?w.endTime=v:Math.abs(w.startTime-h)>.01&&(w.startTime=h,w.endTime=v);else if(l){let T=f.attr[S];bD(S)&&(T=WN(T));const _=Yx(l,h,v,{key:S,data:T},Rn.dateRange);_&&(_.id=d,this.id3Track.addCue(_),g[S]=_,this.hls.config.interstitialsController&&(S==="X-ASSET-LIST"||S==="X-ASSET-URL")&&_.addEventListener("enter",this.onEventCueEnter))}}o[d]={cues:g,dateRange:f,durationKnown:m}}}}class HN{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!r.live)return;const a=this.targetLatency;if(a===null)return;const u=i-a,l=Math.min(this.maxLatency,a+r.targetduration);if(u<l&&u>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,u=this.hls.userConfig;let l=a&&r||t;(this._targetLatencyUpdated||u.liveSyncDuration||u.liveSyncDurationCount||l===0)&&(l=s!==void 0?s:o*i);const c=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const i=r.edge,s=e-t-this.edgeStalled,o=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(I.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(I.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(I.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===V.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,i;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class zN extends rv{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this),e.on(I.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this),e.off(I.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],s={},o={};let a=!1,u=!1,l=!1;t.levels.forEach(c=>{var d;const f=c.attrs;let{audioCodec:h,videoCodec:p}=c;h&&(c.audioCodec=h=zc(h,r)||void 0),((d=p)==null?void 0:d.indexOf("avc1"))===0&&(p=c.videoCodec=GL(p));const{width:g,height:m,unknownCodecs:v}=c;let y=v?v.length:0;if(v)for(let A=y;A--;){const k=v[A];this.isAudioSupported(k)?(c.audioCodec=h=h?`${h},${k}`:k,y--,Yo.audio[h.substring(0,4)]=2):this.isVideoSupported(k)&&(c.videoCodec=p=p?`${p},${k}`:k,y--,Yo.video[p.substring(0,4)]=2)}if(a||(a=!!(g&&m)),u||(u=!!p),l||(l=!!h),y||h&&!this.isAudioSupported(h)||p&&!this.isVideoSupported(p)){this.log(`Some or all CODECS not supported "${f.CODECS}"`);return}const{CODECS:x,"FRAME-RATE":E,"HDCP-LEVEL":b,"PATHWAY-ID":S,RESOLUTION:w,"VIDEO-RANGE":T}=f,_=`${`${S||"."}-`}${c.bitrate}-${w}-${E}-${x}-${T}-${b}`;if(s[_])if(s[_].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const A=o[_]+=1;c.attrs["PATHWAY-ID"]=new Array(A+1).join(".");const k=this.createLevel(c);s[_]=k,i.push(k)}else s[_].addGroupId("audio",f.AUDIO),s[_].addGroupId("text",f.SUBTITLES);else{const A=this.createLevel(c);s[_]=A,o[_]=1,i.push(A)}}),this.filterAndSortMediaOptions(i,t,a,u,l)}createLevel(e){const t=new vu(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(i.message),t.supportedResult=mw(i,[])}return t}isAudioSupported(e){return Qp(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Qp(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,i,s){let o=[],a=[],u=e;if((r||i)&&s&&(u=u.filter(({videoCodec:p,videoRange:g,width:m,height:v})=>(!!p||!!(m&&v))&&jL(g))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let p="no level with compatible codecs found in manifest",g=p;t.levels.length&&(g=`one or more CODECS in variant not supported: ${st(t.levels.map(v=>v.attrs.CODECS).filter((v,y,x)=>x.indexOf(v)===y))}`,this.warn(g),p+=` (${g})`);const m=new Error(p);this.hls.trigger(I.ERROR,{type:pe.MEDIA_ERROR,details:V.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:m,reason:g})}});return}t.audioTracks&&(o=t.audioTracks.filter(p=>!p.audioCodec||this.isAudioSupported(p.audioCodec)),Xx(o)),t.subtitles&&(a=t.subtitles,Xx(a));const l=u.slice(0);u.sort((p,g)=>{if(p.attrs["HDCP-LEVEL"]!==g.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(g.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&p.height!==g.height)return p.height-g.height;if(p.frameRate!==g.frameRate)return p.frameRate-g.frameRate;if(p.videoRange!==g.videoRange)return jc.indexOf(p.videoRange)-jc.indexOf(g.videoRange);if(p.videoCodec!==g.videoCodec){const m=Hy(p.videoCodec),v=Hy(g.videoCodec);if(m!==v)return v-m}if(p.uri===g.uri&&p.codecSet!==g.codecSet){const m=Hc(p.codecSet),v=Hc(g.codecSet);if(m!==v)return v-m}return p.averageBitrate!==g.averageBitrate?p.averageBitrate-g.averageBitrate:0});let c=l[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==l.length)){for(let p=0;p<l.length;p++)if(l[p].pathwayId===u[0].pathwayId){c=l[p];break}}this._levels=u;for(let p=0;p<u.length;p++)if(u[p]===c){var d;this._firstLevel=p;const g=c.bitrate,m=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${g}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const v=Math.min(g,this.hls.config.abrEwmaDefaultEstimateMax);v>m&&m===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=v)}break}const f=s&&!i,h={levels:u,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:!f&&o.some(p=>!!p.url)};this.hls.trigger(I.MANIFEST_PARSED,h)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&i&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${s?" with Pathway "+s:""}`);const u={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(I.LEVEL_SWITCHING,u);const l=o.details;if(!l||l.live){const c=this.switchParams(o.uri,i==null?void 0:i.details,l);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Ae.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===de.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${i}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let u=o.details;u===t.details&&u.advanced&&(u=void 0),this.playlistLoaded(i,t,u)}else(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${r}`),this.hls.trigger(I.LEVEL_LOADING,{url:r,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));kw(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=r.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(I.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(I.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function Xx(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function ET(){return self.SourceBuffer||self.WebKitSourceBuffer}function bT(){if(!es())return!1;const e=ET();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function jN(){if(!bT())return!1;const n=es();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(mu(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(mu(e,"audio"))))}function KN(){var n;const e=ET();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const qN=100;class YN extends Ym{constructor(e,t,r){super(e,t,r,"stream-controller",de.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!oe(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const o=this.getFwdBufferInfoAtPos(i,s,de.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(I.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(I.BUFFER_CREATED,this.onBufferCreated,this),e.on(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(I.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(I.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(I.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(I.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(I.BUFFER_CREATED,this.onBufferCreated,this),e.off(I.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(I.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:i}=this;if(this.stopLoad(),this.setInterval(qN),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=J.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=J.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case J.WAITING_LEVEL:{const{levels:t,level:r}=this,i=t==null?void 0:t[r],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=J.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=J.IDLE;break}break}case J.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,level:s}=this,o=i==null?void 0:i[s];this.resetStartWhenNotLoaded(o||null),this.state=J.IDLE}}break}this.state===J.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const o=r[s],a=this.getMainFwdBufferInfo();if(a===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(a,u)){const g={};this.altAudio===2&&(g.type="video"),this.hls.trigger(I.BUFFER_EOS,g),this.state=J.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const l=o.details;if(!l||this.state===J.WAITING_LEVEL||this.waitForLive(o)){this.level=s,this.state=J.WAITING_LEVEL,this.startFragRequested=!1;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(f,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&Vt(h)&&this.fragmentTracker.getState(h)!==_t.OK){var p;const m=((p=this.backtrackFragment)!=null?p:h).sn-l.startSN,v=l.fragments[m-1];v&&h.cc===v.cc&&(h=v,this.fragmentTracker.removeFragment(v))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const m=this.audioOnly&&!this.altAudio?He.AUDIO:He.VIDEO,v=(m===He.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;v&&this.afterBufferFlushed(v,m,de.MAIN)}h=this.getNextFragmentLoopLoading(h,l,a,de.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,o,f))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);i===_t.NOT_LOADED||i===_t.PARTIAL?Vt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,de.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,u=e[a],l=this.fragLastKbps;l&&this.fragCurrent?r=this.fragCurrent.duration*u.maxBitrate/(1e3*l)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const u=a.maxStartPTS?a.maxStartPTS:a.start,l=a.duration,c=Math.max(o.end,u+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*(this.couldBacktrack?.5:.125)),l*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case J.KEY_LOADING:case J.FRAG_LOADING:case J.FRAG_LOADING_WAITING_RETRY:case J.PARSING:case J.PARSED:this.state=J.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;ai(r,"playing",this.onMediaPlaying),ai(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Nr(r,"playing",this.onMediaPlaying),Nr(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,i=!1;t.levels.forEach(s=>{const o=s.audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,i=i||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&i&&!KN(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==J.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=J.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:i,startFragRequested:s}=this,o=t.level,a=t.details,u=a.totalduration;if(!i){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${u}`);const l=t.levelInfo,c=this.fragCurrent;c&&(this.state===J.FRAG_LOADING||this.state===J.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||(r=l.details)!=null&&r.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,l.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(l.details=a,this.levelLastLoaded=l,s||this.setStartPosition(a,d),this.hls.trigger(I.LEVEL_UPDATED,{details:a,level:o}),this.state===J.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=J.IDLE}s&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,u=s>=o-t.maxFragLookUpTolerance&&s<=a;if(i!==null&&r.duration>i&&(s<i||!u)){const l=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!u&&r.readyState<4||s<a-l)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),r.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),r.currentTime=i))}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level];if(!a){this.warn(`Level ${r.level} not found on progress`);return}const u=a.details;if(!u){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const l=a.videoCodec,c=u.PTSKnown||!u.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new Zw(this.hls,de.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,g=p!==-1,m=new jm(r.level,r.sn,r.stats.chunkCount,s.byteLength,p,g),v=this.initPTS[r.cc];h.push(s,d,f,l,r,i,u.totalduration,c,m,v)}onAudioTrackSwitching(e,t){const r=this.hls,i=this.altAudio===2;if(Kc(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),r.once(I.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(I.AUDIO_TRACK_SWITCHED,t)}),r.trigger(I.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(I.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Kc(t.url,this.hls);if(r){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,o=!1;for(const a in r){const u=r[a];if(u.id==="main"){if(s=a,i=u,a==="video"){const l=r[a];l&&(this.videoBuffer=l.buffer)}}else o=!0}o&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t,s=r.type===de.MAIN;if(s){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===J.PARSED&&(this.state=J.IDLE);return}const a=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),Vt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}const o=this.media;o&&(!this._hasEnoughToStart&&Ce.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=J.ERROR;return}switch(t.details){case V.FRAG_GAP:case V.FRAG_PARSING_ERROR:case V.FRAG_DECRYPT_ERROR:case V.FRAG_LOAD_ERROR:case V.FRAG_LOAD_TIMEOUT:case V.KEY_LOAD_ERROR:case V.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.MAIN,t);break;case V.LEVEL_LOAD_ERROR:case V.LEVEL_LOAD_TIMEOUT:case V.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===J.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Ae.LEVEL&&(this.state=J.IDLE);break;case V.BUFFER_ADD_CODEC_ERROR:case V.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case V.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case V.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=J.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==He.AUDIO||!this.altAudio){const r=(t===He.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,de.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&r&&(r+=i);const s=this.getLevelDetails(),o=Ce.getBuffered(e),a=o.length?o.start(0):0,u=a-r,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);u>0&&(u<l||this.loadingParts&&u<2*((s==null?void 0:s.partTarget)||0))&&(this.log(`adjusting start position by ${u} to match buffer start`),r+=u,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${a}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this,s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=J.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),i.trigger(I.FRAG_LOADED,r),s.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:u,part:l,level:c}=a,{video:d,text:f,id3:h,initSegment:p}=s,{details:g}=c,m=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=J.PARSING,p){if(p!=null&&p.tracks){const x=u.initSegment||u;this._bufferInitSegment(c,p.tracks,x,o),i.trigger(I.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:r,tracks:p.tracks})}const v=p.initPTS,y=p.timescale;oe(v)&&(this.initPTS[u.cc]={baseTime:v,timescale:y},i.trigger(I.INIT_PTS_FOUND,{frag:u,id:r,initPTS:v,timescale:y}))}if(d&&g){const v=g.fragments[u.sn-1-g.startSN],y=u.sn===g.startSN,x=!v||u.cc>v.cc;if(s.independent!==!1){const{startPTS:E,endPTS:b,startDTS:S,endDTS:w}=d;if(l)l.elementaryStreams[d.type]={startPTS:E,endPTS:b,startDTS:S,endDTS:w};else if(d.firstKeyFrame&&d.independent&&o.id===1&&!x&&(this.couldBacktrack=!0),d.dropped&&d.independent){const T=this.getMainFwdBufferInfo(),R=(T?T.end:this.getLoadPosition())+this.config.maxBufferHole,_=d.firstKeyFramePTS?d.firstKeyFramePTS:E;if(!y&&R<_-this.config.maxBufferHole&&!x){this.backtrack(u);return}else x&&(u.gap=!0);u.setElementaryStreamInfo(d.type,u.start,b,u.start,w,!0)}else y&&E-(g.appliedTimelineOffset||0)>dc&&(u.gap=!0);u.setElementaryStreamInfo(d.type,E,b,S,w),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(d,u,l,o,y||x)}else if(y||x)u.gap=!0;else{this.backtrack(u);return}}if(m){const{startPTS:v,endPTS:y,startDTS:x,endDTS:E}=m;l&&(l.elementaryStreams[He.AUDIO]={startPTS:v,endPTS:y,startDTS:x,endDTS:E}),u.setElementaryStreamInfo(He.AUDIO,v,y,x,E),this.bufferFragmentData(m,u,l,o)}if(g&&h!=null&&(t=h.samples)!=null&&t.length){const v={id:r,frag:u,details:g,samples:h.samples};i.trigger(I.FRAG_PARSING_METADATA,v)}if(g&&f){const v={id:r,frag:u,details:g,samples:f.samples};i.trigger(I.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,r,i){if(this.state!==J.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:o,audiovideo:a}=t;if(s){let l=sc(s.codec,e.audioCodec);l==="mp4a"&&(l="mp4a.40.5");const c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5");const d=s.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(l="mp4a.40.5")}l&&l.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id=de.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=de.MAIN;const l=o.codec;if((l==null?void 0:l.length)===4)switch(l){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${l}]${o.codec!==l?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const u=Object.keys(t);if(u.length){if(this.hls.trigger(I.BUFFER_CODECS,t),!this.hls)return;u.forEach(l=>{const d=t[l].initSegment;d!=null&&d.byteLength&&this.hls.trigger(I.BUFFER_APPENDING,{type:l,data:d,frag:r,part:null,chunkMeta:i,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,de.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=J.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(Ce.isBuffered(e,r)?t=this.getAppendedFrag(r):Ce.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(I.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(I.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return oe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(oe(t)){const r=this.getLevelDetails(),i=this.currentFrag||(r?Bs(null,r.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const o=s+(t-i.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class XN{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[r].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=V.KEY_LOAD_ERROR,r,i,s){return new ti({type:pe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:i}=e;for(let s=0;s<t.length;s++){const o=t[s];if(i<=o.cc&&(r==="initSegment"||o.sn==="initSegment"||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const l=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,V.KEY_LOAD_ERROR,l))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,V.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((r=a)!=null&&r.decryptdata.key)return s.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((i=a)!=null&&i.keyLoadPromise){var u;switch((u=a.mediaKeySessionContext)==null?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(l=>(s.key=l.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,V.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=r.loader,s=new i(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=r.keyLoadPolicy.default,c={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,p,g)=>{const{frag:m,keyInfo:v,url:y}=p;if(!m.decryptdata||v!==this.keyUriToKeyInfo[y])return a(this.createKeyLoadError(m,V.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));v.decryptdata.key=m.decryptdata.key=new Uint8Array(f.data),m.keyLoader=null,v.loader=null,o({frag:m,keyInfo:v})},onError:(f,h,p,g)=>{this.resetLoader(h),a(this.createKeyLoadError(t,V.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,Ge({url:u.url,data:void 0},f)))},onTimeout:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(t,V.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,h,p)=>{this.resetLoader(h),a(this.createKeyLoadError(t,V.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(u,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}function Qx(n){const{type:e}=n;switch(e){case Ae.AUDIO_TRACK:return de.AUDIO;case Ae.SUBTITLE_TRACK:return de.SUBTITLE;default:return de.MAIN}}function xh(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class QN{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(I.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(I.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(I.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(I.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,s=r||i,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ae.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:s,url:o,deliveryDirectives:a,levelInfo:u}=t;this.load({id:r,level:i,pathwayId:s,responseType:"text",type:Ae.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:u})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Ae.AUDIO_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o,track:a}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Ae.SUBTITLE_TRACK,url:s,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const r=this.loaders[Ae.LEVEL];if(r){const i=r.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(r.abort(),delete this.loaders[Ae.LEVEL])}}load(e){var t;const r=this.hls.config;let i=this.getInternalLoader(e);if(i){const l=this.hls.logger,c=i.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?l.log(`[playlist-loader]: ignore ${e.url} ongoing request`):l.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}l.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===Ae.MANIFEST?s=r.manifestLoadPolicy.default:s=Ke({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),oe((t=e.deliveryDirectives)==null?void 0:t.part)){let l;if(e.type===Ae.LEVEL&&e.level!==null?l=this.hls.levels[e.level].details:e.type===Ae.AUDIO_TRACK&&e.id!==null?l=this.hls.audioTracks[e.id].details:e.type===Ae.SUBTITLE_TRACK&&e.id!==null&&(l=this.hls.subtitleTracks[e.id].details),l){const c=l.partTarget,d=l.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;s=Ke({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(l,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=l.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(l,d,new Error("no EXTM3U delimiter"),f||null,c);return}c.parsing.start=performance.now(),Or.isMediaPlaylist(p)||d.type!==Ae.MANIFEST?this.handleTrackOrLevelPlaylist(l,c,d,f||null,h):this.handleMasterPlaylist(l,c,d,f)},onError:(l,c,d,f)=>{this.handleNetworkError(c,d,!1,l,f)},onTimeout:(l,c,d)=>{this.handleNetworkError(c,d,!0,void 0,l)}};i.load(e,a,u)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,i){const s=this.hls,o=e.data,a=xh(e,r),u=Or.parseMasterPlaylist(o,a);if(u.playlistParsingError){this.handleManifestParsingError(e,r,u.playlistParsingError,i,t);return}const{contentSteering:l,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p}=u;this.variableList=p;const{AUDIO:g=[],SUBTITLES:m,"CLOSED-CAPTIONS":v}=Or.parseMasterPlaylistMedia(o,a,u);g.length&&!g.some(x=>!x.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new at({}),bitrate:0,url:""})),s.trigger(I.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:m,captions:v,contentSteering:l,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:p})}handleTrackOrLevelPlaylist(e,t,r,i,s){const o=this.hls,{id:a,level:u,type:l}=r,c=xh(e,r),d=oe(u)?u:oe(a)?a:0,f=Qx(r),h=Or.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(l===Ae.MANIFEST){const p={attrs:new at({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+Cw(h,0),o.trigger(I.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(I.ERROR,{type:pe.NETWORK_ERROR,details:V.MANIFEST_PARSING_ERROR,fatal:t.type===Ae.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let o=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Ae.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ae.AUDIO_TRACK||e.type===Ae.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let u=V.UNKNOWN,l=!1;const c=this.getInternalLoader(e);switch(e.type){case Ae.MANIFEST:u=r?V.MANIFEST_LOAD_TIMEOUT:V.MANIFEST_LOAD_ERROR,l=!0;break;case Ae.LEVEL:u=r?V.LEVEL_LOAD_TIMEOUT:V.LEVEL_LOAD_ERROR,l=!1;break;case Ae.AUDIO_TRACK:u=r?V.AUDIO_TRACK_LOAD_TIMEOUT:V.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Ae.SUBTITLE_TRACK:u=r?V.SUBTITLE_TRACK_LOAD_TIMEOUT:V.SUBTITLE_LOAD_ERROR,l=!1;break}c&&this.resetInternalLoader(e.type);const d={type:pe.NETWORK_ERROR,details:u,fatal:l,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:s};if(i){const f=(t==null?void 0:t.url)||e.url;d.response=Ge({url:f,data:void 0},i)}this.hls.trigger(I.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,o){const a=this.hls,{type:u,level:l,id:c,groupId:d,deliveryDirectives:f}=i,h=xh(t,i),p=Qx(i),g=typeof i.level=="number"&&p===de.MAIN?l:void 0;if(!e.fragments.length){const v=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(I.ERROR,{type:pe.NETWORK_ERROR,details:V.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:v,reason:v.message,response:t,context:i,level:g,parent:p,networkDetails:s,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m){if(this.hls.logger.warn(m),!a.config.ignorePlaylistParsingErrors){a.trigger(I.ERROR,{type:pe.NETWORK_ERROR,details:V.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:t,context:i,level:g,parent:p,networkDetails:s,stats:r});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),u){case Ae.MANIFEST:case Ae.LEVEL:a.trigger(I.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||a.levels[0],level:g||0,id:c||0,stats:r,networkDetails:s,deliveryDirectives:f,withoutMultiVariant:u===Ae.MANIFEST});break;case Ae.AUDIO_TRACK:a.trigger(I.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:f});break;case Ae.SUBTITLE_TRACK:a.trigger(I.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:f});break}}}class dr{static get version(){return Eu}static isMSESupported(){return bT()}static isSupported(){return jN()}static getMediaSource(){return es()}static get Events(){return I}static get MetadataSchema(){return Rn}static get ErrorTypes(){return pe}static get ErrorDetails(){return V}static get DefaultConfig(){return dr.defaultConfig?dr.defaultConfig:PN}static set DefaultConfig(e){dr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Xm,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=mL(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=NN(dr.DefaultConfig,e,t);this.userConfig=e,r.progressive&&FN(r,t);const{abrController:i,bufferController:s,capLevelController:o,errorController:a,fpsController:u}=r,l=new a(this),c=this.abrController=new i(this),d=new uD(this),f=r.interstitialsController,h=f?this.interstitialsController=new f(this,dr):null,p=this.bufferController=new s(this,d),g=this.capLevelController=new o(this),m=new u(this),v=new QN(this),y=r.contentSteeringController,x=y?new y(this):null,E=this.levelController=new zN(this,x),b=new VN(this),S=new XN(this.config),w=this.streamController=new YN(this,d,S),T=this.gapController=new $N(this,d);g.setStreamController(w),m.setStreamController(w);const R=[v,E,w];h&&R.splice(1,0,h),x&&R.splice(1,0,x),this.networkControllers=R;const _=[c,p,T,g,m,b,d];this.audioTrackController=this.createController(r.audioTrackController,R);const A=r.audioStreamController;A&&R.push(this.audioStreamController=new A(this,d,S)),this.subtitleTrackController=this.createController(r.subtitleTrackController,R);const k=r.subtitleStreamController;k&&R.push(this.subtititleStreamController=new k(this,d,S)),this.createController(r.timelineController,_),S.emeController=this.emeController=this.createController(r.emeController,_),this.cmcdController=this.createController(r.cmcdController,_),this.latencyController=this.createController(HN,_),this.coreComponents=_,R.push(l);const G=l.onErrorOut;typeof G=="function"&&this.on(I.ERROR,G,l),this.on(I.MANIFEST_LOADED,v.onManifestLoaded,v)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const i=e===I.ERROR;this.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.INTERNAL_EXCEPTION,fatal:i,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(I.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(I.ERROR,{type:pe.OTHER_ERROR,details:V.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,i=t?e:{media:r};this._media=r,this.trigger(I.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(I.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(I.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,i=this._url=$m.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(I.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[de.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[de.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[de.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=oP()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){zL(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,r)for(let s=i;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=r)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=yw(t);return vw(e,r,navigator.mediaCapabilities)}}dr.defaultConfig=void 0;const JN=({onCapture:n,darkMode:e})=>{const t=X.useRef(null),r=X.useRef(null);X.useEffect(()=>{if(t.current){const s=t.current,o=new dr;o.loadSource("http://localhost:8888/stream0/index.m3u8"),o.attachMedia(s),o.on(dr.Events.MANIFEST_PARSED,()=>{s.play().catch(console.error)})}},[]);const i=X.useCallback(()=>{const s=t.current,o=r.current;if(!s||!o){console.error("Stream not loaded!");return}const a=o.getContext("2d");if(!a){console.error("Canvas context not available!");return}o.width=s.videoWidth,o.height=s.videoHeight,a.drawImage(s,0,0,o.width,o.height),o.toBlob(u=>{u?n(u):console.error("Failed to capture photo!")},"image/jpeg")},[n]);return H.jsxs("div",{className:"relative p-4",children:[H.jsx("h2",{className:"text-xl font-semibold mb-2 text-center",children:"Live Camera Stream"}),H.jsx("video",{ref:t,className:"w-full max-w-md h-64 rounded-lg shadow-lg border border-gray-300",autoPlay:!0,muted:!0,controls:!0}),H.jsx("canvas",{ref:r,className:"hidden"}),H.jsx("div",{className:"flex justify-center mt-4",children:H.jsx("button",{onClick:i,className:`px-4 py-2 rounded-lg transition-colors ${e?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-200 hover:bg-gray-300 text-black"}`,type:"button",children:"📸 Capture Photo"})})]})};function ST(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=ST(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function ks(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=ST(n))&&(r&&(r+=" "),r+=e);return r}function ZN(n){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t),t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n))}ZN(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var Uu=n=>typeof n=="number"&&!isNaN(n),Us=n=>typeof n=="string",hi=n=>typeof n=="function",eF=n=>Us(n)||Uu(n),hg=n=>Us(n)||hi(n)?n:null,tF=(n,e)=>n===!1||Uu(n)&&n>0?n:e,pg=n=>X.isValidElement(n)||Us(n)||hi(n)||Uu(n);function nF(n,e,t=300){let{scrollHeight:r,style:i}=n;requestAnimationFrame(()=>{i.minHeight="initial",i.height=r+"px",i.transition=`all ${t}ms`,requestAnimationFrame(()=>{i.height="0",i.padding="0",i.margin="0",setTimeout(e,t)})})}function rF({enter:n,exit:e,appendPosition:t=!1,collapse:r=!0,collapseDuration:i=300}){return function({children:s,position:o,preventExitTransition:a,done:u,nodeRef:l,isIn:c,playToast:d}){let f=t?`${n}--${o}`:n,h=t?`${e}--${o}`:e,p=X.useRef(0);return X.useLayoutEffect(()=>{let g=l.current,m=f.split(" "),v=y=>{y.target===l.current&&(d(),g.removeEventListener("animationend",v),g.removeEventListener("animationcancel",v),p.current===0&&y.type!=="animationcancel"&&g.classList.remove(...m))};g.classList.add(...m),g.addEventListener("animationend",v),g.addEventListener("animationcancel",v)},[]),X.useEffect(()=>{let g=l.current,m=()=>{g.removeEventListener("animationend",m),r?nF(g,u,i):u()};c||(a?m():(p.current=1,g.className+=` ${h}`,g.addEventListener("animationend",m)))},[c]),Qe.createElement(Qe.Fragment,null,s)}}function Jx(n,e){return{content:wT(n.content,n.props),containerId:n.props.containerId,id:n.props.toastId,theme:n.props.theme,type:n.props.type,data:n.props.data||{},isLoading:n.props.isLoading,icon:n.props.icon,reason:n.removalReason,status:e}}function wT(n,e,t=!1){return X.isValidElement(n)&&!Us(n.type)?X.cloneElement(n,{closeToast:e.closeToast,toastProps:e,data:e.data,isPaused:t}):hi(n)?n({closeToast:e.closeToast,toastProps:e,data:e.data,isPaused:t}):n}function iF({closeToast:n,theme:e,ariaLabel:t="close"}){return Qe.createElement("button",{className:`Toastify__close-button Toastify__close-button--${e}`,type:"button",onClick:r=>{r.stopPropagation(),n(!0)},"aria-label":t},Qe.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Qe.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function sF({delay:n,isRunning:e,closeToast:t,type:r="default",hide:i,className:s,controlledProgress:o,progress:a,rtl:u,isIn:l,theme:c}){let d=i||o&&a===0,f={animationDuration:`${n}ms`,animationPlayState:e?"running":"paused"};o&&(f.transform=`scaleX(${a})`);let h=ks("Toastify__progress-bar",o?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${c}`,`Toastify__progress-bar--${r}`,{"Toastify__progress-bar--rtl":u}),p=hi(s)?s({rtl:u,type:r,defaultClassName:h}):ks(h,s),g={[o&&a>=1?"onTransitionEnd":"onAnimationEnd"]:o&&a<1?null:()=>{l&&t()}};return Qe.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":d},Qe.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${c} Toastify__progress-bar--${r}`}),Qe.createElement("div",{role:"progressbar","aria-hidden":d?"true":"false","aria-label":"notification timer",className:p,style:f,...g}))}var oF=1,TT=()=>`${oF++}`;function aF(n,e,t){let r=1,i=0,s=[],o=[],a=e,u=new Map,l=new Set,c=y=>(l.add(y),()=>l.delete(y)),d=()=>{o=Array.from(u.values()),l.forEach(y=>y())},f=({containerId:y,toastId:x,updateId:E})=>{let b=y?y!==n:n!==1,S=u.has(x)&&E==null;return b||S},h=(y,x)=>{u.forEach(E=>{var b;(x==null||x===E.props.toastId)&&((b=E.toggle)==null||b.call(E,y))})},p=y=>{var x,E;(E=(x=y.props)==null?void 0:x.onClose)==null||E.call(x,y.removalReason),y.isActive=!1},g=y=>{if(y==null)u.forEach(p);else{let x=u.get(y);x&&p(x)}d()},m=()=>{i-=s.length,s=[]},v=y=>{var x,E;let{toastId:b,updateId:S}=y.props,w=S==null;y.staleId&&u.delete(y.staleId),y.isActive=!0,u.set(b,y),d(),t(Jx(y,w?"added":"updated")),w&&((E=(x=y.props).onOpen)==null||E.call(x))};return{id:n,props:a,observe:c,toggle:h,removeToast:g,toasts:u,clearQueue:m,buildToast:(y,x)=>{if(f(x))return;let{toastId:E,updateId:b,data:S,staleId:w,delay:T}=x,R=b==null;R&&i++;let _={...a,style:a.toastStyle,key:r++,...Object.fromEntries(Object.entries(x).filter(([k,G])=>G!=null)),toastId:E,updateId:b,data:S,isIn:!1,className:hg(x.className||a.toastClassName),progressClassName:hg(x.progressClassName||a.progressClassName),autoClose:x.isLoading?!1:tF(x.autoClose,a.autoClose),closeToast(k){u.get(E).removalReason=k,g(E)},deleteToast(){let k=u.get(E);if(k!=null){if(t(Jx(k,"removed")),u.delete(E),i--,i<0&&(i=0),s.length>0){v(s.shift());return}d()}}};_.closeButton=a.closeButton,x.closeButton===!1||pg(x.closeButton)?_.closeButton=x.closeButton:x.closeButton===!0&&(_.closeButton=pg(a.closeButton)?a.closeButton:!0);let A={content:y,props:_,staleId:w};a.limit&&a.limit>0&&i>a.limit&&R?s.push(A):Uu(T)?setTimeout(()=>{v(A)},T):v(A)},setProps(y){a=y},setToggle:(y,x)=>{let E=u.get(y);E&&(E.toggle=x)},isToastActive:y=>{var x;return(x=u.get(y))==null?void 0:x.isActive},getSnapshot:()=>o}}var un=new Map,Tu=[],gg=new Set,uF=n=>gg.forEach(e=>e(n)),_T=()=>un.size>0;function lF(){Tu.forEach(n=>RT(n.content,n.options)),Tu=[]}var cF=(n,{containerId:e})=>{var t;return(t=un.get(e||1))==null?void 0:t.toasts.get(n)};function IT(n,e){var t;if(e)return!!((t=un.get(e))!=null&&t.isToastActive(n));let r=!1;return un.forEach(i=>{i.isToastActive(n)&&(r=!0)}),r}function dF(n){if(!_T()){Tu=Tu.filter(e=>n!=null&&e.options.toastId!==n);return}if(n==null||eF(n))un.forEach(e=>{e.removeToast(n)});else if(n&&("containerId"in n||"id"in n)){let e=un.get(n.containerId);e?e.removeToast(n.id):un.forEach(t=>{t.removeToast(n.id)})}}var fF=(n={})=>{un.forEach(e=>{e.props.limit&&(!n.containerId||e.id===n.containerId)&&e.clearQueue()})};function RT(n,e){pg(n)&&(_T()||Tu.push({content:n,options:e}),un.forEach(t=>{t.buildToast(n,e)}))}function hF(n){var e;(e=un.get(n.containerId||1))==null||e.setToggle(n.id,n.fn)}function CT(n,e){un.forEach(t=>{(e==null||!(e!=null&&e.containerId)||(e==null?void 0:e.containerId)===t.id)&&t.toggle(n,e==null?void 0:e.id)})}function pF(n){let e=n.containerId||1;return{subscribe(t){let r=aF(e,n,uF);un.set(e,r);let i=r.observe(t);return lF(),()=>{i(),un.delete(e)}},setProps(t){var r;(r=un.get(e))==null||r.setProps(t)},getSnapshot(){var t;return(t=un.get(e))==null?void 0:t.getSnapshot()}}}function gF(n){return gg.add(n),()=>{gg.delete(n)}}function mF(n){return n&&(Us(n.toastId)||Uu(n.toastId))?n.toastId:TT()}function $u(n,e){return RT(n,e),e.toastId}function Xd(n,e){return{...e,type:e&&e.type||n,toastId:mF(e)}}function Qd(n){return(e,t)=>$u(e,Xd(n,t))}function De(n,e){return $u(n,Xd("default",e))}De.loading=(n,e)=>$u(n,Xd("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...e}));function vF(n,{pending:e,error:t,success:r},i){let s;e&&(s=Us(e)?De.loading(e,i):De.loading(e.render,{...i,...e}));let o={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},a=(l,c,d)=>{if(c==null){De.dismiss(s);return}let f={type:l,...o,...i,data:d},h=Us(c)?{render:c}:c;return s?De.update(s,{...f,...h}):De(h.render,{...f,...h}),d},u=hi(n)?n():n;return u.then(l=>a("success",r,l)).catch(l=>a("error",t,l)),u}De.promise=vF;De.success=Qd("success");De.info=Qd("info");De.error=Qd("error");De.warning=Qd("warning");De.warn=De.warning;De.dark=(n,e)=>$u(n,Xd("default",{theme:"dark",...e}));function yF(n){dF(n)}De.dismiss=yF;De.clearWaitingQueue=fF;De.isActive=IT;De.update=(n,e={})=>{let t=cF(n,e);if(t){let{props:r,content:i}=t,s={delay:100,...r,...e,toastId:e.toastId||n,updateId:TT()};s.toastId!==n&&(s.staleId=n);let o=s.render||i;delete s.render,$u(o,s)}};De.done=n=>{De.update(n,{progress:1})};De.onChange=gF;De.play=n=>CT(!0,n);De.pause=n=>CT(!1,n);function xF(n){var e;let{subscribe:t,getSnapshot:r,setProps:i}=X.useRef(pF(n)).current;i(n);let s=(e=X.useSyncExternalStore(t,r,r))==null?void 0:e.slice();function o(a){if(!s)return[];let u=new Map;return n.newestOnTop&&s.reverse(),s.forEach(l=>{let{position:c}=l.props;u.has(c)||u.set(c,[]),u.get(c).push(l)}),Array.from(u,l=>a(l[0],l[1]))}return{getToastToRender:o,isToastActive:IT,count:s==null?void 0:s.length}}function EF(n){let[e,t]=X.useState(!1),[r,i]=X.useState(!1),s=X.useRef(null),o=X.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:a,pauseOnHover:u,closeToast:l,onClick:c,closeOnClick:d}=n;hF({id:n.toastId,containerId:n.containerId,fn:t}),X.useEffect(()=>{if(n.pauseOnFocusLoss)return f(),()=>{h()}},[n.pauseOnFocusLoss]);function f(){document.hasFocus()||v(),window.addEventListener("focus",m),window.addEventListener("blur",v)}function h(){window.removeEventListener("focus",m),window.removeEventListener("blur",v)}function p(w){if(n.draggable===!0||n.draggable===w.pointerType){y();let T=s.current;o.canCloseOnClick=!0,o.canDrag=!0,T.style.transition="none",n.draggableDirection==="x"?(o.start=w.clientX,o.removalDistance=T.offsetWidth*(n.draggablePercent/100)):(o.start=w.clientY,o.removalDistance=T.offsetHeight*(n.draggablePercent===80?n.draggablePercent*1.5:n.draggablePercent)/100)}}function g(w){let{top:T,bottom:R,left:_,right:A}=s.current.getBoundingClientRect();w.nativeEvent.type!=="touchend"&&n.pauseOnHover&&w.clientX>=_&&w.clientX<=A&&w.clientY>=T&&w.clientY<=R?v():m()}function m(){t(!0)}function v(){t(!1)}function y(){o.didMove=!1,document.addEventListener("pointermove",E),document.addEventListener("pointerup",b)}function x(){document.removeEventListener("pointermove",E),document.removeEventListener("pointerup",b)}function E(w){let T=s.current;if(o.canDrag&&T){o.didMove=!0,e&&v(),n.draggableDirection==="x"?o.delta=w.clientX-o.start:o.delta=w.clientY-o.start,o.start!==w.clientX&&(o.canCloseOnClick=!1);let R=n.draggableDirection==="x"?`${o.delta}px, var(--y)`:`0, calc(${o.delta}px + var(--y))`;T.style.transform=`translate3d(${R},0)`,T.style.opacity=`${1-Math.abs(o.delta/o.removalDistance)}`}}function b(){x();let w=s.current;if(o.canDrag&&o.didMove&&w){if(o.canDrag=!1,Math.abs(o.delta)>o.removalDistance){i(!0),n.closeToast(!0),n.collapseAll();return}w.style.transition="transform 0.2s, opacity 0.2s",w.style.removeProperty("transform"),w.style.removeProperty("opacity")}}let S={onPointerDown:p,onPointerUp:g};return a&&u&&(S.onMouseEnter=v,n.stacked||(S.onMouseLeave=m)),d&&(S.onClick=w=>{c&&c(w),o.canCloseOnClick&&l(!0)}),{playToast:m,pauseToast:v,isRunning:e,preventExitTransition:r,toastRef:s,eventHandlers:S}}var bF=typeof window<"u"?X.useLayoutEffect:X.useEffect,Jd=({theme:n,type:e,isLoading:t,...r})=>Qe.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:n==="colored"?"currentColor":`var(--toastify-icon-color-${e})`,...r});function SF(n){return Qe.createElement(Jd,{...n},Qe.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function wF(n){return Qe.createElement(Jd,{...n},Qe.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function TF(n){return Qe.createElement(Jd,{...n},Qe.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function _F(n){return Qe.createElement(Jd,{...n},Qe.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function IF(){return Qe.createElement("div",{className:"Toastify__spinner"})}var mg={info:wF,warning:SF,success:TF,error:_F,spinner:IF},RF=n=>n in mg;function CF({theme:n,type:e,isLoading:t,icon:r}){let i=null,s={theme:n,type:e};return r===!1||(hi(r)?i=r({...s,isLoading:t}):X.isValidElement(r)?i=X.cloneElement(r,s):t?i=mg.spinner():RF(e)&&(i=mg[e](s))),i}var AF=n=>{let{isRunning:e,preventExitTransition:t,toastRef:r,eventHandlers:i,playToast:s}=EF(n),{closeButton:o,children:a,autoClose:u,onClick:l,type:c,hideProgressBar:d,closeToast:f,transition:h,position:p,className:g,style:m,progressClassName:v,updateId:y,role:x,progress:E,rtl:b,toastId:S,deleteToast:w,isIn:T,isLoading:R,closeOnClick:_,theme:A,ariaLabel:k}=n,G=ks("Toastify__toast",`Toastify__toast-theme--${A}`,`Toastify__toast--${c}`,{"Toastify__toast--rtl":b},{"Toastify__toast--close-on-click":_}),U=hi(g)?g({rtl:b,position:p,type:c,defaultClassName:G}):ks(G,g),M=CF(n),B=!!E||!u,$={closeToast:f,type:c,theme:A},D=null;return o===!1||(hi(o)?D=o($):X.isValidElement(o)?D=X.cloneElement(o,$):D=iF($)),Qe.createElement(h,{isIn:T,done:w,position:p,preventExitTransition:t,nodeRef:r,playToast:s},Qe.createElement("div",{id:S,tabIndex:0,onClick:l,"data-in":T,className:U,...i,style:m,ref:r,...T&&{role:x,"aria-label":k}},M!=null&&Qe.createElement("div",{className:ks("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!R})},M),wT(a,n,!e),D,!n.customProgressBar&&Qe.createElement(sF,{...y&&!B?{key:`p-${y}`}:{},rtl:b,theme:A,delay:u,isRunning:e,isIn:T,closeToast:f,hide:d,type:c,className:v,controlledProgress:B,progress:E||0})))},kF=(n,e=!1)=>({enter:`Toastify--animate Toastify__${n}-enter`,exit:`Toastify--animate Toastify__${n}-exit`,appendPosition:e}),LF=rF(kF("bounce",!0)),DF={position:"top-right",transition:LF,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:n=>n.altKey&&n.code==="KeyT"};function AT(n){let e={...DF,...n},t=n.stacked,[r,i]=X.useState(!0),s=X.useRef(null),{getToastToRender:o,isToastActive:a,count:u}=xF(e),{className:l,style:c,rtl:d,containerId:f,hotKeys:h}=e;function p(m){let v=ks("Toastify__toast-container",`Toastify__toast-container--${m}`,{"Toastify__toast-container--rtl":d});return hi(l)?l({position:m,rtl:d,defaultClassName:v}):ks(v,hg(l))}function g(){t&&(i(!0),De.play())}return bF(()=>{var m;if(t){let v=s.current.querySelectorAll('[data-in="true"]'),y=12,x=(m=e.position)==null?void 0:m.includes("top"),E=0,b=0;Array.from(v).reverse().forEach((S,w)=>{let T=S;T.classList.add("Toastify__toast--stacked"),w>0&&(T.dataset.collapsed=`${r}`),T.dataset.pos||(T.dataset.pos=x?"top":"bot");let R=E*(r?.2:1)+(r?0:y*w);T.style.setProperty("--y",`${x?R:R*-1}px`),T.style.setProperty("--g",`${y}`),T.style.setProperty("--s",`${1-(r?b:0)}`),E+=T.offsetHeight,b+=.025})}},[r,u,t]),X.useEffect(()=>{function m(v){var y;let x=s.current;h(v)&&((y=x.querySelector('[tabIndex="0"]'))==null||y.focus(),i(!1),De.pause()),v.key==="Escape"&&(document.activeElement===x||x!=null&&x.contains(document.activeElement))&&(i(!0),De.play())}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[h]),Qe.createElement("section",{ref:s,className:"Toastify",id:f,onMouseEnter:()=>{t&&(i(!1),De.pause())},onMouseLeave:g,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":e["aria-label"]},o((m,v)=>{let y=v.length?{...c}:{...c,pointerEvents:"none"};return Qe.createElement("div",{tabIndex:-1,className:p(m),"data-stacked":t,style:y,key:`c-${m}`},v.map(({content:x,props:E})=>Qe.createElement(AF,{...E,stacked:t,collapseAll:g,isIn:a(E.toastId,E.containerId),key:`t-${E.key}`},x)))}))}const PF=({darkMode:n})=>{const[e,t]=X.useState("Employee"),[r,i]=X.useState({name:"",val2:"",photo:null}),s=async a=>{var c;if(a.preventDefault(),!r.photo){De.error("Please capture a photo",{position:"top-right"});return}const u={user_type:e,name:r.name,val2:r.val2},l=new FormData;l.append("file",r.photo);try{const d=await je.post("http://52.66.236.1:8000/register_user",l,{headers:{"Content-Type":"multipart/form-data"},params:u,timeout:1e4,validateStatus:f=>f>=200&&f<300});console.log("Response:",d.data),d.data&&(De.success(`${e} registered successfully!`,{position:"top-right"}),i({name:"",val2:"",photo:null}))}catch(d){console.error("Error registering:",d),je.isAxiosError(d)?d.code==="ECONNABORTED"?De.error("Connection timed out. Please try again.",{position:"top-right"}):d.response?De.error(`Registration failed: ${((c=d.response.data)==null?void 0:c.message)||"Unknown error"}`,{position:"top-right"}):De.error("Network error. Please check your connection and try again.",{position:"top-right"}):De.error("An unexpected error occurred. Please try again.",{position:"top-right"})}},o=a=>{const u=new File([a],"photo.jpg",{type:"image/jpeg"});i(l=>({...l,photo:u}))};return H.jsxs("div",{className:`max-w-md mx-auto my-5 p-6 ${n?"bg-gray-800 text-gray-100":"bg-gray-100"} rounded-xl shadow-lg transition-colors duration-200`,children:[H.jsxs("div",{className:"flex mb-6",children:[H.jsx("button",{onClick:()=>t("Employee"),className:`flex-1 py-2 px-4 text-center transition-colors ${e==="Employee"?"bg-green-600 text-white":n?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"} rounded-l-lg`,children:"Employee"}),H.jsx("button",{onClick:()=>t("Visitor"),className:`flex-1 py-2 px-4 text-center transition-colors ${e==="Visitor"?"bg-green-600 text-white":n?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-700"} rounded-r-lg`,children:"Visitor"})]}),H.jsxs("form",{onSubmit:s,className:"space-y-4",children:[H.jsxs("div",{children:[H.jsxs("label",{className:`block text-sm font-medium ${n?"text-gray-200":"text-gray-700"}`,children:[e," Name"]}),H.jsx("input",{type:"text",value:r.name,onChange:a=>i(u=>({...u,name:a.target.value})),className:`mt-1 block w-full rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 ${n?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,required:!0})]}),H.jsxs("div",{children:[H.jsx("label",{className:`block text-sm font-medium ${n?"text-gray-200":"text-gray-700"}`,children:e==="Employee"?"Department":"Purpose"}),H.jsx("input",{type:"text",value:r.val2,onChange:a=>i(u=>({...u,val2:a.target.value})),className:`mt-1 block w-full rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 ${n?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,required:!0})]}),H.jsxs("div",{children:[H.jsx("label",{className:`block text-sm font-medium mb-2 ${n?"text-gray-200":"text-gray-700"}`,children:"Photo"}),H.jsxs("div",{className:"flex items-center space-x-4",children:[H.jsx(JN,{onCapture:o,darkMode:n}),r.photo&&H.jsx("img",{src:URL.createObjectURL(r.photo),alt:"Captured",className:"w-32 h-32 rounded-lg object-cover"})]})]}),H.jsxs("button",{type:"submit",className:"w-full py-2 px-4 rounded-lg transition-colors bg-blue-600 hover:bg-blue-700 text-white",children:["Register ",e]})]}),H.jsx(AT,{})]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kT=function(n,e){return(kT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function yr(n,e){function t(){this.constructor=n}kT(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function le(n,e,t,r){return new(t||(t=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(o,a)}u((r=r.apply(n,[])).next())})}function ce(n,e){var t,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(l){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){o=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(c[0]===6&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(n,o)}catch(d){c=[6,d],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var OF=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(s){for(var o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];return NF(r,o[0],o[1]),o.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(s){var o=s.split(":"),a=o[0],u=o[1];e.urlFlags[a]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(a,u)})}},n}();function NF(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Q(){return LT}var LT=null,ed=new Map,vg=new Map;function DT(n,e){var t=OT(n,e);return ed.get(t)}function FF(n){return vg.get(n)}function Zx(n){for(var e=ed.entries(),t=[];;){var r=e.next(),i=r.done,s=r.value;if(i)break;var o=s[0],a=s[1];o.split("_")[0]===n&&t.push(a)}return t}function PT(n){var e=n.kernelName,t=n.backendName,r=OT(e,t);if(ed.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");ed.set(r,n)}function MF(n){var e=n.kernelName;vg.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),vg.set(e,n)}function OT(n,e){return e+"_"+n}function yg(n,e,t){return Math.max(n,Math.min(e,t))}function NT(n){return n%2==0?n:n+1}function BF(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function L(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Ve(n,e,t){t===void 0&&(t=""),L(Mt(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function ca(n){L(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Jo(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||Ur(n)&&!t)for(var r=0;r<n.length;++r)Jo(n[r],e,t);else e.push(n);return e}function fe(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Mt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function xt(n){return n%1==0}function UF(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function xg(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Po(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function e1(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var s=0,o=function(){if(n())r();else{s++;var a=e(s);t!=null&&s>=t?i():setTimeout(o,a)}};o()})}function $F(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var s=n.slice();return s[r]=e/t,s}function Lt(n,e){var t=e.length;return L((n=n==null?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),L(n.every(function(r){return xt(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function xs(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,s=e==null||i?null:Lt(e,n).sort(),o=0,a=0;a<n.length;++a){if(s!=null){if(s[o]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(s[o]==null||s[o]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),s[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function _u(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function td(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function GF(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function WF(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function VF(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function Ur(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function FT(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function HF(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function uv(n){return typeof n=="string"||n instanceof String}function zF(n){return typeof n=="boolean"}function jF(n){return typeof n=="number"}function Gu(n){return Array.isArray(n)?Gu(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":jF(n)?"float32":uv(n)?"string":zF(n)?"bool":"float32"}function Eg(n){return!!(n&&n.constructor&&n.call&&n.apply)}function bg(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function $r(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function MT(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Jo(n)),t&&GF(n,e),function(s,o){return s instanceof Float32Array&&o==="float32"||s instanceof Int32Array&&o==="int32"||s instanceof Uint8Array&&o==="bool"}(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function t1(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(i,s,o){var a=new Array;if(s.length===1)for(var u=s[0],l=0;l<u;l++)a[l]=o[i+l];else{u=s[0];var c=s.slice(1),d=c.reduce(function(f,h){return f*h});for(l=0;l<u;l++)a[l]=r(i+l*d,c,o)}return a}(0,n,e)}function BT(n,e){for(var t=Wu(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Wu(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Ar(){return Q().platform.now()}function UT(n){n.forEach(function(e){L(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function KF(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Q().platform.encode(n,e)}function nd(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Q().platform.decode(n,e)}function n1(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function qF(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var YF=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new XF)}return n.prototype.profileKernel=function(e,t,r){var i,s=this,o=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(u){(function(l,c,d){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var h=l[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,a.dtype,e),o.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),s.logger.logKernelProfile(e,a,u,l.kernelMs,t,c)})})}),i},n}(),XF=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,s,o){var a=typeof i=="number"?Po(i+"ms",9):i.error,u=Po(e,25),l=t.rank,c=t.size,d=Po(t.shape.toString(),14),f="";for(var h in s){var p=s[h].shape||t.shape,g=p.length;f+=h+": "+g+"D "+(g>0?p:"")+" "}console.log("%c"+u+"	%c"+a+"	%c"+l+"D "+d+"	%c"+c+"	%c"+f+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),r1=20,Sa=3,Eh=7;function QF(n,e,t,r){var i=$r(e),s=function(l,c,d,f){var h=fe(c),p=f[f.length-1],g=new Array(p).fill(0),m=c.length,v=d==="complex64"?Ta(l):l;if(m>1)for(var y=0;y<h/p;y++)for(var x=y*p,E=0;E<p;E++)g[E]=Math.max(g[E],wa(v[x+E],0,d).length);return g}(n,e,t,i),o=e.length,a=function l(c,d,f,h,p,g){g===void 0&&(g=!0);var m=f==="complex64"?2:1,v=d[0],y=d.length;if(y===0)return f==="complex64"?[wa(Ta(c)[0],0,f)]:f==="bool"?[$T(c[0])]:[c[0].toString()];if(y===1){if(v>r1){var x=Sa*m,E=Array.from(c.slice(0,x)),b=Array.from(c.slice((v-Sa)*m,v*m));return f==="complex64"&&(E=Ta(E),b=Ta(b)),["["+E.map(function(M,B){return wa(M,p[B],f)}).join(", ")+", ..., "+b.map(function(M,B){return wa(M,p[v-Sa+B],f)}).join(", ")+"]"]}return["["+(f==="complex64"?Ta(c):Array.from(c)).map(function(M,B){return wa(M,p[B],f)}).join(", ")+"]"]}var S=d.slice(1),w=h.slice(1),T=h[0]*m,R=[];if(v>r1){for(var _=0;_<Sa;_++){var A=(k=_*T)+T;R.push.apply(R,l(c.slice(k,A),S,f,w,p,!1))}for(R.push("..."),_=v-Sa;_<v;_++)A=(k=_*T)+T,R.push.apply(R,l(c.slice(k,A),S,f,w,p,_===v-1))}else for(_=0;_<v;_++){var k;A=(k=_*T)+T,R.push.apply(R,l(c.slice(k,A),S,f,w,p,_===v-1))}var G=y===2?",":"";for(R[0]="["+R[0]+G,_=1;_<R.length-1;_++)R[_]=" "+R[_]+G;var U=`,
`;for(_=2;_<y;_++)U+=`
`;return R[R.length-1]=" "+R[R.length-1]+"]"+(g?"":U),R}(n,e,t,i,s),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(a.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function wa(n,e,t){return Po(Array.isArray(n)?parseFloat(n[0].toFixed(Eh))+" + "+parseFloat(n[1].toFixed(Eh))+"j":uv(n)?"'"+n+"'":t==="bool"?$T(n):parseFloat(n.toFixed(Eh)).toString(),e)}function $T(n){return n===0?"false":"true"}function Ta(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var Iu=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=fe(e),r!=null){var s=r.length;L(s===this.size,function(){return"Length of values '"+s+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||td(t,this.size),this.strides=$r(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),L(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var s=this.locToIndex(r);this.values[s]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,s=e;i<s.length;i++){var o=s[i];if(o<0||o>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Lr().makeTensor(this.values,this.shape,this.dtype)},n}(),Lr=null,j=null,GT=null,lt=function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=fe(e),this.strides=$r(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),L(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,s){return this.throwIfDisposed(),this.reshape([e,t,r,i,s])},n.prototype.asType=function(e){return this.throwIfDisposed(),j.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return le(this,void 0,void 0,function(){var e;return ce(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,j.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return j.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return le(this,void 0,void 0,function(){var e;return ce(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,t1(this.shape,e)]}})})},n.prototype.arraySync=function(){return t1(this.shape,this.dataSync())},n.prototype.data=function(){return le(this,void 0,void 0,function(){var e,t;return ce(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Lr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(i){return nd(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=Lr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return nd(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return le(this,void 0,void 0,function(){var e;return ce(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Lr().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(Lr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),j.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),j.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),j.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),j.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),j.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),j.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),j.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),QF(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),j.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),j.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),j.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),j.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),j.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),j.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),j.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),j.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),j.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),j.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),j.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),j.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,s){return r===void 0&&(r=.001),GT("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,s,i,r)},n.prototype.batchNorm=function(e,t,r,i,s){return s===void 0&&(s=.001),this.throwIfDisposed(),j.batchNorm(this,e,t,r,i,s)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),j.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),j.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),j.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),j.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),j.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),j.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),j.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),j.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),j.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),j.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),j.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),j.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),j.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),j.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),j.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),j.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),j.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),j.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),j.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),j.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),j.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),j.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),j.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),j.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),j.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),j.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),j.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),j.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),j.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),j.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),j.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),j.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),j.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),j.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),j.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),j.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),j.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),j.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),j.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),j.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),j.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),j.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),j.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),j.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),j.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),j.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),j.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),j.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),j.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),j.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),j.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),j.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),j.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),j.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),j.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),j.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),j.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),j.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),j.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),j.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),j.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),j.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),j.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),j.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),j.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),j.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),j.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),j.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),j.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),j.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),j.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),j.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),j.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),j.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),j.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),j.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),j.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),j.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),j.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),j.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),j.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),j.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),j.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),j.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),j.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),j.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),j.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),j.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),j.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,s,o){return i===void 0&&(i="NWC"),s===void 0&&(s=1),this.throwIfDisposed(),j.conv1d(this,e,t,r,i,s,o)},n.prototype.conv2d=function(e,t,r,i,s,o){return i===void 0&&(i="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),j.conv2d(this,e,t,r,i,s,o)},n.prototype.conv2dTranspose=function(e,t,r,i,s){return this.throwIfDisposed(),j.conv2dTranspose(this,e,t,r,i,s)},n.prototype.depthwiseConv2D=function(e,t,r,i,s,o){return i===void 0&&(i="NHWC"),s===void 0&&(s=[1,1]),this.throwIfDisposed(),j.depthwiseConv2d(this,e,t,r,i,s,o)},n.prototype.separableConv2d=function(e,t,r,i,s,o){return s===void 0&&(s=[1,1]),o===void 0&&(o="NHWC"),this.throwIfDisposed(),j.separableConv2d(this,e,t,r,i,s,o)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),j.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),j.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),j.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,s){return this.throwIfDisposed(),j.pool(this,e,t,r,i,s)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Lr().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),j.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),j.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),j.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),j.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,s,o,a,u){return i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=0),a===void 0&&(a=0),u===void 0&&(u=0),this.throwIfDisposed(),j.stridedSlice(this,e,t,r,i,s,o,a,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),j.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),j.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),j.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),j.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),j.spectral.irfft(this)},n}();Object.defineProperty(lt,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var i1,Sg,wg,Tg,_g,Zo=function(n){function e(t,r,i,s){var o=n.call(this,t.shape,t.dtype,t.dataId,s)||this;return o.trainable=r,o.name=i,o}return yr(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Mt(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Lr().disposeTensor(this),this.dataId=t.dataId,Lr().incRef(this,null)},e.prototype.dispose=function(){Lr().disposeVariable(this),this.isDisposedInternal=!0},e}(lt);Object.defineProperty(Zo,Symbol.hasInstance,{value:function(n){return n instanceof lt&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(i1||(i1={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(Sg||(Sg={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(wg||(wg={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(Tg||(Tg={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(_g||(_g={}));var JF={float32:Tg,int32:Sg,bool:wg,complex64:_g};function Gt(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return JF[n][e]}function bh(n){return Gt(n,"int32")}function pt(n,e){if(n.dtype===e.dtype)return[n,e];var t=Gt(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function ZF(n,e){L(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function WT(n){var e=[];return function t(r,i,s){if(r!=null){if(r instanceof lt)return void i.push(r);if(o=r,!(!Array.isArray(o)&&typeof o!="object")){var o,a=r;for(var u in a){var l=a[u];s.has(l)||(s.add(l),t(l,i,s))}}}}(n,e,new Set),e}var Sh,s1=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),eM=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new s1}return n.prototype.ready=function(){return le(this,void 0,void 0,function(){var e,t,r;return ce(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return le(this,void 0,void 0,function(){var t,r,i;return ce(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=s.sent(),[3,3];case 2:i=r,s.label=3;case 3:if(!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new YF(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;Zx(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;Zx(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var s=++this.pendingBackendInitId,o=i.then(function(a){return!(s<t.pendingBackendInitId)&&(t.registry[e]=a,t.pendingBackendInit=null,!0)}).catch(function(a){return!(s<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),s=i.success,o=i.asyncInit;if(o||s)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,s=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,s,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}return this.scopedRun(function(){return i.startScope(s)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(s){throw t(),s}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},n.prototype.runKernel=function(e,t,r,i,s){return this.runKernelFunc(null,t,null,e,r,i,s)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),s=0;r.forEach(function(u){s+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-t-s-o;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,s,o,a){var u,l=this;o===void 0&&(o=[]),a===void 0&&(a=[]);var c=[],d=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var f,h=function(y){d&&(c=y.map(function(x){return l.keep(l.clone(x))}))},p=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=DT(i,this.backendName);return f=v!=null?function(){var y=l.backend.numDataIds();m=v.kernelFunc({inputs:t,attrs:s,backend:l.backend});var x=Array.isArray(m)?m:[m];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,y,x);var E=x.map(function(S){var w=S.dataId,T=S.shape,R=S.dtype;return l.makeTensorFromDataId(w,T,R)}),b=E.filter(function(S,w){return a[w]});return h((o||[]).slice().concat(b)),E}:function(){var y=l.backend.numDataIds();m=l.tidy(function(){return e(l.backend,h)});var x=Array.isArray(m)?m:[m];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,y,x),x},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,t,function(){return f()}):f()}),d&&this.addTapeNode(i,t,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(y){return t[y].shape}),outputShapes:u.map(function(y){return y.shape})}),Array.isArray(m)?u:u[0]},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var s=e;r==="string"&&uv(e[0])&&(s=e.map(function(c){return KF(c)}));var o=i.write(s,t,r),a=new lt(t,r,o,this.nextTensorId());if(this.incRef(a,i),r==="string"){var u=this.state.tensorInfo.get(o),l=HF(s);this.state.numBytes+=l-u.bytes,u.bytes=l}return a},n.prototype.makeTensorFromDataId=function(e,t,r,i){var s=new lt(t,r=r||"float32",e,this.nextTensorId());return this.incRef(s,i),s},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var s=new Zo(e,t,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error("Variable with name "+s.name+" was already registered");return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*FT(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Zo||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return le(this,void 0,void 0,function(){var t,r;return ce(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(s){return s.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,s){var o=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:s},u=FF(e);u!=null&&(i=u.gradFunc),i!=null&&(a.gradient=function(l){return l=l.map(function(c,d){if(c==null){var f=r[d],h=Wu(f.size,f.dtype);return o.makeTensor(h,f.shape,f.dtype)}return c}),i(l.length>1?l:l[0],s)}),this.state.activeTape.push(a)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=WT(e),i=new Set(r.map(function(u){return u.id})),s=0;s<this.state.activeScope.track.length;s++){var o=this.state.activeScope.track[s];o.kept||i.has(o.id)||o.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var s=this;if(i===void 0&&(i=!1),L(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var o=this.scopedRun(function(){return s.startTape()},function(){return s.endTape()},function(){return s.tidy("forward",e)});L(o instanceof lt,function(){return"The result y returned by f() must be a tensor."});var a=function(u,l,c){for(var d={},f={},h=0;h<l.length;h++)d[l[h].id]=!0;for(h=0;h<u.length;h++){var p=(S=u[h]).inputs;for(var g in p){for(var m=p[g],v=!1,y=0;y<l.length;y++)if(d[m.id]){S.outputs.forEach(function(_){return d[_.id]=!0}),v=!0,f[S.id]=!0;break}if(v)break}}var x={};x[c.id]=!0;var E={};for(h=u.length-1;h>=0;h--)for(p=(S=u[h]).inputs,y=0;y<S.outputs.length;y++)if(x[S.outputs[y].id]){for(var g in p)x[p[g].id]=!0,E[S.id]=!0;break}var b=[];for(h=0;h<u.length;h++){var S;if(f[(S=u[h]).id]&&E[S.id]){var w={};for(var g in S.inputs){var T=S.inputs[g];d[T.id]&&(w[g]=T)}var R=Object.assign({},S);R.inputs=w,R.outputs=S.outputs,b.push(R)}}return b}(this.state.activeTape,t,o);if(!i&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[o.id]=r??(u=o.shape,l=BT(fe(u),"float32"),F.makeTensor(l,u,"float32")),function(f,h,p){for(var g=function(v){var y=h[v],x=[];if(y.outputs.forEach(function(w){var T=f[w.id];T!=null?x.push(T):x.push(null)}),y.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var E=y.gradient(x),b=function(w){if(!(w in E))throw new Error("Cannot backprop through input "+w+". Available gradients found: "+Object.keys(E)+".");var T=p(function(){return E[w]()});if(T.dtype!=="float32")throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+w+" must have 'float32' dtype, but has '"+T.dtype+"'");var R=y.inputs[w];if(!Mt(T.shape,R.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+w+"' has shape '"+T.shape+"', which does not match the shape of the input '"+R.shape+"'");if(f[R.id]==null)f[R.id]=T;else{var _=f[R.id];f[R.id]=_.add(T),_.dispose()}};for(var S in y.inputs)b(S)},m=h.length-1;m>=0;m--)g(m)}(c,a,function(f){return s.tidy(f)});var d=t.map(function(f){return c[f.id]});return s.state.gradientDepth===0&&(s.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),s.state.activeTape=null),{value:o,grads:d}})},n.prototype.customGrad=function(e){var t=this;return L(Eg(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];L(i.every(function(a){return a instanceof lt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return i.forEach(function(a,u){o[u]=a}),t.runKernelFunc(function(a,u){return L((r=e.apply(void 0,i.concat([u]))).value instanceof lt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),L(Eg(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},o,function(a,u){var l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];L(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),L(c.every(function(f){return f instanceof lt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return c.forEach(function(f,h){d[h]=function(){return f}}),d})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return le(this,void 0,void 0,function(){var t,r;return ce(this,function(i){switch(i.label){case 0:return t=Ar(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Ar()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new s1,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),F=function(){var n=function(){if(Sh==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Sh=t}return Sh}();if(n._tfengine==null){var e=new OF(n);n._tfengine=new eM(e)}return function(t){LT=t}(n._tfengine.ENV),Lr=function(){return n._tfengine},n._tfengine}();function VT(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Jr=Q();Jr.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Jr.registerFlag("IS_BROWSER",function(){return VT()}),Jr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Jr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Jr.registerFlag("PROD",function(){return!1}),Jr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Jr.getBool("DEBUG")}),Jr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Jr.registerFlag("IS_TEST",function(){return!1});var Ru,kn,Cn,vs={},wh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function tM(n,e){vs[n]=e}function Hr(n){n in vs||(vs[n]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete vs[t]},!1),t===1?r.getContext("webgl",wh)||r.getContext("experimental-webgl",wh):r.getContext("webgl2",wh)}(n));var e=vs[n];return e.isContextLost()?(delete vs[n],Hr(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),vs[n])}function Zd(n,e){return[e,n]}function Ka(n){var e=fe(n);return xg(Math.ceil(e/4))}function Vu(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function lv(n,e){var t,r,i,s,o,a,u,l,c,d=n;return Q().getNumber("WEBGL_VERSION")===2?(t=d.R32F,r=d.R16F,i=d.RGBA16F,s=d.RGBA32F,o=d.RED,a=4,u=1,l=d.HALF_FLOAT,c=d.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,s=d.RGBA,o=n.RGBA,a=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:o,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function he(n,e,t){var r=t();return e&&function(i){var s=i.getError();if(s!==i.NO_ERROR)throw new Error("WebGL Error: "+sM(i,s))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Ru||(Ru={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(kn||(kn={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Cn||(Cn={}));var nM=596e-10,rM=65504;function iM(n){return!!(Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||nM<Math.abs(n)&&Math.abs(n)<rM)}function sM(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Al(n,e,t){return yi(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function oM(n,e,t){var r=yi(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(he(n,e,function(){return n.shaderSource(r,t)}),he(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function aM(n,e,t){var r=yi(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(he(n,e,function(){return n.shaderSource(r,t)}),he(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(i,s){var o=uM.exec(s);if(o==null)return console.log("Couldn't parse line number in error: "+s),void console.log(i);for(var a=+o[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(m,v){return Po((v+1).toString(),l)+m}),d=0,f=0;f<c.length;f++)d=Math.max(c[f].length,d);var h=c.slice(0,a-1),p=c.slice(a-1,a),g=c.slice(a);console.log(h.join(`
`)),console.log(s.split(`
`)[0]),console.log("%c "+Po(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join(`
`))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Th,_h,uM=/ERROR: [0-9]+:([0-9]+):/g;function lM(n,e){return yi(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function cM(n,e,t){if(he(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Ih(n,e,t){if(he(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function dM(n,e,t){var r=yi(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return he(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),he(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function fM(n,e,t){var r=yi(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return he(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),he(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function hM(n,e){return yi(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function pM(n,e){var t=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function gM(n,e){return yi(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function o1(n,e,t,r,i,s,o,a){var u=n.getAttribLocation(t,r);return u!==-1&&(he(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),he(n,e,function(){return n.vertexAttribPointer(u,s,n.FLOAT,!1,o,a)}),he(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function mM(n,e,t,r){bM(n,r),he(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),he(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function vM(n,e,t,r){return yi(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function yM(n,e,t){return n.getUniformLocation(e,t)}function xM(n,e,t,r,i,s){he(n,e,function(){return mM(n,e,r,s)}),he(n,e,function(){return n.uniform1i(i,s)})}function Rh(n,e,t,r){he(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),he(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function a1(n,e,t){he(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),he(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function kl(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+EM(n,e))}function EM(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function yi(n,e,t,r){var i=he(n,e,function(){return t()});if(i==null)throw new Error(r);return i}function bM(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function rd(n,e){return e===void 0&&(e=2),fe(n.slice(0,n.length-e))}function id(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Ch(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[rd(n)].concat(id(n))),e}function SM(n,e){var t;e===void 0&&(e=!1);var r=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?NT(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var i=xs(n);n=i.newShape}var s=fe(n);if(n.length<=1&&s<=r)return[1,s];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var o=rd(n),a=2,u=2;return n.length&&(a=(t=id(n))[0],u=t[1]),xg(s=o*(a/2)*(u/2)).map(function(l){return 2*l})}return xg(s)}function Ll(n){return n%2==0}function Dl(n,e){if(Mt(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Ll(t)&&Ll(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Ll(n[0])&&Ll(e[0])}function wM(n){if(Th==null){var e=Hr(n);Th=e.getParameter(e.MAX_TEXTURE_SIZE)}return Th}function TM(n){if(_h==null){var e=Hr(n);_h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,_h)}function _M(n){if(n===0)return 0;var e=Hr(n);return Qn(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Qn(e,"EXT_disjoint_timer_query")?1:0}function Qn(n,e){return n.getExtension(e)!=null}function u1(n){try{if(Hr(n)!=null)return!0}catch{return!1}return!1}function IM(n){if(n===0)return!1;var e=Hr(n);if(n===1){if(!Qn(e,"OES_texture_float"))return!1}else if(!Qn(e,"EXT_color_buffer_float"))return!1;return Ig(e)}function RM(n){if(n===0)return!1;var e=Hr(n);if(n!==1){if(Qn(e,"EXT_color_buffer_float"))return Ig(e);if(Qn(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var s=lv(r,i),o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,s.internalFormatHalfFloat,1,1,0,s.textureFormatFloat,s.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(o),r.deleteFramebuffer(a),u}(e,t)}return!1}return!!Qn(e,"OES_texture_float")&&!!Qn(e,"WEBGL_color_buffer_float")&&Ig(e)}function Ig(n){var e=lv(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function CM(n){return n===2&&Hr(n).fenceSync!=null}var be=Q();function HT(n){Q().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ae(n,e){return F.tidy(n,e)}function Sn(n){WT(n).forEach(function(e){return e.dispose()})}function AM(n){return F.keep(n)}function sd(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Q().getBool("IS_TEST")||console.warn.apply(console,n)}function us(n,e){var t=n;if(Ur(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||Ur(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&Q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(s,o,a){if(a=a||[],!Array.isArray(s)&&!Ur(s))return void L(o.length===0,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});L(o.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+s.length+" elements"}),L(s.length===o[0],function(){return"Element arr["+a.join("][")+"] should have "+o[0]+" elements, but has "+s.length+" elements"});for(var u=o.slice(1),l=0;l<s.length;++l)i(s[l],u,a.concat(l))}(n,r,[]),r}function l1(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function C(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof lt)return l1(r,n.dtype,e,t),n;var i=Gu(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),l1(r,i,e,t),n==null||!Ur(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var s=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+s+"'")}var o=us(n,i);Ur(n)||Array.isArray(n)||(n=[n]);var a=i!=="string"?MT(n,i,Q().getBool("DEBUG")):Jo(n,[],!0);return F.makeTensor(a,o,i)}function od(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,s){return C(i,e+"["+s+"]",t)},r)}function zT(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function kM(n,e,t){for(var r=n.length+e.length,i=[],s=0,o=0,a=0;a<r;a++)t.indexOf(a)===-1?i.push(n[s++]):i.push(e[o++]);return i}function Qt(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map(function(s){return n[s]})]}function wn(n,e){return kM(n,e.map(function(t){return 1}),e)}function In(n,e,t){L(zT(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function zr(n,e){if(zT(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function cv(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function jr(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function LM(n,e){var t=n[0].length;n.forEach(function(i,s){L(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+s+"] must be the same as the rank of the rest ("+t+")"})}),L(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,s){for(var o=0;o<t;o++)L(o===e||i[o]===r[o],function(){return"Error in concat"+t+"D: Shape of tensors["+s+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+s+"."})})}function ea(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function N(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];F.startScope(t);try{var a=r.apply(void 0,s);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),F.endScope(a),a}catch(u){throw F.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}be.registerFlag("HAS_WEBGL",function(){return be.getNumber("WEBGL_VERSION")>0}),be.registerFlag("WEBGL_VERSION",function(){return u1(2)?2:u1(1)?1:0}),be.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return be.get("WEBGL_VERSION")===2}),be.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),be.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),be.registerFlag("WEBGL_PACK",function(){return be.getBool("HAS_WEBGL")}),be.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_CLIP",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_REDUCE",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_LAZILY_UNPACK",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_CONV_IM2COL",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return wM(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return TM(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=be.getNumber("WEBGL_VERSION");return n===0?0:_M(n)}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),be.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return IM(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!be.getBool("WEBGL_FORCE_F16_TEXTURES")&&be.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return RM(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return CM(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),GT=HT;var $t=N({complex_:function(n,e){var t=C(n,"real","complex"),r=C(e,"imag","complex");return Ve(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),F.runKernelFunc(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),Yn=N({real_:function(n){var e=C(n,"input","real");return F.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),Dr=N({imag_:function(n){var e=C(n,"input","imag");return F.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Wt(n,e,t){return ls(n,e,us(n,t),t)}function ls(n,e,t,r){if(r==null&&(r=Gu(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ur(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){UT(e);var i=fe(e),s=fe(t);L(i===s,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+s});for(var o=0;o<t.length;++o){var a=t[o],u=o!==t.length-1||a!==fe(e.slice(o));L(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return Ur(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?MT(n,r,Q().getBool("DEBUG")):Jo(n,[],!0),F.makeTensor(n,e,r)}function re(n,e){if((Ur(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ur(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ls(n,[],[],e)}function bt(n,e){ca(n);var t=us(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ls(n,null,t,e)}function Yi(n,e,t){if(ca(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=us(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ls(n,e,r,t)}function dv(n,e,t){if(ca(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=us(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ls(n,e,r,t)}function gn(n,e,t){if(ca(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=us(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ls(n,e,r,t)}function DM(n,e,t){if(ca(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=us(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ls(n,e,r,t)}function PM(n,e,t){if(ca(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=us(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ls(n,e=e||r,r,t)}function OM(n,e,t,r){return e===void 0&&(e=!0),F.makeVariable(n,e,t,r)}function da(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=da(n,"float32"),r=et(n,"float32");return $t(t,r)}var i=BT(fe(n),e);return F.makeTensor(i,n,e)}function et(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=et(n,"float32"),r=et(n,"float32");return $t(t,r)}var i=Wu(fe(n),e);return F.makeTensor(i,n,e)}function Gr(n,e,t){return F.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function NM(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return F.runKernelFunc(function(r){return r.linspace(n,e,t)},{})}function ad(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return et([0],r);var i=Wu(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var s=1;s<i.length;s++)i[s]=i[s-1]+t;return bt(i,r)}var jT=N({onesLike_:function(n){var e=C(n,"x","onesLike");if(e.dtype==="complex64"){var t=jT(Yn(e)),r=Me(Dr(e));return $t(t,r)}return F.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,s){return{$x:function(){return Me(i)}}})}}),Me=N({zerosLike_:function(n){var e=C(n,"x","zerosLike");return F.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return Me(t)}}})}}),Rt=N({concat_:function(n,e){e===void 0&&(e=0),L(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=od(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")}),e=Lt(e,t[0].shape)[0];var r=ea(t.map(function(a){return a.shape}),e);if(fe(r)===0)return Wt([],r);if((t=t.filter(function(a){return a.size>0})).length===1)return t[0];var i=t.map(function(a){return a.shape});LM(i,e);var s=t,o={axis:e};return F.runKernelFunc(function(a){return a.concat(t,e)},s,function(a){var u=i.map(function(l){return l[e]});return fv(a,u,e).map(function(l){return function(){return l}})},"Concat",o)}}),FM=N({concat1d_:function(n){return Rt(n,0)}}),MM=N({concat2d_:function(n,e){return Rt(n,e)}}),BM=N({concat3d_:function(n,e){return Rt(n,e)}}),UM=N({concat4d_:function(n,e){return Rt(n,e)}}),fv=N({split_:function(n,e,t){t===void 0&&(t=0);var r,i=C(n,"x","split");return t=Lt(t,i.shape)[0],typeof e=="number"?(L(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(L(i.shape[t]===e.reduce(function(s,o){return s+o}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),F.runKernelFunc(function(s){return s.split(i,r,t)},{$x:i},function(s){return{$x:function(){return Rt(s,t)}}})}});function Hs(n,e){return n(e={exports:{}},e.exports),e.exports}var $M=Hs(function(n){(function(e,t,r){function i(a){var u,l=this,c=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var d=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=0|d)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function s(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function o(a,u){var l=new i(a),c=u&&u.state,d=l.next;return d.int32=function(){return 4294967296*l.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&(typeof c=="object"&&s(c,l),d.state=function(){return s(l,{})}),d}t&&t.exports?t.exports=o:this.alea=o})(0,n)}),GM=Hs(function(n){(function(e,t,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function o(a,u){var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&s(c,l),d.state=function(){return s(l,{})}),d}t&&t.exports?t.exports=o:this.xor128=o})(0,n)}),WM=Hs(function(n){(function(e,t,r){function i(a){var u=this,l="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&s(c,l),d.state=function(){return s(l,{})}),d}t&&t.exports?t.exports=o:this.xorwow=o})(0,n)}),VM=Hs(function(n){(function(e,t,r){function i(a){var u=this;u.next=function(){var l,c,d=u.x,f=u.i;return l=d[f],c=(l^=l>>>7)^l<<24,c^=(l=d[f+1&7])^l>>>10,c^=(l=d[f+3&7])^l>>>3,c^=(l=d[f+4&7])^l<<7,l=d[f+7&7],c^=(l^=l<<13)^l<<9,d[f]=c,u.i=f+1&7,c},function(l,c){var d,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,d=0;d<c.length;++d)f[7&d]=f[7&d]<<15^c.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],l.x=f,l.i=0,d=256;d>0;--d)l.next()}(u,a)}function s(a,u){return u.x=a.x.slice(),u.i=a.i,u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(c.x&&s(c,l),d.state=function(){return s(l,{})}),d}t&&t.exports?t.exports=o:this.xorshift7=o})(0,n)}),HM=Hs(function(n){(function(e,t,r){function i(a){var u=this;u.next=function(){var l,c,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,c=f[h+34&127],l=f[h=h+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[h]=c^l,u.i=h,c+(d^d>>>16)|0},function(l,c){var d,f,h,p,g,m=[],v=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,v=Math.max(v,c.length)),h=0,p=-32;p<v;++p)c&&(f^=c.charCodeAt((p+32)%c.length)),p===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(g=g+1640531527|0,h=(d=m[127&p]^=f+g)==0?h+1:0);for(h>=128&&(m[127&(c&&c.length||0)]=-1),h=127,p=512;p>0;--p)f=m[h+34&127],d=m[h=h+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,m[h]=f^d;l.w=g,l.X=m,l.i=h}(u,a)}function s(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(c.X&&s(c,l),d.state=function(){return s(l,{})}),d}t&&t.exports?t.exports=o:this.xor4096=o})(0,n)}),zM=Hs(function(n){(function(e,t,r){function i(a){var u=this,l="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):l+=a;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function s(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&s(c,l),d.state=function(){return s(l,{})}),d}t&&t.exports?t.exports=o:this.tychei=o})(0,n)}),ys=Hs(function(n){(function(e,t){var r,i=this,s=256,o=6,a="random",u=t.pow(s,o),l=t.pow(2,52),c=2*l,d=s-1;function f(v,y,x){var E=[],b=g(function T(R,_){var A,k=[],G=typeof R;if(_&&G=="object")for(A in R)try{k.push(T(R[A],_-1))}catch{}return k.length?k:G=="string"?R:R+"\0"}((y=y==1?{entropy:!0}:y||{}).entropy?[v,m(e)]:v??function(){try{var T;return r&&(T=r.randomBytes)?T=T(s):(T=new Uint8Array(s),(i.crypto||i.msCrypto).getRandomValues(T)),m(T)}catch{var R=i.navigator,_=R&&R.plugins;return[+new Date,i,_,i.screen,m(e)]}}(),3),E),S=new h(E),w=function(){for(var T=S.g(o),R=u,_=0;T<l;)T=(T+_)*s,R*=s,_=S.g(1);for(;T>=c;)T/=2,R/=2,_>>>=1;return(T+_)/R};return w.int32=function(){return 0|S.g(4)},w.quick=function(){return S.g(4)/4294967296},w.double=w,g(m(S.S),e),(y.pass||x||function(T,R,_,A){return A&&(A.S&&p(A,S),T.state=function(){return p(S,{})}),_?(t[a]=T,R):T})(w,b,"global"in y?y.global:this==t,y.state)}function h(v){var y,x=v.length,E=this,b=0,S=E.i=E.j=0,w=E.S=[];for(x||(v=[x++]);b<s;)w[b]=b++;for(b=0;b<s;b++)w[b]=w[S=d&S+v[b%x]+(y=w[b])],w[S]=y;(E.g=function(T){for(var R,_=0,A=E.i,k=E.j,G=E.S;T--;)R=G[A=d&A+1],_=_*s+G[d&(G[A]=G[k=d&k+R])+(G[k]=R)];return E.i=A,E.j=k,_})(s)}function p(v,y){return y.i=v.i,y.j=v.j,y.S=v.S.slice(),y}function g(v,y){for(var x,E=v+"",b=0;b<E.length;)y[d&b]=d&(x^=19*y[d&b])+E.charCodeAt(b++);return m(y)}function m(v){return String.fromCharCode.apply(0,v)}if(t["seed"+a]=f,g(t.random(),e),n.exports){n.exports=f;try{r=require("crypto")}catch{}}})([],Math)});ys.alea=$M,ys.xor128=GM,ys.xorwow=WM,ys.xorshift7=VM,ys.xor4096=HM,ys.tychei=zM;var ef=ys.alea,hv=function(){function n(e,t,r,i,s){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=s||Math.random();this.random=ef(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var s=void 0,o=void 0,a=void 0;do a=(s=2*this.random()-1)*s+(o=2*this.random()-1)*o;while(a>=1||a===0);var u=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*s*u,r=this.mean+this.stdDev*o*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),jM=function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var s=i||Math.random();this.randu=ef(s.toString()),this.randn=new hv(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,s,o;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-o+Math.log(o)),(s=this.randu())<t||Math.log(s)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),KM=function(){function n(e,t,r,i){var s=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return s.dtype==null||s.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=ef(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function we(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",UT(n),new Iu(n,e,t)}function qM(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var KT=N({batchToSpaceND_:function(n,e,t){var r=C(n,"x","batchToSpaceND"),i=e.reduce(function(s,o){return s*o});return L(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),L(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),L(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),F.runKernelFunc(function(s){return s.batchToSpaceND(r,e,t)},{$x:r},function(s){return{$x:function(){return s.spaceToBatchND(e,t)}}})}}),YM=N({broadcastTo_:function(n,e){var t=C(n,"broadcastTo","x"),r=t.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var s=Array.from(e),o=e.length-1;o>=0;o--)if(t.shape[o]===e[o])s[o]=1;else if(t.shape[o]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=s.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return a.length===0?t.clone():F.runKernelFunc(function(u){return u.tile(t,s)},{input:t},function(u){return{input:function(){return u.sum(a,!0)}}})}}),XM=N({cast_:function(n,e){var t=C(n,"x","cast");if(!WF(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return F.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),QM=N({clone_:function(n){var e=C(n,"x","clone",null);return F.runKernelFunc(function(){return F.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),JM=N({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=C(n,"x","cumsum"),s=zr([e|=0],i.rank),o=i;s!=null&&(o=i.transpose(s));var a=jr(1,i.rank)[0],u=F.runKernelFunc(function(l){return l.cumsum(o,a,t,r)},{permutedX:o},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return s!=null&&(u=u.transpose(s)),u}}),ZM=N({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=C(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],s=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];return L(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),L(s*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+s+" and "+e+` for depthToSpace with input shape
          `+r.shape}),L(o%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+r.shape}),F.runKernelFunc(function(a){return a.depthToSpace(r,e,t)},{$x:r})}}),qn=N({expandDims_:function(n,e){e===void 0&&(e=0);var t=C(n,"x","expandDims",null);L(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(L(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),fr(t,r)}}),qT=N({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=we([n,e],r),s=n<=e?n:e,o=0;o<s;++o)i.set(1,o,o);var a=i.toTensor().as2D(n,e);if(t==null)return a;if(t.length===1)return Oo(qn(a,0),[t[0],1,1]);if(t.length===2)return Oo(qn(qn(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return Oo(qn(qn(qn(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),eB=N({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=C(n,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+s+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var a=o===1?i.as2D(1,-1):i,u=F.runKernelFunc(function(l){return l.multinomial(a,r,e,t)},{logits2D:a});return o===1?u.as1D():u}}),Rg=N({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=C(n,"indices","oneHot","int32"),s=i.shape.concat([e]);return i=i.flatten(),F.runKernelFunc(function(o){return o.oneHot(i,e,t,r)},{$indices:i},function(o){return{$indices:function(){return et(i.shape,"float32")}}}).reshape(s)}}),zs=N({pad_:function(n,e,t){t===void 0&&(t=0);var r=C(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t};return F.runKernelFunc(function(s){return s.pad(r,e,t)},{x:r},function(s){var o=e.map(function(a){return a[0]});return{x:function(){return s.slice(o,r.shape)}}},"PadV2",i)}}),tB=N({pad1d_:function(n,e,t){return t===void 0&&(t=0),L(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),zs(n,[e],t)}}),nB=N({pad2d_:function(n,e,t){return t===void 0&&(t=0),L(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),zs(n,e,t)}}),rB=N({pad3d_:function(n,e,t){return t===void 0&&(t=0),L(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),zs(n,e,t)}}),iB=N({pad4d_:function(n,e,t){return t===void 0&&(t=0),L(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),zs(n,e,t)}}),sB=N({rand_:function(n,e,t){var r=fe(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var s=0;s<r;s++)i[s]=e();return F.makeTensor(i,n,t)}}),oB=N({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new hv(e,t,r,!1,i),o=we(n,r),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),aB=N({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var s=new jM(e,t,r,i),o=we(n,r),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),YT=N({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var s=we(n,r),o=new KM(e,t,null,i),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),fr=N({reshape_:function(n,e){var t=C(n,"x","reshape",null);e=$F(e,t.size),L(t.size===fe(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return F.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",r)}}),XT=N({spaceToBatchND_:function(n,e,t){var r=C(n,"x","spaceToBatchND");return L(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),L(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),L(r.shape.reduce(function(i,s,o){return o>0&&o<=e.length?i&&(s+t[o-1][0]+t[o-1][1])%e[o-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),F.runKernelFunc(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),QT=N({squeeze_:function(n,e){var t=C(n,"x","squeeze");return fr(t,xs(t.shape,e).newShape)}}),Mn=N({stack_:function(n,e){e===void 0&&(e=0);var t=od(n,"tensors","stack");if(L(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,s=t[0].dtype;L(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(a){Ve(i,a.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(a){L(s===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var o=t.map(function(a){return a.expandDims(e)});return Rt(o,e)}}),Oo=N({tile_:function(n,e){var t=C(n,"x","tile",null);L(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var r=[t],i={reps:e};return F.runKernelFunc(function(s,o){var a=s.tile(t,e);return o([t]),a},{x:t},function(s,o){var a=o[0];return{x:function(){var u=Me(a);if(a.rank===1)for(var l=0;l<e[0];++l)u=u.add(s.slice([l*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(l=0;l<e[0];++l)for(var c=0;c<e[1];++c)u=u.add(s.slice([l*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(var d=0;d<e[2];++d)u=u.add(s.slice([l*a.shape[0],c*a.shape[1],d*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(d=0;d<e[2];++d)for(var f=0;f<e[3];++f)u=u.add(s.slice([l*a.shape[0],c*a.shape[1],d*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return u}}},"Tile",i,r)}}),uB=N({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var s=new hv(e,t,r,!0,i),o=we(n,r),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),Ct=N({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=C(n,"x","unstack");L(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var r={axis:e};return F.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return Mn(i,e)}}},"Unpack",r)}}),lB=function(n,e){return le(this,void 0,void 0,function(){var t,r,i,s,o,a,u,l,c,d;return ce(this,function(f){switch(f.label){case 0:return t=C(n,"x","setdiff1d"),r=C(e,"y","setdiff1d"),L(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),L(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),L(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(s=f.sent(),o=new Set(s),a=0,c=0;c<i.length;c++)o.has(i[c])||a++;for(u=new Iu([a],t.dtype),l=new Iu([a],"int32"),c=0,d=0;c<i.length;c++)o.has(i[c])||(u.values[d]=i[c],l.values[d]=c,d++);return[2,[u.toTensor(),l.toTensor()]]}})})};function ud(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var s=e.length,o=0;o<s;++o)i=i.concat([n[o+1]/e[o],e[o]]);i=i.concat(n.slice(s+1))}return i}function ld(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var s=[],o=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?o.push(i):s.push(i);r.push.apply(r,s),r.push(0),r.push.apply(r,o)}return r}function cd(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var s=1;s<n.length;++s)s<=e.length?r?i.push(e[s-1]*n[s]):i.push(n[s]/e[s-1]):i.push(n[s]);return i}function JT(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function ZT(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function e_(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,s=0;s<t.length-1;++s)i*=t[s];var o=n.shape,a=t.slice();a.pop();var u=1;for(s=r;s<n.rank;++s)u*=o[s],a.push(o[s]);var l=$r(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[a,i,u,l]}var t_=30;function Ah(n){return n<=t_?n:bg(n,Math.floor(Math.sqrt(n)))}function cB(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,s="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(s+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(s+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(s+" update.rank != "+(i+n.length-r));for(var o=0;o<i;++o)if(t.shape[o]!==e.shape[o])throw new Error(s+" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+").");for(o=0;o<t.rank-i;++o)if(t.shape[o+i]!==n[o+r])throw new Error(s+" updates.shape["+(o+i)+"] ("+t.shape[o+i]+") != shape["+(o+i)+"] ("+n[o+i]+")")}function dB(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}cB(t,e,n)}function dd(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,s=t.length,o=1,a=i;a<s;++a)o*=t[a];var u=i<1?1:i;return{sliceRank:i,numUpdates:fe(e.shape)/u,sliceSize:o,strides:$r(t.slice(0,i)).concat([1]),outputSize:fe(t)}}function fB(n,e,t){L(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),L(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(s){L(e[s]+t[s]<=n.shape[s],function(){return"Error in slice"+n.rank+"D: begin["+s+"] + size["+s+"] ("+(e[s]+t[s])+") would overflow input.shape["+s+"] ("+n.shape[s]+")"})},i=0;i<n.rank;++i)r(i)}function c1(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function pv(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function hB(n,e,t,r,i){var s=e[i],o=t[i]||1;(n&1<<i||s==null)&&(s=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return s<0&&(s+=a),s=yg(0,s,a-1)}function pB(n,e,t,r,i){var s=e[i],o=t[i]||1;(n&1<<i||s==null)&&(s=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return s<0&&(s+=a),s=o>0?yg(0,s,a):yg(-1,s,a-1)}function n_(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function r_(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function gB(n,e){L(Eg(n),function(){return"The f passed in variableGrads(f) must be a function"}),L(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof Zo}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],F.registeredVariables)e.push(F.registeredVariables[r]);var i=t?e.filter(function(c){return!c.trainable}):null,s=e.length;L((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+s+" variables is trainable."});var o=F.gradients(n,e,null,!0),a=o.value,u=o.grads;L(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),L(a.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var l={};return e.forEach(function(c,d){u[d]!=null&&(l[c.name]=u[d])}),i!=null&&i.forEach(function(c){return l[c.name]=null}),{value:a,grads:l}}function tf(n){return F.customGrad(n)}var xi=N({softmax_:function(n,e){e===void 0&&(e=-1);var t=C(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return F.runKernelFunc(function(r,i){var s=r.softmax(t,e);return i([s]),s},{logits:t},function(r,i){var s=i[0],o=r.mul(s);return{logits:function(){return o.sub(o.sum([e],!0).mul(s))}}},"Softmax",{dim:e},[],[!0])}}),mB=N({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=C(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return tf(function(r,i){var s=r.max(e,!0),o=r.sub(s),a=o.toFloat().sub(o.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),i_=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),s_=function(){function n(){}return n.prototype.time=function(e){return z("time")},n.prototype.read=function(e){return z("read")},n.prototype.readSync=function(e){return z("readSync")},n.prototype.numDataIds=function(){return z("numDataIds")},n.prototype.disposeData=function(e){return z("disposeData")},n.prototype.write=function(e,t,r){return z("write")},n.prototype.move=function(e,t,r,i){return z("move")},n.prototype.memory=function(){return z("memory")},n.prototype.floatPrecision=function(){return z("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return z("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,z("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return z("slice")},n.prototype.stridedSlice=function(e,t,r,i){return z("stridedSlice")},n.prototype.unstack=function(e,t){return z("unstack")},n.prototype.reverse=function(e,t){return z("reverse")},n.prototype.concat=function(e,t){return z("concat")},n.prototype.neg=function(e){return z("neg")},n.prototype.add=function(e,t){return z("add")},n.prototype.addN=function(e){return z("addN")},n.prototype.subtract=function(e,t){return z("subtract")},n.prototype.multiply=function(e,t){return z("multiply")},n.prototype.realDivide=function(e,t){return z("realDivide")},n.prototype.floorDiv=function(e,t){return z("floorDiv")},n.prototype.sum=function(e,t){return z("sum")},n.prototype.prod=function(e,t){return z("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return z("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return z("argMin")},n.prototype.argMax=function(e,t){return z("argMax")},n.prototype.equal=function(e,t){return z("equal")},n.prototype.notEqual=function(e,t){return z("notEqual")},n.prototype.less=function(e,t){return z("less")},n.prototype.lessEqual=function(e,t){return z("lessEqual")},n.prototype.greater=function(e,t){return z("greater")},n.prototype.greaterEqual=function(e,t){return z("greaterEqual")},n.prototype.logicalNot=function(e){return z("logicalNot")},n.prototype.logicalAnd=function(e,t){return z("logicalAnd")},n.prototype.logicalOr=function(e,t){return z("logicalOr")},n.prototype.where=function(e){return z("where")},n.prototype.select=function(e,t,r){return z("select")},n.prototype.topk=function(e,t,r){return z("topk")},n.prototype.min=function(e,t){return z("min")},n.prototype.minimum=function(e,t){return z("minimum")},n.prototype.mod=function(e,t){return z("mod")},n.prototype.max=function(e,t){return z("max")},n.prototype.maximum=function(e,t){return z("maximum")},n.prototype.all=function(e,t){return z("all")},n.prototype.any=function(e,t){return z("any")},n.prototype.squaredDifference=function(e,t){return z("squaredDifference")},n.prototype.ceil=function(e){return z("ceil")},n.prototype.floor=function(e){return z("floor")},n.prototype.round=function(e){return z("round")},n.prototype.sign=function(e){return z("sign")},n.prototype.isNaN=function(e){return z("isNaN")},n.prototype.isInf=function(e){return z("isInf")},n.prototype.isFinite=function(e){return z("isFinite")},n.prototype.pow=function(e,t){return z("pow")},n.prototype.exp=function(e){return z("exp")},n.prototype.expm1=function(e){return z("expm1")},n.prototype.softmax=function(e,t){return z("softmax")},n.prototype.log=function(e){return z("log")},n.prototype.log1p=function(e){return z("log1p")},n.prototype.sqrt=function(e){return z("sqrt")},n.prototype.rsqrt=function(e){return z("rsqrt")},n.prototype.square=function(e){return z("square")},n.prototype.reciprocal=function(e){return z("reciprocal")},n.prototype.relu=function(e){return z("relu")},n.prototype.relu6=function(e){return z("relu6")},n.prototype.prelu=function(e,t){return z("prelu")},n.prototype.elu=function(e){return z("elu")},n.prototype.eluDer=function(e,t){return z("eluDer")},n.prototype.selu=function(e){return z("selu")},n.prototype.int=function(e){return z("int")},n.prototype.clip=function(e,t,r){return z("clip")},n.prototype.abs=function(e){return z("abs")},n.prototype.complexAbs=function(e){return z("complexAbs")},n.prototype.sigmoid=function(e){return z("sigmoid")},n.prototype.softplus=function(e){return z("softplus")},n.prototype.sin=function(e){return z("sin")},n.prototype.cos=function(e){return z("cos")},n.prototype.tan=function(e){return z("tan")},n.prototype.asin=function(e){return z("asin")},n.prototype.acos=function(e){return z("acos")},n.prototype.atan=function(e){return z("atan")},n.prototype.atan2=function(e,t){return z("atan2")},n.prototype.sinh=function(e){return z("sinh")},n.prototype.cosh=function(e){return z("cosh")},n.prototype.tanh=function(e){return z("tanh")},n.prototype.asinh=function(e){return z("asinh")},n.prototype.acosh=function(e){return z("acosh")},n.prototype.atanh=function(e){return z("atanh")},n.prototype.erf=function(e){return z("erf")},n.prototype.step=function(e,t){return z("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,z("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return z("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return z("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return z("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,z("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return z("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return z("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return z("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return z("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return z("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return z("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return z("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return z("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return z("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return z("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return z("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return z("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return z("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return z("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return z("reshape")},n.prototype.cast=function(e,t){return z("cast")},n.prototype.tile=function(e,t){return z("tile")},n.prototype.pad=function(e,t,r){return z("pad")},n.prototype.transpose=function(e,t){return z("transpose")},n.prototype.gather=function(e,t,r){return z("gather")},n.prototype.gatherND=function(e,t){return z("gatherND")},n.prototype.scatterND=function(e,t,r){return z("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return z("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return z("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return z("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return z("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return z("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return z("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,s,o){return z("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,s){return z("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,s,o,a){return z("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return z("multinomial")},n.prototype.oneHot=function(e,t,r,i){return z("oneHot")},n.prototype.cumsum=function(e,t,r,i){return z("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,s){return z("nonMaxSuppression")},n.prototype.fft=function(e){return z("fft")},n.prototype.ifft=function(e){return z("ifft")},n.prototype.complex=function(e,t){return z("complex")},n.prototype.real=function(e){return z("real")},n.prototype.imag=function(e){return z("imag")},n.prototype.cropAndResize=function(e,t,r,i,s,o){return z("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return z("depthToSpace")},n.prototype.split=function(e,t,r){return z("split")},n.prototype.sparseToDense=function(e,t,r,i){return z("sparseToDense")},n.prototype.diag=function(e){return z("diag")},n.prototype.fill=function(e,t,r){return z("fill")},n.prototype.onesLike=function(e){return z("onesLike")},n.prototype.zerosLike=function(e){return z("zerosLike")},n.prototype.linspace=function(e,t,r){return z("linspace")},n.prototype.dispose=function(){return z("dispose")},n}();function z(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Bi(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var s=t-1-i,o=n[s]||1;(e[e.length-1-i]||1)>1&&o===1&&r.unshift(s)}return r}function At(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],s=e.length-r-1,o=e[s];(i==null||i===1&&o>1)&&t.unshift(s)}return t}function Pe(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var s=n[n.length-i-1];s==null&&(s=1);var o=e[e.length-i-1];if(o==null&&(o=1),s===1)t.unshift(o);else if(o===1)t.unshift(s);else{if(s!==o)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(s)}}return t}function Cu(n,e,t,r,i,s,o){o===void 0&&(o="channelsLast");var a,u=pd(e),l=u[0],c=u[1];if(o==="channelsLast")a=[l,c,n[3],n[3]];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);a=[l,c,n[1],n[1]]}return js(n,a,t,r,i,s,!1,o)}function fd(n,e,t,r,i,s,o){o===void 0&&(o="NDHWC");var a,u,l=Cg(e),c=l[0],d=l[1],f=l[2];if(o==="NDHWC")u="channelsLast",a=[c,d,f,n[4],n[4]];else{if(o!=="NCDHW")throw new Error("Unknown dataFormat "+o);u="channelsFirst",a=[c,d,f,n[1],n[1]]}return hd(n,a,t,r,i,!1,u,s)}function js(n,e,t,r,i,s,o,a){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],f=u[3];if(a==="channelsLast")l=n[0],c=n[1],d=n[2],f=n[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=n[0],f=n[1],c=n[2],d=n[3]}var h,p=e[0],g=e[1],m=e[3],v=pd(t),y=v[0],x=v[1],E=pd(r),b=E[0],S=E[1],w=No(p,b),T=No(g,S),R=function(U,M,B,$,D,P,O,K){var Y,ee,ne;if(typeof U=="number"){Y={top:U,bottom:U,left:U,right:U,type:U===0?"VALID":"NUMBER"};var ie=function(Le,$e,Ne,Ye,rt){Ye==null&&(Ye=o_(Le,$e,Ne));var ve=Le[0],qe=Le[1],ot=qa((ve-$e+2*Ye)/Ne+1,rt);L(xt(ot),function(){return"The output # of rows ("+ot+") must be an integer. Change the stride and/or zero pad parameters"});var vt=qa((qe-$e+2*Ye)/Ne+1,rt);return L(xt(vt),function(){return"The output # of columns ("+vt+") must be an integer. Change the stride and/or zero pad parameters"}),[ot,vt]}([M,B],P,$,U,K);ee=ie[0],ne=ie[1]}else if(U==="same"){ee=Math.ceil(M/$),ne=Math.ceil(B/D);var se=Math.max(0,(ee-1)*$+P-M),ye=Math.max(0,(ne-1)*D+O-B),Ee=Math.floor(se/2),_e=se-Ee,nt=Math.floor(ye/2);Y={top:Ee,bottom:_e,left:nt,right:ye-nt,type:"SAME"}}else{if(U!=="valid")throw Error("Unknown padding parameter: "+U);Y={top:0,bottom:0,left:0,right:0,type:"VALID"},ee=Math.ceil((M-P+1)/$),ne=Math.ceil((B-O+1)/D)}return{padInfo:Y,outHeight:ee,outWidth:ne}}(i,c,d,y,x,w,T,s),_=R.padInfo,A=R.outHeight,k=R.outWidth,G=o?m*f:m;return a==="channelsFirst"?h=[l,G,A,k]:a==="channelsLast"&&(h=[l,A,k,G]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:d,inChannels:f,outHeight:A,outWidth:k,outChannels:G,padInfo:_,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:g,effectiveFilterHeight:w,effectiveFilterWidth:T,dilationHeight:b,dilationWidth:S,inShape:n,outShape:h,filterShape:e}}function hd(n,e,t,r,i,s,o,a){s===void 0&&(s=!1),o===void 0&&(o="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],f=u[3],h=u[4];if(o==="channelsLast")l=n[0],c=n[1],d=n[2],f=n[3],h=n[4];else{if(o!=="channelsFirst")throw new Error("Unknown dataFormat "+o);l=n[0],h=n[1],c=n[2],d=n[3],f=n[4]}var p,g=e[0],m=e[1],v=e[2],y=e[4],x=Cg(t),E=x[0],b=x[1],S=x[2],w=Cg(r),T=w[0],R=w[1],_=w[2],A=No(g,T),k=No(m,R),G=No(v,_),U=function(O,K,Y,ee,ne,ie,se,ye,Ee,_e,nt){var Le,$e,Ne,Ye;if(typeof O=="number"){Le={top:O,bottom:O,left:O,right:O,front:O,back:O,type:O===0?"VALID":"NUMBER"};var rt=function(rr,Wn,qr,Yr,Vn,Ys){Vn==null&&(Vn=o_(rr,Wn,Yr));var Qu=rr[0],ds=rr[1],qI=rr[2],mf=qa((Qu-Wn+2*Vn)/Yr+1,Ys);L(xt(mf),function(){return"The output # of depths ("+mf+") must be an integer. Change the stride and/or zero pad parameters"});var vf=qa((ds-Wn+2*Vn)/Yr+1,Ys);L(xt(vf),function(){return"The output # of rows ("+vf+") must be an integer. Change the stride and/or zero pad parameters"});var yf=qa((qI-Wn+2*Vn)/Yr+1,Ys);return L(xt(yf),function(){return"The output # of columns ("+yf+") must be an integer. Change the stride and/or zero pad parameters"}),[mf,vf,yf,qr]}([K,Y,ee,1],ye,1,ne,O,nt);$e=rt[0],Ne=rt[1],Ye=rt[2]}else if(O==="same"){$e=Math.ceil(K/ne),Ne=Math.ceil(Y/ie),Ye=Math.ceil(ee/se);var ve=($e-1)*ne+ye-K,qe=(Ne-1)*ie+Ee-Y,ot=(Ye-1)*se+_e-ee,vt=Math.floor(ve/2),Dt=ve-vt,jt=Math.floor(qe/2),Kt=qe-jt,Gn=Math.floor(ot/2);Le={top:jt,bottom:Kt,left:Gn,right:ot-Gn,front:vt,back:Dt,type:"SAME"}}else{if(O!=="valid")throw Error("Unknown padding parameter: "+O);Le={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},$e=Math.ceil((K-ye+1)/ne),Ne=Math.ceil((Y-Ee+1)/ie),Ye=Math.ceil((ee-_e+1)/se)}return{padInfo:Le,outDepth:$e,outHeight:Ne,outWidth:Ye}}(i,c,d,f,E,b,S,A,k,G,a),M=U.padInfo,B=U.outDepth,$=U.outHeight,D=U.outWidth,P=s?y*h:y;return o==="channelsFirst"?p=[l,P,B,$,D]:o==="channelsLast"&&(p=[l,B,$,D,P]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:d,inWidth:f,inChannels:h,outDepth:B,outHeight:$,outWidth:D,outChannels:P,padInfo:M,strideDepth:E,strideHeight:b,strideWidth:S,filterDepth:g,filterHeight:m,filterWidth:v,effectiveFilterDepth:A,effectiveFilterHeight:k,effectiveFilterWidth:G,dilationDepth:T,dilationHeight:R,dilationWidth:_,inShape:n,outShape:p,filterShape:e}}function o_(n,e,t,r){r===void 0&&(r=1);var i=No(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function pd(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Cg(n){return typeof n=="number"?[n,n,n]:n}function No(n,e){return e<=1?n:n+(n-1)*(e-1)}function qa(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function ta(n){var e=pd(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function Tn(n,e){return ta(n)||ta(e)}function gv(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function a_(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=et(n.shape),i=n.toFloat(),s=t.complex(i,r);return r.dispose(),i.dispose(),s}if(!VF(n.dtype,e))return F.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var o=t.real(n);return s=o.cast(e),o.dispose(),s}if(e==="int32")return t.int(n);if(e==="bool"){var a=re(0,n.dtype);return s=t.notEqual(n,a),a.dispose(),s}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function Ag(n,e){return F.makeTensorFromDataId(n.dataId,e,n.dtype)}function u_(n,e,t){var r=(e-n)/(t-1),i=Wu(t,"float32");i[0]=n;for(var s=1;s<i.length;s++)i[s]=i[s-1]+r;return bt(i,"float32")}function kg(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function d1(n,e){return{real:n[2*e],imag:n[2*e+1]}}function vB(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function yB(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function xB(n,e,t){var r=function(s,o,a){return function(u,l,c){for(var d=0,f=u.length,h=0,p=!1;d<f;){var g=c(l,u[h=d+(f-d>>>1)]);g>0?d=h+1:(f=h,p=!g)}return p?d:-d-1}(s,o,a||EB)}(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function EB(n,e){return n>e?1:n<e?-1:0}function mv(n,e,t,r,i){return l_(n,e,t,r,i,0).selectedIndices}function vv(n,e,t,r,i,s){var o=l_(n,e,t,r,i,s);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function l_(n,e,t,r,i,s,o,a){a===void 0&&(a=!1);for(var u=Array.from(e).map(function(E,b){return{score:E,boxIndex:b,suppressBeginIndex:0}}).filter(function(E){return E.score>i}).sort(f1),l=s>0?-.5/s:0,c=[],d=[];c.length<t&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,g=f.suppressBeginIndex;if(h<i)break;for(var m=!1,v=c.length-1;v>=g;--v){var y=bB(n,p,c[v]);if(y>=r){m=!0;break}if(f.score=f.score*SB(r,l,y),f.score<=i)break}f.suppressBeginIndex=c.length,m||(f.score===h?(c.push(p),d.push(f.score)):f.score>i&&xB(u,f,f1))}var x=c.length;return a&&(c.fill(0,x),d.fill(0,x)),{selectedIndices:bt(c,"int32"),selectedScores:bt(d,"float32"),numValidOutputs:re(x,"int32")}}function bB(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),h=(a-s)*(u-o),p=(d-l)*(f-c);if(h<=0||p<=0)return 0;var g=Math.max(s,l),m=Math.max(o,c),v=Math.min(a,d),y=Math.min(u,f),x=Math.max(v-g,0)*Math.max(y-m,0);return x/(h+p-x)}function SB(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function f1(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function c_(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(s){i[t]=s;var o=n.slice(r,i);return r[t]+=s,o})}function d_(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=we(t,n.dtype);for(r=0;r<i.values.length;++r){for(var s=i.indexToLoc(r),o=new Array(n.rank),a=0;a<o.length;a++)o[a]=s[a]%n.shape[a];var u=n.locToIndex(o);i.values[r]=n.values[u]}return i.toTensor()}function f_(n,e,t,r,i){for(var s=e[e.length-1],o=[n.length/s,s],a=o[0],u=o[1],l=_u(t,a*r),c=_u("int32",a*r),d=0;d<a;d++){for(var f=d*u,h=n.subarray(f,f+u),p=[],g=0;g<h.length;g++)p.push({value:h[g],index:g});p.sort(function(E,b){return b.value-E.value});var m=d*r,v=l.subarray(m,m+r),y=c.subarray(m,m+r);for(g=0;g<r;g++)v[g]=p[g].value,y[g]=p[g].index}var x=e.slice();return x[x.length-1]=r,[Wt(l,x,t),Wt(c,x,"int32")]}function yv(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=we(n,"int32"),s=we([t.length,n.length],"int32");for(r=0;r<t.length;r++){var o=i.indexToLoc(t[r]),a=r*n.length;s.values.set(o,a)}return s.toTensor()}var wB=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,s){return"T"+s});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},TB=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(i,s){return"T"+s});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},_B=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,s=n.inSize,o=Math.ceil(s/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var a=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function h_(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function mn(n,e){return e===1?[n]:h_(n,e)}function tn(){var n,e,t,r,i,s,o,a,u,l;return Q().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}function Ts(n,e,t){t===void 0&&(t="index");var r=$r(e);return r.map(function(i,s){return"int "+n[s]+" = "+t+" / "+i+"; "+(s===r.length-1?"int "+n[s+1]+" = "+t+" - "+n[s]+" * "+i:"index -= "+n[s]+" * "+i)+";"}).join("")}function xv(n){var e=$r(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var p_=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function IB(n,e,t,r){var i=[];n.forEach(function(h){var p=fe(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?i.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+h.name+";"),i.push("uniform int offset"+h.name+";"))});var s,o,a=i.join(`
`),u=n.map(function(h){return function(p,g,m){m===void 0&&(m=!1);var v="";v+=m?g_(p):oo(p);var y=p.shapeInfo.logicalShape,x=g.logicalShape;return y.length<=x.length&&(v+=m?function(E,b){var S,w=E.name,T=w.charAt(0).toUpperCase()+w.slice(1),R="get"+T+"AtOutCoords",_=E.shapeInfo.logicalShape.length,A=b.logicalShape.length,k=Bi(E.shapeInfo.logicalShape,b.logicalShape),G=Je(A),U=A-_,M=["x","y","z","w","u","v"];S=_===0?"":A<2&&k.length>=1?"coords = 0;":k.map(function(Y){return"coords."+M[Y+U]+" = 0;"}).join(`
`);var B="";B=A<2&&_>0?"coords":E.shapeInfo.logicalShape.map(function(Y,ee){return"coords."+M[ee+U]}).join(", ");var $="return outputValue;",D=fe(E.shapeInfo.logicalShape)===1,P=fe(b.logicalShape)===1;if(_!==1||D||P){if(D&&!P)$=A===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(k.length){var O=_-2,K=_-1;k.indexOf(O)>-1&&k.indexOf(K)>-1?$="return vec4(outputValue.x);":k.indexOf(O)>-1?$="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":k.indexOf(K)>-1&&($="return vec4(outputValue.xx, outputValue.zz);")}}else $=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+R+`() {
      `+G+` coords = getOutputCoords();
      `+S+`
      vec4 outputValue = get`+T+"("+B+`);
      `+$+`
    }
  `}(p,g):function(E,b){var S=E.name,w=S.charAt(0).toUpperCase()+S.slice(1),T="get"+w+"AtOutCoords",R=b.texShape,_=E.shapeInfo.texShape,A=E.shapeInfo.logicalShape.length,k=b.logicalShape.length;if(!E.shapeInfo.isUniform&&A===k&&E.shapeInfo.flatOffset==null&&Mt(_,R))return`
      float `+T+`() {
        return sampleTexture(`+S+`, resultUV);
      }
    `;var G,U=Je(k),M=Bi(E.shapeInfo.logicalShape,b.logicalShape),B=k-A,$=["x","y","z","w","u","v"];G=A===0?"":k<2&&M.length>=1?"coords = 0;":M.map(function(P){return"coords."+$[P+B]+" = 0;"}).join(`
`);var D="";return D=k<2&&A>0?"coords":E.shapeInfo.logicalShape.map(function(P,O){return"coords."+$[O+B]}).join(", "),`
    float `+T+`() {
      `+U+` coords = getOutputCoords();
      `+G+`
      return get`+w+"("+D+`);
    }
  `}(p,g)),v}(h,e,r)}).join(`
`),l=e.texShape,c=tn(),d=function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+RB+`
    `+CB+`
    `+AB+`
  `}(c);return e.isPacked?(s=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(E,b){var S=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];return S[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+S[1]+`.0);
      }
    `:S[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+S[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      return 2 * (resTexRC.x * `+S[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(E,b){var S=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];if(Mt(E,b))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+S[0]+", "+S[1]+`));
      }
    `;var w=Math.ceil(E[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));

      int index = resTexRC.x * `+S[1]+` + resTexRC.y;
      int r = 2 * (index / `+w+`);
      int c = imod(index, `+w+`) * 2;

      return ivec2(r, c);
    }
  `}(h,p);case 3:return g=h,m=p,v=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],y=Math.ceil(g[2]/2),x=y*Math.ceil(g[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+y+`);
      int c = imod(index, `+y+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(E,b){for(var S=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)],w=Math.ceil(E[E.length-1]/2),T=w*Math.ceil(E[E.length-2]/2),R=T,_="",A="b, r, c",k=2;k<E.length-1;k++)R*=E[E.length-k-1],_=`
      int b`+k+" = index / "+R+`;
      index -= b`+k+" * "+R+`;
    `+_,A="b"+k+", "+A;return`
    ivec`+E.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+S[0]+", "+S[1]+`));
      int index = resTexRC.x * `+S[1]+` + resTexRC.y;

      `+_+`

      int b = index / `+T+`;
      index -= b * `+T+`;

      int r = 2 * (index / `+w+`);
      int c = imod(index, `+w+`) * 2;

      return ivec`+E.length+"("+A+`);
    }
  `}(h,p)}var g,m,v,y,x}(e.logicalShape,l),o=function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `}(c)):(s=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(v,y){return y[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+y[1]+`.0);
      }
    `:y[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+y[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      return resTexRC.x * `+y[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(v,y){return Mt(v,y)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+y[0]+", "+y[1]+`));
      }
    `:v[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:v[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      int r = index / `+v[1]+`;
      int c = index - r * `+v[1]+`;
      return ivec2(r, c);
    }
  `}(h,p);case 3:return g=p,m=Ts(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      `+m+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(v,y){var x=Ts(["r","c","d","d2"],v);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(h,p);case 5:return function(v,y){var x=Ts(["r","c","d","d2","d3"],v);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+y[0]+`,
                             `+y[1]+`));

      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(h,p);case 6:return function(v,y){var x=Ts(["r","c","d","d2","d3","d4"],v);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var g,m}(e.logicalShape,l),o=function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=kB),[f,d,o,a,s,u,t].join(`
`)}function oo(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var s=t.shapeInfo.texShape,o=s[0],a=s[1];if(o===1&&a===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],d=hs(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+to(t)+`
      }
    `;var s=t.shapeInfo.texShape,o=s[0],a=s[1];if(a===1&&o===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=hs(r);return a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+o+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:o===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+o+", "+a+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=t.shapeInfo.texShape;if(o!=null&&Mt(r,o)){var a=o[0],u=o[1];return`
    float `+s+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+a+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=xs(r),c=l.newShape,d=l.keptDims,f=c;if(f.length<r.length){var h=ao(t,f);return`
      `+oo(h)+`
      float `+s+`(int row, int col) {
        return `+s+"("+uo(["row","col"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+to(t)+`
      }
    `;var p=o[0],g=o[1],m=hs(i);return g===1?`
    float `+s+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+s+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+g+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+s+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+p+", "+g+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=r[1]*r[2],a=r[2],u=xs(r),l=u.newShape,c=u.keptDims,d=l;if(d.length<r.length){var f=ao(t,d);return`
        `+oo(f)+`
        float `+s+`(int row, int col, int depth) {
          return `+s+"("+uo(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+o+", "+a+`, 1)));
        `+to(t)+`
      }
    `;var h=t.shapeInfo.texShape,p=h[0],g=h[1],m=t.shapeInfo.flatOffset;if(g===o&&m==null)return`
        float `+s+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+g+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(g===a&&m==null)return`
    float `+s+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var v=hs(i);return`
      float `+s+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+o+" + col * "+a+" + depth + "+v+`;
        vec2 uv = uvFromFlat(`+p+", "+g+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=r[3],a=r[2]*o,u=r[1]*a,l=xs(r),c=l.newShape,d=l.keptDims;if(c.length<r.length){var f=ao(t,c);return`
      `+oo(f)+`
      float `+s+`(int row, int col, int depth, int depth2) {
        return `+s+"("+uo(["row","col","depth","depth2"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+a+", "+o+`, 1)));
        `+to(t)+`
      }
    `;var h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,g=p[0],m=p[1];if(m===u&&h==null)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(m===o&&h==null)return`
      float `+s+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var v=hs(i);return`
    float `+s+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+a+` +
          depth * `+o+` + depth2;
      vec2 uv = uvFromFlat(`+g+", "+m+", index + "+v+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=r[4],a=r[3]*o,u=r[2]*a,l=r[1]*u,c=xs(r),d=c.newShape,f=c.keptDims;if(d.length<r.length){var h=ao(t,d);return`
      `+oo(h)+`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        return `+s+"("+uo(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+a+", "+o+`)) +
          depth3;
        `+to(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,m=g[0],v=g[1];if(v===l&&p==null)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+a+", "+o+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===o&&p==null)return`
      float `+s+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=hs(i);return`
    float `+s+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+a+` +
          depth2 * `+o+" + depth3 + "+y+`;
      vec2 uv = uvFromFlat(`+m+", "+v+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=xs(r),a=o.newShape,u=o.keptDims;if(a.length<r.length){var l=ao(t,a);return`
      `+oo(l)+`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+s+"("+uo(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],d=r[4]*c,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(t.shapeInfo.isUniform)return`
      float `+s+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+f+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+to(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],y=m[1];if(y===p&&g==null)return`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+f+", "+d+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===c&&g==null)return`
      float `+s+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=hs(i);return`
    float `+s+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+f+` +
          depth2 * `+d+" + depth3 * "+c+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function g_(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=tn(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var s=i.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=tn();return`
    vec4 `+o+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+s+`, uv);
    }
  `}(n);case 2:return function(i){var s=i.shapeInfo.logicalShape,o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],d=tn();if(u!=null&&Mt(s,u))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+d.texture2D+"("+o+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(s[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+f[0]+", "+f[1]+`, row, col);
      return `+d.texture2D+"("+o+`, uv);
    }
  `}(n);case 3:return function(i){var s=i.shapeInfo.logicalShape,o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(s[0]===1){var c=s.slice(1),d=ao(i,c);return`
        `+g_(d)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+uo(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],h=l[1],p=Math.ceil(s[2]/2),g=p*Math.ceil(s[1]/2),m=tn();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+h+", "+g+", "+p+`, b, row, col);
      return `+m.texture2D+"("+o+`, uv);
    }
  `}(n);default:return function(i){for(var s=i.shapeInfo.logicalShape,o=s.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],f=c[1],h=Math.ceil(s[o-1]/2),p=h*Math.ceil(s[o-2]/2),g="int b, int row, int col",m="b * "+p+" + (row / 2) * "+h+" + (col / 2)",v=2;v<o-1;v++)g="int b"+v+", "+g,p*=s[o-v-1],m="b"+v+" * "+p+" + "+m;var y=tn();return`
    vec4 `+u+"("+g+`) {
      int index = `+m+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+d+`);
      return `+y.texture2D+"("+a+`, uv);
    }
  `}(n)}}var RB=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,CB=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,AB=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,kB=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function hs(n){return"offset"+n}function to(n){var e=n.name,t=fe(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Je(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function ao(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function uo(n,e){return e.map(function(t){return n[t]}).join(", ")}var LB=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,L(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=n[n.length-1],s=Math.ceil(i/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");var o,a,u=this.outputShape,l=u.length,c=Je(l),d=mn("coords",l);if(s===1){var f=Je(a=l+1);o=`
        `+f+" sourceLocR = "+f+"("+d.join()+`, 0);
        ++`+d[l-1]+`;
        `+f+" sourceLocG = "+f+"("+d.join()+`, 0);
        ++`+d[l-2]+`;
        `+f+" sourceLocA = "+f+"("+d.join()+`, 0);
        --`+d[l-1]+`;
        `+f+" sourceLocB = "+f+"("+d.join()+`, 0);
        --`+d[l-2]+";"}else a=l,o=`
        `+c+` sourceLocR = coords;
        ++`+d[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+d[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+d[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+d[l-2]+";";var h=["x","y","z","w","u","v"].slice(0,a),p="."+h[a-1],g=h.map(function(T){return"int "+T}),m=mn("sourceLocR",a-1).concat("inIdx.r"),v=mn("sourceLocG",a-1).concat("inIdx.g"),y=mn("sourceLocB",a-1).concat("inIdx.b"),x=mn("sourceLocA",a-1).concat("inIdx.a"),E=t==="max"?"greaterThan":"lessThan",b=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",S=`vec4(
            getAChannel(`+m.join()+`),
            hasNextCol ? getAChannel(`+v.join()+`) : 0.,
            hasNextRow ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",w=r?"":`
      float getBestIndicesAChannel(`+g.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+g.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+w+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+d[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+d[l-2]+" < "+(u[l-2]-1)+`;
        `+o+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+S+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+b+`
          vec4 candidate = `+S+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+E+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},DB=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,o=n.dilationWidth,a=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=a-1-n.padInfo.top,c=u-1-n.padInfo.left,d=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+s+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+o+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},PB=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,s=n.strideHeight,o=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,h=c-1-n.padInfo.front,p=d-1-n.padInfo.top,g=f-1-n.padInfo.left,m=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+p+", "+g+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+s+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},OB=function(n,e,t,r,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],Pe(n,e),Pe(n,t);var o="0.0";r!=null&&(Pe(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var a="1.0";i!=null&&(Pe(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+o+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+s+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},NB=function(n,e,t,r,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Pe(n,e),Pe(n,t);var o="vec4(0.0)";r!=null&&(Pe(n,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var a="vec4(1.0)";i!=null&&(Pe(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+o+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+s+`));

        setOutput((x - mean) * inv + offset);
      }
    `},FB="return areal * breal - aimag * bimag;",MB="return areal * bimag + aimag * breal;",h1=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Pe(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},kh="return a + b;",Lh="return a - b;",p1="return a * b;",m_="return (a < 0.) ? b * a : a;",gt=function(n,e,t){this.variableNames=["A","B"],this.outputShape=Pe(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},v_=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Zr=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Pe(e,t);var i=this.outputShape.length,s="";if(r)if(i===0||fe(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          `+Je(i)+` coords = getOutputCoords();
        `,i===1)s+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var o=mn("coords",i);s+=`
            bool nextRowOutOfBounds =
              (`+o[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+o[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+s+`

        setOutput(result);
      }
    `},BB=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,s){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(s,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),UB=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,s){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(s,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(s,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),$B=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},GB=function(n){this.outputShape=[],this.outputShape=ea(n,1),this.variableNames=n.map(function(a,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var s=e.length,o=e[e.length-1];r.push("else setOutput(getT"+s+"(yR, yC-"+o+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},WB=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ea(n,e);var t=this.outputShape,r=t.length,i=Je(r),s=mn("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(m,v){return"T"+v});var a=new Array(n.length-1);a[0]=n[0][e];for(var u=1;u<a.length;u++)a[u]=a[u-1]+n[u][e];var l=o[e],c=o.slice(-2),d=o.join(),f="if ("+l+" < "+a[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+c.join()+`));
        }`;for(u=1;u<a.length;u++){var h=a[u-1];f+=`
        if (`+l+" < "+a[u]+"  && "+l+" >= "+a[u-1]+`) {
          return getChannel(
            getT`+u+"("+Pl(o,l,h)+`),
            vec2(`+Pl(c,l,h)+`));
        }`}var p=a.length,g=a[a.length-1];f+=`
        return getChannel(
          getT`+p+"("+Pl(o,l,g)+`),
          vec2(`+Pl(c,l,g)+"));",this.userCode=`
      float getValue(`+o.map(function(m){return"int "+m})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+s+`), 0., 0., 0.);

        `+s[r-1]+" = "+s[r-1]+` + 1;
        if (`+s[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+s+`);
        }

        `+s[r-2]+" = "+s[r-2]+` + 1;
        if (`+s[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+s+`);
        }

        `+s[r-1]+" = "+s[r-1]+` - 1;
        if (`+s[r-2]+" < "+t[r-2]+` &&
            `+s[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+s+`);
        }
        setOutput(result);
      }
    `};function Pl(n,e,t){var r=n.indexOf(e);return n.map(function(i,s){return s===r?i+" - "+t:i}).join()}var VB=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+s+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},HB=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,s=n.dataFormat==="channelsLast",o=e-1-n.padInfo.top,a=t-1-n.padInfo.left,u=s?1:2,l=s?2:3,c=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+s+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},zB=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,s=n.padInfo.top,o=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+s+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+o+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},jB=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,s=n.strideHeight,o=n.strideWidth,a=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+s+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+o+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},KB=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+s+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},qB=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,s=e-1-n.padInfo.top,o=t-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},g1=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,s=n.padInfo.left,o=n.strideHeight,a=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,d=n.filterWidth,f=4*Math.floor(n.inChannels/4),h=n.inChannels%4,p=n.dataFormat==="channelsLast",g=p?1:2,m=p?2:3,v=p?3:1,y="",x="";t&&(y=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,x="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+v+`];

        ivec2 xRCCorner =
            ivec2(coords[`+g+"], coords["+m+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+E+`
        `+x+`
        setOutput(result);
      }
    `},YB=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,s=n.strideHeight,o=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,d=n.filterHeight,f=n.filterWidth,h=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+s+", "+o+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},m1=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,s=n.inWidth,o=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,f=n.filterHeight,h=n.filterWidth,p=n.outChannels/n.inChannels,g="",m="";t&&(g=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,m="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+s+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+v+`
        `+m+`
        setOutput(result);
      }
    `},v1=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,s=n.inWidth,o=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,f=n.filterHeight,h=n.filterWidth,p=h,g="int xR; int xC; int xCOffset;",m=0;m<f;m++)for(var v=0;v<h;v++)g+=`
          vec4 xTexelR`+m+"C"+2*v+` = vec4(0.);
          vec4 wR`+m+"C"+v+` = vec4(0.);
          vec4 xR`+m+"C"+v+" = vec4(0.);";for(m=0;m<f;m++)for(var y=0;y<p;y++){if(g+=`
          xR = xRCorner + `+m*c+`;
          xC = xCCorner + `+(v=2*y)*d+`;
        `,l===1){if(v<h&&(g+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+s+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+s+`) {
                    xTexelR`+m+"C"+v+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+s+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+s+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+m+"C"+v+" = vec4(previous.zw, xTexelR"+m+"C"+v+`.xy);
                } else {
                  xR`+m+"C"+v+" = vec4(0, 0, xTexelR"+m+"C"+v+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+s+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                xR`+m+"C"+v+" = xTexelR"+m+"C"+v+`;
              `,v+1<h)){var x=a%2==0?NT(d):d;d%2==0&&a%2==1||d%2!=0&&a%2!=1?(g+=`
                  xCOffset = xC + `+a%2+" + "+x+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+s+`) {
                    xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(g+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+s+`) {
                      xTexelR`+m+"C"+v+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+v+` = vec4(0.);
                    }
                  `),g+=`
                  xR`+m+"C"+(v+1)+` = vec4(
                    xTexelR`+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+`.xy);
                `):g+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+s+`) {
                    xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(v+1)+" = xTexelR"+m+"C"+(v+2)+`;
                `}}else v<h&&(g+=`
              if(xR >= 0 && xR < `+i+`) {
            `,a%2==1?(g+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+s+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+s+`) {
                  xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(v+2)+` = vec4(0.);
                }

                xR`+m+"C"+v+` = vec4(
                  xTexelR`+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+`.zw);
              `,v+1<h&&(g+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+s+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(v+1)+" = vec4(xTexelR"+m+"C"+(v+2)+`.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < `+s+`) {
                  xTexelR`+m+"C"+v+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+v+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+s+`) {
                  xTexelR`+m+"C"+(v+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(v+2)+` = vec4(0.);
                }

                xR`+m+"C"+v+` = vec4(
                  xTexelR`+m+"C"+v+".xy, xTexelR"+m+"C"+(v+2)+`.xy);
              `,v+1<h&&(g+=`
                  xR`+m+"C"+(v+1)+` = vec4(
                    xTexelR`+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+`.zw);
                `)),g+="}");v<h&&(g+=`
            vec4 wTexelR`+m+"C"+v+" = getW("+m+", "+v+`, d1, q);
            wR`+m+"C"+v+" = vec4(wTexelR"+m+"C"+v+".xz, wTexelR"+m+"C"+v+`.xz);
          `,v+1<h&&(g+=`
              vec4 wTexelR`+m+"C"+(v+1)+" = getW("+m+", "+(v+1)+`, d1, q);
              wR`+m+"C"+(v+1)+` =
                vec4(wTexelR`+m+"C"+(v+1)+".xz, wTexelR"+m+"C"+(v+1)+".xz);"))}for(m=0;m<f;m++)for(v=0;v<h;v++)g+="dotProd += xR"+m+"C"+v+" * wR"+m+"C"+v+";";var E="",b="";t&&(E=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,b="result = activation(result);");var S=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+E+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+g+`

        vec4 result = dotProd;
        `+S+`
        `+b+`
        setOutput(result);
      }
    `},XB=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=n[0],o=n[1],a=n[2],u=n[3],l=e[0],c=t[0],d=t[1];this.outputShape=[l,c,d,u];var f=r==="bilinear"?1:0,h=[o-1+".0",a-1+".0"],p=h[0],g=h[1],m=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=m[0],y=m[1],x=m[2],E=d>1?[""+(a-1)/(d-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g],b=E[0],S=E[1],w=E[2];this.userCode=`
      const float height_ratio = float(`+v+`);
      const float width_ratio = float(`+b+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+s+`) {
          return;
        }

        float height_scale = `+y+`;
        float width_scale = `+S+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+w+`;
        if( in_x < 0.0 || in_x > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},QB=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],s=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Je(r)+` coords = getOutputCoords();
        int end = `+y1(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+s+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+y1(r,"coords")+` = idx;
          val += getX(`+function(o,a){if(o===1)return""+a;if(o===2)return a+".x, "+a+".y";if(o===3)return a+".x, "+a+".y, "+a+".z";if(o===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+o+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function y1(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var JB=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ru.DENSE;var e=Ka(n),t=tn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ts(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},ZB=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ru.DENSE;var e=Ka(n),t=tn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ts(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},e3=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),t3=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},n3=function(n){this.variableNames=["A"],this.outTexUsage=kn.DOWNLOAD;var e=tn();this.outputShape=n,this.userCode=`
      `+p_+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},r3=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=kn.DOWNLOAD;var e=tn();this.outputShape=n,this.userCode=`
      `+p_+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},i3=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=tn(),i=e[0],s=e[1];this.outputShape=n;var o="result";t&&(o="floor(result * 255. + 0.5)"),this.userCode=`
      `+xv(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+s+`;
        int c = imod(flatIndex, `+s+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+s+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+o+`, 0., 0., 0.);
      }
    `},s3=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=tn(),i=e[0],s=e[1];this.outputShape=n;var o="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;o+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+s+`;
              c = imod(flatIndex, `+s+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+s+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+xv(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+o+`

        `+r.output+" = "+a+`;
      }
    `},o3="return real * expR - imag * expI;",a3="return real * expI + imag * expR;",x1=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,s=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+s+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},u3=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),l3=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=Je(this.rank),s=function(o,a){var u=o.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=0;d<o.length;d++)d===a?c.push("int(getIndices("+l[d]+"))"):c.push(""+l[d]);return c.join()}(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+s+`));
      }
    `},c3=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Je(e.length),i=Je(t.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+s+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function d3(n,e){var t=tn();return oM(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function f3(n,e){return dM(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function h3(n,e){return fM(n,e,new Uint16Array([0,1,2,2,1,3]))}function Hu(n,e,t,r,i,s,o){pM(t,r);var a=hM(n,e),u=n.TEXTURE_2D;return he(n,e,function(){return n.bindTexture(u,a)}),he(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),he(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),he(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),he(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),he(n,e,function(){return n.texImage2D(u,0,i,t,r,0,s,o,null)}),he(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),a}function p3(n,e,t,r,i){var s=Zd(t,r);return Hu(n,e,s[0],s[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function g3(n,e,t,r,i){var s=Zd(t,r);return Hu(n,e,s[0],s[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function m3(n,e,t,r,i){var s=Zd(t,r);return Hu(n,e,s[0],s[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function v3(n,e,t,r,i){var s=Vu(t,r);return Hu(n,e,s[0],s[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function y3(n,e,t,r,i){var s=Vu(t,r);return Hu(n,e,s[0],s[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function x3(n,e,t,r){return he(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),o1(n,e,t,"clipSpacePos",r,3,20,0)&&o1(n,e,t,"uv",r,2,20,12)}function E3(n,e,t,r,i,s,o){var a,u,l;he(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),s instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(a=new Float32Array(r*i*4),u=n.FLOAT,l=o.internalFormatPackedFloat),a.set(s),he(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,a)}),he(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function b3(n,e,t,r){he(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?he(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):he(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),he(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function S3(n,e,t,r,i){var s=n.createBuffer();he(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,s)});var o=16*t*r;return he(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,o,n.STREAM_READ)}),he(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),he(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),s}function w3(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function T3(n,e,t,r,i){var s=Zd(t,r),o=s[0],a=s[1],u=new Uint8Array(t*r*4);return he(n,e,function(){return n.readPixels(0,0,o,a,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function _3(n,e,t,r,i,s,o,a){var u=n,l=new Float32Array(function(c,d){var f=Vu(c,d);return f[0]*f[1]*4}(s,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function I3(n,e,t,r){var i=new Float32Array(t*r*4);return he(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}var R3=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Q().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,tM(t,e)):this.gl=Hr(t);var r="WEBGL_color_buffer_float";if(Q().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Al(this.gl,this.debug,"OES_texture_float"),Qn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Al(this.gl,this.debug,"OES_texture_half_float");else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Qn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Al(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Qn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Qn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=f3(this.gl,this.debug),this.indexBuffer=h3(this.gl,this.debug),this.framebuffer=gM(this.gl,this.debug),this.textureConfig=lv(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Q().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;he(t,this.debug,function(){return t.finish()}),he(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),he(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),he(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),he(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),he(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),p3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),g3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),m3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),b3(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),E3(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),y3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),v3(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(a1(this.gl,this.debug,this.framebuffer),this.outputTexture=null),he(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return T3(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,s,o){return _3(this.gl,e,0,0,0,s,o,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return w3(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=S3(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(Q().getBool("WEBGL_FENCE_API_ENABLED")){var s=e,o=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=s.clientWaitSync(o,0,0);return a===s.ALREADY_SIGNALED||a===s.CONDITION_SATISFIED},t=o}else Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return I3(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=aM(t,this.debug,e),i=d3(t,this.debug),s=lM(t,this.debug);return he(t,this.debug,function(){return t.attachShader(s,i)}),he(t,this.debug,function(){return t.attachShader(s,r)}),cM(t,this.debug,s),this.debug&&Ih(t,this.debug,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=x3(t,this.debug,this.program,this.vertexBuffer)),s},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&he(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Ih(this.gl,this.debug,this.program),he(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?vM(this.gl,this.debug,e,t):yM(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),he(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),xM(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=Vu(t,r),s=i[0],o=i[1];this.setOutputMatrixTextureDriver(e,s,o)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&Ih(this.gl,this.debug,this.program),kl(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),he(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),he(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Al(this.gl,this.debug,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),s=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,s),s},n.prototype.endQuery=function(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return le(this,void 0,void 0,function(){var t=this;return ce(this,function(r){switch(r.label){case 0:return[4,e1(function(){return t.disposed||t.isQueryAvailable(e,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),s&&!this.disjoint}return s=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),s&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||e1(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Rh(this.gl,this.debug,e,this.framebuffer),this.debug&&kl(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Rh(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&kl(this.gl)):a1(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;Rh(i,this.debug,e,this.framebuffer),this.debug&&kl(i),this.outputTexture=e,he(i,this.debug,function(){return i.viewport(0,0,t,r)}),he(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var s=this;this.throwIfDisposed(),he(this.gl,this.debug,function(){return s.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function E1(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,s=e[r],o=s.shape;if(!Mt(i,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+o+" must match");if(!t.isUniform||!s.isUniform){var a=t.texShape,u=s.isUniform?null:s.texData.texShape;if(!Mt(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var C3=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,s=t.strideWidth,o=t.strideHeight,a=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,d=t.dataFormat,f=a.left,h=a.top,p=i*r,g=tn(),m=d==="channelsLast",v=m?0:1,y=m?1:2,x="",E=0;E<=1;E++)for(var b=0;b<=1;b++)x+=`
          blockIndex = rc.y + `+b+`;
          pos = rc.x + `+E+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+o+" - "+h+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+e[v]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+s+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+i+`.));

              if(d1 < `+e[y]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+m+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*E+b)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*E+b)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+g.output+` = result;
      }
    `},A3=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var s,o=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";s=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+s+`;
        setOutput(val);
      }
    `},k3=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},L3=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s,o=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";s=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+s+`;
        setOutput(result);
      }
    `},D3=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,s=n.effectiveFilterWidth,o=i-1-n.padInfo.top,a=s-1-n.padInfo.left,u=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+s+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+s+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},P3=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,s=n.dilationHeight,o=n.dilationWidth,a=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=a-1-n.padInfo.front,d=u-1-n.padInfo.top,f=l-1-n.padInfo.left,h=a*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+d+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+s+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+o+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Dh=function(n,e,t,r,i,s,o){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),s===void 0&&(s=null),o===void 0&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=t?n[1]:n[2],u=Math.ceil(a/2),l=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";s&&(h=o?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+s+`
        }`:`vec4 activation(vec4 x) {
          `+s+`
        }`,p="result = activation(result);");var g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+f[0]+`);
          result += (`+d[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+g+`

        `+p+`

        setOutput(result);
      }
    `},O3=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),N3=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},F3=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=mn("rc",e),r=Je(e),i=function(a,u,l){if(a===1)return"rc > "+u[0];for(var c="",d=a-2;d<a;d++)c+=l[d]+" >= "+u[d],d<a-1&&(c+="||");return c}(e,n,t),s=function(a,u,l,c){if(a===1)return"";var d=c.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,n[n.length-1],n[n.length-2],t),o=function(a,u){var l=a.length,c=function(d,f){for(var h=[],p=0;p<=1;p++)for(var g=0;g<=1;g++){for(var m=(p===0?"r":"rp1")+", "+(g===0?"c":"cp1"),v=2;v<d;v++)m=f[f.length-1-v]+","+m;h.push(m)}return h}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+s+`

            setOutput(vec4(`+o+`));
          }
        }
      `}},M3=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=Je(r),s=e.map(function(u){return u[0]}).join(","),o=e.map(function(u,l){return u[0]+n[l]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+s+`);
      `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+s+`;
        int end = `+o+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},B3=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(m,v){return m[0]+n[v]+m[1]});for(var r=n.length,i=Je(r),s=e.map(function(m){return m[0]}).join(","),o=e.map(function(m,v){return m[0]+n[v]}).join(","),a=mn("rc",r),u=mn("source",r),l=a[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",d=[i+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,g=r===1?2:4;p<g;p++)h+=`
        `+d[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;h+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+s+`);
      const `+i+" end = "+i+"("+o+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},Ph=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,s=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var f=e==="avg",h="0.0";if(f||(h="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+s+`);
        const ivec2 pads = ivec2(`+c+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var g=4*Math.floor(r/4),m=r%4,v=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+s+`);
      const ivec2 pads = ivec2(`+c+", "+d+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+o+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+v+`
          }

          int xC = xCCorner + `+g+`;
          if (`+(m===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(m===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+v+`
          } else if (`+(m===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+v+`
          }
        }
        setOutput(`+p+`);
      }
    `}},Oh=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,s=n.strideHeight,o=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,h=n.padInfo.front,p=n.padInfo.top,g=n.padInfo.left;this.outputShape=n.outShape;var m=e==="avg",v="0.0";if(m||(v="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+s+", "+o+`);
        const ivec3 pads = ivec3(`+h+", "+p+", "+g+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+a+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(y="avgValue / count");var x=4*Math.floor(r/4),E=r%4,b=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+s+", "+o+`);
      const ivec3 pads = ivec3(`+h+", "+p+", "+g+`);
      const float initializationValue = `+v+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+v+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+b+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(E===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(E===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(E===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+b+`
            }
          }
          setOutput(`+y+`);
        }
      }
    `}},U3=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,s=Math.ceil(i/t);this.outputShape=[r,s];var o="0.0",a="";e==="prod"?o="1.0":e==="min"?(o="1.0 / 1e-20",a="min"):e==="max"&&(o="-1.0 / 1e-20",a="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(o="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(o="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+o+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+o+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},$3=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Ts(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+xv(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},G3=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],s=r[2],o=n.shape,a=o[1],u=o[2],l=[t&&a>1?i-1:i,t&&u>1?s-1:s],c=[t&&a>1?a-1:a,t&&u>1?u-1:u],d=l[0]/c[0],f=l[1]/c[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(s-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},W3=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],s=n[1],o=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?s-1:s,r&&t>1?o-1:o],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+s+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},V3=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],s=n[1],o=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?s-1:s,r&&t>1?o-1:o],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+s+".0, "+o+`.0,
                                     `+o+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},H3=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],s=r[2],o=n.shape,a=o[1],u=o[2],l=[t&&a>1?i-1:i,t&&u>1?s-1:s],c=[t&&a>1?a-1:a,t&&u>1?u-1:u],d=l[0]/c[0],f=l[1]/c[1],h=1/d,p=1/f,g=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+s+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},z3=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],s=n[1],o=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?s-1:s,r&&t>1?o-1:o],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+s+".0, "+o+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},j3=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(s,o){return function(a){return e.indexOf(a)!==-1&&n[a]!==1?n[a]+" - coords["+a+"] - 1":"coords["+a+"]"}(o)}).join(","),i=Je(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},K3=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=mn("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],s=r[t-2]+" + 1 < "+this.outputShape[t-2],o=Je(t);function a(u){var l=n.map(function(c,d){return function(f,h){return e.indexOf(f)!==-1&&n[f]!==1?n[f]+" - "+h[f]+" - 1":""+h[f]}(d,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+o+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return a(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",a(u)}(r.slice())+`;
          }
          if(`+s+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},b1=function(n,e,t,r,i,s,o){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;var a=Je(i.length),u=Je(s.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var f="getUpdates("+d+")",h=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},q3=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,s=n.numSegments,o=s*Math.ceil(i/t);this.outputShape=[r,o];var a=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+s+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+s+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},Y3=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var s=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=[],u=0;u<e.length;u++)a.push(""+s[u]),u<n&&o.push(""+s[u]);r=o.join(),i=a.join()}var l=Je(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},X3=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Je(this.rank),i="uniform int start["+this.rank+"];",s=function(o){if(o===1)return"sourceLoc";if(o<=6)return Nh.slice(0,o).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+o+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(o,a){return"sourceLoc."+Nh[a]+" = start["+a+"] + coords."+Nh[a]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+s+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),Nh=["x","y","z","w","u","v"],Q3=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Je(this.rank),r=mn("coords",this.rank),i=mn("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",o="getChannel(getSource("+i.join()+"), "+s+")",a=`
      result.x = `+o+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+o+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,d){return"start["+d+"]"}).join()+");":e.map(function(c,d){return i[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+a+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),J3=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=Je(t.length),s=Je(t.length),o="";if(r===1)o="coords * strides + begin";else{var a=0;o=t.map(function(u,l){return a++,t.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(a-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+o+`));
      }
    `},Z3=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,s=S1(t,r),o=w1(e,s,r);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[o].shift();return this.usedTextures[o].push(a),a}return this.numUsedTextures++,this.log(),s===Cn.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===Cn.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===Cn.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===Cn.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===Cn.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var s=w1(t,S1(r,i),i);s in this.freeTextures||(this.freeTextures[s]=[]),this.freeTextures[s].push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[s],a=o.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function S1(n,e){if(n===kn.UPLOAD)return Cn.PACKED_2X2_FLOAT32;if(n===kn.RENDER||n==null)return function(t){return Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Cn.PACKED_2X2_FLOAT32:Cn.UNPACKED_FLOAT32:t?Cn.PACKED_2X2_FLOAT16:Cn.UNPACKED_FLOAT16}(e);if(n===kn.DOWNLOAD||n===kn.PIXELS)return Cn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function w1(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var e4=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=Je(this.rank),s=function(o){var a=o.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+o[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<o.length;c++)l.push("imod("+u[c]+", "+o[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+s+`));
      }
    `},t4=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=Je(this.rank),s=function(o){var a=o.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(a),c=0;c<o.length;c++)l[o[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+s+`));
    }
    `},n4=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Je(this.rank),s=h_("rc",this.rank),o=new Array(this.rank);for(r=0;r<e.length;r++)o[e[r]]=s[r];var a="vec2("+o.slice(-2).join()+")",u="++"+s[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+o.join()+"), "+a+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+s[this.rank-1]+`;
      if(++`+s[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},Ev=1.7580993408473768,bv=1.0507009873554805,Re=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},xr="if (isnan(x)) return x;",r4="return x;",T1="return abs(x);",y_=xr+`
  return (x < 0.0) ? 0.0 : x;
`,x_=xr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,E_="return (x >= 0.0) ? x : (exp(x) - 1.0);",i4=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Ev+`;
  float scale = `+bv+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,_1="return -x;",I1="return ceil(x);",R1="return floor(x);",C1="return exp(x);",A1="return exp(x) - 1.0;",s4=xr+`
  return sin(x);
`,o4=xr+`
  return cos(x);
`,a4=xr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,u4=xr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,l4=xr+`
  return atan(x);
`,c4=xr+"return log(x + sqrt(x * x + 1.0));",d4=xr+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,f4=xr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Ol="return x;",h4="return x;",b_=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,S_=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,w_=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_a=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},p4=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=mn("rc",e),r=Je(e),i=function(a,u){if(a===1)return"rc";for(var l="",c=0;c<a;c++)l+=u[c],c<a-1&&(l+=",");return l}(e,t),s=t.slice(-2),o=e<=1?"rc":"vec2("+s.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+o+`));
      }
    `},Nl={};function Fl(n,e){if(e===void 0&&(e=!1),n==="linear")return e?h4:r4;if(n==="relu")return e?b_:y_;if(n==="elu")return e?w_:E_;if(n==="relu6")return e?S_:x_;if(n==="prelu")return e?v_:m_;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var g4=600,m4=function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!Q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var s=Hr(Q().getNumber("WEBGL_VERSION"));i.binaryCache=((r=Q().getNumber("WEBGL_VERSION"))in Nl||(Nl[r]={}),Nl[r]),i.gpgpu=new R3(s),i.canvas=s.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new Z3(i.gpgpu),i.numMBBeforeWarning=Q().global.screen==null?1024:Q().global.screen.height*Q().global.screen.width*window.devicePixelRatio*g4/1024/1024,i.texData=new i_(i,F),i}return yr(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(Q().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var s={};return this.texData.set(s,{shape:r,dtype:i,values:t,usage:kn.UPLOAD}),s},e.prototype.move=function(t,r,i,s){if(Q().getBool("DEBUG")&&this.checkNumericalProblems(r),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:s,values:r,usage:kn.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,s=r.dtype,o=r.complexTensors,a=r.slice,u=r.shape,l=r.isPacked;if(a!=null){var c=void 0;c=l?new _a(u,Ol):new Re(u,Ol);var d=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:s}],s),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(i!=null)return this.convertAndCacheOnCPU(t);if(s==="string")return i;var h,p,g=this.activeTimers!=null;return g&&(h=Ar()),s==="complex64"?p=kg(o.real.dataSync(),o.imag.dataSync()):p=this.getValuesFromTexture(t),g&&(this.downloadWaitMs+=Ar()-h),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return le(this,void 0,void 0,function(){var r,i,s,o,a,u,l,c,d,f,h,p,g,m,v,y,x,E,b,S,w,T;return ce(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(_){return r.push(_)})];if(i=this.texData.get(t),s=i.values,o=i.shape,a=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,a!=null)return d=void 0,d=c?new _a(o,Ol):new Re(o,Ol),f=this.runWebGLProgram(d,[{dataId:t,shape:o,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(s!=null)return[2,this.convertAndCacheOnCPU(t)];if(!Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&Q().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(t),m=this.texData.get(g.dataId),p=(T=this.gpgpu).createBufferFromTexture.apply(T,[m.texture].concat(Ka(o)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return y=R.sent(),x=y[0],E=y[1],v=kg(x,E),[3,5];case 4:p==null?v=this.getValuesFromTexture(t):(b=fe(o),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,b)),R.label=5;case 5:return g!=null&&this.disposeData(g.dataId),S=this.convertAndCacheOnCPU(t,v),w=this.pendingRead.get(t),this.pendingRead.delete(t),w.forEach(function(_){return _(S)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,S]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!iM(i))throw Q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),s=i.shape,o=i.dtype,a=i.isPacked,u=fe(s);if(Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Ka(s))).subarray(0,u);return this.disposeData(l.dataId),d}var f=Q().getBool("WEBGL_PACK")&&a===!0,h=f?Ch(s):s,p=f?new r3(h):new n3(h),g=this.runWebGLProgram(p,[{shape:h,dtype:o,dataId:t}],"float32"),m=this.texData.get(g.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),v},e.prototype.time=function(t){return le(this,void 0,void 0,function(){var r,i,s,o,a,u,l;return ce(this,function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],s=!1,this.programTimersStack==null?(this.programTimersStack=i,s=!0):this.activeTimers.push(i),this.activeTimers=i,t(),o=Jo(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),a=Jo(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,s&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return l=c.sent(),u.kernelMs=BF(l),u.getExtraProfileInfo=function(){return l.map(function(d,f){return{name:a[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ar(),endMs:null}},e.prototype.endTimer=function(t){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Ar(),t)},e.prototype.getQueryTime=function(t){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,s=r.dtype,o=r.texShape,a=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||t,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(o,s),this.textureManager.releaseTexture(i,o,a,u)));var f=this.texData.get(t);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Q().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=F.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every(function(s){return i.texData.get(s.dataId).texture==null&&s.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:F.keep(t.clone()),imag:F.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(fe(i)===0)return Wt([],i,t.dtype);var s=this.texData.get(t.dataId).isPacked,o=n_(t.shape,r,i);if(s||!o){var a=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Q3(i):new X3(i),u=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var s=this.texData.get(t.dataId),o=this.makeOutput(i,t.dtype),a=this.texData.get(o.dataId);Object.assign(a,s),a.shape=i,a.dtype=t.dtype;var u=r_(r,t.strides);s.slice&&(u+=s.slice.flatOffset),a.slice={flatOffset:u,origDataId:s.slice&&s.slice.origDataId||t.dataId};var l=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,l+1),o},e.prototype.stridedSlice=function(t,r,i,s){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,s);var o=pv(r,i,s);if(o.some(function(u){return u===0}))return Wt([],o);var a=new J3(r,s,o);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var i=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new K3(t.shape,r):new j3(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map(function(h){return Yn(h)}),s=t.map(function(h){return Dr(h)});return $t(this.concat(i,r),this.concat(s,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>Q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),a=this.concat(t.slice(0,o),r),u=this.concat(t.slice(o),r);return this.concat([a,u],r)}if(Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var l=new WB(t.map(function(h){return h.shape}),r);return this.compileAndRun(l,t)}var c=ea(t.map(function(h){return h.shape}),r),d=t.map(function(h){return h.as2D(-1,fe(h.shape.slice(r)))}),f=new GB(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,_1,t.dtype);var r=new Re(t.shape,_1);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,s){var o=i?t.shape[2]:t.shape[1],a=s?r.shape[1]:r.shape[2],u=i?t.shape[1]:t.shape[2],l=t.shape[0];if((o===1||a===1)&&u>1e3){i&&(t=t.transpose([0,2,1])),s&&(r=r.transpose([0,2,1]));var c=a===1?t:t.as3D(l,u,1),d=a===1?2:1,f=a===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(d,!0)}var h=Gt(t.dtype,r.dtype),p=new Dh(t.shape,[l,o,a],i,s);return this.compileAndRun(p,[t,r],h)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,s=t.transposeA,o=t.transposeB,a=t.bias,u=t.activation,l=t.preluActivationWeights,c=s?r.shape[2]:r.shape[1],d=o?i.shape[1]:i.shape[2],f=r.shape[0],h=Gt(r.dtype,i.dtype),p=a!=null,g=l!=null,m=u?Fl(u,!0):null,v=new Dh(r.shape,[f,c,d],s,o,p,m,g),y=[r,i];return a&&y.push(a),l&&y.push(l),this.compileAndRun(v,y,h)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),s=this.texData.get(r.dataId),o=new h1(FB,t.shape,r.shape),a=new h1(MB,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,s.complexTensors.real),this.makeComplexComponentTensorInfo(r,s.complexTensors.imag)],l=this.compileAndRun(o,u),c=this.compileAndRun(a,u),d=this.complex(l,c);return l.dispose(),c.dispose(),d}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,p1,t.dtype);var f=new gt(p1,t.shape,r.shape);return this.compileAndRun(f,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,s,o,a){var u=[t,r,i],l=null;a!=null&&(l=a.shape,u.push(a));var c=null;if(o!=null&&(c=o.shape,u.push(o)),Q().getBool("WEBGL_PACK_NORMALIZATION")){var d=new NB(t.shape,r.shape,i.shape,l,c,s);return this.compileAndRun(d,u)}var f=new OB(t.shape,r.shape,i.shape,l,c,s);return this.compileAndRun(f,u)},e.prototype.localResponseNormalization4D=function(t,r,i,s,o){var a=Q().getBool("WEBGL_PACK_NORMALIZATION")?new L3(t.shape,r,i,s,o):new A3(t.shape,r,i,s,o);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,i,s,o,a,u){var l=new k3(r.shape,s,o,a,u);return this.compileAndRun(l,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(o){return nd(o)});return d_(we(t.shape,t.dtype,i),r)}var s=new e4(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.pad=function(t,r,i){var s=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B3(t.shape,r,i):new M3(t.shape,r,i);return this.compileAndRun(s,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new n4(t.shape,r):new t4(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var s=new l3(t.shape,r.size,i);return this.compileAndRun(s,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){L(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=r.reduce(function(d,f){return d*f}),o=ud(t.shape,r,s),a=ld(o.length,r.length),u=cd(t.shape,r,s),l=JT(i,r.length),c=ZT(u,i,r.length);return t.reshape(o).transpose(a).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){L(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=r.reduce(function(f,h){return f*h}),o=[[0,0]];o.push.apply(o,i);for(var a=1+r.length;a<t.shape.length;++a)o.push([0,0]);var u=t.pad(o),l=ud(u.shape,r,s,!1),c=ld(l.length,r.length,!1),d=cd(u.shape,r,s,!1);return u.reshape(l).transpose(c).reshape(d)},e.prototype.reduce=function(t,r,i){var s=t.shape[0],o=t.shape[1],a=Ah(o),u=new U3({windowSize:a,inSize:o,batchSize:s},r),l=this.compileAndRun(u,[t],i);return l.shape[1]===1?l:this.reduce(l,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var s=t.shape[0],o=t.shape[1];i!=null&&(s=i.shape[0],o=i.shape[1]);var a=Ah(o),u=new _B({windowSize:a,inSize:o,batchSize:s},r,i==null),l=[t];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var s=i!=null?i.shape:t.shape,o=Ah(s[s.length-1]),a=new LB(s,o,r,i==null),u=i==null?[t]:[t,i],l=this.compileAndRun(a,u,"int32");return l.rank===t.rank?this.argReducePacked(t,r,l):l},e.prototype.sum=function(t,r){In("sum",r,t.rank);var i=Qt(t.shape,r),s=i[0],o=fe(i[1]),a=t.as2D(-1,o),u=bh(t.dtype);return this.reduce(a,"sum",u).reshape(s)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=Qt(t.shape,r),s=i[0],o=fe(i[1]),a=t.as2D(-1,o),u=bh(t.dtype);return this.reduce(a,"prod",u).reshape(s)},e.prototype.unsortedSegmentSum=function(t,r,i){var s=0,o=zr([s],t.rank),a=t;o!=null&&(a=t.transpose(o),s=jr(1,t.rank)[0]);var u=function(h,p,g){for(var m=[],v=h.length,y=0;y<v;y++)y!==p?m.push(h[y]):m.push(g);return m}(a.shape,s,i),l=fe([a.shape[s]]),c=a.as2D(-1,l),d=bh(t.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,d,i).reshape(u);return o!=null&&(f=f.transpose(cv(o))),f},e.prototype.segOpCompute=function(t,r,i,s,o){var a=t.shape[0],u=t.shape[1],l=function(f,h){var p,g=!1;for(f<=t_?(p=f,g=!0):p=bg(f,Math.floor(Math.sqrt(f)));!g;)p>h||p===f?g=!0:p=bg(f,p+1);return p}(u,o),c=new q3({windowSize:l,inSize:u,batchSize:a,numSegments:o}),d=this.compileAndRun(c,[t,i],s);return d.shape[1]===o?d:(i=ad(0,o).tile([u/l]),this.segOpCompute(d,r,i,s,o))},e.prototype.argMinMaxReduce=function(t,r,i){var s=[r];if(In("arg"+i.charAt(0).toUpperCase()+i.slice(1),s,t.rank),!Q().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=Qt(t.shape,s),a=o[0],u=fe(o[1]),l=t.as2D(-1,u);return this.argReduce(l,i).reshape(a)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,s){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var o=new QB(t.shape,i,s);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new gt("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new gt("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new gt("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new gt("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new gt("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new gt("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new Re(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new gt("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new gt("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var s=new Y3(t.rank,r.shape,r.rank);return this.compileAndRun(s,[t,r,i],Gt(r.dtype,i.dtype))},e.prototype.where=function(t){sd("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return yv(t.shape,r)},e.prototype.topk=function(t,r,i){return f_(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){In("min",r,t.rank);var i=Qt(t.shape,r),s=i[0],o=fe(i[1]),a=t.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(s)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);In("max",r,t.rank);var i=Qt(t.shape,r),s=i[0],o=fe(i[1]),a=t.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(s)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){In("all",r,t.rank);var i=Qt(t.shape,r),s=i[0],o=fe(i[1]),a=t.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(s)},e.prototype.any=function(t,r){In("any",r,t.rank);var i=Qt(t.shape,r),s=i[0],o=fe(i[1]),a=t.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(s)},e.prototype.realDivide=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new gt(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new gt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,kh);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=Gt(t.dtype,r.dtype);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,kh,i);var s=new gt(kh,t.shape,r.shape);return this.compileAndRun(s,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var s=new _a(t.shape,r);return this.compileAndRun(s,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,s,o){o===void 0&&(o=!1);var a=new Zr(i,t.shape,r.shape,o);return this.compileAndRun(a,[t,r],s)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var s=this,o=this.texData.get(t.dataId),a=this.texData.get(r.dataId),u=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],g=s.makeComplexComponentTensorInfo(t,h),m=s.makeComplexComponentTensorInfo(r,p),v=new gt(i,t.shape,r.shape);return s.compileAndRun(v,[g,m],Gt(h.dtype,p.dtype))}),l=u[0],c=u[1],d=this.complex(l,c);return l.dispose(),c.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>Q().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),s=this.addN(t.slice(r));return this.addN([i,s])}var o=t.map(function(l){return l.dtype}).reduce(function(l,c){return Gt(l,c)}),a=t.map(function(l){return l.shape}),u=Q().getBool("WEBGL_PACK")?new TB(t[0].shape,a):new wB(t[0].shape,a);return this.compileAndRun(u,t,o)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Lh);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=Gt(t.dtype,r.dtype);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Lh,t.dtype);var s=new gt(Lh,t.shape,r.shape);return this.compileAndRun(s,[t,r],i)},e.prototype.pow=function(t,r){var i=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),s=Gt(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],s)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,I1,t.dtype);var r=new Re(t.shape,I1);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,R1,t.dtype);var r=new Re(t.shape,R1);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new Re(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new Re(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new Re(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new Re(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new Re(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,C1,t.dtype);var r=new Re(t.shape,C1);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,A1,t.dtype);var r=new Re(t.shape,A1);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=Lt([r],t.shape),s=this.max(t,i),o=wn(s.shape,i),a=this.subtract(t,s.reshape(o)),u=this.exp(a),l=this.sum(u,i).reshape(o);return this.realDivide(u,l)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new Re(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new Re(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new Re(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Re(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new Re(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=Q().getBool("WEBGL_PACK")?new _a(t.shape,b_):new Re(t.shape,y_),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=Q().getBool("WEBGL_PACK")?new _a(t.shape,S_):new Re(t.shape,x_),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(v_,t.shape,r.shape):new gt(m_,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,w_,t.dtype);var r=new Re(t.shape,E_);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new gt("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new Re(t.shape,i4);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new Re(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var s,o=(s=Q().getBool("WEBGL_PACK_CLIP")?new UB(t.shape):new BB(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(s,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,T1,t.dtype);var r=new Re(t.shape,T1);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new $B(t.shape),s=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,s)},e.prototype.sigmoid=function(t){var r=new Re(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new Re(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new Re(t.shape,s4);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new Re(t.shape,o4);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new Re(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new Re(t.shape,a4);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new Re(t.shape,u4);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new Re(t.shape,l4);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new gt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new Re(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new Re(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new Re(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new Re(t.shape,c4);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new Re(t.shape,d4);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new Re(t.shape,f4);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new Re(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new Re(t.shape,function(s){return s===void 0&&(s=0),xr+`
    return x > 0.0 ? 1.0 : float(`+s+`);
  `}(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,s,o,a){var u=t.shape,l=this.texData.get(t.dataId),c=i.inChannels,d=u[0]*u[1]*u[2],f=i.outChannels,h=i.dataFormat==="channelsLast",p=(d===1||f===1)&&c>1e3,g=u[2]%2!=0&&!!l.isPacked;if(p||!Q().getBool("WEBGL_LAZILY_UNPACK")||!Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var m=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],v=this.reshape(t,[1,m,i.inChannels]),y=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:y,transposeA:!1,transposeB:!1,bias:s,activation:o,preluActivationWeights:a}),i.outShape)}var x=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),E={dataId:t.dataId,shape:[1,x,i.inChannels],dtype:t.dtype},b=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,L(Dl(l.shape,E.shape),function(){return"packed reshape "+l.shape+" to "+E.shape+" isn't free"});var S=this.reshape(r,[1,i.inChannels,i.outChannels]),w=this.fusedBatchMatMul({a:E,b:S,transposeA:!1,transposeB:!1,bias:s,activation:o,preluActivationWeights:a}),T=this.texData.get(w.dataId);return L(T.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=b,T.shape=i.outShape,F.makeTensorFromDataId(w.dataId,i.outShape,w.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,s,o,a){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,d=i.outWidth,f=i.outHeight,h=i.dataFormat==="channelsLast",p=u*l*c,g=f*d,m=[p,g],v=t.squeeze([0]),y=r.reshape([1,p,-1]),x=new C3(m,v.shape,i),E=this.compileAndRun(x,[v]).reshape([1,m[0],m[1]]),b=s!=null,S=a!=null,w=o?Fl(o,!0):null,T=new Dh(E.shape,[1,g,i.outChannels],!0,!1,b,w,S),R=[E,y];s&&R.push(s),S&&R.push(a);var _=this.compileAndRun(T,R);return h?_.reshape([1,f,d,i.outChannels]):_.reshape([1,i.outChannels,f,d])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,s=t.convInfo,o=t.bias,a=t.activation,u=t.preluActivationWeights;if(s.filterHeight===1&&s.filterWidth===1&&s.dilationHeight===1&&s.dilationWidth===1&&s.strideHeight===1&&s.strideWidth===1&&(s.padInfo.type==="SAME"||s.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,s,o,a,u);if(Q().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,s,o,a,u);var l=o!=null,c=u!=null,d=a?Fl(a,!1):null,f=new g1(s,l,d,c),h=[r,i];return o&&h.push(o),u&&h.push(u),this.compileAndRun(f,h)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(Q().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var s=new g1(i);return this.compileAndRun(s,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var s=new HB(i);return this.compileAndRun(s,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var s=new VB(i);return this.compileAndRun(s,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,s=t.filter,o=t.convInfo,a=t.bias,u=t.activation,l=t.preluActivationWeights,c=Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,d=u?Fl(u,c):null,f=[i,s],h=a!=null,p=l!=null;return h&&f.push(a),p&&f.push(l),c?(r=new v1(o,h,d,p),this.compileAndRun(r,f)):(r=new m1(o,h,d,p),this.compileAndRun(r,f))},e.prototype.depthwiseConv2D=function(t,r,i){var s;return Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(s=new v1(i),this.compileAndRun(s,[t,r])):(s=new m1(i),this.compileAndRun(s,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var s=new qB(i);return this.compileAndRun(s,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var s=new KB(i);return this.compileAndRun(s,[t,r])},e.prototype.conv3d=function(t,r,i){var s=new YB(i);return this.compileAndRun(s,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var s=new jB(i);return this.compileAndRun(s,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var s=new zB(i);return this.compileAndRun(s,[t,r])},e.prototype.maxPool=function(t,r){var i=new Ph(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new Ph(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,s){var o=new Ph(s,"max",!0),a=this.compileAndRun(o,[r]),u=new D3(s),l=this.compileAndRun(u,[t,a],r.dtype);return a.dispose(),l},e.prototype.avgPoolBackprop=function(t,r,i){var s=new DB(i);return this.compileAndRun(s,[t],r.dtype)},e.prototype.cast=function(t,r){return a_(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],s=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==r&&(s[o++]=t.shape[a]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(t,u,l).reshape(s);return c},e.prototype.avgPool3d=function(t,r){var i=new Oh(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var s=new PB(i);return this.compileAndRun(s,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new Oh(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,s){var o=new Oh(s,"max",!0),a=this.compileAndRun(o,[r]),u=new P3(s),l=this.compileAndRun(u,[t,a],r.dtype);return a.dispose(),l},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!Dl(t.shape,r)&&(i.texture===null||!Dl(i.shape,r))){var s=this.packedReshape(t,r);return F.makeTensorFromDataId(s.dataId,s.shape,s.dtype)}return Ag(t,r)},e.prototype.resizeBilinear=function(t,r,i,s){var o=Q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new V3(t.shape,r,i,s):new W3(t.shape,r,i,s);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var s=new G3(t,r,i);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,s){var o=new z3(t.shape,r,i,s);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var s=new H3(t,r,i);return this.compileAndRun(s,[t])},e.prototype.multinomial=function(t,r,i,s){var o=r?t:xi(t),a=o.shape[0],u=o.shape[1],l=new O3(a,u,i),c=l.getCustomSetupFunc(s);return this.compileAndRun(l,[o],"int32",c)},e.prototype.oneHot=function(t,r,i,s){var o=new N3(t.size,r,i,s);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var r=new t3(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,s,o){return sd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),mv(t.dataSync(),r.dataSync(),i,s,o)},e.prototype.cropAndResize=function(t,r,i,s,o,a){var u=new XB(t.shape,r.shape,s,o,a);return this.compileAndRun(u,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){L(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var s=t.shape[0],o=i==="NHWC"?t.shape[1]:t.shape[2],a=i==="NHWC"?t.shape[2]:t.shape[3],u=i==="NHWC"?t.shape[3]:t.shape[1],l=o*r,c=a*r,d=u/(r*r),f=new e3(i==="NHWC"?[s,l,c,d]:[s,d,l,c],r,i);return this.compileAndRun(f,[t])},e.prototype.split=function(t,r,i){return c_(t,r,i)},e.prototype.scatterND=function(t,r,i){var s=dd(0,t,i),o=s.sliceRank,a=s.numUpdates,u=s.sliceSize,l=s.strides,c=s.outputSize,d=[c/u,u],f=t.reshape([a,o]),h=r.reshape([a,u]);if(c===0)return Ag(Wt([]),i);var p=re(0),g=new b1(a,o,f.rank,h.rank,l,d);return this.compileAndRun(g,[h,f,p]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,s){var o=dd(0,t,i),a=o.sliceRank,u=o.numUpdates,l=o.strides,c=o.outputSize,d=new b1(u,a,t.rank,r.rank,l,[c,1]);return this.compileAndRun(d,[r,t,s]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),s=new x1(o3,t.shape,r),o=new x1(a3,t.shape,r),a=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(s,a),l=this.compileAndRun(o,a),c=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(t,r){var i=r.shape,s=i[i.length-1],o=e_(t,r),a=o[0],u=o[1],l=o[2],c=o[3],d=r.reshape([u,s]),f=t.reshape([t.size/l,l]),h=new c3(s,c,[u,l]);return this.compileAndRun(h,[f,d]).reshape(a)},e.prototype.fill=function(t,r,i){if((i=i||Gu(r))==="string"){var s=td(i,fe(t));return s.fill(r),F.makeTensor(s,t,i,this)}var o=new u3(t,r),a=o.getCustomSetupFunc(r);return this.compileAndRun(o,[],i,a)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return u_(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return F.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new p4(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new F3(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[rd(t.shape)].concat(id(t.shape)),s={dtype:t.dtype,shape:i,dataId:t.dataId},o=[rd(r)].concat(id(r)),a=new $3(o,i),u=this.runWebGLProgram(a,[s],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),s=i.isPacked,o=i.shape,a=i.dtype,u=Ch(o);return r=s?new ZB(u):new JB(u),{dtype:a,shape:o,dataId:this.runWebGLProgram(r,[{shape:u,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,s,o){var a=this;o===void 0&&(o=!1);var u=this.makeTensorInfo(t.outputShape,i),l=this.texData.get(u.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===Ru.DENSE){var c=Ka(t.outputShape);l.texShape=c.map(function(x){return 2*x})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),fe(u.shape)===0)return l.values=_u(u.dtype,0),u;var d=[],f=r.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var E=a.texData.get(x.dataId);if(E.texture==null){if(!t.packedInputs&&fe(x.shape)<=Q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:E.values};t.packedInputs&&(E.isPacked=!0,E.shape=x.shape)}else if(!!E.isPacked!=!!t.packedInputs)x=E.isPacked?a.unpackTensor(x):a.packTensor(x),d.push(x),E=a.texData.get(x.dataId);else if(E.isPacked&&!Dl(E.shape,x.shape)){var b=x,S=x.shape;x.shape=E.shape,x=a.packedReshape(x,S),d.push(x),E=a.texData.get(x.dataId),b.shape=S}return a.uploadToGPU(x.dataId),{shape:x.shape,texData:E,isUniform:!1}});this.uploadToGPU(u.dataId);var h,p={shape:u.shape,texData:l,isUniform:!1},g=function(x,E,b){var S="";E.concat(b).forEach(function(R){var _=R.texData!=null&&R.texData.slice!=null&&R.texData.slice.flatOffset>0,A=R.isUniform?"uniform":R.texData.texShape;S+=R.shape+"_"+A+"_"+_});var w=x.userCode,T=x.constructor.name;return T+="_"+S+"_"+w}(t,f,p),m=this.getAndSaveBinary(g,function(){return function(x,E,b,S){var w=E.userCode,T=b.map(function(D,P){var O={logicalShape:D.shape,texShape:D.isUniform?null:D.texData.texShape,isUniform:D.isUniform,isPacked:!D.isUniform&&D.texData.isPacked,flatOffset:null};return D.texData!=null&&D.texData.slice!=null&&D.texData.slice.flatOffset>0&&(O.flatOffset=D.texData.slice.flatOffset),{name:E.variableNames[P],shapeInfo:O}}),R=T.map(function(D){return D.shapeInfo}),_={logicalShape:S.shape,texShape:S.texData.texShape,isUniform:!1,isPacked:S.texData.isPacked,flatOffset:null},A=IB(T,_,w,E.packedInputs),k=x.createProgram(A),G=null,U=x.getUniformLocation(k,"NAN",!1);Q().getNumber("WEBGL_VERSION")===1&&(G=x.getUniformLocation(k,"INFINITY",!1));for(var M={},B=0;B<E.variableNames.length;B++){var $=E.variableNames[B];M[$]=x.getUniformLocation(k,$,!1),M["offset"+$]=x.getUniformLocation(k,"offset"+$,!1)}return{program:E,source:A,webGLProgram:k,uniformLocations:M,inShapeInfos:R,outShapeInfo:_,infLoc:G,nanLoc:U}}(a.gpgpu,t,f,p)}),v=this.activeTimers!=null;if(v&&(h=this.startTimer()),function(x,E,b,S,w){E1(E.inShapeInfos,b),E1([E.outShapeInfo],[S]);var T=S.texData.texture,R=S.texData.texShape;S.texData.isPacked?x.setOutputPackedMatrixTexture(T,R[0],R[1]):x.setOutputMatrixTexture(T,R[0],R[1]),x.setProgram(E.webGLProgram),Q().getNumber("WEBGL_VERSION")===1&&E.infLoc!==null&&x.gl.uniform1f(E.infLoc,1/0),E.nanLoc!==null&&x.gl.uniform1f(E.nanLoc,NaN),b.forEach(function(_,A){var k=E.program.variableNames[A],G=E.uniformLocations[k],U=E.uniformLocations["offset"+k];if(G!=null)if(_.isUniform)if(fe(_.shape)<2)x.gl.uniform1f(G,_.uniformValues[0]);else{var M=_.uniformValues;M instanceof Float32Array||(M=new Float32Array(M)),x.gl.uniform1fv(G,M)}else _.texData.slice!=null&&U!=null&&x.gl.uniform1i(U,_.texData.slice.flatOffset),x.setInputMatrixTexture(_.texData.texture,G,A)}),w!=null&&w(x,E.webGLProgram),x.executeProgram()}(this.gpgpu,m,f,p,s),d.forEach(function(x){return a.disposeData(x.dataId)}),v&&(h=this.endTimer(h),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(h)})),!Q().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var y=this.unpackTensor(u);return this.disposeData(u.dataId),y}return u},e.prototype.compileAndRun=function(t,r,i,s,o){o===void 0&&(o=!1),i=i||r[0].dtype;var a=this.runWebGLProgram(t,r,i,s,o);return F.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ae(function(){if(!Q().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Q().getBool("DEBUG");Q().set("DEBUG",!1);var i=t.abs(re(1e-8)).dataSync()[0];if(Q().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),s=i.shape,o=i.dtype,a=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var d,f=this.activeTimers!=null;f&&(d=Ar());var h=i.texShape;if(h==null&&(h=SM(s,c),i.texShape=h),a!=null){var p=Ch(s),g=void 0,m=h[1],v=h[0],y=a instanceof Uint8Array;c?(m=(r=Vu(h[0],h[1]))[0],v=r[1],g=new s3(p,[v,m],y)):g=new i3(p,[v,m],y);var x=this.makeTensorInfo([v,m],o);this.texData.get(x.dataId).usage=y?kn.PIXELS:kn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),m,v,a);var E=this.runWebGLProgram(g,[x],o,null,!0),b=this.texData.get(E.dataId);i.texture=b.texture,i.texShape=b.texShape,i.isPacked=b.isPacked,i.usage=b.usage,this.disposeData(x.dataId),this.texData.delete(E.dataId),i.values=null,f&&(this.uploadWaitMs+=Ar()-d)}else{var S=this.acquireTexture(h,l,o,c);i.texture=S}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),s=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=function(o,a){if(a==="float32"||a==="complex64")return o;if(a==="int32"||a==="bool"){for(var u=a==="int32"?new Int32Array(o.length):new Uint8Array(o.length),l=0;l<u.length;++l)u[l]=Math.round(o[l]);return u}throw new Error("Unknown dtype "+a)}(r,s)),i.values},e.prototype.acquireTexture=function(t,r,i,s){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,s)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*FT(r)},e}(s_);VT()&&F.registerBackend("webgl",function(){return new m4},2);var v4=N({square_:function(n){var e=C(n,"x","square"),t=[e];return F.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},t,[])}}),Au="SquaredDifference",T_=N({squaredDifference_:function(n,e){var t,r=C(n,"a","squaredDifference"),i=C(e,"b","squaredDifference");t=pt(r,i),r=t[0],i=t[1],Pe(r.shape,i.shape);var s={a:r,b:i},o=[r,i];return F.runKernelFunc(function(a,u){var l=a.squaredDifference(r,i);return u([r,i]),l},s,function(a,u){var l=u[0],c=u[1],d=re(2);return{a:function(){return a.mul(l.sub(c).mul(d))},b:function(){return a.mul(c.sub(l).mul(d))}}},Au,{},o,[])}}),y4=N({abs_:function(n){var e=C(n,"x","abs");return e.dtype==="complex64"?F.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):F.runKernelFunc(function(t,r){var i=t.abs(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),x4=N({acos_:function(n){var e=C(n,"x","acos");return F.runKernelFunc(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(re(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),E4=N({acosh_:function(n){var e=C(n,"x","acosh");return F.runKernelFunc(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),b4=N({asin_:function(n){var e=C(n,"x","asin");return F.runKernelFunc(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(re(1).sub(i.toFloat().square()).sqrt())}}})}}),S4=N({asinh_:function(n){var e=C(n,"x","asinh");return F.runKernelFunc(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(re(1).add(i.toFloat().square()).sqrt())}}})}}),w4=N({atan_:function(n){var e=C(n,"x","atan");return F.runKernelFunc(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),T4=N({atanh_:function(n){var e=C(n,"x","atanh");return F.runKernelFunc(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(re(1).sub(i.toFloat().square()))}}})}}),_4=N({ceil_:function(n){var e=C(n,"x","ceil");return F.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Me(t)}}})}}),Sv=N({clipByValue_:function(n,e,t){var r=C(n,"x","clipByValue");L(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var i=[r],s={min:e,max:t};return F.runKernelFunc(function(o,a){var u=o.clip(r,e,t);return a([r]),u},{x:r},function(o,a){var u=a[0];return{x:function(){return o.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),Me(o))}}},"ClipByValue",s,i)}}),I4=N({cos_:function(n){var e=C(n,"x","cos"),t=[e];return F.runKernelFunc(function(r,i){var s=r.cos(e);return i([e]),s},{x:e},function(r,i){var s=i[0];return{x:function(){return s.toFloat().sin().neg().mul(r)}}},"Cos",{},t)}}),R4=N({cosh_:function(n){var e=C(n,"x","cosh");return F.runKernelFunc(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),C4=N({erf_:function(n){var e=C(n,"x","erf");return L(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),F.runKernelFunc(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Lg=N({exp_:function(n){var e=C(n,"x","exp");return F.runKernelFunc(function(t,r){var i=t.exp(e);return r([i]),i},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),A4=N({expm1_:function(n){var e=C(n,"x","expm1");return F.runKernelFunc(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),k4=N({floor_:function(n){var e=C(n,"x","floor");return F.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Me(t)}}})}}),L4=N({log_:function(n){var e=C(n,"x","log"),t=[e];return F.runKernelFunc(function(r,i){var s=r.log(e);return i([e]),s},{x:e},function(r,i){var s=i[0];return{x:function(){return r.div(s.toFloat())}}},"Log",{},t)}}),D4=N({log1p_:function(n){var e=C(n,"x","log1p");return F.runKernelFunc(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),P4=N({logSigmoid_:function(n){var e=C(n,"x","logSigmoid");return F.runKernelFunc(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),gd=N({neg_:function(n){var e=C(n,"x","neg"),t=[e];return F.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},t)}}),O4=N({reciprocal_:function(n){var e=C(n,"x","reciprocal");return F.runKernelFunc(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),N4=N({round_:function(n){var e=C(n,"x","round");return F.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Me(t)}}})}}),__=N({rsqrt_:function(n){var e=C(n,"x","rsqrt"),t=[e];return F.runKernelFunc(function(r,i){var s=r.rsqrt(e);return i([e]),s},{x:e},function(r,i){var s=i[0];return{x:function(){return r.div(s.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),I_=N({sigmoid_:function(n){var e=C(n,"x","sigmoid");return F.runKernelFunc(function(t,r){var i=t.sigmoid(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(re(1).sub(i)))}}},"Sigmoid")}}),F4=N({sign_:function(n){var e=C(n,"x","sign");return F.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Me(t)}}})}}),M4=N({isNaN_:function(n){var e=C(n,"x","isNaN");return F.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Me(t)}}})}}),B4=N({isInf_:function(n){var e=C(n,"x","isInf");return F.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Me(t)}}})}}),U4=N({isFinite_:function(n){var e=C(n,"x","isFinite");return F.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Me(t)}}})}}),$4=N({sin_:function(n){var e=C(n,"x","sin"),t=[e];return F.runKernelFunc(function(r,i){var s=r.sin(e);return i([e]),s},{x:e},function(r,i){var s=i[0];return{x:function(){return s.toFloat().cos().mul(r)}}},"Sin",{},t)}}),G4=N({sinh_:function(n){var e=C(n,"x","sinh");return F.runKernelFunc(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),W4=N({softplus_:function(n){var e=C(n,"x","softplus");return F.runKernelFunc(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),V4=N({sqrt_:function(n){var e=C(n,"x","sqrt");return F.runKernelFunc(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),H4=N({step_:function(n,e){e===void 0&&(e=0);var t=C(n,"x","step");return F.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Me(r)}}})}}),z4=N({tan_:function(n){var e=C(n,"x","tan");return F.runKernelFunc(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),j4=N({tanh_:function(n){var e=C(n,"x","tanh");return F.runKernelFunc(function(t,r){var i=t.tanh(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return re(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function R_(n,e,t,r,i,s){var o,a,u=C(n,"x","batchNorm"),l=C(e,"mean","batchNorm"),c=C(t,"variance","batchNorm");return i!=null&&(o=C(i,"scale","batchNorm")),r!=null&&(a=C(r,"offset","batchNorm")),L(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),L(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),L(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),o!=null&&L(o.rank===2||o.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."}),a!=null&&L(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),zu(u,l,c,a,o,s)}function C_(n,e,t,r,i,s){var o,a,u=C(n,"x","batchNorm"),l=C(e,"mean","batchNorm"),c=C(t,"variance","batchNorm");return i!=null&&(o=C(i,"scale","batchNorm")),r!=null&&(a=C(r,"offset","batchNorm")),L(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),L(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),L(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),o!=null&&L(o.rank===3||o.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."}),a!=null&&L(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),zu(u,l,c,a,o,s)}function A_(n,e,t,r,i,s){var o,a,u=C(n,"x","batchNorm"),l=C(e,"mean","batchNorm"),c=C(t,"variance","batchNorm");return i!=null&&(o=C(i,"scale","batchNorm")),r!=null&&(a=C(r,"offset","batchNorm")),L(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),L(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),L(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),o!=null&&L(o.rank===4||o.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."}),a!=null&&L(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),zu(u,l,c,a,o,s)}function zu(n,e,t,r,i,s){s==null&&(s=.001);var o,a,u,l=C(n,"x","batchNorm"),c=C(e,"mean","batchNorm"),d=C(t,"variance","batchNorm");i!=null&&(o=C(i,"scale","batchNorm")),r!=null&&(a=C(r,"offset","batchNorm")),L(c.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),L(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),L(o==null||c.rank===o.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var f=[l,c,d,o];return F.runKernelFunc(function(h,p){var g=h.batchNormalization(u,Ml(c),Ml(d),s,Ml(o),Ml(a));return p([l,c,d,o]),g},{x:l,mean:c,variance:d,scale:o,offset:a},function(h,p){var g=p,m=g[0],v=g[1],y=g[2],x=g[3],E=x??re(1),b=At(v.shape,u.shape),S=[];if(v.rank===1){for(var w=0;w<u.shape.length-1;++w)S.push(u.shape[w]);S.push(1)}var T=m.sub(v),R=h.mul(E),_=__(y.add(re(s))),A=_.mul(_).mul(_).mul(re(-.5));return{x:function(){return v.rank===1?h.mul(Oo(_.as4D(1,1,1,v.shape[0]),S)).mul(E).reshape(m.shape):h.mul(_).mul(E).reshape(m.shape)},mean:function(){var k=_.mul(re(-1)).mul(R);return v.rank===1&&(k=k.sum(b)),k.reshape(v.shape)},variance:function(){var k=A.mul(T).mul(R);return v.rank===1&&(k=k.sum(b)),k.reshape(v.shape)},scale:function(){var k=T.mul(_),G=h.mul(k);return v.rank===1&&(G=G.sum(b)),G.reshape(v.shape)},offset:function(){var k=h;return v.rank===1&&(k=k.sum(b)),k.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:s},f).reshape(l.shape)}function Ml(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function nf(){HT("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var K4=N({batchNormalization2d_:function(n,e,t,r,i,s){return r===void 0&&(r=.001),nf(),R_(n,e,t,s,i,r)}}),q4=N({batchNormalization3d_:function(n,e,t,r,i,s){return r===void 0&&(r=.001),nf(),C_(n,e,t,s,i,r)}}),Y4=N({batchNormalization4d_:function(n,e,t,r,i,s){return r===void 0&&(r=.001),nf(),A_(n,e,t,s,i,r)}}),X4=N({batchNormalization_:function(n,e,t,r,i,s){return r===void 0&&(r=.001),nf(),zu(n,e,t,s,i,r)}}),k_=N({batchNorm_:zu}),Q4=N({batchNorm2d_:R_}),J4=N({batchNorm3d_:C_}),Z4=N({batchNorm4d_:A_}),rf=N({logicalAnd_:function(n,e){var t=C(n,"a","logicalAnd","bool"),r=C(e,"b","logicalAnd","bool");return Pe(t.shape,r.shape),F.runKernelFunc(function(i){return i.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),eU=N({logicalNot_:function(n){var e=C(n,"x","logicalNot","bool");return F.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),L_=N({logicalOr_:function(n,e){var t=C(n,"a","logicalOr","bool"),r=C(e,"b","logicalOr","bool");return Pe(t.shape,r.shape),F.runKernelFunc(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),tU=N({logicalXor_:function(n,e){var t=C(n,"a","logicalXor","bool"),r=C(e,"b","logicalXor","bool");return Pe(t.shape,r.shape),L_(n,e).logicalAnd(rf(n,e).logicalNot())}}),$s=N({where_:function(n,e,t){var r=C(e,"a","where"),i=C(t,"b","where"),s=C(n,"condition","where","bool");return Ve(r.shape,i.shape,"Error in where: "),s.rank===1?L(s.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Ve(s.shape,i.shape,"Error in where: "),F.runKernelFunc(function(o,a){var u=o.select(s,r,i);return a([s]),u},{$condition:s,$a:r,$b:i},function(o,a){var u=a[0];return{$condition:function(){return Me(u).toFloat()},$a:function(){return o.mul(u.cast(o.dtype))},$b:function(){return o.mul(u.logicalNot().cast(o.dtype))}}})}}),D_=function(n){return le(this,void 0,void 0,function(){var e,t,r;return ce(this,function(i){switch(i.label){case 0:return[4,(e=C(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=yv(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},ke=N({add_:function(n,e){var t,r=C(n,"a","add"),i=C(e,"b","add");t=pt(r,i),r=t[0],i=t[1];var s=Pe(r.shape,i.shape);return F.runKernelFunc(function(o){return o.add(r,i)},{a:r,b:i},function(o){return{a:function(){var a=o,u=At(r.shape,s);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=o,u=At(i.shape,s);return u.length>0&&(a=a.sum(u)),a.reshape(i.shape)}}},"Add")}}),nU=N({addN_:function(n){L(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),L(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,s){return C(i,"tensors"+s,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Mt(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return F.runKernelFunc(function(i){return i.addN(e)},r,function(i){var s={};return e.forEach(function(o,a){s[a]=function(){return i.clone()}}),s},"AddN")}}),rU=N({addStrict_:function(n,e){var t=C(n,"a","addStrict"),r=C(e,"b","addStrict");return Ve(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),iU=N({atan2_:function(n,e){var t,r=C(n,"a","atan2"),i=C(e,"b","atan2");t=pt(r,i),r=t[0],i=t[1];var s=Pe(r.shape,i.shape);return F.runKernelFunc(function(o,a){var u=o.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(o,a){var u=a[0],l=a[1];return{$a:function(){var c=ke(u.square(),l.square()),d=o.mul(l.div(c)),f=At(u.shape,s);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var c=ke(u.square(),l.square()),d=gd(o.mul(u.div(c))),f=At(l.shape,s);return f.length>0&&(d=d.sum(f)),d.reshape(l.shape)}}})}}),cr=N({div_:function(n,e){var t,r=C(n,"a","div"),i=C(e,"b","div");if(t=pt(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return P_(r,i);var s=Pe(r.shape,i.shape);return F.runKernelFunc(function(o,a){var u=o.realDivide(r,i);return a([r,i]),u},{a:r,b:i},function(o,a){var u=a[0],l=a[1];return{a:function(){var c=o.div(l.toFloat()),d=At(u.shape,s);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=o.mul(u.toFloat()),d=At(l.shape,s);d.length>0&&(c=c.sum(d).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"Div")}}),sU=N({divNoNan_:function(n,e){var t,r=C(n,"a","div"),i=C(e,"b","div");r=(t=pt(r,i))[0],i=t[1];var s=cr(r,i),o=Me(s),a=i.equal(o);return $s(a,o,s)}}),oU=N({divStrict_:function(n,e){var t=C(n,"a","div"),r=C(e,"b","div");return Ve(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),P_=N({floorDiv_:function(n,e){var t,r=C(n,"a","floorDiv"),i=C(e,"b","floorDiv");t=pt(r,i),r=t[0],i=t[1];var s=Pe(r.shape,i.shape);return F.runKernelFunc(function(o,a){var u=o.floorDiv(r,i);return a([r,i]),u},{a:r,b:i},function(o,a){var u=a[0],l=a[1];return{a:function(){var c=o.div(l.toFloat()),d=At(u.shape,s);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=o.mul(u.toFloat()),d=At(l.shape,s);d.length>0&&(c=c.sum(d).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"FloorDiv")}}),wv=N({maximum_:function(n,e){var t,r=C(n,"a","maximum"),i=C(e,"b","maximum");return t=pt(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Pe(r.shape,i.shape),F.runKernelFunc(function(s,o){var a=s.maximum(r,i);return o([r,i]),a},{a:r,b:i},function(s,o){var a=o[0],u=o[1];return{a:function(){return s.mul(a.greaterEqual(u).toFloat())},b:function(){return s.mul(a.less(u).toFloat())}}},"Maximum")}}),aU=N({maximumStrict_:function(n,e){var t=C(n,"a","maximumStrict"),r=C(e,"b","maximumStrict");return Ve(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),O_=N({minimum_:function(n,e){var t,r=C(n,"a","minimum"),i=C(e,"b","minimum");return t=pt(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Pe(r.shape,i.shape),F.runKernelFunc(function(s,o){var a=s.minimum(r,i);return o([r,i]),a},{a:r,b:i},function(s,o){var a=o[0],u=o[1];return{a:function(){return s.mul(a.lessEqual(u).toFloat())},b:function(){return s.mul(a.greater(u).toFloat())}}},"Minimum")}}),uU=N({minimumStrict_:function(n,e){var t=C(n,"a","minimumStrict"),r=C(e,"b","minimumStrict");return Ve(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),lU=N({mod_:function(n,e){var t,r=C(n,"a","mod"),i=C(e,"b","mod");t=pt(r,i),r=t[0],i=t[1];var s=Pe(r.shape,i.shape);return F.runKernelFunc(function(o,a){var u=o.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(o,a){var u=a[0],l=a[1];return{$a:function(){var c=At(u.shape,s);return c.length>0?o.sum(c).reshape(u.shape):o},$b:function(){var c=o.mul(u.div(l).floor().neg()),d=At(l.shape,s);return d.length>0?c.sum(d).reshape(l.shape):c}}})}}),cU=N({modStrict_:function(n,e){var t=C(n,"a","modStrict"),r=C(e,"b","modStrict");return Ve(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),rn=N({mul_:function(n,e){var t,r=C(n,"a","mul"),i=C(e,"b","mul");t=pt(r,i),r=t[0],i=t[1];var s=Pe(r.shape,i.shape);return F.runKernelFunc(function(o,a){var u=o.multiply(r,i);return a([r,i]),u},{a:r,b:i},function(o,a){var u=a[0],l=a[1];return{a:function(){var c=o.mul(l.toFloat()),d=At(u.shape,s);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=o.mul(u.toFloat()),d=At(l.shape,s);return d.length>0?c.sum(d).reshape(l.shape):c}}},"Mul")}}),dU=N({mulStrict_:function(n,e){var t=C(n,"a","mul"),r=C(e,"b","mul");return Ve(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),md=N({pow_:function(n,e){var t,r=C(n,"base","pow"),i=C(e,"exp","pow");t=pt(r,i),r=t[0],i=t[1];var s=Pe(r.shape,i.shape),o=[r,i];return F.runKernelFunc(function(a,u){var l=a.pow(r,i);return u([r,i,l]),l},{a:r,b:i},function(a,u){var l=u[0],c=u[1],d=u[2];return{a:function(){var f=c.toFloat(),h=a.mul(f.mul(l.pow(f.sub(re(1))))),p=At(l.shape,s);return p.length>0&&(h=h.sum(p)),h.reshape(l.shape)},b:function(){var f=l.greater(0),h=l.log().where(f,Me(l)),p=a.mul(d.mul(h)),g=At(c.shape,s);return g.length>0&&(p=p.sum(g)),p.reshape(c.shape)}}},"Pow",{},o,[!0])}}),fU=N({powStrict_:function(n,e){return Ve(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),hU=N({squaredDifferenceStrict_:function(n,e){var t=C(n,"a","squaredDifferenceStrict"),r=C(e,"b","squaredDifferenceStrict");return Ve(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),kt=N({sub_:function(n,e){var t,r=C(n,"a","sub"),i=C(e,"b","sub");t=pt(r,i),r=t[0],i=t[1];var s=Pe(r.shape,i.shape);return F.runKernelFunc(function(o){return o.subtract(r,i)},{a:r,b:i},function(o){return{a:function(){var a=o,u=At(r.shape,s);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=o,u=At(i.shape,s);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}},"Sub")}}),pU=N({subStrict_:function(n,e){var t=C(n,"a","subStrict"),r=C(e,"b","subStrict");return Ve(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),N_=N({equal_:function(n,e){var t,r=C(n,"a","equal"),i=C(e,"b","equal");return t=pt(r,i),r=t[0],i=t[1],Pe(r.shape,i.shape),F.runKernelFunc(function(s){return s.equal(r,i)},{$a:r,$b:i})}}),gU=N({equalStrict_:function(n,e){var t=C(n,"a","equalStrict"),r=C(e,"b","equalStrict");return Ve(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),mU=N({greater_:function(n,e){var t,r=C(n,"a","greater"),i=C(e,"b","greater");return t=pt(r,i),r=t[0],i=t[1],Pe(r.shape,i.shape),F.runKernelFunc(function(s){return s.greater(r,i)},{a:r,b:i},null,"Greater")}}),F_=N({greaterEqual_:function(n,e){var t,r=C(n,"a","greaterEqual"),i=C(e,"b","greaterEqual");return t=pt(r,i),r=t[0],i=t[1],Pe(r.shape,i.shape),F.runKernelFunc(function(s,o){var a=s.greaterEqual(r,i);return o([r,i]),a},{a:r,b:i},function(s,o){var a=o[0],u=o[1];return{a:function(){return Me(a)},b:function(){return Me(u)}}},"GreaterEqual")}}),vU=N({greaterEqualStrict_:function(n,e){var t=C(n,"a","greaterEqualStrict"),r=C(e,"b","greaterEqualStrict");return Ve(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),yU=N({greaterStrict_:function(n,e){var t=C(n,"a","greaterStrict"),r=C(e,"b","greaterStrict");return Ve(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),xU=N({less_:function(n,e){var t,r=C(n,"a","less"),i=C(e,"b","less");return t=pt(r,i),r=t[0],i=t[1],Pe(r.shape,i.shape),F.runKernelFunc(function(s){return s.less(r,i)},{a:r,b:i},null,"Less")}}),EU=N({lessEqual_:function(n,e){var t,r=C(n,"a","lessEqual"),i=C(e,"b","lessEqual");return t=pt(r,i),r=t[0],i=t[1],Pe(r.shape,i.shape),F.runKernelFunc(function(s,o){var a=s.lessEqual(r,i);return o([r,i]),a},{a:r,b:i},null,"LessEqual")}}),bU=N({lessEqualStrict_:function(n,e){var t=C(n,"a","lessEqualStrict"),r=C(e,"b","lessEqualStrict");return Ve(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),SU=N({lessStrict_:function(n,e){var t=C(n,"a","lessStrict"),r=C(e,"b","lessStrict");return Ve(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),wU=N({notEqual_:function(n,e){var t,r=C(n,"a","notEqual"),i=C(e,"b","notEqual");return t=pt(r,i),r=t[0],i=t[1],Pe(r.shape,i.shape),F.runKernelFunc(function(s){return s.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),TU=N({notEqualStrict_:function(n,e){var t=C(n,"a","notEqualStrict"),r=C(e,"b","notEqualStrict");return Ve(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function k1(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function L1(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Tv=N({gather_:function(n,e,t){t===void 0&&(t=0);var r=C(n,"x","gather"),i=C(e,"indices","gather","int32");t=Lt(t,r.shape)[0];var s=function(o,a,u){for(var l=o.shape[u],c=[],d=1,f=1,h=0;h<u;h++)c.push(o.shape[h]),d*=o.shape[h];for(h=0;h<a.rank;h++)c.push(a.shape[h]);for(h=u+1;h<o.rank;h++)c.push(o.shape[h]),f*=o.shape[h];return{batchSize:d,sliceSize:f,dimSize:l,outputShape:c}}(r,i,t);return F.runKernelFunc(function(o,a){var u=o.gather(r,i.flatten(),t);return a([i]),u},{x:r,indices:i},function(o,a){var u=a[0];return{x:function(){var l=r.shape,c=u.size,d=l.slice(0,t),f=d.length,h=l.slice(t,l.length).slice(1),p=h.length,g=k1(0,f),m=k1(f+1,f+1+p),v=L1([d,[c],h]),y=o.reshape(v),x=u.reshape([c]),E=L1([[f],g,m]),b=y.transpose(E),S=M_(b,x,r.shape[t]),w=cv(E);return S=S.transpose(w)},indices:function(){return u}}},"Gather",{axis:t}).reshape(s.outputShape)}}),M_=N({unsortedSegmentSum_:function(n,e,t){var r=C(n,"x","unsortedSegmentSum"),i=C(e,"segmentIds","unsortedSegmentSum","int32");return L(xt(t),function(){return"numSegments must be of dtype int"}),F.runKernelFunc(function(s,o){var a=s.unsortedSegmentSum(r,i,t);return o([i]),a},{$x:r},function(s,o){var a=o[0];return{$x:function(){return function(u,l){for(var c=wv(l,Me(l)),d=Tv(u,c),f=F_(l,re(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=qn(f,p+1);f=rf(f,da(d.shape,"bool"));var g=Me(d);return $s(f,d,g)}(s,a)}}})}}),_U=function(n,e,t){return le(this,void 0,void 0,function(){var r,i,s,o,a,u,l,c,d,f,h,p,g;return ce(this,function(m){switch(m.label){case 0:for(r=C(n,"tensor","boolMask"),i=C(e,"mask","boolMask","bool"),s=t??0,o=i.rank,a=r.shape,L(o>0,function(){return"mask cannot be scalar"}),Ve(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=s;l<s+o;l++)u*=a[l];return c=a.slice(0,s).concat([u],a.slice(s+o)),d=r.reshape(c),f=i.reshape([-1]),[4,D_(f)];case 1:return h=m.sent(),p=h.squeeze([1]),g=Tv(d,p,s),n!==r&&r.dispose(),e!==i&&i.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,g]}})})};function B_(n,e,t,r,i,s,o){s===void 0&&(s="NHWC"),L(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),L(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),L(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),L(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var c=s==="NHWC"?a[3]:a[1],d=s==="NHWC"?u.shape[3]:u.shape[1];L(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."}),L(d===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&L(xt(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var f=gv(s),h=js(a,t.shape,r,1,i,o,!1,f),p=F.runKernelFunc(function(g,m){var v=g.conv2dDerInput(u,t,h);return m([t,u]),v},{dy4D:u,filter:t},function(g,m){var v=m[0],y=m[1];return{dy4D:function(){return nr(g,v,r,i,s,1,o)},filter:function(){return _v(g,y,v.shape,r,i,s,o)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Fh(n){var e=function(s){return typeof s=="number"?[s,s,s]:s.length===2?[s[0],s[1],1]:s}(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function U_(n,e,t,r,i){L(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var s=n,o=e,a=!1;e.rank===4&&(a=!0,o=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),s=[1,n[0],n[1],n[2],n[3]]);var u=s[4],l=o.shape[4];L(s.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+s.length+"."}),L(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank}),L(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),L(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),L(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."});var c=hd(s,t.shape,r,1,i),d=F.runKernelFunc(function(f){return f.conv3dDerInput(o,t,c)},{dy5D:o});return a?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var IU=N({conv1d_:function(n,e,t,r,i,s,o){i===void 0&&(i="NWC"),s===void 0&&(s=1);var a=C(n,"x","conv1d"),u=C(e,"filter","conv1d"),l=a,c=!1;a.rank===2&&(c=!0,l=a.as3D(1,a.shape[0],a.shape[1])),L(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),L(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),o!=null&&L(xt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}),L(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),L(Tn(t,s),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+s+"'"}),L(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),h=nr(f,d,[1,t],r,"NHWC",[1,s],o);return c?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),nr=N({conv2d_:function(n,e,t,r,i,s,o){i===void 0&&(i="NHWC"),s===void 0&&(s=[1,1]);var a=C(n,"x","conv2d"),u=C(e,"filter","conv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),L(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),L(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),o!=null&&L(xt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d=i==="NHWC"?l.shape[3]:l.shape[1];L(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),L(Tn(t,s),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"});var f=gv(i),h=js(l.shape,u.shape,t,s,r,o,!1,f),p=[u,l],g=F.runKernelFunc(function(m,v){var y=m.conv2d(l,u,h);return v([u,l]),y},{x:l,filter:u},function(m,v){var y=v,x=y[0],E=y[1];return L(ta(s),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"}),{x:function(){return $_(E.shape,m,x,t,r,i)},filter:function(){return _v(E,m,x.shape,t,r,i)}}},"Conv2D",h,p);return c?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),RU=N({conv3d_:function(n,e,t,r,i,s){i===void 0&&(i="NDHWC"),s===void 0&&(s=[1,1,1]);var o=C(n,"x","conv3d"),a=C(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),L(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),L(a.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),L(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),L(function(f,h){return Fh(f)||Fh(h)}(t,s),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),L(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=hd(u.shape,a.shape,t,s,r),d=F.runKernelFunc(function(f,h){var p=f.conv3d(u,a,c);return h([u,a]),p},{x:u,$filter:a},function(f,h){L(Fh(s),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+s+"'"});var p=h[0],g=h[1];return{x:function(){return U_(p.shape,f,g,t,r)},$filter:function(){return function(m,v,y,x,E){var b=m;m.rank===4&&(b=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var S=v;S.rank===4&&(S=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),L(b.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+b.shape+"."}),L(S.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+S.shape+"."}),L(y.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),L(b.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+b.shape[4]+") must match input depth in filter ("+y[3]+"."}),L(S.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+S.shape[4]+") must match output depth for filter ("+y[4]+")."});var w=hd(b.shape,y,x,1,E);return F.runKernelFunc(function(T){return T.conv3dDerFilter(b,S,w)},{x5D:b,dy5D:S})}(p,f,g.shape,t,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),_v=N({conv2dDerFilter_:function(n,e,t,r,i,s,o){s===void 0&&(s="NHWC");var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),L(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),L(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),L(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var l=s==="NHWC"?a.shape[3]:a.shape[1],c=s==="NHWC"?u.shape[3]:u.shape[1];L(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+t[2]+"."}),L(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."}),o!=null&&L(xt(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var d=gv(s),f=js(a.shape,t,r,1,i,o,!1,d);return F.runKernelFunc(function(h){return h.conv2dDerFilter(a,u,f)},{x4D:a,dy4D:u})}}),$_=N({conv2dDerInput_:B_}),sf=N({depthwiseConv2d_:function(n,e,t,r,i,s,o){s===void 0&&(s=[1,1]);var a=C(n,"x","depthwiseConv2d"),u=C(e,"filter","depthwiseConv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),L(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),L(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),L(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),s==null&&(s=[1,1]),L(Tn(t,s),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),o!=null&&L(xt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var d=js(l.shape,u.shape,t,s,r,o,!0),f=[l,u],h=F.runKernelFunc(function(p,g){var m=p.depthwiseConv2D(l,u,d);return g([l,u]),m},{x:l,filter:u},function(p,g){L(ta(s),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+s+"'"});var m=g[0],v=g[1];return{x:function(){return G_(m.shape,p,v,d)},filter:function(){return W_(m,p,v.shape,d)}}},"DepthwiseConv2dNative",d,f);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),G_=N({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,s=!1;e.rank===3&&(s=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=F.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return s?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),W_=N({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e;return s.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),F.runKernelFunc(function(o){return o.depthwiseConv2DDerFilter(i,s,r)},{x4D:i,dy4D:s})}}),Iv=N({separableConv2d_:function(n,e,t,r,i,s,o){s===void 0&&(s=[1,1]),o===void 0&&(o="NHWC");var a=C(n,"x","separableConv2d"),u=C(e,"depthwiseFilter","separableConv2d"),l=C(t,"pointwiseFilter","separableConv2d"),c=a,d=!1;if(a.rank===3&&(d=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");L(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),L(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),L(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),L(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),L(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],h=u.shape[3];L(l.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+l.shape[2]+"."});var p=sf(c,u,r,i,o,s),g=nr(p,l,1,"valid",o);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),CU=N({conv2dTranspose_:function(n,e,t,r,i,s){return B_(t,C(n,"x","conv2dTranspose"),C(e,"filter","conv2dTranspose"),r,i,"NHWC",s)}}),AU=N({conv3dTranspose_:function(n,e,t,r,i){return U_(t,C(n,"x","conv3dTranspose"),C(e,"filter","conv3dTranspose"),r,i)}}),of=N({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var s=C(n,"a","matMul"),o=C(e,"b","matMul");i=pt(s,o),s=i[0],o=i[1];var a=t?s.shape[s.rank-2]:s.shape[s.rank-1],u=r?o.shape[o.rank-1]:o.shape[o.rank-2],l=t?s.shape[s.rank-1]:s.shape[s.rank-2],c=r?o.shape[o.rank-2]:o.shape[o.rank-1],d=s.shape.slice(0,-2),f=o.shape.slice(0,-2),h=fe(d),p=fe(f);L(s.rank>=2&&o.rank>=2&&s.rank===o.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+o.rank+"."}),L(Mt(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+s.shape+" and "+o.shape+" must match."}),L(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+s.shape+" and "+o.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var g=s.shape.slice(0,-2).concat([l,c]),m=t?s.as3D(h,a,l):s.as3D(h,l,a),v=r?o.as3D(p,c,u):o.as3D(p,u,c),y={transposeA:t,transposeB:r};return F.runKernelFunc(function(x,E){var b=x.batchMatMul(m,v,t,r);return E([m,v]),b},{a:m,b:v},function(x,E){var b=E,S=b[0],w=b[1];return t||r?!t&&r?{a:function(){return x.matMul(w,!1,!1)},b:function(){return x.matMul(S,!0,!1)}}:t&&!r?{a:function(){return w.matMul(x,!1,!0)},b:function(){return S.matMul(x,!1,!1)}}:{a:function(){return w.matMul(x,!0,!0)},b:function(){return x.matMul(S,!0,!0)}}:{a:function(){return x.matMul(w,!1,!0)},b:function(){return S.matMul(x,!0,!1)}}},"BatchMatMul",y).reshape(g)}}),kU=N({dot_:function(n,e){var t=C(n,"t1","dot"),r=C(e,"t2","dot");L(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],s=r.rank===1?r.size:r.shape[0];return L(i===s,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+s+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),LU=N({outerProduct_:function(n,e){var t=C(n,"v1","outerProduct"),r=C(e,"v2","outerProduct");return L(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),ju=N({reverse_:function(n,e){var t=C(n,"x","reverse");if(t.rank===0)return t.clone();var r=Lt(e,t.shape);return F.runKernelFunc(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),DU=N({reverse1d_:function(n){var e=C(n,"x","reverse");return L(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),ju(e,0)}}),PU=N({reverse2d_:function(n,e){var t=C(n,"x","reverse");return L(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),ju(t,e)}}),OU=N({reverse3d_:function(n,e){var t=C(n,"x","reverse");return L(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),ju(t,e)}}),NU=N({reverse4d_:function(n,e){var t=C(n,"x","reverse");return L(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),ju(t,e)}});function V_(n,e,t,r,i,s){var o=C(n,"x","maxPool"),a=o,u=!1;o.rank===3&&(u=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),L(a.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),L(Tn(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),s!=null&&L(xt(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var l=Cu(a.shape,e,t,r,i,s);if(l.filterWidth===1&&l.filterHeight===1&&Mt(l.inShape,l.outShape))return o.clone();var c=[a],d=F.runKernelFunc(function(f,h){var p=f.maxPool(a,l);return h([a,p]),p},{x:a},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,y,x,E,b,S,w){var T=C(m,"dy","maxPoolBackprop"),R=C(v,"input","maxPoolBackprop"),_=C(y,"output","maxPoolBackprop");L(R.rank===T.rank,function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+T.rank+")"}),L(Tn(E,b),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+b+"'"}),L(T.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+T.rank+"."}),L(R.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var A=Cu(R.shape,x,E,b,S,w);return F.runKernelFunc(function(k){return k.maxPoolBackprop(T,R,_,A)},{$dy:T,$input:R})}(f,p,g,e,t,r,i)}}},"MaxPool",l,c);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function H_(n,e,t,r,i,s){var o=C(n,"x","avgPool","float32");L(Tn(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var a=o,u=!1;o.rank===3&&(u=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),L(a.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),s!=null&&L(xt(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var l=Cu(a.shape,e,t,r,i,s);if(l.filterWidth===1&&l.filterHeight===1&&Mt(l.inShape,l.outShape))return o.clone();var c=F.runKernelFunc(function(d){return d.avgPool(a,l)},{x:a},function(d){return{x:function(){return function(f,h,p,g,m,v){var y=C(f,"dy","avgPoolBackprop"),x=C(h,"input","avgPoolBackprop");L(x.rank===y.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+y.rank+")"}),L(Tn(g,m),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"});var E=x,b=y,S=!1;x.rank===3&&(S=!0,E=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),b=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),L(b.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+b.rank+"."}),L(E.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+E.rank+"."});var w=Cu(E.shape,p,g,m,v),T=F.runKernelFunc(function(R){return R.avgPoolBackprop(b,E,w)},{dy4D:b,input4D:E});return S?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}(d,a,e,t,r,i)}}},"AvgPool",l);return c=c.cast(o.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Ot=N({maxPool_:function(n,e,t,r,i){return V_(n,e,t,1,r,i)}}),Ku=N({avgPool_:function(n,e,t,r,i){return H_(n,e,t,1,r,i)}}),FU=N({pool_:function(n,e,t,r,i,s){i==null&&(i=[1,1]),s==null&&(s=1),r===0&&(r="valid");var o=C(n,"x","maxPool"),a=o,u=!1;o.rank===3&&(u=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),L(Tn(s,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+i+"'"});var l,c=Cu(a.shape,e,s,i,r),d=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(E,b){var S=E.map(function(R,_){return R+(R-1)*(b[_]-1)}).map(function(R){return R-1}),w=S.map(function(R){return Math.floor(R/2)}),T=S.map(function(R,_){return R-w[_]});return S.map(function(R,_){return[w[_],T[_]]})}([c.filterHeight,c.filterWidth],d):[[0,0],[0,0]];var f=d[0]===1&&d[1]===1,h=function(E,b,S){var w=S.map(function(U){return U[0]}),T=S.map(function(U){return U[1]}),R=E.concat(w,T),_=b.map(function(U,M){return(U-R[M]%U)%U}),A=T.map(function(U,M){return U+_[M]}),k=b.map(function(U,M){return[w[M],A[M]]}),G=b.map(function(U,M){return[0,_[M]]});return[k,G]}([c.inHeight,c.inWidth],d,l),p=h[0],g=h[1],m=f?r:"valid",v=f?a:XT(a,d,p),y=(t==="avg"?function(){return H_(v,e,s,1,m)}:function(){return V_(v,e,s,1,m)})(),x=f?y:KT(y,d,g);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),MU=N({maxPool3d_:function(n,e,t,r,i,s,o){s===void 0&&(s="NDHWC");var a=C(n,"x","maxPool3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),o==null&&(o=[1,1,1]),L(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),L(s==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+s}),L(Tn(t,o),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),i!=null&&L(xt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=fd(u.shape,e,t,o,r,i,s),d=F.runKernelFunc(function(f,h){var p=f.maxPool3d(u,c);return h([u,p]),p},{x:u},function(f,h){var p=h[0],g=h[1];return{x:function(){return function(m,v,y,x,E,b,S,w){var T=C(m,"dy","maxPool3dBackprop"),R=C(v,"input","maxPool3dBackprop"),_=C(y,"output","maxPool3dBackprop"),A=T,k=R,G=_,U=!1;R.rank===4&&(U=!0,A=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3]),k=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),G=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3])),L(A.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+A.rank+"."}),L(k.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+k.rank+"."}),L(G.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+G.rank+"."}),b==null&&(b=[1,1,1]),L(Tn(E,b),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+b+"'"}),w!=null&&L(xt(S),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+S+"."});var M=fd(k.shape,x,E,b,S,w),B=F.runKernelFunc(function($){return $.maxPool3dBackprop(A,k,G,M)},{dy5D:A,input5D:k});return U?B.as4D(B.shape[1],B.shape[2],B.shape[3],B.shape[4]):B}(f,p,g,e,t,o,r,i)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),BU=N({avgPool3d_:function(n,e,t,r,i,s,o){s===void 0&&(s="NDHWC");var a=C(n,"x","avgPool3d","float32"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),o==null&&(o=[1,1,1]),L(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),L(s==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+s}),L(Tn(t,o),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),i!=null&&L(xt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=fd(u.shape,e,t,o,r,i,s),d=F.runKernelFunc(function(f){return f.avgPool3d(u,c)},{x:u},function(f){return{x:function(){return function(h,p,g,m,v,y,x){var E=C(h,"dy","avgPool3dBackprop"),b=C(p,"input","avgPool3dBackprop"),S=E,w=b,T=!1;b.rank===4&&(T=!0,S=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),w=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),L(S.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+S.rank+"."}),L(w.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+w.rank+"."}),v==null&&(v=[1,1,1]),L(Tn(m,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+v+"'"}),x!=null&&L(xt(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+y+"."});var R=fd(w.shape,g,m,v,y,x),_=F.runKernelFunc(function(A){return A.avgPool3dBackprop(S,w,R)},{dy5D:S,input5D:w});return T?_.as4D(_.shape[1],_.shape[2],_.shape[3],_.shape[4]):_}(f,u,e,t,o,r,i)}}});return d=d.cast(u.dtype),l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Vr=N({slice_:function(n,e,t){var r,i,s=C(n,"x","slice");if(s.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(s.rank-1).fill(0)):e.length<s.rank?e.concat(new Array(s.rank-e.length).fill(0)):e.slice()).forEach(function(u){L(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(s.rank).fill(-1):typeof t=="number"?[t].concat(new Array(s.rank-1).fill(-1)):t.length<s.rank?t.concat(new Array(s.rank-t.length).fill(-1)):t).map(function(u,l){return u>=0?u:(L(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),s.shape[l]-r[l])}),fB(s,r,i);var o=s.shape,a={begin:r,size:i};return F.runKernelFunc(function(u){return u.slice(s,r,i)},{x:s},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],o[c]-r[c]-i[c]]);return{x:function(){return u.pad(l)}}},"Slice",a)}}),UU=N({slice1d_:function(n,e,t){var r=C(n,"x","slice1d");return L(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Vr(r,[e],[t])}}),$U=N({slice2d_:function(n,e,t){var r=C(n,"x","slice2d");return L(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Vr(r,e,t)}}),z_=N({slice3d_:function(n,e,t){var r=C(n,"x","slice3d");return L(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Vr(r,e,t)}}),GU=N({slice4d_:function(n,e,t){var r=C(n,"x","slice4d");return L(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Vr(r,e,t)}});function j_(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(wn(e.shape,r))),n.rank<t.rank&&(n=n.reshape(wn(n.shape,r))),{x:function(){var s=n.mul(t.equal(e).cast(n.dtype));return i==null?s:s.transpose(i)}}}var WU=N({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","all","bool"),i=Lt(e,r.shape),s=i,o=zr(s,r.rank);o!=null&&(r=r.transpose(o),s=jr(s.length,r.rank));var a=F.runKernelFunc(function(l){return l.all(r,s)},{$x:r});if(t){var u=wn(a.shape,i);return a.reshape(u)}return a}}),VU=N({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","any","bool"),i=Lt(e,r.shape),s=i,o=zr(s,r.rank);o!=null&&(r=r.transpose(o),s=jr(s.length,r.rank));var a=F.runKernelFunc(function(l){return l.any(r,s)},{$x:r});if(t){var u=wn(a.shape,i);return a.reshape(u)}return a}}),HU=N({argMax_:function(n,e){e===void 0&&(e=0);var t=C(n,"x","argMax");e==null&&(e=0);var r=Lt(e,t.shape),i=zr(r,t.rank);i!=null&&(t=t.transpose(i),r=jr(r.length,t.rank));var s={axis:r[0]},o=[t];return F.runKernelFunc(function(a,u){var l=a.argMax(t,r[0]);return u([t]),l},{x:t},function(a,u){var l=u[0];return{x:function(){return Me(l)}}},"ArgMax",s,o)}}),zU=N({argMin_:function(n,e){e===void 0&&(e=0);var t=C(n,"x","argMin");e==null&&(e=0);var r=Lt(e,t.shape),i=zr(r,t.rank);return i!=null&&(t=t.transpose(i),r=jr(r.length,t.rank)),F.runKernelFunc(function(s,o){var a=s.argMin(t,r[0]);return o([t]),a},{$x:t},function(s,o){var a=o[0];return{$x:function(){return Me(a)}}})}}),jU=N({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","logSumExp"),i=Lt(e,r.shape),s=r.max(i,!0),o=r.sub(s).exp().sum(i).log(),a=s.reshape(o.shape).add(o);if(t){var u=wn(a.shape,i);return a.reshape(u)}return a}}),af=N({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","max"),i=r,s=Lt(e,r.shape),o=s,a=zr(o,r.rank);a!=null&&(r=r.transpose(a),o=jr(o.length,r.rank));var u=[r],l=F.runKernelFunc(function(d,f){var h=d.max(r,o);return f([i,h]),h},{x:r},function(d,f){return j_(d,f[1],f[0],s,a)},"Max",{axes:o},u,[!0]);if(t){var c=wn(l.shape,s);l=l.reshape(c)}return l}}),KU=N({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","mean"),i=Lt(e,r.shape),s=fe(Qt(r.shape,i)[1]);return tf(function(o){var a=re(s);return{value:(a.dtype===o.dtype?o:o.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(u){var l=o.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(da(o.shape,"float32")).div(s)}}})(r)}}),qU=N({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","min"),i=r,s=Lt(e,r.shape),o=s,a=zr(o,r.rank);a!=null&&(r=r.transpose(a),o=jr(o.length,r.rank));var u=[r],l=F.runKernelFunc(function(d,f){var h=d.min(r,o);return f([i,h]),h},{x:r},function(d,f){return j_(d,f[1],f[0],s,a)},"Min",{axes:o},u,[!0]);if(t){var c=wn(l.shape,s);l=l.reshape(c)}return l}}),YU=N({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Lt(e,(n=C(n,"x","moments")).shape),i=n.mean(r,t),s=i.shape;t||(s=wn(i.shape,r));var o=n.toFloat().sub(i.reshape(s)).square();return{mean:i,variance:o.mean(r,t)}}}),K_=N({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Lt(e,r.shape);return tf(function(s){var o=zr(i,s.rank),a=i,u=s;o!=null&&(u=s.transpose(o),a=jr(a.length,s.rank));var l=function(h){var p=s.shape.slice();return i.forEach(function(g){p[g]=1}),h.reshape(p).mul(da(s.shape,"float32"))},c={axes:a},d=F.runKernelFunc(function(h){return h.sum(u,a)},{x:u},function(h){return{x:function(){return l(h)}}},"Sum",c);if(t){var f=wn(d.shape,i);d=d.reshape(f)}return{value:d,gradFunc:l}})(r)}}),XU=N({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=C(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Lt(e,r.shape),s=zr(i,r.rank),o=i,a=r;s!=null&&(a=r.transpose(s),o=jr(o.length,r.rank));var u=F.runKernelFunc(function(c){return c.prod(a,o)},{permutedX:a});if(t){var l=wn(u.shape,i);u=u.reshape(l)}return u}}),q_=N({elu_:function(n){var e=C(n,"x","elu");return F.runKernelFunc(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return F.runKernelFunc(function(s){return s.eluDer(t,i)},{dy:t,y:i})}}})}}),QU=N({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=C(n,"x","leakyRelu");return wv(re(e).mul(t),t)}}),Y_=N({prelu_:function(n,e){var t=C(n,"x","prelu"),r=C(e,"alpha","prelu");return F.runKernelFunc(function(i,s){var o=i.prelu(t,r);return s([t,r]),o},{x:t,alpha:r},function(i,s){var o=s[0],a=s[1],u=o.greater(0);return{x:function(){return $s(u,i,i.mul(a))},alpha:function(){var l=$s(u,Me(i),i.mul(o)),c=At(a.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(a.shape)}}},"Prelu")}}),ct=N({relu_:function(n){var e=C(n,"x","relu");return e.dtype==="bool"?e.toInt():F.runKernelFunc(function(t,r){var i=t.relu(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),X_=N({relu6_:function(n){var e=C(n,"x","relu6");return e.dtype==="bool"?e.toInt():F.runKernelFunc(function(t,r){var i=t.relu6(e);return r([e]),i},{x:e},function(t,r){var i=r[0],s=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(s.toFloat())}}},"Relu6")}}),JU=N({selu_:function(n){var e=C(n,"x","selu");return F.runKernelFunc(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var s=i.greater(re(0)),o=re(Ev),a=re(bv),u=t.mul(a),l=t.mul(o).mul(i.toFloat().exp());return $s(s,u,l)}}})}}),ns=N({transpose_:function(n,e){var t=C(n,"x","transpose");if(e==null&&(e=t.shape.map(function(i,s){return s}).reverse()),L(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){L(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var r={perm:e};return F.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},function(i){var s=cv(e);return{x:function(){return i.transpose(s)}}},"Transpose",r)}}),ZU=N({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var s=C(n,"x","localResponseNormalization");L(s.rank===4||s.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+s.rank+"."}),L(xt(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var o=s,a=!1;s.rank===3&&(a=!0,o=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]));var u=F.runKernelFunc(function(l,c){var d=l.localResponseNormalization4D(o,e,t,r,i);return c([o,d]),d},{x4D:o},function(l,c){var d=c[0],f=c[1];return{x4D:function(){return F.runKernelFunc(function(h){return h.LRNGrad(l,d,f,e,t,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Q_=N({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=function a(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return a(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(re(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=C(n,"x","norm"),e,t),s=i.shape;if(r){var o=Lt(t,n.shape);s=wn(i.shape,o)}return i.reshape(s)}}),e$=N({basicLSTMCell_:function(n,e,t,r,i,s){var o=C(n,"forgetBias","basicLSTMCell"),a=C(e,"lstmKernel","basicLSTMCell"),u=C(t,"lstmBias","basicLSTMCell"),l=C(r,"data","basicLSTMCell"),c=C(i,"c","basicLSTMCell"),d=C(s,"h","basicLSTMCell"),f=l.concat(d,1).matMul(a).add(u),h=f.shape[0],p=f.shape[1]/4,g=[h,p],m=f.slice([0,0],g),v=f.slice([0,p],g),y=f.slice([0,2*p],g),x=f.slice([0,3*p],g),E=m.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(o.add(y).sigmoid())),b=E.tanh().mulStrict(x.sigmoid());return[E,b]}}),t$=N({multiRNNCell_:function(n,e,t,r){for(var i=C(e,"data","multiRNNCell"),s=od(t,"c","multiRNNCell"),o=od(r,"h","multiRNNCell"),a=i,u=[],l=0;l<n.length;l++){var c=n[l](a,s[l],o[l]);u.push(c[0]),u.push(c[1]),a=c[1]}var d=[],f=[];for(l=0;l<u.length;l+=2)d.push(u[l]),f.push(u[l+1]);return[d,f]}}),n$=N({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var s=C(n,"v","movingAverage"),o=C(e,"x","movingAverage"),a=C(t,"decay","movingAverage");ZF(s,o),L(Mt(s.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=re(1),l=u.sub(a),c=o.sub(s).mul(l);if(i){L(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=C(r,"step","movingAverage");c=c.div(u.sub(md(a,d)))}return s.add(c)}}),r$=N({stridedSlice_:function(n,e,t,r,i,s,o,a,u){if(i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=0),a===void 0&&(a=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),o!==0)throw new Error("ellipsis mask is not yet supported");var l=C(n,"x","stridedSlice"),c=c1(a),d=l.shape.slice();c.forEach(function(m){e[m]=0,t[m]=1,d.splice(m,0,1)}),l=l.reshape(d);for(var f=0;f<l.rank;f++)e[f]=hB(i,e,r,l.shape,f),t[f]=pB(s,t,r,l.shape,f),r[f]=r[f]||1;var h=c1(u);h.forEach(function(m){t[m]=e[m]+1,r[m]=1});var p=pv(e,t,r),g=p.filter(function(m,v){return h.indexOf(v)===-1});return r.every(function(m){return m===1})?Vr(l,e,p).reshape(g):F.runKernelFunc(function(m){return m.stridedSlice(l,e,t,r)},{$x:l}).reshape(g)}}),i$=N({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=C(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var s=F.runKernelFunc(function(o){return o.topk(r,e,t)},{$x:r});return{values:s[0],indices:s[1]}}}),s$=N({scatterND_:function(n,e,t){var r=C(n,"indices","scatterND","int32"),i=C(e,"updates","scatterND");return dB(i,r,t),F.runKernelFunc(function(s){return s.scatterND(r,i,t)},{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),Rv=N({fft_:function(n){L(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return F.runKernelFunc(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),vd=N({ifft_:function(n){L(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return F.runKernelFunc(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),Cv=N({rfft_:function(n,e){L(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var s=n.shape.map(function(v){return 0}),o=n.shape.map(function(v){return v});o[n.shape.length-1]=e,t=n.slice(s,o),r=e}else if(e!=null&&e>r){var a=n.shape.map(function(v){return v});a[n.shape.length-1]=e-r,t=n.concat(et(a),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=$t(t,u).as2D(i,r),c=Rv(l),d=Math.floor(r/2)+1,f=Yn(c),h=Dr(c),p=f.split([d,r-d],f.shape.length-1),g=h.split([d,r-d],h.shape.length-1),m=t.shape.slice();return m[t.shape.length-1]=d,$t(p[0],g[0]).reshape(m)}}),J_=N({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=vd(r);return Yn(i)}var s=[t,2*(e-1)],o=Yn(n).as2D(t,e),a=Dr(n).as2D(t,e),u=o.slice([0,1],[t,e-2]).reverse(1),l=a.slice([0,1],[t,e-2]).reverse(1).mul(re(-1)),c=o.concat(u,1),d=a.concat(l,1);return r=$t(c,d).as2D(s[0],s[1]),i=vd(r),Yn(i)}}),o$=Object.freeze({fft:Rv,ifft:vd,rfft:Cv,irfft:J_}),a$=N({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=C(n,"sparseIndices","sparseToDense","int32"),s=C(e,"sparseValues","sparseToDense"),o=C(r,"defaultValue","sparseToDense",s.dtype);return function(a,u,l,c){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var d=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,s,t,o),F.runKernelFunc(function(a){return a.sparseToDense(i,s,t,o)},{$sparseIndices:i,$sparseValues:s,$defaultValue:o})}}),u$=N({gatherND_:function(n,e){var t=C(e,"indices","gatherND","int32"),r=C(n,"x","gatherND");return F.runKernelFunc(function(i){return i.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),l$=N({diag_:function(n){var e=C(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return F.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),c$=N({dropout_:function(n,e,t,r){var i=C(n,"x","dropout");if(L(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),L(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return n instanceof lt?i.clone():i;var s=function(u,l){if(l==null)return u.shape.slice();if(Mt(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],d=0;d<u.shape.length;d++)l[d]==null&&u.shape[d]!=null?c.push(u.shape[d]):c.push(l[d]);return c}return l}(i,t),o=1-e,a=YT(s,0,1,"float32",r).add(o).floor().div(o);return i.mul(a)}});function Z_(n,e,t){for(var r=1-n%2,i=new Float32Array(n),s=0;s<n;++s){var o=2*Math.PI*s/(n+r-1);i[s]=e-t*Math.cos(o)}return bt(i,"float32")}var Av=N({hannWindow_:function(n){return Z_(n,.5,.5)}}),eI=N({hammingWindow_:function(n){return Z_(n,.54,.46)}}),kv=N({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var s=0,o=[];s+e<=n.size;)o.push(Vr(n,s,e)),s+=t;if(r)for(;s<n.size;){var a=s+e-n.size,u=Rt([Vr(n,s,e-a),Gr([a],i)]);o.push(u),s+=t}return o.length===0?Yi([],[0,e]):Rt(o).as2D(o.length,e)}}),tI=N({stft_:function(n,e,t,r,i){var s;i===void 0&&(i=Av),r==null&&(s=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(s)/Math.log(2)))));for(var o=kv(n,e,t),a=rn(o,i(e)),u=[],l=0;l<o.shape[0];l++)u.push(Cv(a.slice([l,0],[1,e]),r));return Rt(u)}}),d$=Object.freeze({hannWindow:Av,hammingWindow:eI,frame:kv,stft:tI}),nn,f$=function(n,e,t){return t===void 0&&(t=1),le(this,void 0,void 0,function(){var r,i,s,o,a,u,l,c,d,f,h,p,g,m;return ce(this,function(v){switch(v.label){case 0:return r=C(n,"predictions","inTopK"),i=C(e,"targets","inTopK"),L(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),L(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),Ve(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),s=r.shape[r.shape.length-1],L(t>0&&t<=s,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+s+"), but got "+t}),[4,r.data()];case 1:return o=v.sent(),[4,i.data()];case 2:for(a=v.sent(),u=[o.length/s,s],c=u[1],d=_u("bool",l=u[0]),f=0;f<l;f++){for(h=f*c,p=o.subarray(h,h+c),g=[],m=0;m<p.length;m++)g.push({value:p[m],index:m});for(g.sort(function(y,x){return x.value-y.value}),d[f]=0,m=0;m<t;m++)if(g[m].index===a[f]){d[f]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,Wt(d,i.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(nn||(nn={}));var h$=N({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=nn.SUM_BY_NONZERO_WEIGHTS);var i=C(n,"labels","absoluteDifference"),s=C(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=C(t,"weights","absoluteDifference")),Ve(i.shape,s.shape,"Error in absoluteDifference: ");var a=i.sub(s).abs();return Ei(a,o,r)}}),Ei=N({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=nn.SUM_BY_NONZERO_WEIGHTS);var r=C(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=C(e,"weights","computeWeightedLoss"));var s=i==null?r:r.mul(i);if(t===nn.NONE)return s;if(t===nn.SUM)return s.sum();if(t===nn.MEAN){if(i==null)return s.mean();var o=r.size/i.size,a=s.sum().div(i.sum());return o>1?a.div(re(o)):a}if(t===nn.SUM_BY_NONZERO_WEIGHTS){if(i==null)return s.sum().div(re(r.size));var u=i.mul(da(r.shape)).notEqual(re(0)).sum().toFloat();return s.sum().div(u)}throw Error("Unknown reduction: "+t)}}),p$=N({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=nn.SUM_BY_NONZERO_WEIGHTS);var s=C(n,"labels","cosineDistance"),o=C(e,"predictions","cosineDistance"),a=null;r!=null&&(a=C(r,"weights","cosineDistance")),Ve(s.shape,o.shape,"Error in cosineDistance: ");var u=re(1).sub(s.mul(o).sum(t,!0));return Ei(u,a,i)}}),g$=N({hingeLoss_:function(n,e,t,r){r===void 0&&(r=nn.SUM_BY_NONZERO_WEIGHTS);var i=C(n,"labels","hingeLoss"),s=C(e,"predictions","hingeLoss"),o=null;t!=null&&(o=C(t,"weights","hingeLoss")),Ve(i.shape,s.shape,"Error in hingeLoss: ");var a=re(1);i=re(2).mul(i).sub(a);var u=a.sub(i.mul(s)).relu();return Ei(u,o,r)}}),m$=N({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=nn.SUM_BY_NONZERO_WEIGHTS);var s=C(n,"labels","huberLoss"),o=C(e,"predictions","huberLoss"),a=null;t!=null&&(a=C(t,"weights","huberLoss")),Ve(s.shape,o.shape,"Error in huberLoss: ");var u=re(r),l=o.sub(s).abs(),c=O_(l,u),d=l.sub(c),f=re(.5).mul(c.square()).add(u.mul(d));return Ei(f,a,i)}}),v$=N({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=nn.SUM_BY_NONZERO_WEIGHTS);var s=C(n,"labels","logLoss"),o=C(e,"predictions","logLoss"),a=null;t!=null&&(a=C(t,"weights","logLoss")),Ve(s.shape,o.shape,"Error in logLoss: ");var u=re(1),l=re(r),c=s.mul(o.add(l).log()).neg().sub(u.sub(s).mul(u.sub(o).add(l).log()));return Ei(c,a,i)}}),y$=N({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=nn.SUM_BY_NONZERO_WEIGHTS);var i=C(n,"labels","meanSquaredError"),s=C(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=C(t,"weights","meanSquaredError")),Ve(i.shape,s.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(s);return Ei(a,o,r)}}),x$=N({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=nn.SUM_BY_NONZERO_WEIGHTS);var s=C(n,"multiClassLabels","sigmoidCrossEntropy"),o=C(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=C(t,"weights","sigmoidCrossEntropy")),Ve(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=re(r),l=re(1),c=re(.5);s=s.mul(l.sub(u)).add(c.mul(u))}var d=function(f,h){var p=C(f,"labels","sigmoidCrossEntropyWithLogits"),g=C(h,"logits","sigmoidCrossEntropyWithLogits");Ve(p.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=g.relu(),v=g.mul(p),y=g.abs().neg().exp().log1p();return m.sub(v).add(y)}(s,o);return Ei(d,a,i)}}),E$=N({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=nn.SUM_BY_NONZERO_WEIGHTS);var s=C(n,"onehotLabels","softmaxCrossEntropy"),o=C(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=C(t,"weights","softmaxCrossEntropy")),Ve(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=re(r),l=re(1),c=re(s.shape[1]);s=s.mul(l.sub(u)).add(u.div(c))}var d=function(f,h,p){if(p===void 0&&(p=-1),p===-1&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return tf(function(g,m,v){var y=m.logSumExp([p],!0),x=m.toFloat().sub(y);return v([g,x]),{value:x.mul(g).neg().sum([p]),gradFunc:function(E,b){var S=b[0],w=b[1],T=wn(E.shape,[p]);return[E.reshape(T).mul(S.toFloat().sub(w.exp())),E.reshape(T).mul(w.exp().sub(S.toFloat()))]}}})(f,h)}(s,o);return Ei(d,a,i)}}),b$=Object.freeze({get Reduction(){return nn},absoluteDifference:h$,computeWeightedLoss:Ei,cosineDistance:p$,hingeLoss:g$,huberLoss:m$,logLoss:v$,meanSquaredError:y$,sigmoidCrossEntropy:x$,softmaxCrossEntropy:E$});function D1(n,e){return e===void 0&&(e=!1),F.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=qT(t),s=n.clone(),o=Yi([[1]],[1,1]),a=o.clone(),u=t>=r?r:t,l=function(d){var f,h=s,p=a,g=i;f=F.tidy(function(){var m=s.slice([d,d],[t-d,1]),v=m.norm(),y=s.slice([d,d],[1,1]),x=Yi([[-1]]).where(y.greater(0),Yi([[1]])),E=y.sub(x.mul(v)),b=m.div(E);a=b.shape[0]===1?o.clone():o.concat(b.slice([1,0],[b.shape[0]-1,b.shape[1]]),0);var S=x.matMul(E).div(v).neg(),w=s.slice([d,0],[t-d,r]),T=S.mul(a);if(d===0)s=w.sub(T.matMul(a.transpose().matMul(w)));else{var R=w.sub(T.matMul(a.transpose().matMul(w)));s=s.slice([0,0],[d,r]).concat(R,0)}var _=i.slice([0,d],[t,i.shape[1]-d]);if(d===0)i=_.sub(_.matMul(a).matMul(T.transpose()));else{var A=_.sub(_.matMul(a).matMul(T.transpose()));i=i.slice([0,0],[t,d]).concat(A,1)}return[a,s,i]}),a=f[0],s=f[1],i=f[2],Sn([h,p,g])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),s=s.slice([0,0],[r,r])),[i,s]})}var S$=N({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=C(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,s=r.shape.slice(-2),o=s[0],a=s[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+o+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=o),t<0&&(t=a);var u=ad(0,o,1,"int32").reshape([-1,1]),l=ad(0,a,1,"int32"),c=kt(u,l),d=rf(c.lessEqual(re(+e,"int32")),c.greaterEqual(re(-t,"int32"))),f=et([o,a],r.dtype);return Mn(Ct(r.reshape([-1,o,a])).map(function(h){return $s(d,h,f)})).reshape(i)}}),w$=N({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,L(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){L(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=fv(n,n.shape[0],0).map(function(u){return QT(u,[0])});L(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var s=[],o=n,a=function(u){s.push(F.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var d=K_(s[c].mulStrict(l)).mul(s[c]);l=l.sub(d)}return l.div(Q_(l,"euclidean"))}))};for(i=0;i<n.length;++i)a(i);return e?Mn(s,0):s}}),T$=N({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return D1(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(o,a){return o*a}),r=Ct(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],s=[];return r.forEach(function(o){var a=D1(o,e),u=a[0],l=a[1];i.push(u),s.push(l)}),[Mn(i,0).reshape(n.shape),Mn(s,0).reshape(n.shape)]}}),_$=Object.freeze({bandPart:S$,gramSchmidt:w$,qr:T$});function uf(n,e,t,r,i,s){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),s==null&&(s=0);var o=n.shape[0];return t=Math.min(t,o),L(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),L(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),L(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),L(e.rank===1,function(){return"scores must be a 1D tensor"}),L(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),L(0<=s&&s<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+s+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}var I$=N({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=C(n,"images","resizeBilinear");L(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),L(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,s=!1;r.rank===3&&(s=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],a=e[1],u=F.runKernelFunc(function(l,c){return c([i]),l.resizeBilinear(i,o,a,t)},{x:i},function(l,c){return{x:function(){return F.runKernelFunc(function(d){return d.resizeBilinearBackprop(l,c[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:o,newWidth:a});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),R$=N({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=C(n,"images","resizeNearestNeighbor");L(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),L(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),L(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,s=!1;r.rank===3&&(s=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e[0],a=e[1],u=F.runKernelFunc(function(l,c){return c([i]),l.resizeNearestNeighbor(i,o,a,t)},{batchImages:i},function(l,c){return{batchImages:function(){return F.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),C$=N({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var s=C(n,"boxes","nonMaxSuppression"),o=C(e,"scores","nonMaxSuppression"),a=uf(s,o,t,r,i);t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return F.runKernelFunc(function(l){return l.nonMaxSuppression(s,o,t,r,i)},{boxes:s,scores:o},null,"NonMaxSuppressionV3",u)}}),A$=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),le(this,void 0,void 0,function(){var s,o,a,u,l,c,d;return ce(this,function(f){switch(f.label){case 0:return s=C(n,"boxes","nonMaxSuppressionAsync"),o=C(e,"scores","nonMaxSuppressionAsync"),a=uf(s,o,t,r,i),t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([s.data(),o.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],d=mv(l,c,t,r,i),s!==n&&s.dispose(),o!==e&&o.dispose(),[2,d]}})})},k$=N({nonMaxSuppressionWithScore_:function(n,e,t,r,i,s){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),s===void 0&&(s=0);var o=C(n,"boxes","nonMaxSuppression"),a=C(e,"scores","nonMaxSuppression"),u=uf(o,a,t,r,i,s),l={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:s=u.softNmsSigma},c=F.runKernel("NonMaxSuppressionV5",{boxes:o,scores:a},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),L$=function(n,e,t,r,i,s){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),s===void 0&&(s=0),le(this,void 0,void 0,function(){var o,a,u,l,c,d,f;return ce(this,function(h){switch(h.label){case 0:return o=C(n,"boxes","nonMaxSuppressionAsync"),a=C(e,"scores","nonMaxSuppressionAsync"),u=uf(o,a,t,r,i,s),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma,[4,Promise.all([o.data(),a.data()])];case 1:return l=h.sent(),c=l[0],d=l[1],f=vv(c,d,t,r,i,s),o!==n&&o.dispose(),a!==e&&a.dispose(),[2,f]}})})},D$=N({cropAndResize_:function(n,e,t,r,i,s){var o=C(n,"image","cropAndResize"),a=C(e,"boxes","cropAndResize","float32"),u=C(t,"boxInd","cropAndResize","int32");i=i||"bilinear",s=s||0;var l=a.shape[0];return L(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."}),L(a.rank===2&&a.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+a.shape+"."}),L(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+a.shape+"."}),L(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),L(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),L(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),F.runKernelFunc(function(c,d){return c.cropAndResize(o,a,u,r,i,s)},{images:o,boxes:a,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:s,cropSize:r})}}),Lv=Object.freeze({resizeBilinear:I$,resizeNearestNeighbor:R$,nonMaxSuppression:C$,nonMaxSuppressionAsync:A$,nonMaxSuppressionWithScore:k$,nonMaxSuppressionWithScoreAsync:L$,cropAndResize:D$}),Dv=function(n,e){return!(n>0)||e==="linear"},Pv=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Ov=function(n,e){var t=e,r=At(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},Nv=function(n,e,t){if(e==="linear")return n;if(e==="relu")return ct(n);if(e==="elu")return q_(n);if(e==="relu6")return X_(n);if(e==="prelu")return Y_(n,t);throw new Error("Unknown fused activation "+e+".")},P$=N({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,s=i!==void 0&&i,o=n.transposeB,a=o!==void 0&&o,u=n.bias,l=n.activation,c=l===void 0?"linear":l,d=n.preluActivationWeights;if(Dv(F.state.gradientDepth,c)===!1){var f=of(t,r,s,a);return u!=null&&(f=ke(f,u)),Nv(f,c,d)}var h=C(t,"a","fused matMul"),p=C(r,"b","fused matMul");e=pt(h,p),h=e[0],p=e[1];var g=s?h.shape[h.rank-2]:h.shape[h.rank-1],m=a?p.shape[p.rank-1]:p.shape[p.rank-2],v=s?h.shape[h.rank-1]:h.shape[h.rank-2],y=a?p.shape[p.rank-2]:p.shape[p.rank-1],x=h.shape.slice(0,-2),E=p.shape.slice(0,-2),b=fe(x),S=fe(E);L(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),L(Mt(x,E),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+E+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),L(g===m,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+m+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+s+" and transposeB="+a+" must match."});var w,T,R=h.shape.slice(0,-2).concat([v,y]),_=s?h.as3D(b,g,v):h.as3D(b,v,g),A=a?p.as3D(S,y,m):p.as3D(S,m,y);u!=null&&Pe(R,(w=pt(w=C(u,"bias","fused matMul"),h)[0]).shape),d!=null&&(T=C(d,"prelu weights","fused matMul"));var k={a:_,b:A};u!=null&&(k.bias=w),d!=null&&(k.preluActivationWeights=T);var G=[_,A];return F.runKernelFunc(function(U,M){var B=U.fusedBatchMatMul({a:_,b:A,transposeA:s,transposeB:a,bias:w,activation:c,preluActivationWeights:T});return M([_,A,B]),B},k,function(U,M){var B=M[0],$=M[1],D=M[2],P=Pv(U,D,c),O={};return u!=null&&(O={bias:function(){return Ov(w,P)}}),Object.assign(s||a?!s&&a?{a:function(){return P.matMul($,!1,!1)},b:function(){return P.matMul(B,!0,!1)}}:s&&!a?{a:function(){return $.matMul(P,!1,!0)},b:function(){return B.matMul(P,!1,!1)}}:{a:function(){return $.matMul(P,!0,!0)},b:function(){return P.matMul(B,!0,!0)}}:{a:function(){return P.matMul($,!1,!0)},b:function(){return B.matMul(P,!0,!1)}},O)},"_FusedMatMul",{transposeA:s,transposeB:a,activation:c},G,[!0]).reshape(R)}}),O$=N({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,s=n.dataFormat,o=s===void 0?"NHWC":s,a=n.dilations,u=a===void 0?[1,1]:a,l=n.dimRoundingMode,c=n.bias,d=n.activation,f=d===void 0?"linear":d,h=n.preluActivationWeights;if(f=f||"linear",Dv(F.state.gradientDepth,f)===!1){var p=nr(e,t,r,i,o,u,l);return c!=null&&(p=ke(p,c)),Nv(p,f,h)}var g=C(e,"x","conv2d"),m=C(t,"filter","conv2d"),v=g,y=!1;g.rank===3&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),L(v.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),L(m.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),l!=null&&L(xt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),L(v.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),L(Tn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),L(o==="NHWC",function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."});var x,E,b=js(v.shape,m.shape,r,u,i,l);c!=null&&(x=pt(x=C(c,"bias","fused conv2d"),g)[0],Pe(b.outShape,x.shape)),h!=null&&(E=C(h,"prelu weights","fused conv2d"));var S={x:v,filter:m};c!=null&&(S.bias=x),h!=null&&(S.preluActivationWeights=E);var w=[m,v],T=F.runKernelFunc(function(R,_){var A=R.fusedConv2d({input:v,filter:m,convInfo:b,bias:x,activation:f,preluActivationWeights:E});return _([m,v,A]),A},S,function(R,_){var A=_,k=A[0],G=A[1],U=A[2],M=Pv(R,U,f);L(ta(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var B={};return c!=null&&(B={bias:function(){return Ov(x,M)}}),Object.assign({x:function(){return $_(G.shape,M,k,r,i)},filter:function(){return _v(G,M,k.shape,r,i)}},B)},"FusedConv2D",{convInfo:b,activation:f},w,[!0]);return y?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}}),N$=N({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,s=n.dataFormat,o=s===void 0?"NHWC":s,a=n.dilations,u=a===void 0?[1,1]:a,l=n.dimRoundingMode,c=n.bias,d=n.activation,f=d===void 0?"linear":d,h=n.preluActivationWeights;if(Dv(F.state.gradientDepth,f)===!1){var p=sf(e,t,r,i,o,u,l);return c!=null&&(p=ke(p,c)),Nv(p,f,h)}var g=C(e,"x","depthwiseConv2d"),m=C(t,"filter","depthwiseConv2d"),v=g,y=!1;g.rank===3&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),L(v.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),L(m.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),L(v.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),u==null&&(u=[1,1]),L(Tn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&L(xt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var x,E,b=js(v.shape,m.shape,r,u,i,l,!0);c!=null&&(x=pt(x=C(c,"bias","fused conv2d"),g)[0],Pe(b.outShape,x.shape)),h!=null&&(E=C(h,"prelu weights","fused depthwiseConv2d"));var S={x:v,filter:m};c!=null&&(S.bias=x),h!=null&&(S.preluActivationWeights=E);var w=[m,v],T=F.runKernelFunc(function(R,_){var A=R.fusedDepthwiseConv2D({input:v,filter:m,convInfo:b,bias:x,activation:f,preluActivationWeights:E});return _([m,v,A]),A},S,function(R,_){L(ta(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var A=_[0],k=_[1],G=_[2],U=Pv(R,G,f),M={};return c!=null&&(M={bias:function(){return Ov(x,U)}}),Object.assign({x:function(){return G_(k.shape,U,A,b)},filter:function(){return W_(k,U,A.shape,b)}},M)},"FusedDepthwiseConv2D",{convInfo:b,activation:f},w,[!0]);return y?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}}),F$=Object.freeze({matMul:P$,conv2d:O$,depthwiseConv2d:N$}),M$=Object.freeze({image:Lv,linalg:_$,losses:b$,spectral:o$,fused:F$,signal:d$,square:v4,squaredDifference:T_,conv1d:IU,conv2d:nr,conv3d:RU,depthwiseConv2d:sf,separableConv2d:Iv,conv2dTranspose:CU,conv3dTranspose:AU,op:N,batchNormalization2d:K4,batchNormalization3d:q4,batchNormalization4d:Y4,batchNormalization:X4,batchNorm:k_,batchNorm2d:Q4,batchNorm3d:J4,batchNorm4d:Z4,booleanMaskAsync:_U,complex:$t,real:Yn,imag:Dr,concat:Rt,concat1d:FM,concat2d:MM,concat3d:BM,concat4d:UM,split:fv,matMul:of,dot:kU,outerProduct:LU,reverse:ju,reverse1d:DU,reverse2d:PU,reverse3d:OU,reverse4d:NU,maxPool:Ot,avgPool:Ku,pool:FU,maxPool3d:MU,avgPool3d:BU,slice:Vr,slice1d:UU,slice2d:$U,slice3d:z_,slice4d:GU,abs:y4,acos:x4,acosh:E4,asin:b4,asinh:S4,atan:w4,atanh:T4,ceil:_4,clipByValue:Sv,cos:I4,cosh:R4,erf:C4,exp:Lg,expm1:A4,floor:k4,log:L4,log1p:D4,logSigmoid:P4,neg:gd,reciprocal:O4,round:N4,rsqrt:__,sigmoid:I_,sign:F4,isNaN:M4,isInf:B4,isFinite:U4,sin:$4,sinh:G4,softplus:W4,sqrt:V4,step:H4,tan:z4,tanh:j4,all:WU,any:VU,argMax:HU,argMin:zU,logSumExp:jU,max:af,mean:KU,min:qU,moments:YU,sum:K_,prod:XU,equal:N_,equalStrict:gU,greater:mU,greaterEqual:F_,greaterEqualStrict:vU,greaterStrict:yU,less:xU,lessEqual:EU,lessEqualStrict:bU,lessStrict:SU,notEqual:wU,notEqualStrict:TU,add:ke,addN:nU,addStrict:rU,atan2:iU,div:cr,divNoNan:sU,divStrict:oU,floorDiv:P_,maximum:wv,maximumStrict:aU,minimum:O_,minimumStrict:uU,mod:lU,modStrict:cU,mul:rn,mulStrict:dU,pow:md,powStrict:fU,squaredDifferenceStrict:hU,sub:kt,subStrict:pU,elu:q_,leakyRelu:QU,prelu:Y_,relu:ct,relu6:X_,selu:JU,logicalAnd:rf,logicalNot:eU,logicalOr:L_,logicalXor:tU,where:$s,whereAsync:D_,buffer:we,print:qM,batchToSpaceND:KT,broadcastTo:YM,cast:XM,clone:QM,cumsum:JM,depthToSpace:ZM,expandDims:qn,eye:qT,multinomial:eB,oneHot:Rg,pad:zs,pad1d:tB,pad2d:nB,pad3d:rB,pad4d:iB,rand:sB,randomNormal:oB,randomGamma:aB,randomUniform:YT,reshape:fr,spaceToBatchND:XT,squeeze:QT,stack:Mn,tile:Oo,truncatedNormal:uB,unstack:Ct,setdiff1dAsync:lB,fill:Gr,linspace:NM,ones:da,range:ad,scalar:re,tensor:Wt,tensor1d:bt,tensor2d:Yi,tensor3d:dv,tensor4d:gn,tensor5d:DM,tensor6d:PM,variable:OM,zeros:et,onesLike:jT,zerosLike:Me,transpose:ns,softmax:xi,logSoftmax:mB,localResponseNormalization:ZU,norm:Q_,gather:Tv,unsortedSegmentSum:M_,basicLSTMCell:e$,multiRNNCell:t$,movingAverage:n$,stridedSlice:r$,topk:i$,scatterND:s$,fft:Rv,ifft:vd,rfft:Cv,irfft:J_,sparseToDense:a$,gatherND:u$,diag:l$,dropout:c$,hannWindow:Av,hammingWindow:eI,frame:kv,stft:tI,inTopKAsync:f$});function Z(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&L(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function Mh(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var B$=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new i_(t,F),t}return yr(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,Q().get("IS_NODE")&&sd(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var s={};return this.data.set(s,{values:t,dtype:i}),s},e.prototype.move=function(t,r,i,s){this.data.set(t,{values:r,dtype:s})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return le(this,void 0,void 0,function(){return ce(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,s=r.complexTensors;return i==="complex64"?kg(this.readSync(s.real.dataId),this.readSync(s.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map(function(s){return nd(s)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return we(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var s=this.write(t,r,i);return F.makeTensorFromDataId(s,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){return r=Ar(),t(),[2,{kernelMs:Ar()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:F.keep(t.clone()),imag:F.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Z(t,"slice"),n_(t.shape,r,i)){var s=r_(r,t.strides),o=fe(i);return Wt(this.readSync(t.dataId).subarray(s,s+o),i,t.dtype)}for(var a=we(i,t.dtype),u=this.bufferSync(t),l=0;l<a.size;++l){var c=a.indexToLoc(l).map(function(d,f){return d+r[f]});a.values[l]=u.get.apply(u,c)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,i,s){Z(t,"stridedSlice");var o=pv(r,i,s);if(o.some(function(h){return h===0}))return Wt([],o);for(var a=we(o,t.dtype),u=this.bufferSync(t),l=0;l<a.size;l++){for(var c=a.indexToLoc(l),d=new Array(c.length),f=0;f<d.length;f++)d[f]=c[f]*s[f]+r[f];a.set.apply(a,[u.get.apply(u,d)].concat(c))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=we([t.size,t.size],t.dtype),s=i.values,o=0;o<r.length;o++)s[o*t.size+o]=r[o];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],s=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==r&&(s[o++]=t.shape[a]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(t,u,l).reshape(s);return c},e.prototype.reverse=function(t,r){Z(t,"reverse");for(var i=we(t.shape,t.dtype),s=this.bufferSync(t),o=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach(function(d){return c[d]=t.shape[d]-1-c[d]}),i.set.apply(i,[s.get.apply(s,c)].concat(l))},a=0;a<i.size;a++)o(a);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var s=t.map(function(h){return Yn(h)}),o=t.map(function(h){return Dr(h)});return $t(this.concat(s,r),this.concat(o,r))}var a=t.map(function(h){var p=fe(h.shape.slice(r));return h.as2D(-1,p)}),u=ea(a.map(function(h){return h.shape}),1),l=we(u,t[0].dtype).values;if(a[0].shape[0]===1){var c=0;a.forEach(function(h){l.set(i.readSync(h.dataId),c),c+=h.size})}else{var d=0;a.forEach(function(h){for(var p=i.readSync(h.dataId),g=0,m=0;m<h.shape[0];++m)for(var v=m*u[1]+d,y=0;y<h.shape[1];++y)l[v+y]=p[g++];d+=h.shape[1]})}var f=ea(t.map(function(h){return h.shape}),r);return Wt(l,f,t[0].dtype)},e.prototype.neg=function(t){return Z(t,"neg"),this.multiply(re(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,s,o,a){return{real:i+o,imag:s+a}}):this.broadcastedBinaryOp(t,r,Gt(t.dtype,r.dtype),function(i,s){return i+s})},e.prototype.addN=function(t){var r=this;Z(t,"addN");for(var i=t.map(function(c){return r.readSync(c.dataId)}),s=we(t[0].shape,t[0].dtype),o=s.values,a=0;a<t.length;a++)for(var u=i[a],l=0;l<o.length;l++)o[l]+=u[l];return s.toTensor()},e.prototype.softmax=function(t,r){var i=Lt([r],t.shape),s=this.max(t,i),o=wn(s.shape,i),a=this.subtract(t,s.reshape(o)),u=this.exp(a),l=this.sum(u,i).reshape(o);return this.realDivide(u,l)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,s,o,a){return{real:i-o,imag:s-a}}):this.broadcastedBinaryOp(t,r,Gt(t.dtype,r.dtype),function(i,s){return i-s})},e.prototype.pow=function(t,r){return Z([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,s){return Math.pow(i,s)})},e.prototype.batchMatMul=function(t,r,i,s){Z([t,r],"matMul");for(var o=i?t.shape[1]:t.shape[2],a=i?t.shape[2]:t.shape[1],u=s?r.shape[1]:r.shape[2],l=t.shape[0],c=this.readSync(t.dataId),d=this.readSync(r.dataId),f=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=f[0],p=f[1],g=f[2],m=s?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=m[0],y=m[1],x=m[2],E=a*u,b=we([l,a,u],t.dtype),S=b.values,w=this.blockSize,T=0;T<l;T++)for(var R=0;R<a;R+=w)for(var _=0;_<u;_+=w)for(var A=0;A<o;A+=w)for(var k=Math.min(R+w,a),G=Math.min(_+w,u),U=Math.min(A+w,o),M=R;M<k;M++)for(var B=_;B<G;B++){for(var $=0,D=A;D<U;D++)$+=c[T*h+M*p+D*g]*d[D*v+B*y+T*x];S[T*E+(M*u+B)]+=$}return b.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,s=t.transposeA,o=t.transposeB,a=t.bias,u=t.activation,l=t.preluActivationWeights,c=this.batchMatMul(r,i,s,o);return a&&(c=this.add(c,a)),u&&(c=Mh(this,c,u,l)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,s,o,a){return{real:i*o-s*a,imag:i*a+s*o}}):this.broadcastedBinaryOp(t,r,Gt(t.dtype,r.dtype),function(i,s){return i*s})},e.prototype.realDivide=function(t,r){return Z([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",function(i,s){return i/s})},e.prototype.floorDiv=function(t,r){return Z([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(i,s){return Math.floor(i/s)})},e.prototype.sum=function(t,r){Z(t,"sum"),In("sum",r,t.rank);for(var i=Qt(t.shape,r),s=i[0],o=i[1],a=et(s,Gt(t.dtype,"int32")),u=fe(o),l=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=c[f+p];l[d]=h}return a},e.prototype.prod=function(t,r){Z(t,"sum");for(var i=Qt(t.shape,r),s=i[0],o=i[1],a=et(s,Gt(t.dtype,"int32")),u=fe(o),l=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=c[f+p];l[d]=h}return a},e.prototype.unsortedSegmentSum=function(t,r,i){Z(t,"unsortedSegmentSum");for(var s=[],o=t.rank-r.rank,a=0;a<o;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var u=re(a,"int32"),l=N_(u,r).asType("float32").mul(t).sum(0);s.push(l)}return Mn(s)},e.prototype.argMin=function(t,r){Z(t,"argMin");var i=[r];In("argMin",i,t.rank);for(var s=Qt(t.shape,i),o=s[0],a=s[1],u=et(o,"int32"),l=fe(a),c=this.readSync(u.dataId),d=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*l,p=d[h],g=0,m=0;m<l;++m){var v=d[h+m];v<p&&(p=v,g=m)}c[f]=g}return u},e.prototype.argMax=function(t,r){Z(t,"argMax");var i=[r];In("argMax",i,t.rank);for(var s=Qt(t.shape,i),o=s[0],a=s[1],u=et(o,"int32"),l=fe(a),c=this.readSync(u.dataId),d=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*l,p=d[h],g=0,m=0;m<l;++m){var v=d[h+m];v>p&&(p=v,g=m)}c[f]=g}return u},e.prototype.cumsum=function(t,r,i,s){if(Z(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var o=Gt(t.dtype,"int32"),a=et(t.shape,o),u=this.readSync(a.dataId),l=this.readSync(t.dataId),c=t.shape[t.rank-1],d=s?function(m,v){return m+c-v-1}:function(m,v){return m+v},f=0;f<l.length;f+=c)for(var h=0;h<c;h++){var p=d(f,h);if(h===0)u[p]=i?0:l[p];else{var g=d(f,h-1);u[p]=i?l[g]+u[g]:l[p]+u[g]}}return a},e.prototype.equal=function(t,r){return Z([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i===s?1:0})},e.prototype.notEqual=function(t,r){return Z([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i!==s?1:0})},e.prototype.less=function(t,r){return Z([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i<s?1:0})},e.prototype.lessEqual=function(t,r){return Z([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i<=s?1:0})},e.prototype.greater=function(t,r){return Z([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i>s?1:0})},e.prototype.greaterEqual=function(t,r){return Z([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i>=s?1:0})},e.prototype.logicalNot=function(t){Z(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),s=0;s<r.length;++s)i[s]=r[s]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Z([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i&&s})},e.prototype.logicalOr=function(t,r){return Z([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(i,s){return i||s})},e.prototype.select=function(t,r,i){Z([t,r,i],"select");for(var s=this.readSync(t.dataId),o=this.readSync(r.dataId),a=this.readSync(i.dataId),u=et(r.shape,Gt(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,d=t.rank===0||t.rank>1||r.rank===1?1:fe(r.shape.slice(1)),f=0;f<s.length;f++)for(var h=0;h<d;h++)s[f]===1?l[c++]=o[f]:l[c++]=a[f];return u},e.prototype.where=function(t){Z([t],"where");var r=this.readSync(t.dataId);return yv(t.shape,r)},e.prototype.topk=function(t,r,i){return Z(t,"topk"),f_(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Z(t,"min"),In("min",r,t.rank);for(var i=Qt(t.shape,r),s=i[0],o=i[1],a=et(s,t.dtype),u=fe(o),l=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var g=c[f+p];g<h&&(h=g)}l[d]=h}return a},e.prototype.minimum=function(t,r){return Z([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,s){return Math.min(i,s)})},e.prototype.mod=function(t,r){return Z([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,s){var o=i%s;return i<0&&s<0||i>=0&&s>=0?o:(o+s)%s})},e.prototype.max=function(t,r){Z(t,"max"),In("max",r,t.rank);for(var i=Qt(t.shape,r),s=i[0],o=i[1],a=et(s,t.dtype),u=fe(o),l=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var g=c[f+p];g>h&&(h=g)}l[d]=h}return a},e.prototype.maximum=function(t,r){return Z([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,s){return Math.max(i,s)})},e.prototype.all=function(t,r){Z(t,"all"),In("all",r,t.rank);for(var i=Qt(t.shape,r),s=i[0],o=i[1],a=et(s,t.dtype),u=fe(o),l=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var g=c[f+p];h=h&&g}l[d]=h}return a},e.prototype.any=function(t,r){Z(t,"any"),In("any",r,t.rank);for(var i=Qt(t.shape,r),s=i[0],o=i[1],a=et(s,t.dtype),u=fe(o),l=this.readSync(a.dataId),c=this.readSync(t.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var g=c[f+p];h=h||g}l[d]=h}return a},e.prototype.squaredDifference=function(t,r){return Z([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,s){var o=i-s;return o*o})},e.prototype.ceil=function(t){Z(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s)i[s]=Math.ceil(r[s]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Z(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s)i[s]=Math.floor(r[s]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s)r[s]<0?i[s]=-1:r[s]>0?i[s]=1:i[s]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isNaN(r[s])&&(i[s]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),s=0;s<r.length;++s)Math.abs(r[s])===1/0&&(i[s]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Z(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),s=0;s<r.length;++s)Number.isFinite(r[s])&&(i[s]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Z(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s){var o=Math.floor(r[s]);r[s]-o<.5?i[s]=Math.floor(r[s]):r[s]-o>.5?i[s]=Math.ceil(r[s]):i[s]=o%2==0?o:o+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Z(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s)i[s]=Math.exp(r[s]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Z(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s)i[s]=Math.expm1(r[s]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Z(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];i[s]=Math.log(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Z(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];i[s]=Math.log1p(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Z(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];i[s]=Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Z(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s){var o=r[s];i[s]=1/Math.sqrt(o)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Z(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),s=0;s<r.length;++s)i[s]=1/r[s];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Z(t,"relu");for(var r=et(t.shape,t.dtype),i=this.readSync(r.dataId),s=this.readSync(t.dataId),o=0;o<s.length;++o)i[o]=Math.max(0,s[o]);return r},e.prototype.relu6=function(t){Z(t,"relu");for(var r=et(t.shape,t.dtype),i=this.readSync(r.dataId),s=this.readSync(t.dataId),o=0;o<s.length;++o)i[o]=Math.min(Math.max(0,s[o]),6);return r},e.prototype.prelu=function(t,r){return Z([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,s){return i<0?s*i:i})},e.prototype.elu=function(t){Z(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s){var o=i[s];r[s]=o>=0?o:Math.exp(o)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Z([t,r],"eluDer");for(var i=new Float32Array(r.size),s=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<s.length;++a){var u=s[a];i[a]=u>=1?o[a]:o[a]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Z(t,"selu");for(var r=Ev,i=bv,s=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var u=o[a];s[a]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(s,t.shape,"float32")},e.prototype.clip=function(t,r,i){Z(t,"clip");for(var s=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var u=o[a];s[a]=u>i?i:u<r?r:u}return this.makeOutput(s,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.abs(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<t.size;++s){var o=i[2*s],a=i[2*s+1];r[s]=Math.hypot(o,a)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Z(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=i[s];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Z(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=1/(1+Math.exp(-i[s]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Z(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o){var a=s[o]>-r,u=s[o]<r,l=Math.exp(s[o]),c=void 0;c=u?l:a?s[o]:Math.log(1+l),i[o]=c}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Z(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.sin(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Z(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.cos(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Z(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.tan(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Z(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.asin(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Z(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.acos(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Z(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.atan(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Z([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,s){return Math.atan2(i,s)})},e.prototype.sinh=function(t){Z(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.sinh(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Z(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.cosh(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Z(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=UF(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Z(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.asinh(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Z(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.acosh(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Z(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s)r[s]=Math.atanh(i[s]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Z(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),s=0;s<i.length;++s){var o=Math.sign(i[s]),a=Math.abs(i[s]),u=1/(1+.3275911*a);r[s]=o*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Z(t,"step");for(var i=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o){var a=s[o];isNaN(a)?i[o]=NaN:i[o]=a>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,s=t.convInfo,o=t.bias,a=t.activation,u=t.preluActivationWeights,l=this.conv2d(r,i,s);return o&&(l=this.add(l,o)),a&&(l=Mh(this,l,a,u)),l},e.prototype.conv2d=function(t,r,i){Z([t,r],"conv2d");for(var s=i.filterHeight,o=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,d=i.dataFormat==="channelsLast",f=we(i.outShape,t.dtype),h=t.strides[0],p=d?t.strides[1]:t.strides[2],g=d?t.strides[2]:1,m=d?1:t.strides[1],v=f.strides[0],y=d?f.strides[1]:f.strides[2],x=d?f.strides[2]:1,E=d?1:f.strides[1],b=this.readSync(t.dataId),S=this.readSync(r.dataId),w=f.values,T=0;T<i.batchSize;++T)for(var R=T*h,_=T*v,A=0;A<i.outHeight;++A)for(var k=_+A*y,G=A*i.strideHeight-c,U=0;U<s;U++){var M=G+U*a;if(!(M<0||M>=i.inHeight))for(var B=U*r.strides[0],$=R+M*p,D=0;D<i.outWidth;++D)for(var P=k+D*x,O=D*i.strideWidth-l,K=0;K<o;K++){var Y=O+K*u;if(!(Y<0||Y>=i.inWidth))for(var ee=$+Y*g,ne=B+K*r.strides[1],ie=0;ie<i.inChannels;++ie){for(var se=b[ee+ie*m],ye=0;ye<i.outChannels;++ye)w[P+ye*E]+=se*S[ne+ye];ne+=i.outChannels}}}return f.toTensor()},e.prototype.conv3d=function(t,r,i){for(var s=i.filterDepth,o=i.filterHeight,a=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,d=i.padInfo.front,f=i.padInfo.left,h=i.padInfo.top,p=we(i.outShape,t.dtype),g=this.readSync(t.dataId),m=this.readSync(r.dataId),v=p.values,y=0;y<i.batchSize;++y)for(var x=y*t.strides[0],E=y*p.strides[0],b=0;b<i.outDepth;++b)for(var S=E+b*p.strides[1],w=b*i.strideDepth-d,T=0;T<s;T++){var R=w+T*u;if(!(R<0||R>=i.inDepth))for(var _=T*r.strides[0],A=x+R*t.strides[1],k=0;k<i.outHeight;++k)for(var G=S+k*p.strides[2],U=k*i.strideHeight-h,M=0;M<o;M++){var B=U+M*l;if(!(B<0||B>=i.inHeight))for(var $=_+M*r.strides[1],D=A+B*t.strides[2],P=0;P<i.outWidth;++P)for(var O=G+P*i.outChannels,K=P*i.strideWidth-f,Y=0;Y<a;Y++){var ee=K+Y*c;if(!(ee<0||ee>=i.inWidth))for(var ne=$+Y*r.strides[2],ie=D+ee*i.inChannels,se=ne,ye=0;ye<i.inChannels;++ye){for(var Ee=g[ie+ye],_e=0;_e<i.outChannels;++_e)v[O+_e]+=Ee*m[se+_e];se+=i.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Z([t,r],"conv2dDerInput");for(var s=we(i.inShape,"float32"),o=s.values,a=this.readSync(t.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],d=l[1],f=l[2],h=i.batchSize,p=i.filterHeight,g=i.filterWidth,m=i.inChannels,v=i.inHeight,y=i.inWidth,x=i.outChannels,E=i.outHeight,b=i.outWidth,S=i.strideHeight,w=i.strideWidth,T=i.dataFormat,R=p-1-i.padInfo.top,_=g-1-i.padInfo.left,A=T==="channelsLast",k=s.strides[0],G=A?s.strides[1]:s.strides[2],U=A?s.strides[2]:1,M=A?1:s.strides[1],B=t.strides[0],$=A?t.strides[1]:t.strides[2],D=A?t.strides[2]:1,P=A?1:t.strides[1],O=0;O<h;++O)for(var K=0;K<m;++K)for(var Y=0;Y<v;++Y)for(var ee=Y-R,ne=Math.max(0,Math.ceil(ee/S)),ie=Math.min(E,(p+ee)/S),se=0;se<y;++se){for(var ye=se-_,Ee=Math.max(0,Math.ceil(ye/w)),_e=Math.min(b,(g+ye)/w),nt=0,Le=ne;Le<ie;++Le)for(var $e=Le*S-ee,Ne=Ee;Ne<_e;++Ne)for(var Ye=B*O+$*Le+D*Ne,rt=c*(p-1-$e)+d*(g-1-(Ne*w-ye))+f*K,ve=0;ve<x;++ve)nt+=a[Ye+P*ve]*u[rt+ve];o[k*O+G*Y+U*se+M*K]=nt}return s.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var s=we(i.inShape,"float32"),o=s.values,a=s.strides,u=a[0],l=a[1],c=a[2],d=a[3],f=this.readSync(t.dataId),h=t.strides,p=h[0],g=h[1],m=h[2],v=h[3],y=this.readSync(r.dataId),x=r.strides,E=x[0],b=x[1],S=x[2],w=x[3],T=i.batchSize,R=i.filterDepth,_=i.filterHeight,A=i.filterWidth,k=i.inChannels,G=i.inDepth,U=i.inHeight,M=i.inWidth,B=i.outChannels,$=i.outDepth,D=i.outHeight,P=i.outWidth,O=i.strideDepth,K=i.strideHeight,Y=i.strideWidth,ee=R-1-i.padInfo.front,ne=_-1-i.padInfo.top,ie=A-1-i.padInfo.left,se=0;se<T;++se)for(var ye=0;ye<k;++ye)for(var Ee=0;Ee<G;++Ee)for(var _e=Ee-ee,nt=Math.max(0,Math.ceil(_e/O)),Le=Math.min($,(R+_e)/O),$e=0;$e<U;++$e)for(var Ne=$e-ne,Ye=Math.max(0,Math.ceil(Ne/K)),rt=Math.min(D,(_+Ne)/K),ve=0;ve<M;++ve){for(var qe=ve-ie,ot=Math.max(0,Math.ceil(qe/Y)),vt=Math.min(P,(A+qe)/Y),Dt=0,jt=nt;jt<Le;++jt)for(var Kt=jt*O-_e,Gn=Ye;Gn<rt;++Gn)for(var rr=Gn*K-Ne,Wn=ot;Wn<vt;++Wn)for(var qr=p*se+g*jt+m*Gn+v*Wn,Yr=E*(R-1-Kt)+b*(_-1-rr)+S*(A-1-(Wn*Y-qe))+w*ye,Vn=0;Vn<B;++Vn)Dt+=f[qr+Vn]*y[Yr+Vn];o[u*se+l*Ee+c*$e+d*ve+ye]=Dt}return s.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Z([t,r],"conv2dDerFilter");for(var s=i.strideHeight,o=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=we(i.filterShape,"float32"),d=i.padInfo.left,f=i.padInfo.top,h=this.bufferSync(t),p=this.bufferSync(r),g=0;g<a;++g)for(var m=Math.max(0,Math.ceil((f-g)/s)),v=Math.min(i.outHeight,(i.inHeight+f-g)/s),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((d-y)/o)),E=Math.min(i.outWidth,(i.inWidth+d-y)/o),b=0;b<i.inChannels;++b)for(var S=0;S<i.outChannels;++S){for(var w=0,T=0;T<i.batchSize;++T)for(var R=m;R<v;++R)for(var _=g+R*s-f,A=x;A<E;++A){var k=y+A*o-d;w+=l?h.get(T,_,k,b)*p.get(T,R,A,S):h.get(T,b,_,k)*p.get(T,S,R,A)}c.set(w,g,y,b,S)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var s=i.strideDepth,o=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,d=we(i.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],g=h[1],m=h[2],v=h[3],y=this.readSync(r.dataId),x=r.strides,E=x[0],b=x[1],S=x[2],w=x[3],T=this.readSync(t.dataId),R=t.strides,_=R[0],A=R[1],k=R[2],G=R[3],U=i.padInfo.front,M=i.padInfo.left,B=i.padInfo.top,$=0;$<u;++$)for(var D=Math.max(0,Math.ceil((U-$)/s)),P=Math.min(i.outDepth,(i.inDepth+U-$)/s),O=$*p,K=0;K<l;++K)for(var Y=Math.max(0,Math.ceil((B-K)/o)),ee=Math.min(i.outHeight,(i.inHeight+B-K)/o),ne=K*g+O,ie=0;ie<c;++ie)for(var se=Math.max(0,Math.ceil((M-ie)/a)),ye=Math.min(i.outWidth,(i.inWidth+M-ie)/a),Ee=ie*m+ne,_e=0;_e<i.inChannels;++_e)for(var nt=_e*v+Ee,Le=0;Le<i.outChannels;++Le){for(var $e=0,Ne=0;Ne<i.batchSize;++Ne)for(var Ye=Ne*_,rt=Ne*E,ve=D;ve<P;++ve)for(var qe=($+ve*s-U)*A+Ye,ot=ve*b+rt,vt=Y;vt<ee;++vt)for(var Dt=(K+vt*o-B)*k+qe,jt=vt*S+ot,Kt=se;Kt<ye;++Kt){var Gn=Kt*w+jt;$e+=T[(ie+Kt*a-M)*G+Dt+_e]*y[Gn+Le]}f[nt+Le]=$e}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,s=t.convInfo,o=t.bias,a=t.activation,u=t.preluActivationWeights,l=this.depthwiseConv2D(r,i,s);return o&&(l=this.add(l,o)),a&&(l=Mh(this,l,a,u)),l},e.prototype.depthwiseConv2D=function(t,r,i){Z([t,r],"depthwiseConv2D");for(var s=i.filterHeight,o=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,d=i.outChannels/i.inChannels,f=we(i.outShape,t.dtype),h=this.readSync(t.dataId),p=this.readSync(r.dataId),g=f.values,m=0;m<i.batchSize;++m)for(var v=m*t.strides[0],y=m*f.strides[0],x=0;x<i.outHeight;++x)for(var E=y+x*f.strides[1],b=x*i.strideHeight-l,S=0;S<s;++S){var w=b+S*a;if(!(w<0||w>=i.inHeight))for(var T=S*r.strides[0],R=v+w*t.strides[1],_=0;_<i.outWidth;++_)for(var A=E+_*f.strides[2],k=_*i.strideWidth-c,G=0;G<o;++G){var U=k+G*u;if(!(U<0||U>=i.inWidth))for(var M=T+G*r.strides[1],B=R+U*i.inChannels,$=A,D=M,P=0;P<i.inChannels;++P){for(var O=h[B+P],K=0;K<d;++K)g[$+K]+=O*p[D+K];$+=d,D+=d}}}return f.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Z([t,r],"depthwiseConv2DDerInput");for(var s=we(i.inShape,"float32"),o=s.values,a=s.strides,u=a[0],l=a[1],c=a[2],d=this.readSync(t.dataId),f=t.strides,h=f[0],p=f[1],g=f[2],m=this.readSync(r.dataId),v=r.strides,y=v[0],x=v[1],E=v[2],b=i.batchSize,S=i.filterHeight,w=i.filterWidth,T=i.inChannels,R=i.inHeight,_=i.inWidth,A=i.outChannels,k=i.outHeight,G=i.outWidth,U=i.strideHeight,M=i.strideWidth,B=S-1-i.padInfo.top,$=w-1-i.padInfo.left,D=A/T,P=0;P<b;++P)for(var O=0;O<T;++O)for(var K=0;K<R;++K)for(var Y=K-B,ee=Math.max(0,Math.ceil(Y/U)),ne=Math.min(k,(S+Y)/U),ie=0;ie<_;++ie){for(var se=ie-$,ye=Math.max(0,Math.ceil(se/M)),Ee=Math.min(G,(w+se)/M),_e=0,nt=ee;nt<ne;++nt)for(var Le=nt*U-Y,$e=ye;$e<Ee;++$e)for(var Ne=h*P+p*nt+g*$e,Ye=y*(S-1-Le)+x*(w-1-($e*M-se))+E*O,rt=0;rt<D;++rt)_e+=d[Ne+(O*D+rt)]*m[Ye+rt];o[u*P+l*K+c*ie+O]=_e}return s.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Z([t,r],"depthwiseConv2DDerFilter");for(var s=i.strideHeight,o=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=we(i.filterShape,"float32"),c=i.padInfo.left,d=i.padInfo.top,f=i.outChannels/i.inChannels,h=this.bufferSync(t),p=this.bufferSync(r),g=0;g<a;++g)for(var m=Math.max(0,Math.ceil((d-g)/s)),v=Math.min(i.outHeight,(i.inHeight+d-g)/s),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((c-y)/o)),E=Math.min(i.outWidth,(i.inWidth+c-y)/o),b=0;b<i.outChannels;++b){for(var S=Math.trunc(b/f),w=b%f,T=0,R=0;R<i.batchSize;++R)for(var _=m;_<v;++_)for(var A=g+_*s-d,k=x;k<E;++k){var G=y+k*o-c;T+=h.get(R,A,G,S)*p.get(R,_,k,b)}l.set(T,g,y,S,w)}return l.toTensor()},e.prototype.tile=function(t,r){return Z(t,"tile"),d_(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Z(t,"pad");var s=r.map(function(f,h){return f[0]+t.shape[h]+f[1]}),o=r.map(function(f){return f[0]}),a=this.bufferSync(t),u=we(s,t.dtype);i!==0&&u.values.fill(i);for(var l=0;l<t.size;l++){var c=a.indexToLoc(l),d=c.map(function(f,h){return f+o[h]});u.set.apply(u,[a.get.apply(a,c)].concat(d))}return u.toTensor()},e.prototype.transpose=function(t,r){Z(t,"transpose");for(var i=new Array(t.rank),s=0;s<i.length;s++)i[s]=t.shape[r[s]];var o=this.readSync(t.dataId),a=we(i,t.dtype),u=this.bufferSync(t);for(s=0;s<t.size;++s){for(var l=u.indexToLoc(s),c=new Array(l.length),d=0;d<c.length;d++)c[d]=l[r[d]];var f=a.locToIndex(c);a.values[f]=o[s]}return a.toTensor()},e.prototype.gather=function(t,r,i){Z([t,r],"gather");var s=t.shape.slice(),o=this.readSync(r.dataId);s[i]=o.length;for(var a=we(s,t.dtype),u=this.bufferSync(t),l=0;l<a.size;++l){var c=a.indexToLoc(l),d=c.slice();d[i]=o[c[i]];var f=u.locToIndex(d);a.values[l]=u.values[f]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Z([t],"batchToSpaceND");var s=r.reduce(function(d,f){return d*f}),o=ud(t.shape,r,s),a=ld(o.length,r.length),u=cd(t.shape,r,s),l=JT(i,r.length),c=ZT(u,i,r.length);return t.reshape(o).transpose(a).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){Z([t],"spaceToBatchND");var s=r.reduce(function(f,h){return f*h}),o=[[0,0]];o.push.apply(o,i);for(var a=1+r.length;a<t.shape.length;++a)o.push([0,0]);var u=t.pad(o),l=ud(u.shape,r,s,!1),c=ld(l.length,r.length,!1),d=cd(u.shape,r,s,!1);return u.reshape(l).transpose(c).reshape(d)},e.prototype.pool=function(t,r,i){Z(t,"pool");for(var s=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),g=we(r.outShape,t.dtype),m=g.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],x=r.outShape[3],E=0;E<r.batchSize;++E)for(var b=E*v,S=E*t.strides[0],w=0;w<r.inChannels;++w)for(var T=0;T<r.outHeight;++T)for(var R=T*s-d,_=Math.max(0,R),A=Math.min(r.inHeight,l+R),k=b+T*y,G=0;G<r.outWidth;++G){for(var U=G*o-f,M=Math.max(0,U),B=Math.min(r.inWidth,c+U),$=h,D=0,P=0,O=_;O<A;O+=a){for(var K=S+O*t.strides[1],Y=M;Y<B;Y+=u){var ee=p[K+Y*t.strides[2]+w];i==="max"&&ee>$?$=ee:i==="avg"&&(D+=ee,P++)}if(isNaN($))break}m[k+G*x+w]=i==="avg"?D/P:$}return g.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var i=we(r.outShape,"int32"),s=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(t),p=0;p<r.batchSize;++p)for(var g=0;g<r.inChannels;++g)for(var m=0;m<r.outHeight;++m){for(var v=m*s-d,y=v;y<0;)y+=a;for(var x=Math.min(r.inHeight,l+v),E=0;E<r.outWidth;++E){for(var b=E*o-f,S=b;S<0;)S+=u;for(var w=Math.min(r.inWidth,c+b),T=Number.NEGATIVE_INFINITY,R=-1,_=y;_<x;_+=a)for(var A=_-v,k=S;k<w;k+=u){var G=k-b,U=h.get(p,_,k,g);U>T&&(T=U,R=A*c+G)}i.set(R,p,m,E,g)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,s){Z([r,i],"maxPoolBackprop");for(var o=this.maxPoolPositions(r,s),a=s.strideHeight,u=s.strideWidth,l=s.dilationHeight,c=s.dilationWidth,d=s.effectiveFilterHeight,f=s.effectiveFilterWidth,h=f-1-s.padInfo.left,p=d-1-s.padInfo.top,g=we(r.shape,"float32"),m=this.bufferSync(o),v=this.bufferSync(t),y=0;y<s.batchSize;++y)for(var x=0;x<s.inChannels;++x)for(var E=0;E<s.inHeight;++E)for(var b=0;b<s.inWidth;++b){for(var S=E-p,w=b-h,T=0,R=0;R<d;R+=l){var _=(S+R)/a;if(!(_<0||_>=s.outHeight||Math.floor(_)!==_))for(var A=0;A<f;A+=c){var k=(w+A)/u;if(!(k<0||k>=s.outWidth||Math.floor(k)!==k)){var G=d*f-1-m.get(y,_,k,x)===R*f+A?1:0;G!==0&&(T+=v.get(y,_,k,x)*G)}}}g.set(T,y,E,b,x)}return g.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Z([t,r],"avgPoolBackprop");for(var s=i.strideHeight,o=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,g=we(r.shape,"float32"),m=1/(a*u),v=this.bufferSync(t),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var E=0;E<i.inHeight;++E)for(var b=0;b<i.inWidth;++b){for(var S=E-p,w=b-h,T=0,R=0;R<d;R+=l){var _=(S+R)/s;if(!(_<0||_>=i.outHeight||Math.floor(_)!==_))for(var A=0;A<f;A+=c){var k=(w+A)/o;k<0||k>=i.outWidth||Math.floor(k)!==k||(T+=v.get(y,_,k,x))}}g.set(T*m,y,E,b,x)}return g.toTensor()},e.prototype.pool3d=function(t,r,i){Z(t,"pool3d");for(var s=r.strideDepth,o=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(t.dataId),x=we(r.outShape,t.dtype),E=x.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[2]*r.outShape[3]*r.outShape[4],w=r.outShape[3]*r.outShape[4],T=r.outShape[4],R=0;R<r.batchSize;++R)for(var _=R*b,A=R*t.strides[0],k=0;k<r.inChannels;++k)for(var G=0;G<r.outDepth;++G){for(var U=G*s-p,M=U;M<0;)M+=u;for(var B=Math.min(r.inDepth,d+U),$=_+G*S,D=0;D<r.outHeight;++D){for(var P=D*o-g,O=P;O<0;)O+=l;for(var K=Math.min(r.inHeight,f+P),Y=$+D*w,ee=0;ee<r.outWidth;++ee){for(var ne=ee*a-m,ie=ne;ie<0;)ie+=c;for(var se=Math.min(r.inWidth,h+ne),ye=Y+ee*T,Ee=v,_e=0,nt=0,Le=M;Le<B;Le+=u){for(var $e=A+Le*t.strides[1],Ne=O;Ne<K;Ne+=l){for(var Ye=$e+Ne*t.strides[2],rt=ie;rt<se;rt+=c){var ve=y[Ye+rt*t.strides[3]+k];if(i==="max"&&ve>Ee?Ee=ve:i==="avg"&&(_e+=ve,nt++),isNaN(Ee))break}if(isNaN(Ee))break}if(isNaN(Ee))break}E[ye+k]=i==="avg"?_e/nt:Ee}}}return x.toTensor()},e.prototype.avgPool3d=function(t,r){return Z(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Z([t,r],"avgPool3dBackprop");for(var s=i.strideDepth,o=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,d=i.dilationDepth,f=i.dilationHeight,h=i.dilationWidth,p=i.effectiveFilterDepth,g=i.effectiveFilterHeight,m=i.effectiveFilterWidth,v=p-1-i.padInfo.front,y=m-1-i.padInfo.left,x=g-1-i.padInfo.top,E=we(r.shape,"float32"),b=1/(u*l*c),S=this.bufferSync(t),w=0;w<i.batchSize;++w)for(var T=0;T<i.inChannels;++T)for(var R=0;R<i.inDepth;++R)for(var _=0;_<i.inHeight;++_)for(var A=0;A<i.inWidth;++A){for(var k=R-v,G=_-x,U=A-y,M=0,B=0;B<p;B+=d){var $=(k+B)/s;if(!($<0||$>=i.outDepth||Math.floor($)!==$))for(var D=0;D<g;D+=f){var P=(G+D)/o;if(!(P<0||P>=i.outHeight||Math.floor(P)!==P))for(var O=0;O<m;O+=h){var K=(U+O)/a;K<0||K>=i.outWidth||Math.floor(K)!==K||(M+=S.get(w,$,P,K,T))}}}E.set(M*b,w,R,_,A,T)}return E.toTensor()},e.prototype.maxPool3d=function(t,r){return Z(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=we(r.outShape,"int32"),s=r.strideDepth,o=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,g=r.padInfo.top,m=r.padInfo.left,v=this.bufferSync(t),y=0;y<r.batchSize;++y)for(var x=0;x<r.inChannels;++x)for(var E=0;E<r.outDepth;++E){for(var b=E*s-p,S=b;S<0;)S+=u;for(var w=Math.min(r.inDepth,d+b),T=0;T<r.outHeight;++T){for(var R=T*o-g,_=R;_<0;)_+=l;for(var A=Math.min(r.inHeight,f+R),k=0;k<r.outWidth;++k){for(var G=k*a-m,U=G;U<0;)U+=c;for(var M=Math.min(r.inWidth,h+G),B=Number.NEGATIVE_INFINITY,$=-1,D=S;D<w;D+=u)for(var P=D-b,O=_;O<A;O+=l)for(var K=O-R,Y=U;Y<M;Y+=c){var ee=Y-G,ne=v.get(y,D,O,Y,x);ne>=B&&(B=ne,$=P*f*h+K*f+ee)}i.set($,y,E,T,k,x)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,s){Z([r,i],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(r,s),a=s.strideDepth,u=s.strideHeight,l=s.strideWidth,c=s.dilationDepth,d=s.dilationHeight,f=s.dilationWidth,h=s.effectiveFilterDepth,p=s.effectiveFilterHeight,g=s.effectiveFilterWidth,m=h-1-s.padInfo.front,v=g-1-s.padInfo.left,y=p-1-s.padInfo.top,x=we(r.shape,"float32"),E=this.bufferSync(o),b=this.bufferSync(t),S=0;S<s.batchSize;++S)for(var w=0;w<s.inChannels;++w)for(var T=0;T<s.inDepth;++T)for(var R=0;R<s.inHeight;++R)for(var _=0;_<s.inWidth;++_){for(var A=T-m,k=R-y,G=_-v,U=0,M=0;M<h;M+=c){var B=(A+M)/a;if(!(B<0||B>=s.outDepth||Math.floor(B)!==B))for(var $=0;$<p;$+=d){var D=(k+$)/u;if(!(D<0||D>=s.outHeight||Math.floor(D)!==D))for(var P=0;P<g;P+=f){var O=(G+P)/l;if(!(O<0||O>=s.outWidth||Math.floor(O)!==O)){var K=h*p*g-1-E.get(S,B,D,O,w)===M*p*g+$*g+P?1:0;K!==0&&(U+=b.get(S,B,D,O,w)*K)}}}}x.set(U,S,T,R,_,w)}return x.toTensor()},e.prototype.cast=function(t,r){return a_(t,r,this)},e.prototype.reshape=function(t,r){return Ag(t,r)},e.prototype.avgPool=function(t,r){return Z(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,i,s){Z(t,"resizeBilinear");for(var o=t.shape,a=o[0],u=o[1],l=o[2],c=o[3],d=this.readSync(t.dataId),f=new Float32Array(fe([a,r,i,c])),h=[s&&r>1?u-1:u,s&&i>1?l-1:l],p=[s&&r>1?r-1:r,s&&i>1?i-1:i],g=0,m=h[0]/p[0],v=h[1]/p[1],y=0;y<a;y++)for(var x=0;x<r;x++)for(var E=m*x,b=Math.floor(E),S=E-b,w=Math.min(u-1,Math.ceil(E)),T=y*t.strides[0]+b*t.strides[1],R=y*t.strides[0]+w*t.strides[1],_=0;_<i;_++)for(var A=v*_,k=Math.floor(A),G=A-k,U=Math.min(l-1,Math.ceil(A)),M=T+k*t.strides[2],B=R+k*t.strides[2],$=T+U*t.strides[2],D=R+U*t.strides[2],P=0;P<c;P++){var O=d[M+P],K=d[B+P],Y=O+(d[$+P]-O)*G,ee=Y+(K+(d[D+P]-K)*G-Y)*S;f[g++]=ee}return Wt(f,[a,r,i,c])},e.prototype.resizeBilinearBackprop=function(t,r,i){Z([t,r],"resizeBilinearBackprop");for(var s=r.shape,o=s[0],a=s[1],u=s[2],l=s[3],c=t.shape,d=c[1],f=c[2],h=new Float32Array(o*a*u*l),p=[i&&d>1?a-1:a,i&&f>1?u-1:u],g=[i&&d>1?d-1:d,i&&f>1?f-1:f],m=p[0]/g[0],v=p[1]/g[1],y=this.readSync(t.dataId),x=0,E=0;E<o;E++)for(var b=E*r.strides[0],S=0;S<d;S++)for(var w=S*m,T=Math.floor(w),R=Math.min(Math.ceil(w),a-1),_=b+T*r.strides[1],A=b+R*r.strides[1],k=w-T,G=1-k,U=0;U<f;U++)for(var M=U*v,B=Math.floor(M),$=Math.min(Math.ceil(M),u-1),D=M-B,P=1-D,O=_+B*r.strides[2],K=_+$*r.strides[2],Y=A+B*r.strides[2],ee=A+$*r.strides[2],ne=G*P,ie=G*D,se=k*P,ye=k*D,Ee=0;Ee<l;Ee++){var _e=y[x++];h[O+Ee]+=_e*ne,h[K+Ee]+=_e*ie,h[Y+Ee]+=_e*se,h[ee+Ee]+=_e*ye}return gn(h,[o,u,a,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,s){Z(t,"resizeNearestNeighbor");for(var o=t.shape,a=o[0],u=o[1],l=o[2],c=o[3],d=this.readSync(t.dataId),f=new Float32Array(a*r*i*c),h=[s&&r>1?u-1:u,s&&i>1?l-1:l],p=[s&&r>1?r-1:r,s&&i>1?i-1:i],g=h[0]/p[0],m=h[1]/p[1],v=0,y=0;y<a;y++)for(var x=y*t.strides[0],E=0;E<r;E++)for(var b=g*E,S=x+Math.min(u-1,s?Math.round(b):Math.floor(b))*t.strides[1],w=0;w<i;w++)for(var T=m*w,R=S+Math.min(l-1,s?Math.round(T):Math.floor(T))*t.strides[2],_=0;_<c;_++){var A=d[R+_];f[v++]=A}return Wt(f,[a,r,i,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Z([t,r],"resizeNearestNeighborBackprop");for(var s=r.shape,o=s[0],a=s[1],u=s[2],l=s[3],c=t.shape,d=c[1],f=c[2],h=new Float32Array(o*a*u*l),p=this.readSync(t.dataId),g=[i&&d>1?a-1:a,i&&f>1?u-1:u],m=[i&&d>1?d-1:d,i&&f>1?f-1:f],v=g[0]/m[0],y=g[1]/m[1],x=1/v,E=1/y,b=2*Math.ceil(x)+2,S=2*Math.ceil(E)+2,w=0;w<o;w++)for(var T=w*r.strides[0],R=0;R<a;R++)for(var _=T+R*r.strides[1],A=Math.floor(R*x),k=Math.floor(A-b/2),G=0;G<u;G++)for(var U=_+G*r.strides[2],M=Math.floor(G*E),B=Math.floor(M-S/2),$=0;$<l;$++){for(var D=0,P=0;P<b;P++){var O=P+k;if(!(O<0||O>=d)){var K=T+O*t.strides[1],Y=O*v;if(R===Math.min(a-1,i?Math.round(Y):Math.floor(Y)))for(var ee=0;ee<S;ee++){var ne=ee+B;if(!(ne<0||ne>=f)){var ie=K+ne*t.strides[2],se=ne*y;G===Math.min(u-1,i?Math.round(se):Math.floor(se))&&(D+=p[ie+$])}}}}h[U+$]=D}return gn(h,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,s,o,a){Z([t,r,i,o,a],"batchNorm");for(var u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),d=o?this.readSync(o.dataId):new Float32Array([1]),f=a?this.readSync(a.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,g=d.length,m=c.length,v=l.length,y=0,x=0,E=0,b=0,S=0;S<u.length;++S)h[S]=f[y++]+(u[S]-l[x++])*d[E++]/Math.sqrt(c[b++]+s),y>=p&&(y=0),x>=v&&(x=0),E>=g&&(E=0),b>=m&&(b=0);return gn(h,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,s,o){Z(t,"localResponseNormalization4D");var a=t.shape[3],u=a-1,l=this.readSync(t.dataId),c=t.size,d=new Float32Array(c);function f(m){for(var v=m%a,y=m-v+Math.max(0,v-r),x=m-v+Math.min(v+r,u),E=0;y<=x;y++){var b=l[y];E+=b*b}return E}for(var h=0;h<c;h++){var p=f(h),g=l[h]*Math.pow(i+s*p,-o);d[h]=g}return gn(d,t.shape)},e.prototype.LRNGrad=function(t,r,i,s,o,a,u){Z(t,"LRNGrad");for(var l=t.shape[3],c=this.readSync(t.dataId),d=this.readSync(r.dataId),f=this.readSync(i.dataId),h=new Float32Array(t.size),p=t.size,g=0;g<p;g++){for(var m=g%l,v=g-m+Math.max(0,m-s),y=g-m+Math.min(l,m+s+1),x=0,E=v;E<y;E++)x+=Math.pow(d[E],2);for(x=a*x+o,E=v;E<y;E++){var b=-2*a*u*d[E]*f[g]/x;g===E&&(b+=Math.pow(x,-u)),b*=c[g],h[E]+=b}}return gn(h,t.shape)},e.prototype.multinomial=function(t,r,i,s){Z(t,"multinomial");for(var o=r?t:xi(t),a=o.shape[0],u=o.shape[1],l=et([a,i],"int32"),c=this.readSync(l.dataId),d=this.readSync(o.dataId),f=0;f<a;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var g=1;g<p.length;++g)p[g]=p[g-1]+d[h+g];for(var m=ef(s.toString()),v=f*i,y=0;y<i;++y){var x=m();c[v+y]=p.length;for(var E=0;E<p.length;E++)if(x<p[E]){c[v+y]=E;break}}}return l},e.prototype.oneHot=function(t,r,i,s){Z(t,"oneHot");var o=new Float32Array(t.size*r);o.fill(s);for(var a=this.readSync(t.dataId),u=0;u<t.size;++u)a[u]>=0&&a[u]<r&&(o[u*r+a[u]]=i);return Yi(o,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,s,o){return Z(t,"nonMaxSuppression"),mv(this.readSync(t.dataId),this.readSync(r.dataId),i,s,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],s=t.shape[1],o=we(t.shape,"float32"),a=we(t.shape,"float32"),u=Yn(t).as2D(i,s),l=Dr(t).as2D(i,s),c=0;c<i;c++)for(var d=u.slice([c,0],[1,s]),f=l.slice([c,0],[1,s]),h=$t(d,f),p=this.readSync(this.fftImpl(h,r).dataId),g=0;g<s;g++){var m=d1(p,g);o.values[c*s+g]=m.real,a.values[c*s+g]=m.imag}return $t(o.toTensor(),a.toTensor()).as2D(i,s)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),s=i.size;if(this.isExponentOf2(s)){var o=this.fftRadix2(i,s,r).as2D(t.shape[0],t.shape[1]);return r&&(o=$t(Yn(o).div(re(s)),Dr(o).div(re(s)))),o}var a=this.readSync(t.dataId),u=function(l){for(var c=new Float32Array(l.length/2),d=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],d[f/2]=l[f+1];return{real:c,imag:d}}(this.fourierTransformByMatmul(a,s,r));return $t(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var s=this.readSync(t.dataId),o=r/2,a=function(v){for(var y=Math.ceil(v.length/4),x=new Float32Array(y),E=new Float32Array(y),b=0;b<v.length;b+=4)x[Math.floor(b/4)]=v[b],E[Math.floor(b/4)]=v[b+1];return{real:x,imag:E}}(s),u=$t(a.real,a.imag).as1D(),l=function(v){for(var y=Math.floor(v.length/4),x=new Float32Array(y),E=new Float32Array(y),b=2;b<v.length;b+=4)x[Math.floor(b/4)]=v[b],E[Math.floor(b/4)]=v[b+1];return{real:x,imag:E}}(s),c=$t(l.real,l.imag).as1D();u=this.fftRadix2(u,o,i),c=this.fftRadix2(c,o,i);var d=function(v,y){for(var x=new Float32Array(v/2),E=new Float32Array(v/2),b=0;b<Math.ceil(v/2);b++){var S=(y?2:-2)*Math.PI*(b/v);x[b]=Math.cos(S),E[b]=Math.sin(S)}return{real:x,imag:E}}(r,i),f=$t(d.real,d.imag).mul(c),h=u.add(f),p=u.sub(f),g=Yn(h).concat(Yn(p)),m=Dr(h).concat(Dr(p));return $t(g,m).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var s=new Float32Array(2*r),o=0;o<r;o++){for(var a=0,u=0,l=0;l<r;l++){var c=yB(o*l,r,i),d=d1(t,l);a+=d.real*c.real-d.imag*c.imag,u+=d.real*c.imag+d.imag*c.real}i&&(a/=r,u/=r),vB(s,a,u,o)}return s},e.prototype.depthToSpace=function(t,r,i){L(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),L(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var s=t.shape[0],o=t.shape[1],a=t.shape[2],u=t.shape[3],l=o*r,c=a*r,d=u/(r*r),f=this.readSync(t.dataId),h=new Float32Array(s*l*c*d),p=0,g=0;g<s;++g)for(var m=0;m<l;++m)for(var v=Math.floor(m/r),y=m%r,x=0;x<c;++x)for(var E=Math.floor(x/r),b=(y*r+x%r)*d,S=0;S<d;++S){var w=S+b+u*(E+a*(v+o*g));h[p++]=f[w]}return gn(h,[s,l,c,d])},e.prototype.broadcastedBinaryOp=function(t,r,i,s){var o=Pe(t.shape,r.shape),a=we(o,i),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=Bi(t.shape,o),d=Bi(r.shape,o),f=a.values;if(c.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=s(u[h%u.length],l[h%l.length]);else{var p=this.bufferSync(t),g=this.bufferSync(r),m=function(v){var y=a.indexToLoc(v),x=y.slice(-t.rank);c.forEach(function(w){return x[w]=0});var E=p.locToIndex(x),b=y.slice(-r.rank);d.forEach(function(w){return b[w]=0});var S=g.locToIndex(b);f[v]=s(u[E],l[S])};for(h=0;h<f.length;++h)m(h)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var s=Pe(t.shape,r.shape),o=we(s,"float32"),a=we(s,"float32"),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=Bi(t.shape,s),d=Bi(r.shape,s),f=o.values,h=a.values;if(c.length+d.length===0)for(var p=0;p<f.length;p++){var g=p%u.length,m=p%l.length,v=i(u[2*g],u[2*g+1],l[2*m],l[2*m+1]);f[p]=v.real,h[p]=v.imag}else{var y=this.bufferSync(this.data.get(t.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),E=function(b){var S=o.indexToLoc(b),w=S.slice(-t.rank);c.forEach(function(k){return w[k]=0});var T=y.locToIndex(w),R=S.slice(-r.rank);d.forEach(function(k){return R[k]=0});var _=x.locToIndex(R),A=i(u[2*T],u[2*T+1],l[2*_],l[2*_+1]);f[b]=A.real,h[b]=A.imag};for(p=0;p<f.length;p++)E(p)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(t,r,i){return c_(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,s,o,a){for(var u=t.shape,l=u[0],c=u[1],d=u[2],f=u[3],h=r.shape[0],p=s[0],g=s[1],m=we([h,p,g,f],"float32"),v=this.readSync(r.dataId),y=this.readSync(i.dataId),x=this.readSync(t.dataId),E=t.strides,b=m.strides,S=0;S<h;S++){var w=4*S,T=v[w],R=v[w+1],_=v[w+2],A=v[w+3],k=y[S];if(!(k>=l))for(var G=p>1?(_-T)*(c-1)/(p-1):0,U=g>1?(A-R)*(d-1)/(g-1):0,M=0;M<p;M++){var B=p>1?T*(c-1)+M*G:.5*(T+_)*(c-1);if(B<0||B>c-1)for(var $=0;$<g;$++)for(var D=0;D<f;D++){var P=D+$*b[2]+M*b[1]+S*b[0];m.values[P]=a}else if(o==="bilinear"){var O=Math.floor(B),K=Math.ceil(B),Y=B-O;for($=0;$<g;$++)if((Le=g>1?R*(d-1)+$*U:.5*(R+A)*(d-1))<0||Le>d-1)for(D=0;D<f;D++)P=D+$*b[2]+M*b[1]+S*b[0],m.values[P]=a;else{var ee=Math.floor(Le),ne=Math.ceil(Le),ie=Le-ee;for(D=0;D<f;D++){var se=x[P=D+ee*E[2]+O*E[1]+k*E[0]],ye=x[P=D+ne*E[2]+O*E[1]+k*E[0]],Ee=x[P=D+ee*E[2]+K*E[1]+k*E[0]],_e=se+(ye-se)*ie,nt=Ee+(x[P=D+ne*E[2]+K*E[1]+k*E[0]]-Ee)*ie;P=D+$*b[2]+M*b[1]+S*b[0],m.values[P]=_e+(nt-_e)*Y}}}else for($=0;$<g;++$){var Le;if((Le=g>1?R*(d-1)+$*U:.5*(R+A)*(d-1))<0||Le>d-1)for(D=0;D<f;D++)P=D+$*b[2]+M*b[1]+S*b[0],m.values[P]=a;else{var $e=Math.round(Le),Ne=Math.round(B);for(D=0;D<f;D++){var Ye=D+$e*E[2]+Ne*E[1]+k*E[0],rt=D+$*b[2]+M*b[1]+S*b[0];m.values[rt]=x[Ye]}}}}}return m.toTensor()},e.prototype.sparseToDense=function(t,r,i,s){var o=dd(0,t,i),a=o.sliceRank,u=o.numUpdates,l=o.sliceSize,c=o.strides,d=o.outputSize;return this.scatter(t,r,i,d,l,u,a,c,s,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,s=i[i.length-1],o=e_(t,r),a=o[0],u=o[1],l=o[2],c=o[3];if(u===0)return Wt([],a,t.dtype);for(var d=new Iu([u,l],t.dtype),f=this.readSync(r.dataId),h=this.readSync(t.dataId),p=0;p<u;p++){for(var g=[],m=0,v=0;v<s;v++){var y=f[p*s+v];m+=y*c[v],g.push(y)}if(m<0||m>=t.size/l)throw new Error("Invalid indices: "+g+" does not index into "+t.shape);for(var x=0;x<l;x++)d.values[p*l+x]=h[m*l+x]}return d.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,i){var s=dd(0,t,i),o=s.sliceRank,a=s.numUpdates,u=s.sliceSize,l=s.strides,c=s.outputSize,d=re(0);return this.scatter(t,r,i,c,u,a,o,l,d,!0)},e.prototype.fill=function(t,r,i){var s=td(i=i||Gu(r),fe(t));return s.fill(r),F.makeTensor(s,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=td(t.dtype,fe(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return u_(t,r,i)},e.prototype.scatter=function(t,r,i,s,o,a,u,l,c,d){var f=[s/o,o],h=this.readSync(t.dataId),p=this.readSync(r.dataId);if(s===0)return Wt([],i,r.dtype);var g=new Iu(f,r.dtype);g.values.fill(this.readSync(c.dataId)[0]);for(var m=0;m<a;m++){for(var v=[],y=0,x=0;x<u;x++){var E=h[m*u+x];v.push(E),y+=E*l[x]}if(y<0||y>=s/o)throw new Error("Invalid indices: "+v+" does not index into "+i);for(var b=0;b<o;b++)d?g.values[y*o+b]+=p[m*o+b]:g.values[y*o+b]=r.rank===0?p[0]:p[m*o+b]}return g.toTensor().reshape(i)},e}(s_);F.registerBackend("cpu",function(){return new B$},1);for(var Bh=0,P1=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,s=i.boxes,o=i.scores,a=r,u=a.maxOutputSize,l=a.iouThreshold,c=a.scoreThreshold,d=a.softNmsSigma,f=t;Z(s,"NonMaxSuppressionWithScore");var h=vv(f.data.get(s.dataId).values,f.data.get(o.dataId).values,u,l,c,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;Z(r,"square");for(var s=i.data.get(r.dataId).values,o=new Float32Array(s.length),a=0;a<s.length;++a){var u=s[a];o[a]=u*u}return{dataId:i.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Au,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,s=r.b,o=t;Z([i,s],Au);var a=o.data.get(i.dataId).values,u=o.data.get(s.dataId).values,l=function(f,h,p,g,m,v){var y=Pe(f,h),x=y.length,E=$r(y),b=_u(m,fe(y)),S=f.length,w=h.length,T=$r(f),R=$r(h),_=Bi(f,y),A=Bi(h,y);if(_.length+A.length===0)for(var k=0;k<b.length;++k)b[k]=v(p[k%p.length],g[k%g.length]);else{var G=function(U){var M=qF(U,x,E),B=M.slice(-S);_.forEach(function(O){return B[O]=0});var $=n1(B,S,T),D=M.slice(-w);A.forEach(function(O){return D[O]=0});var P=n1(D,w,R);b[U]=v(p[$],g[P])};for(k=0;k<b.length;++k)G(k)}return[b,y]}(i.shape,s.shape,a,u,i.dtype,function(f,h){var p=f-h;return p*p}),c=l[0],d=l[1];return{dataId:o.write(c,d,i.dtype),shape:d,dtype:i.dtype}}}];Bh<P1.length;Bh++)PT(P1[Bh]);var no,U$=function(n){this.variableNames=["A"];var e=tn(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},$$=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=tn(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var Uh=0,O1=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,s=r.numChannels,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],d=[c,l],f=[c,l,s];(a||o)&&(no==null&&(no=document.createElement("canvas").getContext("2d")),no.canvas.width=l,no.canvas.height=c,no.drawImage(i,0,0,l,c),i=no.canvas);var h=t.makeTensorInfo(d,"int32");t.texData.get(h.dataId).usage=kn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(h.dataId),i);var p=Q().getBool("WEBGL_PACK")?new $$(f):new U$(f),g=t.runWebGLProgram(p,[h],"int32");return t.disposeData(h.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;sd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,s=i.boxes,o=i.scores,a=r,u=a.maxOutputSize,l=a.iouThreshold,c=a.scoreThreshold,d=a.softNmsSigma,f=t,h=vv(f.readSync(s.dataId),f.readSync(o.dataId),u,l,c,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,s=new Re(r.shape,"return x * x;");return i.runWebGLProgram(s,[r],r.dtype)}},{kernelName:Au,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,s=r.b,o=t,a=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr("return (a - b) * (a - b);",i.shape,s.shape):new gt("return (a - b) * (a - b);",i.shape,s.shape);return o.compileAndRun(a,[i,s])}}];Uh<O1.length;Uh++)PT(O1[Uh]);for(var $h=0,N1=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:Au,gradFunc:function(n,e){var t=e[0],r=e[1],i=re(2);return{a:function(){return rn(n,rn(i,kt(t,r)))},b:function(){return rn(n,rn(i,kt(r,t)))}}}}];$h<N1.length;$h++)MF(N1[$h]);var G$=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();Q().get("IS_BROWSER")&&Q().setPlatform("browser",new G$);var Gh,W$=function(){return require("node-fetch")},V$=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return Q().global.fetch!=null?Q().global.fetch(e,t):(Gh==null&&(Gh=W$()),Gh(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n}();Q().get("IS_NODE")&&Q().setPlatform("node",new V$);var Dg={float32:4,int32:4,uint16:2,uint8:1,bool:1},yd=4;function nI(n,e){for(var t={},r=0,i=function(a){var u=a.name,l=a.dtype,c=a.shape,d=fe(c),f=void 0;if("quantization"in a){var h=a.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Dg[h.dtype],g=n.slice(r,r+d*p),m=h.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(l==="float32")f=Float32Array.from(m,function(S){return S*h.scale+h.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(m,function(S){return Math.round(S*h.scale+h.min)})}r+=d*p}else if(l==="string"){var v=fe(a.shape);f=[];for(var y=0;y<v;y++){var x=new Uint32Array(n.slice(r,r+yd))[0];r+=yd;var E=new Uint8Array(n.slice(r,r+x));f.push(E),r+=x}}else{var b=Dg[l];if(g=n.slice(r,r+d*b),l==="float32")f=new Float32Array(g);else if(l==="int32")f=new Int32Array(g);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(g)}r+=d*b}t[u]=Wt(f,c,l)},s=0,o=e;s<o.length;s++)i(o[s]);return t}function H$(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(s){if(e+=s.byteLength,t.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+s.constructor.name)});var r=new Uint8Array(e),i=0;return t.forEach(function(s){r.set(new Uint8Array(s.buffer),i),i+=s.byteLength}),r.buffer}var Pg=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function F1(n){return Pg?Buffer.byteLength(n):new Blob([n]).size}function Fv(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function M1(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function qu(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:F1(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:F1(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Ln=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(s){var o=s(e,r);o!==null&&i.push(o)}),i},n}(),Fo="://",Xi=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){L(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Fo)&&(e=e.slice(0,e.indexOf(Fo))),L(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();L(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function fc(n){if(n.indexOf(Fo)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Xi.getSchemes().join(","));return{scheme:n.split(Fo)[0],path:n.split(Fo)[1]}}function B1(n,e,t){return t===void 0&&(t=!1),le(this,void 0,void 0,function(){var r,i,s,o,a,u,l,c,d;return ce(this,function(f){switch(f.label){case 0:return L(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),L((r=Ln.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),L(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),i=r[0],L((s=Ln.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),L(s.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),o=s[0],a=fc(n).scheme,u=fc(n).path,l=a===fc(n).scheme,[4,i.load()];case 1:return c=f.sent(),t&&l?[4,Xi.getManager(a).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,o.save(c)];case 4:return d=f.sent(),!t||l?[3,6]:[4,Xi.getManager(a).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var _s="models_store",Ui="model_info_store";function rI(){if(!Q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Og(n){var e=n.result;e.createObjectStore(_s,{keyPath:"modelPath"}),e.createObjectStore(Ui,{keyPath:"modelPath"})}var Mo=function(){function n(e){if(this.indexedDB=rI(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return le(this,void 0,void 0,function(){return ce(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,s){var o=r.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Og(o)},o.onsuccess=function(){var a=o.result;if(t==null){var u=a.transaction(_s,"readonly"),l=u.objectStore(_s).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return a.close(),s(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(g){return a.close(),s(l.error)},u.oncomplete=function(){return a.close()}}else{var c,d=qu(t),f=a.transaction(Ui,"readwrite"),h=f.objectStore(Ui),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var g=(c=a.transaction(_s,"readwrite")).objectStore(_s).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:d});g.onsuccess=function(){return i({modelArtifactsInfo:d})},g.onerror=function(m){var v=(h=f.objectStore(Ui)).delete(r.modelPath);v.onsuccess=function(){return a.close(),s(g.error)},v.onerror=function(y){return a.close(),s(g.error)}}},p.onerror=function(g){return a.close(),s(p.error)},f.oncomplete=function(){c==null?a.close():c.oncomplete=function(){return a.close()}}}},o.onerror=function(a){return s(o.error)}})},n.URL_SCHEME="indexeddb://",n}(),U1=function(n){return Q().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Mo.URL_SCHEME)?(e=n.slice(Mo.URL_SCHEME.length),new Mo(e)):null;var e};Ln.registerSaveRouter(U1),Ln.registerLoadRouter(U1);var z$=function(){function n(){this.indexedDB=rI()}return n.prototype.listModels=function(){return le(this,void 0,void 0,function(){var e=this;return ce(this,function(t){return[2,new Promise(function(r,i){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Og(s)},s.onsuccess=function(){var o=s.result,a=o.transaction(Ui,"readonly"),u=a.objectStore(Ui).getAll();u.onsuccess=function(){for(var l={},c=0,d=u.result;c<d.length;c++){var f=d[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return o.close(),i(u.error)},a.oncomplete=function(){return o.close()}},s.onerror=function(o){return i(s.error)}})]})})},n.prototype.removeModel=function(e){return le(this,void 0,void 0,function(){var t=this;return ce(this,function(r){var i;return e=(i=e).startsWith(Mo.URL_SCHEME)?i.slice(Mo.URL_SCHEME.length):i,[2,new Promise(function(s,o){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Og(a)},a.onsuccess=function(){var u,l=a.result,c=l.transaction(Ui,"readwrite"),d=c.objectStore(Ui),f=d.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),o(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var h=d.delete(e),p=function(){var g=(u=l.transaction(_s,"readwrite")).objectStore(_s).delete(e);g.onsuccess=function(){return s(f.result.modelArtifactsInfo)},g.onerror=function(m){return o(f.error)}};h.onsuccess=p,h.onerror=function(g){return p(),l.close(),o(f.error)}},f.onerror=function(h){return l.close(),o(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},a.onerror=function(u){return o(a.error)}})]})})},n}();if(Q().getBool("IS_BROWSER"))try{Xi.registerManager(Mo.URL_SCHEME,new z$)}catch{}var ii="/",lo="tensorflowjs_models",iI="info",j$="model_topology",K$="weight_specs",q$="weight_data",Y$="model_metadata";function sI(n){return{info:[lo,n,iI].join(ii),topology:[lo,n,j$].join(ii),weightSpecs:[lo,n,K$].join(ii),weightData:[lo,n,q$].join(ii),modelMetadata:[lo,n,Y$].join(ii)}}function X$(n){var e=n.split(ii);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(ii)}var Bo=function(){function n(e){if(!Q().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=sI(this.modelPath)}return n.prototype.save=function(e){return le(this,void 0,void 0,function(){var t,r,i;return ce(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=qu(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(o){if(Pg)return Buffer.from(o).toString("base64");for(var a=new Uint8Array(o),u="",l=0,c=a.length;l<c;l++)u+=String.fromCharCode(a[l]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return le(this,void 0,void 0,function(){var e,t,r,i,s,o,a;return ce(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(s=this.LS.getItem(this.keys.modelMetadata))!=null&&(o=JSON.parse(s),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(l){if(Pg){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var d=atob(l),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(a),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),$1=function(n){return Q().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Bo.URL_SCHEME)?(e=n.slice(Bo.URL_SCHEME.length),new Bo(e)):null;var e};Ln.registerSaveRouter($1),Ln.registerLoadRouter($1);var Q$=function(){function n(){L(Q().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),L(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return le(this,void 0,void 0,function(){var e,t,r,i,s,o;return ce(this,function(a){for(e={},t=lo+ii,r=ii+iI,i=0;i<this.LS.length;++i)(s=this.LS.key(i)).startsWith(t)&&s.endsWith(r)&&(o=X$(s),e[o]=JSON.parse(this.LS.getItem(s)));return[2,e]})})},n.prototype.removeModel=function(e){return le(this,void 0,void 0,function(){var t,r;return ce(this,function(i){var s;if(e=(s=e).startsWith(Bo.URL_SCHEME)?s.slice(Bo.URL_SCHEME.length):s,t=sI(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(Q().getBool("IS_BROWSER"))try{Xi.registerManager(Bo.URL_SCHEME,new Q$)}catch{}var J$="model",Z$=".json",e6=".weights.bin";function G1(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var Wh=function(){function n(e){if(!Q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=J$),this.modelTopologyFileName=e+Z$,this.weightDataFileName=e+e6}return n.prototype.save=function(e){return le(this,void 0,void 0,function(){var t,r,i,s,o,a;return ce(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},s=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(o=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=s,[4,G1(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,G1(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:qu(e)}]}})})},n.URL_SCHEME="downloads://",n}(),t6=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return le(this,void 0,void 0,function(){var e,t,r=this;return ce(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(s,o){var a=new FileReader;a.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){t.length===0&&s({modelTopology:c});var d=l.weightsManifest;if(d!=null){var f;try{f=r.checkManifestAndWeightFiles(d,t)}catch(m){return void o(m)}var h=[],p=[],g=[];d.forEach(function(m){m.paths.forEach(function(v){p.push(v),g.push(null)}),h.push.apply(h,m.weights)}),d.forEach(function(m){m.paths.forEach(function(v){var y=new FileReader;y.onload=function(x){var E=x.target.result,b=p.indexOf(v);g[b]=E,g.indexOf(null)===-1&&s({modelTopology:c,weightSpecs:h,weightData:Fv(g),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},y.onerror=function(x){return o("Failed to weights data from file of path '"+v+"'.")},y.readAsArrayBuffer(f[v])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(u){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map(function(u){return M1(u.name)}),s={},o=0,a=e;o<a.length;o++)a[o].paths.forEach(function(u){var l=M1(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");s[u]=t[i.indexOf(l)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return s},n}();function W1(n,e,t,r){(function(s){L(s!=null&&Array.isArray(s)&&s.length>0,function(){return"promises must be a none empty array"})})(n),function(s,o){L(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+s}),L(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+o}),L(o>=s,function(){return"startFraction must be no more than endFraction, but got startFraction "+s+" and endFraction "+o})}(t=t??0,r=r??1);var i=0;return Promise.all(n.map(function(s){return s.then(function(o){var a=t+ ++i/n.length*(r-t);return e(a),o}),s}))}function oI(n,e){return le(this,void 0,void 0,function(){var t,r,i,s,o,a,u,l,c;return ce(this,function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Q().platform.fetch:e.fetchFunc,r=n.map(function(f){return t(f,e.requestInit,{isBinary:!0})}),i=0,s=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return o=d.sent(),[3,4];case 2:return[4,W1(r,e.onProgress,i,s)];case 3:o=d.sent(),d.label=4;case 4:return a=o.map(function(f){return f.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return c=d.sent(),[3,8];case 6:return[4,W1(a,e.onProgress,u,l)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}})})}function V1(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),le(e,void 0,void 0,function(){var s,o,a,u,l,c,d,f,h,p;return ce(this,function(g){switch(g.label){case 0:if(s=t.map(function(){return!1}),o={},a=i!=null?i.map(function(){return!1}):[],u=[],t.forEach(function(m,v){var y=0;m.weights.forEach(function(x){var E="quantization"in x?x.quantization.dtype:x.dtype,b=Dg[E]*fe(x.shape),S=function(){s[v]=!0,o[v]==null&&(o[v]=[]),o[v].push({manifestEntry:x,groupOffset:y,sizeBytes:b})};i!=null?i.forEach(function(w,T){w===x.name&&(S(),a[T]=!0)}):S(),u.push(x.name),y+=b})}),!a.every(function(m){return m}))throw l=i.filter(function(m,v){return!a[v]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=s.reduce(function(m,v,y){return v&&m.push(y),m},[]),d=[],c.forEach(function(m){t[m].paths.forEach(function(v){var y=r+(r.endsWith("/")?"":"/")+v;d.push(y)})}),[4,n(d)];case 1:return f=g.sent(),h={},p=0,c.forEach(function(m){for(var v=t[m].paths.length,y=0,x=0;x<v;x++)y+=f[p+x].byteLength;for(var E=new ArrayBuffer(y),b=new Uint8Array(E),S=0,w=0;w<v;w++){var T=new Uint8Array(f[p+w]);b.set(T,S),S+=T.byteLength}o[m].forEach(function(R){var _=nI(E.slice(R.groupOffset,R.groupOffset+R.sizeBytes),[R.manifestEntry]);for(var A in _)h[A]=_[A]}),p+=v}),[2,h]}})})}}Ln.registerSaveRouter(function(n){return Q().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Wh.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new Wh(e)}(n.slice(Wh.URL_SCHEME.length)):null});var aI=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(L(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Q().platform.fetch,L(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&L(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return le(this,void 0,void 0,function(){var t,r,i,s;return ce(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((s=o.sent()).ok)return[2,{modelArtifactsInfo:qu(e),responses:[s]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+s.status+".")}})})},n.prototype.load=function(){return le(this,void 0,void 0,function(){var e,t,r,i,s,o,a,u,l,c,d,f;return ce(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,s=t.weightsManifest,o=t.generatedBy,a=t.convertedBy,u=t.format,l=t.userDefinedMetadata,i==null&&s==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return s==null?[3,7]:[4,this.loadWeights(s)];case 6:f=h.sent(),c=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:d,userDefinedMetadata:l,generatedBy:o,convertedBy:a,format:u}]}})})},n.prototype.loadWeights=function(e){return le(this,void 0,void 0,function(){var t,r,i,s,o,a,u,l,c,d,f;return ce(this,function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var g=p.lastIndexOf("/"),m=p.lastIndexOf("?"),v=p.substring(0,g),y=m>g?p.substring(m):"";return[v+"/",y]}(t),i=r[0],s=r[1],o=this.weightPathPrefix||i,a=[],u=0,l=e;u<l.length;u++)c=l[u],a.push.apply(a,c.weights);return d=[],e.forEach(function(p){p.paths.forEach(function(g){d.push(o+g+s)})}),[4,oI(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[a,Fv(f)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function Ng(n){return n.match(aI.URL_SCHEME_REGEX)!=null}var H1=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return Ng(t)}):Ng(n))?Fg(n,{onProgress:e}):null};function Fg(n,e){return new aI(n,e)}Ln.registerSaveRouter(H1),Ln.registerLoadRouter(H1);var Vh=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){return[2,this.modelArtifacts]})})},n}(),n6=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return le(this,void 0,void 0,function(){return ce(this,function(t){return[2,this.saveHandler(e)]})})},n}(),uI=Object.freeze({browserFiles:function(n){return new t6(n)},browserHTTPRequest:function(n,e){return Fg(n,e)},concatenateArrayBuffers:Fv,decodeWeights:nI,encodeWeights:function(n,e){return le(this,void 0,void 0,function(){var t,r,i,s,o,a=this;return ce(this,function(u){switch(u.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),s=function(l){var c=i[l],d=Array.isArray(n)?n[l].tensor:n[c];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+d.dtype);var f={name:c,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var h=new Promise(function(p){return le(a,void 0,void 0,function(){var g,m,v,y,x,E,b;return ce(this,function(S){switch(S.label){case 0:return[4,d.bytes()];case 1:for(g=S.sent(),m=g.reduce(function(w,T){return w+T.length},0)+yd*g.length,v=new Uint8Array(m),y=0,x=0;x<g.length;x++)E=g[x],b=new Uint8Array(new Uint32Array([E.length]).buffer),v.set(b,y),y+=yd,v.set(E,y),y+=E.length;return p(v),[2]}})})});r.push(h)}else r.push(d.data());e!=null&&(f.group=e),t.push(f)},o=0;o<i.length;++o)s(o);return[4,Promise.all(r)];case 1:return[2,{data:H$(u.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new Vh(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vh({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vh({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return Ln.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:qu,getSaveHandlers:function(n){return Ln.getSaveHandlers(n)},http:Fg,isHTTPScheme:Ng,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),le(this,void 0,void 0,function(){return ce(this,function(i){return[2,V1(function(s){return oI(s,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return Ln.registerLoadRouter(n)},registerSaveRouter:function(n){return Ln.registerSaveRouter(n)},weightsLoaderFactory:V1,withSaveHandler:function(n){return new n6(n)},copyModel:function(n,e){return le(this,void 0,void 0,function(){return ce(this,function(t){return[2,B1(n,e,!1)]})})},listModels:function(){return le(this,void 0,void 0,function(){var n,e,t,r,i,s,o;return ce(this,function(a){switch(a.label){case 0:n=Xi.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?(i=r[t],[4,Xi.getManager(i).listModels()]):[3,4];case 2:for(o in s=a.sent())e[i+Fo+o]=s[o];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return le(this,void 0,void 0,function(){return ce(this,function(t){return[2,B1(n,e,!0)]})})},removeModel:function(n){return le(this,void 0,void 0,function(){var e;return ce(this,function(t){return e=fc(n),[2,Xi.getManager(e.scheme).removeModel(e.path)]})})}}),ro;N({confusionMatrix_:function(n,e,t){var r=C(n,"labels","confusionMatrix"),i=C(e,"predictions","confusionMatrix");L(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),L(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),L(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),L(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),L(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var s=Rg(r.asType("int32"),t),o=Rg(i.asType("int32"),t);return s.transpose().matMul(o).asType("int32")}});var r6=N({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,s=!1,o=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)s=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);o=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(DT("FromPixels",F.backendName)!=null)return F.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,u,l=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],d=l[1];if(o?a=n.getContext("2d").getImageData(0,0,c,d).data:r||t?a=n.data:(s||i)&&(ro==null&&(ro=document.createElement("canvas").getContext("2d")),ro.canvas.width=c,ro.canvas.height=d,ro.drawImage(n,0,0,c,d),a=ro.getImageData(0,0,c,d).data),e===4)u=new Int32Array(a);else{var f=c*d;u=new Int32Array(f*e);for(var h=0;h<f;h++)for(var p=0;p<e;++p)u[h*e+p]=a[4*h+p]}return dv(u,[d,c,e],"int32")}}),Mv=Object.freeze({toPixels:function(n,e){return le(this,void 0,void 0,function(){var t,r,i,s,o,a,u,l,c,d,f,h,p,g,m,v,y,x,E,b,S,w,T;return ce(this,function(R){switch(R.label){case 0:if(t=C(n,"img","toPixels"),n instanceof lt||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],s=r[1],(o=t.rank===2?1:t.shape[2])>4||o===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,t.data()];case 1:return a=R.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=R.sent(),d=c[0],f=c[1],h=d[0],p=f[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(g=t.dtype==="float32"?255:1,m=new Uint8ClampedArray(s*i*4),v=0;v<i*s;++v)y=void 0,x=void 0,E=void 0,b=void 0,o===1?(y=a[v]*g,x=a[v]*g,E=a[v]*g,b=255):o===3?(y=a[3*v]*g,x=a[3*v+1]*g,E=a[3*v+2]*g,b=255):o===4&&(y=a[4*v]*g,x=a[4*v+1]*g,E=a[4*v+2]*g,b=a[4*v+3]*g),m[(S=4*v)+0]=Math.round(y),m[S+1]=Math.round(x),m[S+2]=Math.round(E),m[S+3]=Math.round(b);return e!=null&&(e.width=s,e.height=i,w=e.getContext("2d"),T=new ImageData(m,s,i),w.putImageData(T,0,0)),t!==n&&t.dispose(),[2,m]}})})},fromPixels:r6}),i6=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),s6=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function Ks(n){L(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),L(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),L(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),s6.register(n)}var qs=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return yr(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var s=this.computeGradients(t,i),o=s.value,a=s.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:a[l.name]}});this.applyGradients(u)}else this.applyGradients(a);return Sn(a),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return gB(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Sn(this.iterations_)},e.prototype.saveIterations=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:re(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){return ce(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(i6);Object.defineProperty(qs,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var o6=function(n){function e(t,r,i){i===void 0&&(i=null);var s=n.call(this)||this;return s.learningRate=t,s.rho=r,s.epsilon=i,s.accumulatedGrads=[],s.accumulatedUpdates=[],i==null&&(s.epsilon=F.backend.epsilon()),s}return yr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,s){var o=F.registeredVariables[i];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:i+"/accum_grad",variable:ae(function(){return Me(o).variable(!1)})}),r.accumulatedUpdates[s]==null&&(r.accumulatedUpdates[s]={originalName:i+"/accum_var",variable:ae(function(){return Me(o).variable(!1)})});var a=Array.isArray(t)?t[s].tensor:t[i];if(a!=null){var u=r.accumulatedGrads[s].variable,l=r.accumulatedUpdates[s].variable;ae(function(){var c=u.mul(r.rho).add(a.square().mul(1-r.rho)),d=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),f=l.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(c),l.assign(f);var h=d.mul(-r.learningRate).add(o);o.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Sn(this.accumulatedGrads.map(function(t){return t.variable})),Sn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){var t;return ce(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(qs);Ks(o6);var a6=function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return yr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,s){var o=F.registeredVariables[i];r.accumulatedGrads[s]==null&&(r.accumulatedGrads[s]={originalName:i+"/accumulator",variable:ae(function(){return Gr(o.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(t)?t[s].tensor:t[i];if(a!=null){var u=r.accumulatedGrads[s].variable;ae(function(){var l=u.add(a.square());u.assign(l);var c=a.div(l.add(F.backend.epsilon()).sqrt()).mul(-r.learningRate).add(o);o.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Sn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){return ce(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(qs);Ks(a6);var u6=function(n){function e(t,r,i,s){s===void 0&&(s=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=i,o.epsilon=s,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],ae(function(){o.accBeta1=re(r).variable(),o.accBeta2=re(i).variable()}),s==null&&(o.epsilon=F.backend.epsilon()),o}return yr(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t);ae(function(){var s=kt(1,r.accBeta1),o=kt(1,r.accBeta2);i.forEach(function(a,u){var l=F.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:ae(function(){return Me(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:ae(function(){return Me(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[a];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),g=h.div(s),m=p.div(o);d.assign(h),f.assign(p);var v=g.div(m.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Sn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Sn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){var t;return ce(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){var r,i=this;return ce(this,function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),ae(function(){i.accBeta1.assign(md(i.beta1,i.iterations_+1)),i.accBeta2.assign(md(i.beta2,i.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(qs);Ks(u6);var l6=function(n){function e(t,r,i,s,o){s===void 0&&(s=null),o===void 0&&(o=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=s,a.decay=o,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],ae(function(){a.iteration=re(0).variable(),a.accBeta1=re(r).variable()}),s==null&&(a.epsilon=F.backend.epsilon()),a}return yr(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(s){return s.name}):Object.keys(t);ae(function(){var s=kt(1,r.accBeta1),o=cr(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var l=F.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:Me(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:Me(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[a];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2),g=c.abs(),m=p.maximum(g);d.assign(h),f.assign(m);var v=o.div(s).mul(h.div(m.add(r.epsilon))).add(l);l.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Sn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Sn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){return ce(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(qs);Ks(l6);var lI=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return yr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,s){var o=Array.isArray(t)?t[s].tensor:t[i];if(o!=null){var a=F.registeredVariables[i];ae(function(){var u=r.c.mul(o).add(a);a.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=AM(re(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){return ce(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(qs);Ks(lI);var c6=function(n){function e(t,r,i){i===void 0&&(i=!1);var s=n.call(this,t)||this;return s.learningRate=t,s.momentum=r,s.useNesterov=i,s.accumulations=[],s.m=re(s.momentum),s}return yr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,s){var o=F.registeredVariables[i];r.accumulations[s]==null&&(r.accumulations[s]={originalName:i+"/momentum",variable:ae(function(){return Me(o).variable(!1)})});var a=r.accumulations[s].variable,u=Array.isArray(t)?t[s].tensor:t[i];u!=null&&ae(function(){var l,c=r.m.mul(a).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(o):r.c.mul(c).add(o),a.assign(c),o.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Sn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){return ce(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(lI);Ks(c6);var d6=function(n){function e(t,r,i,s,o){r===void 0&&(r=.9),i===void 0&&(i=0),s===void 0&&(s=null),o===void 0&&(o=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=i,a.epsilon=s,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=o,s==null&&(a.epsilon=F.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return yr(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,s){var o=F.registeredVariables[i];r.accumulatedMeanSquares[s]==null&&(r.accumulatedMeanSquares[s]={originalName:i+"/rms",variable:ae(function(){return Me(o).variable(!1)})}),r.accumulatedMoments[s]==null&&(r.accumulatedMoments[s]={originalName:i+"/momentum",variable:ae(function(){return Me(o).variable(!1)})}),r.accumulatedMeanGrads[s]==null&&r.centered&&(r.accumulatedMeanGrads[s]={originalName:i+"/mg",variable:ae(function(){return Me(o).variable(!1)})});var a=Array.isArray(t)?t[s].tensor:t[i];if(a!=null){var u=r.accumulatedMeanSquares[s].variable,l=r.accumulatedMoments[s].variable;ae(function(){var c=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[s].variable,f=d.mul(r.decay).add(a.mul(1-r.decay)),h=l.mul(r.momentum).add(a.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),d.assign(f),l.assign(h);var p=o.sub(h);o.assign(p)}else{var g=u.mul(r.decay).add(a.square().mul(1-r.decay));h=l.mul(r.momentum).add(a.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),u.assign(g),l.assign(h),p=o.sub(h),o.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Sn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Sn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Sn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return le(this,void 0,void 0,function(){var t;return ce(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(qs);Ks(d6);lt.prototype.squaredDifference=function(n){return T_(this,n)},j=M$;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Mg=function(n,e){return Mg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Mg(n,e)};function Se(n,e){Mg(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Zt=function(){return Zt=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Zt.apply(this,arguments)};function ge(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(d){o(d)}}function u(c){try{l(r.throw(c))}catch(d){o(d)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(n,[])).next())})}function me(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ya(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}var Uo=function(){function n(e,t){if(!Ls(e)||!Ls(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function lf(n,e){return n instanceof lt&&n.shape.length===e}function f6(n){return lf(n,2)}function cf(n){return lf(n,3)}function Qi(n){return lf(n,4)}function h6(n){return n%1!==0}function z1(n){return n%2===0}function p6(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function j1(n){return n&&n.width&&n.height}function g6(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Uo(Math.round(t*i),Math.round(r*i))}function Bv(n){return n.reduce(function(e,t){return e.add(t)},new Ue(0,0)).div(new Ue(n.length,n.length))}function ku(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function Ls(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function K1(n){return Ls(n)&&0<=n&&n<=1}var Ue=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),rs=function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Ls),s=[r.x,r.y,r.width,r.height].every(Ls);if(!s&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=s?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=o[0],u=o[1],l=o[2],c=o[3];n.assertIsValidBox({x:a,y:u,width:l,height:c},"Box.constructor",t),this._x=a,this._y=u,this._width=l,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Ls)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Ue(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Ue(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Ue(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Ue(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.round(o)}),t=e[0],r=e[1],i=e[2],s=e[3];return new n({x:t,y:r,width:i,height:s})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(o){return Math.floor(o)}),t=e[0],r=e[1],i=e[2],s=e[3];return new n({x:t,y:r,width:i,height:s})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,s=e.height,o=Math.abs(i-s);return i<s&&(t-=o/2,i+=o),s<i&&(r-=o/2,s+=o),new n({x:t,y:r,width:i,height:s})},n.prototype.rescale=function(e){var t=j1(e)?e.width:e,r=j1(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],s=r[1],o=r[2],a=r[3];return new n({x:i,y:s,width:o,height:a})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,s=r.y,o=r.right,a=r.bottom,u=Math.max(i,0),l=Math.max(s,0),c=o-u,d=a-l,f=Math.min(c,e-u),h=Math.min(d,t-l);return new n({x:u,y:l,width:f,height:h}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,s=r.height,o=this.x+e,a=this.y+t;return new n({x:o,y:a,width:i,height:s})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,s=1,o=1,a=r,u=i,l=this.left,c=this.top,d=this.right,f=this.bottom;return d>t&&(a=-d+t+r,d=t),f>e&&(u=-f+e+i,f=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:o,edy:u,dx:s,edx:a,y:c,ey:f,x:l,ex:d,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),df=function(n){Se(e,n);function e(t,r,i,s,o){return o===void 0&&(o=!1),n.call(this,{left:t,top:r,right:i,bottom:s},o)||this}return e}(rs),cI=function(){function n(e,t,r,i,s){this._imageDims=new Uo(s.width,s.height),this._score=e,this._classScore=t,this._className=r,this._box=new rs(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new rs(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}(),Kr=function(n){Se(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),s=i.score,o=i.relativeBox,a=i.imageDims;return new e(s,o,a)},e}(cI);function m6(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),s=r*i;return t?s/(n.area+e.area-s):s/Math.min(n.area,e.area)}function v6(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,u){return u<a?u:a},1/0),i=t.reduce(function(a,u){return u<a?u:a},1/0),s=e.reduce(function(a,u){return a<u?u:a},0),o=t.reduce(function(a,u){return a<u?u:a},0);return new df(r,i,s,o)}function Lu(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(a,u){return{score:a,boxIndex:u}}).sort(function(a,u){return a.score-u.score}).map(function(a){return a.boxIndex}),s=[],o=function(){var a=i.pop();s.push(a);for(var u=i,l=[],c=0;c<u.length;c++){var d=u[c],f=n[a],h=n[d];l.push(m6(f,h,r))}i=i.filter(function(p,g){return l[g]<=t})};i.length>0;)o();return s}function Yu(n,e){return ae(function(){var t=e[0],r=e[1],i=e[2],s=Gr(Ya(n.shape.slice(0,3),[1]),t),o=Gr(Ya(n.shape.slice(0,3),[1]),r),a=Gr(Ya(n.shape.slice(0,3),[1]),i),u=Rt([s,o,a],3);return kt(n,u)})}function y6(n,e){return e===void 0&&(e=!1),ae(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var s=Math.abs(r-i),o=Math.round(s*(e?.5:1)),a=r>i?2:1,u=function(h){var p=n.shape.slice();return p[a]=h,Gr(p,0)},l=u(o),c=s-l.shape[a],d=e&&c?u(c):null,f=[d,n,l].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return Rt(f,a)})}function Hh(n){return 1/(1+Math.exp(-n))}var Uv=function(n){Se(e,n);function e(t,r,i,s,o){return o===void 0&&(o=!1),n.call(this,{x:t,y:r,width:i,height:s},o)||this}return e}(rs),x6=.5,E6=.43,b6=.45,xd=function(){function n(e,t,r){r===void 0&&(r=new Ue(0,0));var i=t.width,s=t.height;this._imgDims=new Uo(i,s),this._shift=r,this._positions=e.map(function(o){return o.mul(new Ue(i,s)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Ue(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Ue(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Ue(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof Kr?e.box.floor():new rs(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),s=i.useDlibAlignment,o=i.minBoxPadding;return s?this.alignDlib():this.alignMinBbox(o)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],s=function(d){return i.sub(d).magnitude()},o=(s(t)+s(r))/2,a=Math.floor(o/b6),u=Bv(e),l=Math.floor(Math.max(0,u.x-x6*a)),c=Math.floor(Math.max(0,u.y-E6*a));return new Uv(l,c,Math.min(a,this.imageWidth+l),Math.min(a,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=v6(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),S6=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],Bv([t[3],t[4]])]},e}(xd),w6=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Bv)},e}(xd),q1=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+p6(this.distance)+")":"")},n}(),Y1=function(n){Se(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(rs.assertIsValidBox(t,r),!Ls(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(rs),Bl=function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n}();(function(n){Se(e,n);function e(t,r,i,s){var o=n.call(this,t,r)||this;return o._score=i,o._classScore=s,o}return e.assertIsValidPredictedBox=function(t,r){if(Y1.assertIsValidLabeledBox(t,r),!K1(t.score)||!K1(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(Y1);function T6(n){return n.detection instanceof Kr}function $v(n,e){var t={detection:e};return Object.assign({},n,t)}function dI(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function fI(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,s){n.readFile(r,function(o,a){return o?s(o):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function hI(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},s=fI();return Zt({Canvas:n||function(){function o(){}return o}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function o(){}return o}(),Image:e||function(){function o(){}return o}(),ImageData:global.ImageData||function(){function o(){}return o}(),Video:global.HTMLVideoElement||function(){function o(){}return o}(),createCanvasElement:t,createImageElement:r,fetch:i},s)}function pI(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function gI(){return typeof global=="object"&&typeof require=="function"&&typeof KI<"u"&&typeof process<"u"&&!!process.version}var St;function _6(){if(!St)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return St}function Bg(n){St=n}function Gv(){pI()&&Bg(dI()),gI()&&Bg(hI())}function I6(n){if(St||Gv(),!St)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?St.Canvas:e,r=n.Image,i=r===void 0?St.Image:r;St.Canvas=t,St.Image=i,St.createCanvasElement=n.createCanvasElement||function(){return new t},St.createImageElement=n.createImageElement||function(){return new i},St.ImageData=n.ImageData||St.ImageData,St.Video=n.Video||St.Video,St.fetch=n.fetch||St.fetch,St.readFile=n.readFile||St.readFile}var on={getEnv:_6,setEnv:Bg,initialize:Gv,createBrowserEnv:dI,createFileSystem:fI,createNodejsEnv:hI,monkeyPatch:I6,isBrowser:pI,isNodejs:gI};Gv();function mI(n){return!on.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function Gs(n){var e=on.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=mI(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var s=i.getContext("2d");if(!s)throw new Error("resolveContext2d - canvas 2d context is null");return s}var X1;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(X1||(X1={}));function vI(n){var e=on.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function R6(n){return new Promise(function(e,t){if(n instanceof on.getEnv().Canvas||vI(n))return e();function r(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",i),e(s))}function i(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",r),s.currentTarget.removeEventListener("error",i),t(s))}n.addEventListener("load",r),n.addEventListener("error",i)})}function yI(n){var e=on.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Uo(n.naturalWidth,n.naturalHeight):n instanceof r?new Uo(n.videoWidth,n.videoHeight):new Uo(n.width,n.height)}function ff(n){var e=n.width,t=n.height,r=on.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function Wv(n,e){var t=on.getEnv().ImageData;if(!(n instanceof t)&&!vI(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=yI(n),i=r.width,s=r.height,o=ff({width:i,height:s});return n instanceof t?Gs(o).putImageData(n,0,0):Gs(o).drawImage(n,0,0,i,s),o}function C6(n,e){return ge(this,void 0,void 0,function(){var t,r,i,s,o,a;return me(this,function(u){switch(u.label){case 0:return t=on.getEnv().createCanvasElement(),r=n.shape.slice(Qi(n)?1:0),i=r[0],s=r[1],o=r[2],a=ae(function(){return n.as3D(i,s,o).toInt()}),[4,Mv.toPixels(a,t)];case 1:return u.sent(),a.dispose(),[2,t]}})})}function Q1(n){var e=on.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function A6(n,e,t){t===void 0&&(t=!1);var r=on.getEnv(),i=r.Image,s=r.Canvas;if(!(n instanceof i||n instanceof s))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=yI(n),a=e/Math.max(o.height,o.width),u=a*o.width,l=a*o.height,c=ff({width:e,height:e}),d=n instanceof s?n:Wv(n),f=Math.abs(u-l)/2,h=t&&u<l?f:0,p=t&&l<u?f:0;return Gs(c).drawImage(d,h,p,u,l),c}var Ed=function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,s){if(cf(i)){r._imageTensors[s]=i,r._inputDimensions[s]=i.shape;return}if(Qi(i)){var o=i.shape[0];if(o!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");r._imageTensors[s]=i,r._inputDimensions[s]=i.shape.slice(1);return}var a=i instanceof on.getEnv().Canvas?i:Wv(i);r._canvases[s]=a,r._inputDimensions[s]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return ku(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return g6({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,ae(function(){var i=ku(r.batchSize,0,1).map(function(o){var a=r.getInput(o);if(a instanceof lt){var u=Qi(a)?a:a.expandDims();return u=y6(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=Lv.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(a instanceof on.getEnv().Canvas)return Mv.fromPixels(A6(a,e,t));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),s=Mn(i.map(function(o){return o.toFloat()})).as4D(r.batchSize,e,e,3);return s})},n}();function Bt(n){return ge(this,void 0,void 0,function(){var e,t,r;return me(this,function(i){switch(i.label){case 0:if(n instanceof Ed)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(s){return Array.isArray(n)?" at input index "+s+":":""},r=e.map(mI),r.forEach(function(s,o){if(!Q1(s)&&!cf(s)&&!Qi(s))throw typeof e[o]=="string"?new Error("toNetInput -"+t(o)+" string passed, but could not resolve HTMLElement for element id "+e[o]):new Error("toNetInput -"+t(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Qi(s)){var a=s.shape[0];if(a!==1)throw new Error("toNetInput -"+t(o)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(s){return Q1(s)&&R6(s)}))];case 1:return i.sent(),[2,new Ed(r,Array.isArray(n))]}})})}function Vv(n,e){return ge(this,void 0,void 0,function(){var t,r,i,s,o,a,u;return me(this,function(l){switch(l.label){case 0:return t=on.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,Bt(n)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return s=i.getInput(0),s instanceof t?(o=s,[3,4]):[3,2];case 2:return[4,C6(s)];case 3:o=l.sent(),l.label=4;case 4:r=o,l.label=5;case 5:return a=Gs(r),u=e.map(function(c){return c instanceof Kr?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var d=c.x,f=c.y,h=c.width,p=c.height,g=ff({width:h,height:p});return Gs(g).putImageData(a.getImageData(d,f,h,p),0,0),g})]}})})}function Hv(n,e){return ge(this,void 0,void 0,function(){return me(this,function(t){if(!cf(n)&&!Qi(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Qi(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ae(function(){var r=n.shape.slice(Qi(n)?1:0),i=r[0],s=r[1],o=r[2],a=e.map(function(l){return l instanceof Kr?l.forSize(s,i).box:l}).map(function(l){return l.clipAtImageBorders(s,i)}),u=a.map(function(l){var c=l.x,d=l.y,f=l.width,h=l.height;return z_(n.as3D(i,s,o),[d,c,0],[h,f,o])});return u})]})})}function k6(n,e){return ge(this,void 0,void 0,function(){var t,r;return me(this,function(i){switch(i.label){case 0:return t=on.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function L6(n){return ge(this,void 0,void 0,function(){return me(this,function(e){switch(e.label){case 0:return[4,k6(n)];case 1:return[2,e.sent().json()]}})})}function xI(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(a){return a}),s=n.endsWith(".json")?i[i.length-1]:t,o=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return o=n.startsWith("/")?"/"+o:o,{modelBaseUri:o,manifestUri:o==="/"?"/"+s:o+"/"+s}}function D6(n,e){return ge(this,void 0,void 0,function(){var t,r,i,s;return me(this,function(o){switch(o.label){case 0:return t=xI(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,L6(r)];case 1:return s=o.sent(),[2,uI.loadWeights(s,i)]}})})}var bi=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,s=r.objProp;i[s].dispose(),i[s]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Zo})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Zo)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,s=Wt(i.dataSync());i.dispose(),e.reassignParamFromPath(r,s)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return ge(this,void 0,void 0,function(){return me(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return ge(this,void 0,void 0,function(){var t;return me(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,D6(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return ge(this,void 0,void 0,function(){var t,r,i,s,o,a,u,l,c,d;return me(this,function(f){switch(f.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=on.getEnv().readFile,r=xI(e,this.getDefaultModelName()),i=r.manifestUri,s=r.modelBaseUri,o=function(h){return Promise.all(h.map(function(p){return t(p).then(function(g){return g.buffer})}))},a=uI.weightsLoaderFactory(o),c=(l=JSON).parse,[4,t(i)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,a(u,s)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(s,o){if(!s.nextObj.hasOwnProperty(o))throw new Error("traversePropertyPath - object does not have property "+o+", for path "+e);return{obj:s.nextObj,objProp:o,nextObj:s.nextObj[o]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof lt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n}();function Dn(n,e,t){return ae(function(){var r=Iv(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=ke(r,e.bias),r})}function zh(n,e,t){return t===void 0&&(t=!1),ae(function(){var r=ct(t?ke(nr(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):Dn(n,e.conv0,[2,2])),i=Dn(r,e.conv1,[1,1]),s=ct(ke(r,i)),o=Dn(s,e.conv2,[1,1]);return ct(ke(r,ke(i,o)))})}function Ul(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),ae(function(){var i=ct(t?ke(nr(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Dn(n,e.conv0,r?[2,2]:[1,1])),s=Dn(i,e.conv1,[1,1]),o=ct(ke(i,s)),a=Dn(o,e.conv2,[1,1]),u=ct(ke(i,ke(s,a))),l=Dn(u,e.conv3,[1,1]);return ct(ke(i,ke(s,ke(a,l))))})}function gr(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),ae(function(){var i=ke(nr(n,e.filters,[1,1],t),e.bias);return r?ct(i):i})}function Si(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function hf(n,e){return function(t,r,i,s){var o=gn(n(t*r*i*i),[i,i,t,r]),a=bt(n(r));return e.push({paramPath:s+"/filters"},{paramPath:s+"/bias"}),{filters:o,bias:a}}}function zv(n,e){return function(t,r,i){var s=Yi(n(t*r),[t,r]),o=bt(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:s,bias:o}}}var EI=function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n}();function jv(n,e){return function(t,r,i){var s=gn(n(9*t),[3,3,t,1]),o=gn(n(t*r),[1,1,t,r]),a=bt(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new EI(s,o,a)}}function Kv(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new EI(t,r,i)}}function cs(n,e){return function(t,r,i){var s=n[t];if(!lf(s,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+s);return e.push({originalPath:t,paramPath:i||t}),s}}function wi(n){var e=n;function t(i){var s=e.slice(0,i);return e=e.slice(i),s}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function bI(n,e){var t=hf(n,e),r=jv(n,e);function i(o,a,u,l){l===void 0&&(l=!1);var c=l?t(o,a,3,u+"/conv0"):r(o,a,u+"/conv0"),d=r(a,a,u+"/conv1"),f=r(a,a,u+"/conv2");return{conv0:c,conv1:d,conv2:f}}function s(o,a,u,l){l===void 0&&(l=!1);var c=i(o,a,u,l),d=c.conv0,f=c.conv1,h=c.conv2,p=r(a,a,u+"/conv3");return{conv0:d,conv1:f,conv2:h,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:s}}function P6(n){var e=[],t=wi(n),r=t.extractWeights,i=t.getRemainingWeights,s=bI(r,e).extractDenseBlock4Params,o=s(3,32,"dense0",!0),a=s(32,64,"dense1"),u=s(64,128,"dense2"),l=s(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:o,dense1:a,dense2:u,dense3:l}}}function SI(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function wI(n,e){var t=cs(n,e),r=SI(t),i=Kv(t);function s(a,u){u===void 0&&(u=!1);var l=u?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),d=i(a+"/conv2");return{conv0:l,conv1:c,conv2:d}}function o(a,u){u===void 0&&(u=!1);var l=u?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),d=i(a+"/conv2"),f=i(a+"/conv3");return{conv0:l,conv1:c,conv2:d,conv3:f}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:o}}function O6(n){var e=[],t=wI(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Si(n,e),{params:r,paramMappings:e}}var TI=function(n){Se(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ae(function(){var i=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],o=Yu(i,s).div(re(255)),a=Ul(o,r.dense0,!0);return a=Ul(a,r.dense1),a=Ul(a,r.dense2),a=Ul(a,r.dense3),a=Ku(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return O6(t)},e.prototype.extractParams=function(t){return P6(t)},e}(bi);function Fr(n,e){return ae(function(){return ke(of(n,e.weights),e.bias)})}function N6(n,e,t){var r=[],i=wi(n),s=i.extractWeights,o=i.getRemainingWeights,a=zv(s,r),u=a(e,t,"fc");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:u}}}function F6(n){var e=[],t=cs(n,e);function r(s){var o=t(s+"/weights",2),a=t(s+"/bias",1);return{weights:o,bias:a}}var i={fc:r("fc")};return Si(n,e),{params:i,paramMappings:e}}function _I(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var II=function(n){Se(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ae(function(){var s=t instanceof Ed?r.faceFeatureExtractor.forwardInput(t):t;return Fr(s.as2D(s.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,s=r.paramMappings;this._params=i,this._paramMappings=s},e.prototype.extractClassifierParams=function(t){return N6(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=_I(t),i=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),F6(s)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),s=i*r+i,o=t.slice(0,t.length-s),a=t.slice(t.length-s);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},e}(bi),J1=["neutral","happy","sad","angry","fearful","disgusted","surprised"],M6=function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);J1.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return J1.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),B6=function(n){Se(e,n);function e(t){return t===void 0&&(t=new TI),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return ae(function(){return xi(r.runNet(t))})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return ge(this,void 0,void 0,function(){var r,i,s,o,a=this;return me(this,function(u){switch(u.label){case 0:return[4,Bt(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(Ct(i).map(function(l){return ge(a,void 0,void 0,function(){var c;return me(this,function(d){switch(d.label){case 0:return[4,l.data()];case 1:return c=d.sent(),l.dispose(),[2,c]}})})}))];case 3:return s=u.sent(),i.dispose(),o=s.map(function(l){return new M6(l)}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(II);function RI(n,e){var t={expressions:e};return Object.assign({},n,t)}function U6(n){return T6(n)&&n.landmarks instanceof xd&&n.unshiftedLandmarks instanceof xd&&n.alignedRect instanceof Kr}function qv(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),s=n.detection.imageDims,o=new Kr(n.detection.score,i.rescale(s.reverse()),s),a={landmarks:r,unshiftedLandmarks:e,alignedRect:o};return Object.assign({},n,a)}function $6(n,e){var t=hf(n,e),r=jv(n,e);function i(o,a,u){var l=r(o,a,u+"/separable_conv0"),c=r(a,a,u+"/separable_conv1"),d=t(o,a,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:d}}function s(o,a){var u=r(o,o,a+"/separable_conv0"),l=r(o,o,a+"/separable_conv1"),c=r(o,o,a+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:s}}function G6(n,e){var t=[],r=wi(n),i=r.extractWeights,s=r.getRemainingWeights,o=$6(i,t),a=o.extractConvParams,u=o.extractSeparableConvParams,l=o.extractReductionBlockParams,c=o.extractMainBlockParams,d=a(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),h=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:f,reduction_block_1:h},g={};ku(e,0,1).forEach(function(x){g["main_block_"+x]=c(128,"middle_flow/main_block_"+x)});var m=l(128,256,"exit_flow/reduction_block"),v=u(256,512,"exit_flow/separable_conv"),y={reduction_block:m,separable_conv:v};if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:g,exit_flow:y}}}function W6(n,e){var t=cs(n,e),r=SI(t),i=Kv(t);function s(a){var u=i(a+"/separable_conv0"),l=i(a+"/separable_conv1"),c=r(a+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function o(a){var u=i(a+"/separable_conv0"),l=i(a+"/separable_conv1"),c=i(a+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:s,extractMainBlockParams:o}}function V6(n,e){var t=[],r=W6(n,t),i=r.extractConvParams,s=r.extractSeparableConvParams,o=r.extractReductionBlockParams,a=r.extractMainBlockParams,u=i("entry_flow/conv_in"),l=o("entry_flow/reduction_block_0"),c=o("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};ku(e,0,1).forEach(function(m){f["main_block_"+m]=a("middle_flow/main_block_"+m)});var h=o("exit_flow/reduction_block"),p=s("exit_flow/separable_conv"),g={reduction_block:h,separable_conv:p};return Si(n,t),{params:{entry_flow:d,middle_flow:f,exit_flow:g},paramMappings:t}}function CI(n,e,t){return ke(nr(n,e.filters,t,"same"),e.bias)}function jh(n,e,t){t===void 0&&(t=!0);var r=t?ct(n):n;return r=Dn(r,e.separable_conv0,[1,1]),r=Dn(ct(r),e.separable_conv1,[1,1]),r=Ot(r,[3,3],[2,2],"same"),r=ke(r,CI(n,e.expansion_conv,[2,2])),r}function H6(n,e){var t=Dn(ct(n),e.separable_conv0,[1,1]);return t=Dn(ct(t),e.separable_conv1,[1,1]),t=Dn(ct(t),e.separable_conv2,[1,1]),t=ke(t,n),t}var z6=function(n){Se(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return ae(function(){var s=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Yu(s,o).div(re(256)),u=ct(CI(a,i.entry_flow.conv_in,[2,2]));return u=jh(u,i.entry_flow.reduction_block_0,!1),u=jh(u,i.entry_flow.reduction_block_1),ku(r._numMainBlocks,0,1).forEach(function(l){u=H6(u,i.middle_flow["main_block_"+l])}),u=jh(u,i.exit_flow.reduction_block),u=ct(Dn(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return V6(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return G6(t,this._numMainBlocks)},e}(bi);function j6(n){var e=[],t=wi(n),r=t.extractWeights,i=t.getRemainingWeights,s=zv(r,e),o=s(512,1,"fc/age"),a=s(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:o,gender:a}}}}function K6(n){var e=[],t=cs(n,e);function r(s){var o=t(s+"/weights",2),a=t(s+"/bias",1);return{weights:o,bias:a}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Si(n,e),{params:i,paramMappings:e}}var bd;(function(n){n.FEMALE="female",n.MALE="male"})(bd||(bd={}));var q6=function(n){Se(e,n);function e(t){t===void 0&&(t=new z6(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ae(function(){var s=t instanceof Ed?r.faceFeatureExtractor.forwardInput(t):t,o=Ku(s,[7,7],[2,2],"valid").as2D(s.shape[0],-1),a=Fr(o,i.fc.age).as1D(),u=Fr(o,i.fc.gender);return{age:a,gender:u}})},e.prototype.forwardInput=function(t){var r=this;return ae(function(){var i=r.runNet(t),s=i.age,o=i.gender;return{age:s,gender:xi(o)}})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return ge(this,void 0,void 0,function(){var r,i,s,o,a,u,l=this;return me(this,function(c){switch(c.label){case 0:return[4,Bt(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),s=Ct(i.age),o=Ct(i.gender),a=s.map(function(d,f){return{ageTensor:d,genderTensor:o[f]}}),[4,Promise.all(a.map(function(d){var f=d.ageTensor,h=d.genderTensor;return ge(l,void 0,void 0,function(){var p,g,m,v,y;return me(this,function(x){switch(x.label){case 0:return[4,f.data()];case 1:return p=x.sent()[0],[4,h.data()];case 2:return g=x.sent()[0],m=g>.5,v=m?bd.MALE:bd.FEMALE,y=m?g:1-g,f.dispose(),h.dispose(),[2,{age:p,gender:v,genderProbability:y}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,s=r.paramMappings;this._params=i,this._paramMappings=s},e.prototype.extractClassifierParams=function(t){return j6(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=_I(t),i=r.featureExtractorMap,s=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),K6(s)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),s=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(s)},e}(bi),AI=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var s=i.map(function(a){var u=a.width,l=a.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),o=s.length;return ae(function(){var a=function(f,h){return Mn([Gr([68],f),Gr([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=s[f],g=p.width,m=p.height;return h(g,m)?Math.abs(g-m)/2:0},l=function(f){return u(f,function(h,p){return h<p})},c=function(f){return u(f,function(h,p){return p<h})},d=t.mul(Gr([o,136],r)).sub(Mn(Array.from(Array(o),function(f,h){return a(l(h),c(h))}))).div(Mn(Array.from(Array(o),function(f,h){return a(s[h].width,s[h].height)})));return d})},e.prototype.forwardInput=function(t){var r=this;return ae(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(s){var o=s[0],a=s[1];return{height:o,width:a}}))})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return ge(this,void 0,void 0,function(){var r,i,s,o=this;return me(this,function(a){switch(a.label){case 0:return[4,Bt(t)];case 1:return r=a.sent(),i=ae(function(){return Ct(o.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return ge(o,void 0,void 0,function(){var c,d,f,h,p;return me(this,function(g){switch(g.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return c=f.apply(d,[g.sent()]),h=c.filter(function(m,v){return z1(v)}),p=c.filter(function(m,v){return!z1(v)}),[2,new w6(Array(68).fill(0).map(function(m,v){return new Ue(h[v],p[v])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return s=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(II),kI=function(n){Se(e,n);function e(t){return t===void 0&&(t=new TI),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(AI);function Y6(n){var e=[],t=wI(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Si(n,e),{params:r,paramMappings:e}}function X6(n){var e=[],t=wi(n),r=t.extractWeights,i=t.getRemainingWeights,s=bI(r,e).extractDenseBlock3Params,o=s(3,32,"dense0",!0),a=s(32,64,"dense1"),u=s(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:o,dense1:a,dense2:u}}}var Q6=function(n){Se(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ae(function(){var i=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],o=Yu(i,s).div(re(255)),a=zh(o,r.dense0,!0);return a=zh(a,r.dense1),a=zh(a,r.dense2),a=Ku(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Y6(t)},e.prototype.extractParams=function(t){return X6(t)},e}(bi),J6=function(n){Se(e,n);function e(t){return t===void 0&&(t=new Q6),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(AI);(function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(kI);function Z6(n,e){return ke(rn(n,e.weights),e.biases)}function Yv(n,e,t,r,i){i===void 0&&(i="same");var s=e.conv,o=s.filters,a=s.bias,u=nr(n,o,t,i);return u=ke(u,a),u=Z6(u,e.scale),r?ct(u):u}function e5(n,e){return Yv(n,e,[1,1],!0)}function LI(n,e){return Yv(n,e,[1,1],!1)}function DI(n,e){return Yv(n,e,[2,2],!0,"valid")}function t5(n,e){function t(a,u,l){var c=n(a),d=c.length/(u*l*l);if(h6(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return ae(function(){return ns(gn(c,[u,d,l,l]),[2,3,1,0])})}function r(a,u,l,c){var d=t(a,u,l),f=bt(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:d,bias:f}}function i(a,u){var l=bt(n(a)),c=bt(n(a));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function s(a,u,l,c){var d=r(a,u,l,c+"/conv"),f=i(u,c+"/scale");return{conv:d,scale:f}}function o(a,u,l,c,d){d===void 0&&(d=!1);var f=s((d?.5:1)*a,u,l,c+"/conv1"),h=s(a,u,l,c+"/conv2");return{conv1:f,conv2:h}}return{extractConvLayerParams:s,extractResidualLayerParams:o}}function n5(n){var e=wi(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],s=t5(t,i),o=s.extractConvLayerParams,a=s.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),l=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),d=a(9216,32,3,"conv32_3"),f=a(36864,64,3,"conv64_down",!0),h=a(36864,64,3,"conv64_1"),p=a(36864,64,3,"conv64_2"),g=a(36864,64,3,"conv64_3"),m=a(147456,128,3,"conv128_down",!0),v=a(147456,128,3,"conv128_1"),y=a(147456,128,3,"conv128_2"),x=a(589824,256,3,"conv256_down",!0),E=a(589824,256,3,"conv256_1"),b=a(589824,256,3,"conv256_2"),S=a(589824,256,3,"conv256_down_out"),w=ae(function(){return ns(Yi(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var T={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:g,conv128_down:m,conv128_1:v,conv128_2:y,conv256_down:x,conv256_1:E,conv256_2:b,conv256_down_out:S,fc:w};return{params:T,paramMappings:i}}function r5(n,e){var t=cs(n,e);function r(o){var a=t(o+"/scale/weights",1),u=t(o+"/scale/biases",1);return{weights:a,biases:u}}function i(o){var a=t(o+"/conv/filters",4),u=t(o+"/conv/bias",1),l=r(o);return{conv:{filters:a,bias:u},scale:l}}function s(o){return{conv1:i(o+"/conv1"),conv2:i(o+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:s}}function i5(n){var e=[],t=r5(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,s=r("conv32_down"),o=i("conv32_1"),a=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),d=i("conv64_2"),f=i("conv64_3"),h=i("conv128_down"),p=i("conv128_1"),g=i("conv128_2"),m=i("conv256_down"),v=i("conv256_1"),y=i("conv256_2"),x=i("conv256_down_out"),E=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!f6(E))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+E);var b={conv32_down:s,conv32_1:o,conv32_2:a,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:g,conv256_down:m,conv256_1:v,conv256_2:y,conv256_down_out:x,fc:E};return Si(n,e),{params:b,paramMappings:e}}function wr(n,e){var t=e5(n,e.conv1);return t=LI(t,e.conv2),t=ke(t,n),t=ct(t),t}function $l(n,e){var t=DI(n,e.conv1);t=LI(t,e.conv2);var r=Ku(n,2,2,"valid"),i=et(r.shape),s=r.shape[3]!==t.shape[3],o=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(o){var a=Ya(t.shape);a[1]=1;var u=et(a);t=Rt([t,u],1);var l=Ya(t.shape);l[2]=1;var c=et(l);t=Rt([t,c],2)}return r=s?Rt([r,i],3):r,t=ke(r,t),t=ct(t),t}var s5=function(n){Se(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ae(function(){var i=t.toBatchTensor(150,!0).toFloat(),s=[122.782,117.001,104.298],o=Yu(i,s).div(re(256)),a=DI(o,r.conv32_down);a=Ot(a,3,2,"valid"),a=wr(a,r.conv32_1),a=wr(a,r.conv32_2),a=wr(a,r.conv32_3),a=$l(a,r.conv64_down),a=wr(a,r.conv64_1),a=wr(a,r.conv64_2),a=wr(a,r.conv64_3),a=$l(a,r.conv128_down),a=wr(a,r.conv128_1),a=wr(a,r.conv128_2),a=$l(a,r.conv256_down),a=wr(a,r.conv256_1),a=wr(a,r.conv256_2),a=$l(a,r.conv256_down_out);var u=a.mean([1,2]),l=of(u,r.fc);return l})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return ge(this,void 0,void 0,function(){var r,i,s,o=this;return me(this,function(a){switch(a.label){case 0:return[4,Bt(t)];case 1:return r=a.sent(),i=ae(function(){return Ct(o.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return s=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return i5(t)},e.prototype.extractParams=function(t){return n5(t)},e}(bi);function PI(n,e){var t={descriptor:e};return Object.assign({},n,t)}function OI(n,e){var t={age:e};return Object.assign({},n,t)}function NI(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var FI=function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,s=t.maxNumScales,o=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=s||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function o5(n,e){function t(u,l){var c=gn(n(9*u),[3,3,u,1]),d=bt(n(u)),f=bt(n(u)),h=bt(n(u)),p=bt(n(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}function r(u,l,c,d,f){var h=gn(n(u*l*c*c),[c,c,u,l]),p=bt(n(l));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function i(u,l,c,d){var f=r(u,l,c,d,!0),h=f.filters,p=f.bias;return{filters:h,batch_norm_offset:p}}function s(u,l,c){var d=t(u,c+"/depthwise_conv"),f=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:f}}function o(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=s(32,64,"mobilenetv1/conv_1"),c=s(64,128,"mobilenetv1/conv_2"),d=s(128,128,"mobilenetv1/conv_3"),f=s(128,256,"mobilenetv1/conv_4"),h=s(256,256,"mobilenetv1/conv_5"),p=s(256,512,"mobilenetv1/conv_6"),g=s(512,512,"mobilenetv1/conv_7"),m=s(512,512,"mobilenetv1/conv_8"),v=s(512,512,"mobilenetv1/conv_9"),y=s(512,512,"mobilenetv1/conv_10"),x=s(512,512,"mobilenetv1/conv_11"),E=s(512,1024,"mobilenetv1/conv_12"),b=s(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:g,conv_8:m,conv_9:v,conv_10:y,conv_11:x,conv_12:E,conv_13:b}}function a(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),d=i(128,256,3,"prediction_layer/conv_3"),f=i(256,128,1,"prediction_layer/conv_4"),h=i(128,256,3,"prediction_layer/conv_5"),p=i(256,64,1,"prediction_layer/conv_6"),g=i(64,128,3,"prediction_layer/conv_7"),m=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),v=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),y=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),E=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),b=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),S=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),w=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),T=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),R=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),_=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),A=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),k={box_encoding_predictor:m,class_predictor:v},G={box_encoding_predictor:y,class_predictor:x},U={box_encoding_predictor:E,class_predictor:b},M={box_encoding_predictor:S,class_predictor:w},B={box_encoding_predictor:T,class_predictor:R},$={box_encoding_predictor:_,class_predictor:A};return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:g,box_predictor_0:k,box_predictor_1:G,box_predictor_2:U,box_predictor_3:M,box_predictor_4:B,box_predictor_5:$}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:a}}function a5(n){var e=[],t=wi(n),r=t.extractWeights,i=t.getRemainingWeights,s=o5(r,e),o=s.extractMobilenetV1Params,a=s.extractPredictionLayerParams,u=o(),l=a(),c=dv(r(5118*4),[1,5118,4]),d={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:d},paramMappings:e}}function u5(n,e){var t=cs(n,e);function r(l,c,d){var f=t(l+"/Conv2d_"+c+"_pointwise/weights",4,d+"/filters"),h=t(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:f,batch_norm_offset:h}}function i(l){var c="mobilenetv1/conv_"+l,d="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",h=c+"/pointwise_conv",p=t(d+"/depthwise_weights",4,f+"/filters"),g=t(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),m=t(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),v=t(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),y=t(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:g,batch_norm_offset:m,batch_norm_mean:v,batch_norm_variance:y},pointwise_conv:r("MobilenetV1",l,h)}}function s(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function o(l,c){var d=t(l+"/weights",4,c+"/filters"),f=t(l+"/biases",1,c+"/bias");return{filters:d,bias:f}}function a(l){var c=o("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),d=o("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:d}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:u}}function l5(n){var e=[],t=u5(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,s=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!cf(s))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+s);var o={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:s}};return Si(n,e),{params:o,paramMappings:e}}function Ir(n,e,t){return ae(function(){var r=nr(n,e.filters,t,"same");return r=ke(r,e.batch_norm_offset),Sv(r,0,6)})}var c5=.0010000000474974513;function d5(n,e,t){return ae(function(){var r=sf(n,e.filters,t,"same");return r=k_(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,c5),Sv(r,0,6)})}function f5(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function h5(n,e){return ae(function(){var t=null,r=Ir(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(s,o){var a=o+1,u=f5(a);r=d5(r,s.depthwise_conv,u),r=Ir(r,s.pointwise_conv,[1,1]),a===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function p5(n,e,t,r,i){var s=n.shape[0],o=Math.min(t,s),a=e.map(function(c,d){return{score:c,boxIndex:d}}).filter(function(c){return c.score>i}).sort(function(c,d){return d.score-c.score}),u=function(c){return c<=r?1:0},l=[];return a.forEach(function(c){if(!(l.length>=o)){for(var d=c.score,f=l.length-1;f>=0;--f){var h=g5(n,c.boxIndex,l[f]);if(h!==0&&(c.score*=u(h),c.score<=i))break}d===c.score&&l.push(c.boxIndex)}}),l}function g5(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),s=Math.min(r[e][1],r[e][3]),o=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),l=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),d=Math.max(r[t][1],r[t][3]),f=(o-i)*(a-s),h=(c-u)*(d-l);if(f<=0||h<=0)return 0;var p=Math.max(i,u),g=Math.max(s,l),m=Math.min(o,c),v=Math.min(a,d),y=Math.max(m-p,0)*Math.max(v-g,0);return y/(f+h-y)}function m5(n){var e=Ct(ns(n,[1,0])),t=[kt(e[2],e[0]),kt(e[3],e[1])],r=[ke(e[0],cr(t[0],re(2))),ke(e[1],cr(t[1],re(2)))];return{sizes:t,centers:r}}function v5(n,e){var t=m5(n),r=t.sizes,i=t.centers,s=Ct(ns(e,[1,0])),o=cr(rn(Lg(cr(s[2],re(5))),r[0]),re(2)),a=ke(rn(cr(s[0],re(10)),r[0]),i[0]),u=cr(rn(Lg(cr(s[3],re(5))),r[1]),re(2)),l=ke(rn(cr(s[1],re(10)),r[1]),i[1]);return ns(Mn([kt(a,o),kt(l,u),ke(a,o),ke(l,u)]),[1,0])}function y5(n,e,t){return ae(function(){var r=n.shape[0],i=v5(fr(Oo(t.extra_dim,[r,1,1]),[-1,4]),fr(n,[-1,4]));i=fr(i,[r,i.shape[0]/r,4]);var s=I_(Vr(e,[0,0,1],[-1,-1,-1])),o=Vr(s,[0,0,0],[-1,-1,1]);o=fr(o,[r,o.shape[1]]);var a=Ct(i),u=Ct(o);return{boxes:a,scores:u}})}function io(n,e){return ae(function(){var t=n.shape[0],r=fr(gr(n,e.box_encoding_predictor),[t,-1,1,4]),i=fr(gr(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function x5(n,e,t){return ae(function(){var r=Ir(n,t.conv_0,[1,1]),i=Ir(r,t.conv_1,[2,2]),s=Ir(i,t.conv_2,[1,1]),o=Ir(s,t.conv_3,[2,2]),a=Ir(o,t.conv_4,[1,1]),u=Ir(a,t.conv_5,[2,2]),l=Ir(u,t.conv_6,[1,1]),c=Ir(l,t.conv_7,[2,2]),d=io(e,t.box_predictor_0),f=io(n,t.box_predictor_1),h=io(i,t.box_predictor_2),p=io(o,t.box_predictor_3),g=io(u,t.box_predictor_4),m=io(c,t.box_predictor_5),v=Rt([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,m.boxPredictionEncoding],1),y=Rt([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,g.classPrediction,m.classPrediction],1);return{boxPredictions:v,classPredictions:y}})}var pf=function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),MI=function(n){Se(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ae(function(){var i=t.toBatchTensor(512,!1).toFloat(),s=kt(rn(i,re(.007843137718737125)),re(1)),o=h5(s,r.mobilenetv1),a=x5(o.out,o.conv11,r.prediction_layer),u=a.boxPredictions,l=a.classPredictions;return y5(u,l,r.output_layer)})},e.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return me(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Bt(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i,s,o,a,u,l,c,d,f,h,p,g,m,v,y,x,E,b,S,w,T;return me(this,function(R){switch(R.label){case 0:return i=new pf(r),s=i.maxResults,o=i.minConfidence,[4,Bt(t)];case 1:for(a=R.sent(),u=this.forwardInput(a),l=u.boxes,c=u.scores,d=l[0],f=c[0],h=1;h<l.length;h++)l[h].dispose(),c[h].dispose();return m=(g=Array).from,[4,f.data()];case 2:return p=m.apply(g,[R.sent()]),v=.5,y=p5(d,p,s,v,o),x=a.getReshapedInputDimensions(0),E=a.inputSize,b=E/x.width,S=E/x.height,w=d.arraySync(),T=y.map(function(_){var A=[Math.max(0,w[_][0]),Math.min(1,w[_][2])].map(function($){return $*S}),k=A[0],G=A[1],U=[Math.max(0,w[_][1]),Math.min(1,w[_][3])].map(function($){return $*b}),M=U[0],B=U[1];return new Kr(p[_],new Uv(M,k,B-M,G-k),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,T]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return l5(t)},e.prototype.extractParams=function(t){return a5(t)},e}(bi);(function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(MI);var E5=.4,b5=[new Ue(.738768,.874946),new Ue(2.42204,2.65704),new Ue(4.30971,7.04493),new Ue(10.246,4.59428),new Ue(12.6868,11.8741)],S5=[new Ue(1.603231,2.094468),new Ue(6.041143,7.080126),new Ue(2.882459,3.518061),new Ue(4.266906,5.178857),new Ue(9.041765,10.66308)],w5=[117.001,114.697,97.404],T5="tiny_yolov2_model",_5="tiny_yolov2_separable_conv_model",Gl=function(n){return typeof n=="number"};function I5(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Gl(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return Gl(e.x)&&Gl(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(Gl)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function Xv(n){return ae(function(){var e=rn(n,re(.10000000149011612));return ke(ct(kt(n,e)),e)})}function Ri(n,e){return ae(function(){var t=zs(n,[[0,0],[1,1],[1,1],[0,0]]);return t=nr(t,e.conv.filters,[1,1],"valid"),t=kt(t,e.bn.sub),t=rn(t,e.bn.truediv),t=ke(t,e.conv.bias),Xv(t)})}function Ci(n,e){return ae(function(){var t=zs(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Iv(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=ke(t,e.bias),Xv(t)})}function R5(n,e){var t=hf(n,e);function r(o,a){var u=bt(n(o)),l=bt(n(o));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:u,truediv:l}}function i(o,a,u){var l=t(o,a,3,u+"/conv"),c=r(a,u+"/bn");return{conv:l,bn:c}}var s=jv(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:s}}function C5(n,e,t,r){var i=wi(n),s=i.extractWeights,o=i.getRemainingWeights,a=[],u=R5(s,a),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,f;if(e.withSeparableConvs){var h=r[0],p=r[1],g=r[2],m=r[3],v=r[4],y=r[5],x=r[6],E=r[7],b=r[8],S=e.isFirstLayerConv2d?l(h,p,3,"conv0"):d(h,p,"conv0"),w=d(p,g,"conv1"),T=d(g,m,"conv2"),R=d(m,v,"conv3"),_=d(v,y,"conv4"),A=d(y,x,"conv5"),k=E?d(x,E,"conv6"):void 0,G=b?d(E,b,"conv7"):void 0,U=l(b||E||x,5*t,1,"conv8");f={conv0:S,conv1:w,conv2:T,conv3:R,conv4:_,conv5:A,conv6:k,conv7:G,conv8:U}}else{var h=r[0],p=r[1],g=r[2],m=r[3],v=r[4],y=r[5],x=r[6],E=r[7],b=r[8],S=c(h,p,"conv0"),w=c(p,g,"conv1"),T=c(g,m,"conv2"),R=c(m,v,"conv3"),_=c(v,y,"conv4"),A=c(y,x,"conv5"),k=c(x,E,"conv6"),G=c(E,b,"conv7"),U=l(b,5*t,1,"conv8");f={conv0:S,conv1:w,conv2:T,conv3:R,conv4:_,conv5:A,conv6:k,conv7:G,conv8:U}}if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:f,paramMappings:a}}function A5(n,e){var t=cs(n,e);function r(a){var u=t(a+"/sub",1),l=t(a+"/truediv",1);return{sub:u,truediv:l}}function i(a){var u=t(a+"/filters",4),l=t(a+"/bias",1);return{filters:u,bias:l}}function s(a){var u=i(a+"/conv"),l=r(a+"/bn");return{conv:u,bn:l}}var o=Kv(t);return{extractConvParams:i,extractConvWithBatchNormParams:s,extractSeparableConvParams:o}}function k5(n,e){var t=[],r=A5(n,t),i=r.extractConvParams,s=r.extractConvWithBatchNormParams,o=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?i("conv0"):o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:u>7?o("conv6"):void 0,conv7:u>8?o("conv7"):void 0,conv8:i("conv8")}}else a={conv0:s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:s("conv6"),conv7:s("conv7"),conv8:i("conv8")};return Si(n,t),{params:a,paramMappings:t}}var Z1;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(Z1||(Z1={}));var Qv=function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),BI=function(n){Se(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return I5(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=Ri(t,r.conv0);return i=Ot(i,[2,2],[2,2],"same"),i=Ri(i,r.conv1),i=Ot(i,[2,2],[2,2],"same"),i=Ri(i,r.conv2),i=Ot(i,[2,2],[2,2],"same"),i=Ri(i,r.conv3),i=Ot(i,[2,2],[2,2],"same"),i=Ri(i,r.conv4),i=Ot(i,[2,2],[2,2],"same"),i=Ri(i,r.conv5),i=Ot(i,[2,2],[1,1],"same"),i=Ri(i,r.conv6),i=Ri(i,r.conv7),gr(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?Xv(gr(t,r.conv0,"valid",!1)):Ci(t,r.conv0);return i=Ot(i,[2,2],[2,2],"same"),i=Ci(i,r.conv1),i=Ot(i,[2,2],[2,2],"same"),i=Ci(i,r.conv2),i=Ot(i,[2,2],[2,2],"same"),i=Ci(i,r.conv3),i=Ot(i,[2,2],[2,2],"same"),i=Ci(i,r.conv4),i=Ot(i,[2,2],[2,2],"same"),i=Ci(i,r.conv5),i=Ot(i,[2,2],[1,1],"same"),i=r.conv6?Ci(i,r.conv6):i,i=r.conv7?Ci(i,r.conv7):i,gr(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,s=this.params;if(!s)throw new Error("TinyYolov2 - load model before inference");return ae(function(){var o=t.toBatchTensor(r,!1).toFloat();return o=i.config.meanRgb?Yu(o,i.config.meanRgb):o,o=o.div(re(256)),i.config.withSeparableConvs?i.runMobilenet(o,s):i.runTinyYolov2(o,s)})},e.prototype.forward=function(t,r){return ge(this,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return i=this.forwardInput,[4,Bt(t)];case 1:return[4,i.apply(this,[s.sent(),r])];case 2:return[2,s.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i,s,o,a,u,l,c,d,f,h,p,g,m,v,y=this;return me(this,function(x){switch(x.label){case 0:return i=new Qv(r),s=i.inputSize,o=i.scoreThreshold,[4,Bt(t)];case 1:return a=x.sent(),[4,this.forwardInput(a,s)];case 2:return u=x.sent(),l=ae(function(){return Ct(u)[0].expandDims()}),c={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(l,a.getReshapedInputDimensions(0),o)];case 3:return d=x.sent(),u.dispose(),l.dispose(),f=d.map(function(E){return E.box}),h=d.map(function(E){return E.score}),p=d.map(function(E){return E.classScore}),g=d.map(function(E){return y.config.classes[E.label]}),m=Lu(f.map(function(E){return E.rescale(s)}),h,this.config.iouThreshold,!0),v=m.map(function(E){return new cI(h[E],p[E],g[E],f[E],c)}),[2,v]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return k5(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return C5(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return ge(this,void 0,void 0,function(){var s,o,a,u,l,c,d,f,h,p,g,m,v,y,x,E,b,S,w,T,R,_,A,k,G,U,M,B,$,D=this;return me(this,function(P){switch(P.label){case 0:return s=r.width,o=r.height,a=Math.max(s,o),u=a/s,l=a/o,c=t.shape[1],d=this.config.anchors.length,f=ae(function(){var O=t.reshape([c,c,d,D.boxEncodingSize]),K=O.slice([0,0,0,0],[c,c,d,4]),Y=O.slice([0,0,0,4],[c,c,d,1]),ee=D.withClassScores?xi(O.slice([0,0,0,5],[c,c,d,D.config.classes.length]),3):re(0);return[K,Y,ee]}),h=f[0],p=f[1],g=f[2],m=[],[4,p.array()];case 1:return v=P.sent(),[4,h.array()];case 2:y=P.sent(),x=0,P.label=3;case 3:if(!(x<c))return[3,12];E=0,P.label=4;case 4:if(!(E<c))return[3,11];b=0,P.label=5;case 5:return b<d?(S=Hh(v[x][E][b][0]),!i||S>i?(w=(E+Hh(y[x][E][b][0]))/c*u,T=(x+Hh(y[x][E][b][1]))/c*l,R=Math.exp(y[x][E][b][2])*this.config.anchors[b].x/c*u,_=Math.exp(y[x][E][b][3])*this.config.anchors[b].y/c*l,A=w-R/2,k=T-_/2,G={row:x,col:E,anchor:b},this.withClassScores?[4,this.extractPredictedClass(g,G)]:[3,7]):[3,9]):[3,10];case 6:return $=P.sent(),[3,8];case 7:$={classScore:1,label:0},P.label=8;case 8:U=$,M=U.classScore,B=U.label,m.push(Zt({box:new df(A,k,A+R,k+_),score:S,classScore:S*M,label:B},G)),P.label=9;case 9:return b++,[3,5];case 10:return E++,[3,4];case 11:return x++,[3,3];case 12:return h.dispose(),p.dispose(),g.dispose(),[2,m]}})})},e.prototype.extractPredictedClass=function(t,r){return ge(this,void 0,void 0,function(){var i,s,o,a;return me(this,function(u){switch(u.label){case 0:return i=r.row,s=r.col,o=r.anchor,[4,t.array()];case 1:return a=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return a[i][s][o][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(bi),L5=function(n){Se(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:E5,classes:["face"]},t?{anchors:S5,meanRgb:w5}:{anchors:b5,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ge(this,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return[4,this.detect(t,r)];case 1:return i=s.sent(),[2,i.map(function(o){return new Kr(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?_5:T5},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(BI),UI=function(n){Se(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(Qv),Xu=function(){function n(){}return n.prototype.then=function(e){return ge(this,void 0,void 0,function(){var t;return me(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return ge(this,void 0,void 0,function(){return me(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function gf(n,e,t,r,i){return i===void 0&&(i=function(s){var o=s.alignedRect;return o}),ge(this,void 0,void 0,function(){var s,o,a,u,l;return me(this,function(c){switch(c.label){case 0:return s=n.map(function(d){return U6(d)?i(d):d.detection}),a=r,a?[3,5]:e instanceof lt?[4,Hv(e,s)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,Vv(e,s)];case 3:u=c.sent(),c.label=4;case 4:a=u,c.label=5;case 5:return o=a,[4,t(o)];case 6:return l=c.sent(),o.forEach(function(d){return d instanceof lt&&d.dispose()}),[2,l]}})})}function Jv(n,e,t,r,i){return ge(this,void 0,void 0,function(){var s=this;return me(this,function(o){return[2,gf([n],e,function(a){return ge(s,void 0,void 0,function(){return me(this,function(u){return[2,t(a[0])]})})},r,i)]})})}function D5(n){return ae(function(){return Mn(Ct(n,3).reverse(),3)})}var Wl=2,Sd=12;function P5(n,e){var t=hf(n,e),r=zv(n,e);function i(l,c){var d=bt(n(l));return e.push({paramPath:c}),d}function s(l,c,d){d===void 0&&(d=!1);var f=t(l[0],l[1],3,c+"/conv1"),h=i(l[1],c+"/prelu1_alpha"),p=t(l[1],l[2],3,c+"/conv2"),g=i(l[2],c+"/prelu2_alpha"),m=t(l[2],l[3],d?2:3,c+"/conv3"),v=i(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:h,conv2:p,prelu2_alpha:g,conv3:m,prelu3_alpha:v}}function o(){var l=s([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),d=t(32,4,1,"pnet/conv4_2");return Zt(Zt({},l),{conv4_1:c,conv4_2:d})}function a(){var l=s([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return Zt(Zt({},l),{fc1:c,prelu4_alpha:d,fc2_1:f,fc2_2:h})}function u(){var l=s([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=i(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),m=r(256,10,"onet/fc2_3");return Zt(Zt({},l),{conv4:c,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:g,fc2_3:m})}return{extractPNetParams:o,extractRNetParams:a,extractONetParams:u}}function O5(n){var e=wi(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],s=P5(t,i),o=s.extractPNetParams,a=s.extractRNetParams,u=s.extractONetParams,l=o(),c=a(),d=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:d},paramMappings:i}}function N5(n,e){var t=cs(n,e);function r(c){var d=t(c+"/weights",4,c+"/filters"),f=t(c+"/bias",1);return{filters:d,bias:f}}function i(c){var d=t(c+"/weights",2),f=t(c+"/bias",1);return{weights:d,bias:f}}function s(c){return t(c,1)}function o(c){var d=r(c+"/conv1"),f=s(c+"/prelu1_alpha"),h=r(c+"/conv2"),p=s(c+"/prelu2_alpha"),g=r(c+"/conv3"),m=s(c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:h,prelu2_alpha:p,conv3:g,prelu3_alpha:m}}function a(){var c=o("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Zt(Zt({},c),{conv4_1:d,conv4_2:f})}function u(){var c=o("rnet"),d=i("rnet/fc1"),f=s("rnet/prelu4_alpha"),h=i("rnet/fc2_1"),p=i("rnet/fc2_2");return Zt(Zt({},c),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})}function l(){var c=o("onet"),d=r("onet/conv4"),f=s("onet/prelu4_alpha"),h=i("onet/fc1"),p=s("onet/prelu5_alpha"),g=i("onet/fc2_1"),m=i("onet/fc2_2"),v=i("onet/fc2_3");return Zt(Zt({},c),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:g,fc2_2:m,fc2_3:v})}return{extractPNetParams:a,extractRNetParams:u,extractONetParams:l}}function F5(n){var e=[],t=N5(n,e),r=t.extractPNetParams,i=t.extractRNetParams,s=t.extractONetParams,o=r(),a=i(),u=s();return Si(n,e),{params:{pnet:o,rnet:a,onet:u},paramMappings:e}}function Ug(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function M5(n,e,t){for(var r=t[0],i=t[1],s=Sd/n,o=[],a=Math.min(r,i)*s,u=0;a>=12;)o.push(s*Math.pow(e,u)),a=a*e,u+=1;return o}var Zv=function(n){Se(e,n);function e(t,r,i,s){return n.call(this,{left:t,top:r,right:i,bottom:s},!0)||this}return e}(rs);function $I(n){return ae(function(){return rn(kt(n,re(127.5)),re(.0078125))})}function $o(n,e){return ae(function(){return ke(ct(n),rn(e,gd(ct(gd(n)))))})}function e0(n,e,t){return t===void 0&&(t=!1),ae(function(){var r=gr(n,e.conv1,"valid");return r=$o(r,e.prelu1_alpha),r=Ot(r,t?[2,2]:[3,3],[2,2],"same"),r=gr(r,e.conv2,"valid"),r=$o(r,e.prelu2_alpha),r=t?r:Ot(r,[3,3],[2,2],"valid"),r=gr(r,e.conv3,"valid"),r=$o(r,e.prelu3_alpha),r})}function B5(n,e){return ae(function(){var t=e0(n,e,!0),r=gr(t,e.conv4_1,"valid"),i=qn(af(r,3),3),s=xi(kt(r,i),3),o=gr(t,e.conv4_2,"valid");return{prob:s,regions:o}})}function U5(n,e){return ae(function(){var t=Ug(e,n.shape.slice(1)),r=t.height,i=t.width,s=Lv.resizeBilinear(n,[r,i]),o=$I(s);return ns(o,[0,2,1,3])})}function $5(n,e,t,r){for(var i=[],s=n.arraySync(),o=0;o<n.shape[0];o++)for(var a=0;a<n.shape[1];a++)s[o][a]>=r&&i.push(new Ue(a,o));var u=i.map(function(l){var c=new df(Math.round((l.y*Wl+1)/t),Math.round((l.x*Wl+1)/t),Math.round((l.y*Wl+Sd)/t),Math.round((l.x*Wl+Sd)/t)),d=s[l.y][l.x],f=e.arraySync(),h=new Zv(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:d,region:h}});return u}function G5(n,e,t,r,i){i.stage1=[];var s=e.map(function(f){return ae(function(){var h={scale:f},p=U5(n,f),g=Date.now(),m=B5(p,r),v=m.prob,y=m.regions;h.pnet=Date.now()-g;var x=Ct(Ct(v,3)[1])[0],E=Ct(y)[0];return{scoresTensor:x,regionsTensor:E,scale:f,statsForScale:h}})}),o=s.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,g=f.scale,m=f.statsForScale,v=$5(h,p,g,t);if(h.dispose(),p.dispose(),!v.length)return i.stage1.push(m),[];var y=Date.now(),x=Lu(v.map(function(E){return E.cell}),v.map(function(E){return E.score}),.5);return m.nms=Date.now()-y,m.numBoxes=x.length,i.stage1.push(m),x.map(function(E){return v[E]})}),a=o.reduce(function(f,h){return f.concat(h)},[]),u=[],l=[];if(a.length>0){var c=Date.now(),d=Lu(a.map(function(f){return f.cell}),a.map(function(f){return f.score}),.7);i.stage1_nms=Date.now()-c,l=d.map(function(f){return a[f].score}),u=d.map(function(f){return a[f]}).map(function(f){var h=f.cell,p=f.region;return new df(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:l}}function GI(n,e,t){var r=t.width,i=t.height;return ge(this,void 0,void 0,function(){var s,o,a,u=this;return me(this,function(l){switch(l.label){case 0:return s=Gs(n),[4,Promise.all(e.map(function(c){return ge(u,void 0,void 0,function(){var d,f,h,p,g,m,v,y;return me(this,function(x){return d=c.padAtBorders(n.height,n.width),f=d.y,h=d.ey,p=d.x,g=d.ex,m=p-1,v=f-1,y=s.getImageData(m,v,g-m,h-v),[2,on.isNodejs()?Wv(y):createImageBitmap(y)]})})}))];case 1:return o=l.sent(),a=[],o.forEach(function(c){var d=ff({width:r,height:i}),f=Gs(d);f.drawImage(c,0,0,r,i);for(var h=f.getImageData(0,0,r,i).data,p=[],g=0;g<h.length;g+=4)p.push(h[g+2]),p.push(h[g+1]),p.push(h[g]);a.push(p)}),[2,a.map(function(c){var d=ae(function(){var f=ns(gn(c,[1,r,i,3]),[0,2,1,3]).toFloat();return $I(f)});return d})]}})})}function W5(n,e){return ae(function(){var t=e0(n,e),r=fr(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Fr(r,e.fc1),s=$o(i,e.prelu4_alpha),o=Fr(s,e.fc2_1),a=qn(af(o,1),1),u=xi(kt(o,a),1),l=Fr(s,e.fc2_2),c=Ct(u,1)[1];return{scores:c,regions:l}})}function V5(n,e,t,r,i){return ge(this,void 0,void 0,function(){var s,o,a,u,l,c,d,f,h,p,g,m,v,y;return me(this,function(x){switch(x.label){case 0:return s=Date.now(),[4,GI(n,e,{width:24,height:24})];case 1:return o=x.sent(),i.stage2_extractImagePatches=Date.now()-s,s=Date.now(),a=o.map(function(E){var b=W5(E,r);return E.dispose(),b}),i.stage2_rnet=Date.now()-s,u=a.length>1?Rt(a.map(function(E){return E.scores})):a[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[x.sent()]),u.dispose(),f=l.map(function(E,b){return{score:E,idx:b}}).filter(function(E){return E.score>t}).map(function(E){var b=E.idx;return b}),h=f.map(function(E){return e[E]}),p=f.map(function(E){return l[E]}),g=[],m=[],h.length>0&&(s=Date.now(),v=Lu(h,p,.7),i.stage2_nms=Date.now()-s,y=v.map(function(E){var b=a[f[E]].regions.arraySync();return new Zv(b[0][0],b[0][1],b[0][2],b[0][3])}),m=v.map(function(E){return p[E]}),g=v.map(function(E,b){return h[E].calibrate(y[b])})),a.forEach(function(E){E.regions.dispose(),E.scores.dispose()}),[2,{boxes:g,scores:m}]}})})}function H5(n,e){return ae(function(){var t=e0(n,e);t=Ot(t,[2,2],[2,2],"same"),t=gr(t,e.conv4,"valid"),t=$o(t,e.prelu4_alpha);var r=fr(t,[t.shape[0],e.fc1.weights.shape[0]]),i=Fr(r,e.fc1),s=$o(i,e.prelu5_alpha),o=Fr(s,e.fc2_1),a=qn(af(o,1),1),u=xi(kt(o,a),1),l=Fr(s,e.fc2_2),c=Fr(s,e.fc2_3),d=Ct(u,1)[1];return{scores:d,regions:l,points:c}})}function z5(n,e,t,r,i){return ge(this,void 0,void 0,function(){var s,o,a,u,l,c,d,f,h,p,g,m,v,y,x;return me(this,function(E){switch(E.label){case 0:return s=Date.now(),[4,GI(n,e,{width:48,height:48})];case 1:return o=E.sent(),i.stage3_extractImagePatches=Date.now()-s,s=Date.now(),a=o.map(function(b){var S=H5(b,r);return b.dispose(),S}),i.stage3_onet=Date.now()-s,u=a.length>1?Rt(a.map(function(b){return b.scores})):a[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[E.sent()]),u.dispose(),f=l.map(function(b,S){return{score:b,idx:S}}).filter(function(b){return b.score>t}).map(function(b){var S=b.idx;return S}),h=f.map(function(b){var S=a[b].regions.arraySync();return new Zv(S[0][0],S[0][1],S[0][2],S[0][3])}),p=f.map(function(b,S){return e[b].calibrate(h[S])}),g=f.map(function(b){return l[b]}),m=[],v=[],y=[],p.length>0&&(s=Date.now(),x=Lu(p,g,.7,!1),i.stage3_nms=Date.now()-s,m=x.map(function(b){return p[b]}),v=x.map(function(b){return g[b]}),y=x.map(function(b,S){return Array(5).fill(0).map(function(w,T){var R=a[b].points.arraySync();return new Ue(R[0][T]*(m[S].width+1)+m[S].left,R[0][T+5]*(m[S].height+1)+m[S].top)})})),a.forEach(function(b){b.regions.dispose(),b.scores.dispose(),b.points.dispose()}),[2,{boxes:m,scores:v,points:y}]}})})}var j5=function(n){Se(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return ge(this,void 0,void 0,function(){return me(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return ge(this,void 0,void 0,function(){return me(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i,s,o,a,u,l,c,d,f,h,p,g,m,v,y,x,E,b,S,w,T;return me(this,function(R){switch(R.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(s=t.canvases[0],!s)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},a=Date.now(),u=ae(function(){return D5(qn(Mv.fromPixels(s)).toFloat())}),l=function(_){return u.dispose(),o.total=Date.now()-a,_},c=u.shape.slice(1),d=c[0],f=c[1],h=new FI(r),p=h.minFaceSize,g=h.scaleFactor,m=h.maxNumScales,v=h.scoreThresholds,y=h.scaleSteps,x=(y||M5(p,g,[d,f])).filter(function(_){var A=Ug(_,[d,f]);return Math.min(A.width,A.height)>Sd}).slice(0,m),o.scales=x,o.pyramid=x.map(function(_){return Ug(_,[d,f])}),E=Date.now(),[4,G5(u,x,v[0],i.pnet,o)];case 1:return b=R.sent(),o.total_stage1=Date.now()-E,b.boxes.length?(o.stage2_numInputBoxes=b.boxes.length,E=Date.now(),[4,V5(s,b.boxes,v[1],i.rnet,o)]):[2,l({results:[],stats:o})];case 2:return S=R.sent(),o.total_stage2=Date.now()-E,S.boxes.length?(o.stage3_numInputBoxes=S.boxes.length,E=Date.now(),[4,z5(s,S.boxes,v[2],i.onet,o)]):[2,l({results:[],stats:o})];case 3:return w=R.sent(),o.total_stage3=Date.now()-E,T=w.boxes.map(function(_,A){return qv($v({},new Kr(w.scores[A],new Uv(_.left/f,_.top/d,_.width/f,_.height/d),{height:d,width:f})),new S6(w.points[A].map(function(k){return k.sub(new Ue(_.left,_.top)).div(new Ue(_.width,_.height))}),{width:_.width,height:_.height}))}),[2,l({results:T,stats:o})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return i=this.forwardInput,[4,Bt(t)];case 1:return[4,i.apply(this,[s.sent(),r])];case 2:return[2,s.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return i=this.forwardInput,[4,Bt(t)];case 1:return[2,i.apply(this,[s.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return F5(t)},e.prototype.extractParams=function(t){return O5(t)},e}(bi),K5=.4,q5=[new Ue(1.603231,2.094468),new Ue(6.041143,7.080126),new Ue(2.882459,3.518061),new Ue(4.266906,5.178857),new Ue(9.041765,10.66308)],Y5=[117.001,114.697,97.404],X5=function(n){Se(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:K5,classes:["face"],anchors:q5,meanRgb:Y5,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return ge(this,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return[4,this.detect(t,r)];case 1:return i=s.sent(),[2,i.map(function(o){return new Kr(o.score,o.relativeBox,{width:o.imageWidth,height:o.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(BI),Pn={ssdMobilenetv1:new MI,tinyFaceDetector:new X5,tinyYolov2:new L5,mtcnn:new j5,faceLandmark68Net:new kI,faceLandmark68TinyNet:new J6,faceRecognitionNet:new s5,faceExpressionNet:new B6,ageGenderNet:new q6},WI=function(n){Se(e,n);function e(t,r,i){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s.extractedFaces=i,s}return e}(Xu),t0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i=this;return me(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),[4,gf(t,this.input,function(o){return ge(i,void 0,void 0,function(){return me(this,function(a){switch(a.label){case 0:return[4,Promise.all(o.map(function(u){return Pn.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,t.map(function(o,a){return RI(o,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new s0(this,this.input)},e}(WI),n0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return me(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,Jv(t,this.input,function(s){return Pn.faceExpressionNet.predictExpressions(s)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,RI(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new o0(this,this.input)},e}(WI),r0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new a0(this,this.input)},e.prototype.withFaceDescriptors=function(){return new l0(this,this.input)},e}(t0),i0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new u0(this,this.input)},e.prototype.withFaceDescriptor=function(){return new c0(this,this.input)},e}(n0),VI=function(n){Se(e,n);function e(t,r,i){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s.extractedFaces=i,s}return e}(Xu),s0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i=this;return me(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),[4,gf(t,this.input,function(o){return ge(i,void 0,void 0,function(){return me(this,function(a){switch(a.label){case 0:return[4,Promise.all(o.map(function(u){return Pn.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=s.sent(),[2,t.map(function(o,a){var u=r[a],l=u.age,c=u.gender,d=u.genderProbability;return OI(NI(o,c,d),l)})]}})})},e.prototype.withFaceExpressions=function(){return new t0(this,this.input)},e}(VI),o0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,s,o;return me(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,Jv(t,this.input,function(u){return Pn.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,s=r.gender,o=r.genderProbability,[2,OI(NI(t,s,o),i)]}})})},e.prototype.withFaceExpressions=function(){return new n0(this,this.input)},e}(VI),a0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new r0(this,this.input)},e.prototype.withFaceDescriptors=function(){return new l0(this,this.input)},e}(s0),u0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new i0(this,this.input)},e.prototype.withFaceDescriptor=function(){return new c0(this,this.input)},e}(o0),HI=function(n){Se(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e}(Xu),l0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return me(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,gf(t,this.input,function(s){return Promise.all(s.map(function(o){return Pn.faceRecognitionNet.computeFaceDescriptor(o)}))},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(s,o){return PI(t[o],s)})]}})})},e.prototype.withFaceExpressions=function(){return new r0(this,this.input)},e.prototype.withAgeAndGender=function(){return new a0(this,this.input)},e}(HI),c0=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return me(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,Jv(t,this.input,function(s){return Pn.faceRecognitionNet.computeFaceDescriptor(s)},null,function(s){return s.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,PI(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new i0(this,this.input)},e.prototype.withAgeAndGender=function(){return new u0(this,this.input)},e}(HI),zI=function(n){Se(e,n);function e(t,r,i){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s.useTinyLandmarkNet=i,s}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Pn.faceLandmark68TinyNet:Pn.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Xu),Q5=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,s,o,a=this;return me(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(l){return l.detection}),this.input instanceof lt?[4,Hv(this.input,r)]:[3,3];case 2:return s=u.sent(),[3,5];case 3:return[4,Vv(this.input,r)];case 4:s=u.sent(),u.label=5;case 5:return i=s,[4,Promise.all(i.map(function(l){return a.landmarkNet.detectLandmarks(l)}))];case 6:return o=u.sent(),i.forEach(function(l){return l instanceof lt&&l.dispose()}),[2,t.map(function(l,c){return qv(l,o[c])})]}})})},e.prototype.withFaceExpressions=function(){return new r0(this,this.input)},e.prototype.withAgeAndGender=function(){return new a0(this,this.input)},e.prototype.withFaceDescriptors=function(){return new l0(this,this.input)},e}(zI),J5=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,s,o;return me(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?(r=t.detection,this.input instanceof lt?[4,Hv(this.input,[r])]:[3,3]):[2];case 2:return s=a.sent(),[3,5];case 3:return[4,Vv(this.input,[r])];case 4:s=a.sent(),a.label=5;case 5:return i=s,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return o=a.sent(),i.forEach(function(u){return u instanceof lt&&u.dispose()}),[2,qv(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new i0(this,this.input)},e.prototype.withAgeAndGender=function(){return new u0(this,this.input)},e.prototype.withFaceDescriptor=function(){return new c0(this,this.input)},e}(zI),jI=function(n){Se(e,n);function e(t,r){r===void 0&&(r=new pf);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e}(Xu),Z5=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,s;return me(this,function(o){switch(o.label){case 0:return t=this,r=t.input,i=t.options,i instanceof FI?[4,Pn.mtcnn.forward(r,i)]:[3,2];case 1:return[2,o.sent().map(function(a){return a.detection})];case 2:if(s=i instanceof UI?function(a){return Pn.tinyFaceDetector.locateFaces(a,i)}:i instanceof pf?function(a){return Pn.ssdMobilenetv1.locateFaces(a,i)}:i instanceof Qv?function(a){return Pn.tinyYolov2.locateFaces(a,i)}:null,!s)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,s(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return ge(t,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return i=s.sent(),[2,r(i.map(function(o){return $v({},o)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new Q5(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new t0(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new s0(this.runAndExtendWithFaceDetections(),this.input)},e}(jI),eG=function(n){Se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return me(this,function(i){switch(i.label){case 0:return[4,new Z5(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(s){s.score>r.score&&(r=s)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return ge(t,void 0,void 0,function(){var i;return me(this,function(s){switch(s.label){case 0:return[4,this.run()];case 1:return i=s.sent(),[2,r(i?$v({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new J5(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new n0(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new o0(this.runAndExtendWithFaceDetection(),this.input)},e}(jI);function tG(n,e){return e===void 0&&(e=new pf),new eG(n,e)}function nG(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,s){return i-r[s]}).reduce(function(i,s){return i+Math.pow(s,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,s=function(){return"person "+i++};this._labeledDescriptors=r.map(function(o){if(o instanceof Bl)return o;if(o instanceof Float32Array)return new Bl(s(),[o]);if(o.descriptor&&o.descriptor instanceof Float32Array)return new Bl(s(),[o.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return nG(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,s=r.label;return new q1(s,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new q1("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return Bl.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();const rG=({darkMode:n})=>{const e=X.useRef(null),t=X.useRef(null),[r,i]=X.useState(!1),[s,o]=X.useState(!1),[a,u]=X.useState(!1);return X.useEffect(()=>{(async()=>{await Pn.tinyFaceDetector.loadFromUri("/models"),o(!0)})()},[]),X.useEffect(()=>{if(e.current){const l=e.current,c=new dr({liveDurationInfinity:!0,enableWorker:!0,lowLatencyMode:!0});c.loadSource("http://localhost:8888/stream0/index.m3u8"),c.attachMedia(l),c.on(dr.Events.MANIFEST_PARSED,()=>{l.play().catch(console.error)})}},[]),X.useEffect(()=>{let l;const c=async()=>{var g;if(!e.current||!s||r||!a)return;const d=e.current,f=t.current;if(!f)return;const h=f.getContext("2d");if(!h)return;f.width=d.videoWidth,f.height=d.videoHeight,h.drawImage(d,0,0,f.width,f.height);const p=await tG(f,new UI);if(console.log("Detection:",p),p){i(!0);try{console.log("Inside Detection...");const m=f.toDataURL("image/jpeg");if(!m)return;const v=await fetch(m).then(E=>E.blob()),y=new FormData;y.append("file",v,"face.jpg");const x=await je.post("http://52.66.236.1:8000/match",y,{headers:{"Content-Type":"multipart/form-data"}});if(console.log("Response:",x.data),(g=x.data.matches)!=null&&g.length){const E=x.data.matches[0];if(E.status==="Blocked"){De.error(`Dear ${E.name}, Your access is blocked.`,{position:"top-right"}),setTimeout(()=>i(!1),5e3);return}if(E.name!=="unknown"){if(E.user_type=="Visitor"){De.success(`Welcome ${E.name}! Visitor Entry`,{position:"top-right"}),setTimeout(()=>i(!1),5e3);return}De.success(`Welcome ${E.name}! Attendance recorded.`,{position:"top-right"}),setTimeout(()=>i(!1),5e3);return}}}catch(m){console.error("Error:",m),De.error("Error recognizing face. Please try again.",{position:"top-right"})}i(!1)}};return s&&a&&(l=window.setInterval(c,1e3)),()=>clearInterval(l)},[s,r,a]),H.jsxs("div",{className:`max-w-md mx-auto my-5 p-6 ${n?"bg-gray-800 text-gray-100":"bg-gray-100"} rounded-xl shadow-lg`,children:[H.jsx("h2",{className:`text-2xl font-bold mb-6 ${n?"text-gray-100":"text-gray-900"}`,children:"Smart Attendance"}),H.jsxs("div",{className:"relative",children:[H.jsx("video",{ref:e,className:`w-full rounded-lg shadow-lg ${a?"":"grayscale opacity-50"}`,muted:!0,autoPlay:!0,controls:!0}),!s&&H.jsx("p",{className:`mt-4 text-center ${n?"text-gray-300":"text-gray-600"}`,children:"Loading face detection models..."})]}),H.jsx("canvas",{ref:t,className:"hidden"}),H.jsxs("div",{className:"flex justify-center mt-4 space-x-4",children:[H.jsx("button",{onClick:()=>u(!0),className:`p-2 rounded-full shadow-md transition-all ${a?"bg-gray-500 text-gray-300 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:a,children:H.jsx(k2,{size:32})}),H.jsx("button",{onClick:()=>u(!1),className:`p-2 rounded-full shadow-md transition-all ${a?"bg-red-500 text-white hover:bg-red-600":"bg-gray-500 text-gray-300 cursor-not-allowed"}`,disabled:!a,children:H.jsx(L2,{size:32})})]}),H.jsx(AT,{})]})},iG=()=>{const[n,e]=X.useState(""),[t,r]=X.useState(""),[i,s]=X.useState(localStorage.getItem("isLoggedIn")==="true"),o=async u=>{var c,d,f,h;u.preventDefault();const l=new FormData;l.append("user_id",n),l.append("password",t);try{const p=await je.post("http://52.66.236.1:8000/login",l),g=(c=p.data.message)==null?void 0:c.toLowerCase().includes("login successful");p.status===200&&g?(localStorage.setItem("isLoggedIn","true"),s(!0)):alert("Login failed: "+p.data.message)}catch(p){console.error("Login error:",((d=p.response)==null?void 0:d.data)||p.message),alert("Something went wrong: "+(((h=(f=p.response)==null?void 0:f.data)==null?void 0:h.message)||p.message))}},a=()=>{localStorage.removeItem("isLoggedIn"),s(!1)};return H.jsx("div",{className:"dashboard-container",children:i?H.jsxs("div",{className:"dashboard-content",children:[H.jsx("h1",{children:"Welcome to the Dashboard"}),H.jsx("p",{children:"This is your main content area."}),H.jsx("button",{onClick:a,className:"logout-btn",children:"Logout"})]}):H.jsxs("form",{className:"login-form",onSubmit:o,children:[H.jsx("h2",{children:"Login"}),H.jsx("input",{type:"text",placeholder:"Username",value:n,onChange:u=>e(u.target.value),required:!0}),H.jsx("input",{type:"password",placeholder:"Password",value:t,onChange:u=>r(u.target.value),required:!0}),H.jsx("button",{type:"submit",children:"Login"})]})})},sG=()=>{const[n,e]=X.useState([]),[t,r]=X.useState(null),[i,s]=X.useState({id:"",name:"",department:"",status:""});X.useEffect(()=>{o()},[]);const o=()=>{je.post("http://52.66.236.1:8000/get_all_employees").then(f=>{e(f.data.employees)}).catch(f=>{console.error("Failed to fetch employees",f)})},a=f=>{r(f.id),s({...f})},u=()=>{r(null),s({id:"",name:"",department:"",status:""})},l=async()=>{try{const{id:f,name:h,department:p,status:g}=i,m=`http://52.66.236.1:8000/update_employee_status?emp_id=${f}&name=${encodeURIComponent(h)}&department=${encodeURIComponent(p)}&status=${encodeURIComponent(g||"")}`;await je.post(m),alert("Details updated successfully"),r(null),s({id:"",name:"",department:"",status:""}),o()}catch(f){console.error("Failed to update employee",f),alert("Something went wrong while updating: "+f.message)}},c=(f,h)=>{s(p=>({...p,[f]:h}))},d=async f=>{if(window.confirm("Are you sure you want to delete this employee?"))try{await je.post(`http://52.66.236.1:8000/delete_employee?emp_id=${f}`),alert("Employee deleted successfully"),o()}catch(h){console.error("Failed to delete employee",h),alert("Something went wrong while deleting: "+h.message)}};return H.jsxs("div",{style:{padding:"20px"},children:[H.jsx("h1",{style:{fontSize:"24px",marginBottom:"20px"},children:"All Employees"}),H.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[H.jsx("thead",{children:H.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[H.jsx("th",{style:Ia,children:"ID"}),H.jsx("th",{style:Ia,children:"Name"}),H.jsx("th",{style:Ia,children:"Department"}),H.jsx("th",{style:Ia,children:"Status"}),H.jsx("th",{style:Ia,children:"Actions"})]})}),H.jsx("tbody",{children:n.map(f=>H.jsxs("tr",{children:[H.jsx("td",{style:Ra,children:f.id}),H.jsx("td",{style:Ra,children:t===f.id?H.jsx("input",{value:i.name,onChange:h=>c("name",h.target.value)}):f.name}),H.jsx("td",{style:Ra,children:t===f.id?H.jsx("input",{value:i.department,onChange:h=>c("department",h.target.value)}):f.department}),H.jsx("td",{style:Ra,children:t===f.id?H.jsx("input",{value:i.status||"",onChange:h=>c("status",h.target.value)}):f.status||"Not Assigned"}),H.jsx("td",{style:Ra,children:t===f.id?H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:l,style:eE,children:H.jsx(AS,{size:16})}),H.jsx("button",{onClick:u,style:tE,children:H.jsx(DS,{size:16})})]}):H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:()=>a(f),style:eE,children:H.jsx(kS,{size:16})}),H.jsx("button",{onClick:()=>d(f.id),style:tE,children:H.jsx(LS,{size:16})})]})})]},f.id))})]})]})},Ia={padding:"5px",border:"1px solid #ccc",textAlign:"left"},Ra={padding:"5px",border:"1px solid #ddd"},eE={marginRight:"8px",padding:"6px 10px",backgroundColor:"#e0e0ff",border:"1px solid #999",borderRadius:"4px",cursor:"pointer"},tE={padding:"6px 10px",backgroundColor:"#ffe0e0",border:"1px solid #999",borderRadius:"4px",cursor:"pointer"},oG=({collapsed:n,onToggle:e})=>H.jsxs(H.Fragment,{children:[H.jsxs("div",{className:`sidebar ${n?"collapsed":""}`,children:[H.jsx("button",{className:"toggle-btn",onClick:e,children:"✖"}),H.jsxs("ul",{children:[H.jsx("li",{children:H.jsx(jf,{to:"/dashboard",children:"Dashboard"})}),H.jsx("li",{children:H.jsx(jf,{to:"/employee",children:"Employees"})}),H.jsx("li",{children:H.jsx(jf,{to:"/visitors",children:"Visitors"})})]})]}),n&&H.jsx("button",{className:"open-btn",onClick:e,children:"☰"})]}),Kh=({children:n})=>{const[e,t]=X.useState(!1);return H.jsxs("div",{className:"dashboard-container",children:[H.jsx(oG,{collapsed:e,onToggle:()=>t(!e)}),H.jsx("div",{className:`admin-layout ${e?"full-width":"with-sidebar"}`,children:n})]})},aG=()=>{const[n,e]=X.useState([]),[t,r]=X.useState(null),[i,s]=X.useState({id:"",name:"",type:"",status:""});X.useEffect(()=>{o()},[]);const o=()=>{je.post("http://52.66.236.1:8000/get_all_visitors").then(f=>{e(f.data.visitors)}).catch(f=>{console.error("Failed to fetch visitors",f)})},a=f=>{r(f.id),s({...f})},u=()=>{r(null),s({id:"",name:"",type:"",status:""})},l=async()=>{try{const{id:f,name:h,type:p,status:g}=i,m=`http://52.66.236.1:8000/update_visitor_status?visitor_id=${encodeURIComponent(f)}&name=${encodeURIComponent(h)}&visitor_type=${encodeURIComponent(p)}&status=${encodeURIComponent(g||"")}`;await je.post(m),alert("Details updated successfully"),r(null),s({id:"",name:"",type:"",status:""}),o()}catch(f){console.error("Failed to update visitor",f),alert("Something went wrong while updating: "+f.message)}},c=(f,h)=>{s(p=>({...p,[f]:h}))},d=async f=>{if(window.confirm("Are you sure you want to delete this visitor?"))try{await je.post(`http://52.66.236.1:8000/delete_visitor?visitor_id=${f}`),alert("Visitor deleted successfully"),o()}catch(h){console.error("Failed to delete visitor",h),alert("Something went wrong while deleting: "+h.message)}};return H.jsxs("div",{style:{padding:"20px"},children:[H.jsx("h1",{style:{fontSize:"24px",marginBottom:"20px"},children:"All Visitors"}),H.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[H.jsx("thead",{children:H.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[H.jsx("th",{style:Ca,children:"ID"}),H.jsx("th",{style:Ca,children:"Name"}),H.jsx("th",{style:Ca,children:"Type"}),H.jsx("th",{style:Ca,children:"Status"}),H.jsx("th",{style:Ca,children:"Actions"})]})}),H.jsx("tbody",{children:n.map(f=>H.jsxs("tr",{children:[H.jsx("td",{style:Aa,children:f.id}),H.jsx("td",{style:Aa,children:t===f.id?H.jsx("input",{value:i.name,onChange:h=>c("name",h.target.value)}):f.name}),H.jsx("td",{style:Aa,children:t===f.id?H.jsx("input",{value:i.type,onChange:h=>c("type",h.target.value)}):f.type}),H.jsx("td",{style:Aa,children:t===f.id?H.jsx("input",{value:i.status||"",onChange:h=>c("status",h.target.value)}):f.status||"Not Assigned"}),H.jsx("td",{style:Aa,children:t===f.id?H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:l,style:nE,children:H.jsx(AS,{size:16})}),H.jsx("button",{onClick:u,style:rE,children:H.jsx(DS,{size:16})})]}):H.jsxs(H.Fragment,{children:[H.jsx("button",{onClick:()=>a(f),style:nE,children:H.jsx(kS,{size:16})}),H.jsx("button",{onClick:()=>d(f.id),style:rE,children:H.jsx(LS,{size:16})})]})})]},f.id))})]})]})},Ca={padding:"5px",border:"1px solid #ccc",textAlign:"left"},Aa={padding:"5px",border:"1px solid #ddd"},nE={marginRight:"8px",padding:"6px 10px",backgroundColor:"#e0e0ff",border:"1px solid #999",borderRadius:"4px",cursor:"pointer"},rE={padding:"6px 10px",backgroundColor:"#ffe0e0",border:"1px solid #999",borderRadius:"4px",cursor:"pointer"},iE=({children:n})=>localStorage.getItem("isLoggedIn")==="true"?n:H.jsx(d2,{to:"/dashboard"});function uG(){const[n,e]=X.useState(()=>{const t=localStorage.getItem("darkMode");return t?JSON.parse(t):!1});return X.useEffect(()=>{localStorage.setItem("darkMode",JSON.stringify(n)),n?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[n]),H.jsx(b2,{children:H.jsxs("div",{className:`min-h-screen ${n?"dark bg-gray-900":"bg-gray-50"} transition-colors duration-200`,children:[H.jsx("nav",{className:`${n?"bg-gray-800":"bg-gray-100"} shadow-lg`,children:H.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:H.jsxs("div",{className:"flex justify-between h-16",children:[H.jsxs("div",{className:"flex space-x-8",children:[H.jsxs(tc,{to:"/",className:`flex items-center px-3 py-2 ${n?"text-gray-200 hover:text-blue-400":"text-gray-700 hover:text-blue-600"}`,children:[H.jsx(P2,{className:"w-5 h-5 mr-2"}),"Attendance"]}),H.jsx(tc,{to:"/register",className:`flex items-center px-3 py-2 ${n?"text-gray-200 hover:text-blue-400":"text-gray-700 hover:text-blue-600"}`,children:"Registration"}),H.jsx(tc,{to:"/dashboard",className:`flex items-center px-3 py-2 ${n?"text-gray-200 hover:text-blue-400":"text-gray-700 hover:text-blue-600"}`,children:"Dashboard"})]}),H.jsx("button",{onClick:()=>e(!n),className:`p-2 rounded-lg ${n?"text-yellow-300 hover:bg-gray-700":"text-gray-700 hover:bg-gray-200"}`,"aria-label":"Toggle dark mode",children:n?H.jsx(D2,{className:"w-5 h-5"}):H.jsx(A2,{className:"w-5 h-5"})})]})})}),H.jsx("main",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:H.jsxs(h2,{children:[H.jsx(so,{path:"/",element:H.jsx(rG,{darkMode:n})}),H.jsx(so,{path:"/register",element:H.jsx(PF,{darkMode:n})}),H.jsx(so,{path:"/dashboard",element:H.jsx(Kh,{children:H.jsx(iG,{})})}),H.jsx(so,{path:"/employee",element:H.jsx(iE,{children:H.jsx(Kh,{children:H.jsx(sG,{})})})}),H.jsx(so,{path:"/visitors",element:H.jsx(iE,{children:H.jsx(Kh,{children:H.jsx(aG,{})})})})]})})]})})}vS(document.getElementById("root")).render(H.jsx(X.StrictMode,{children:H.jsx(uG,{})}))});export default lG();
